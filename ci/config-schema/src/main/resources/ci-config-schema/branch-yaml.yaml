type: object
additionalProperties: true
required: [ "service" ]

properties:
  service:
    $ref: "#/definitions/abc_slug"
  ci:
    type: object
    additionalProperties: false
    properties:
      delegated-config:
        $ref: "#/definitions/path"
      autocheck:
        type: object
        additionalProperties: false
        properties:
          pool:
            $ref: "#/definitions/path"
          dirs:
            $ref: "#/definitions/path_list"
          strong:
            type: boolean
          large-autostart:
            oneOf:
              - type: array
                items:
                  $ref: "#/definitions/large_autostart"
              - $ref: "#/definitions/large_autostart"
              - type: array
                items:
                  $ref: "#/definitions/large_autostart_simple"
              - $ref: "#/definitions/large_autostart_simple"

definitions:
  allowed_names:
    type: string
    pattern: "^((\\w|-){0,63}[A-Za-z0-9])?$"

  path:
    type: string
    pattern: "^/{0,1}[a-zA-Z0-9_\\- .~,()\\[\\]\\{\\}+=#$@!]+(/{1}[a-zA-Z0-9_\\- .~,()\\[\\]\\{\\}+=#$@!]+)*$"

  target_path:
    type: string
    pattern: "^[a-zA-Z0-9_\\- .~,()\\[\\]\\{\\}+=#$@!]+(/{1}([a-zA-Z0-9_\\- .~,()\\[\\]\\{\\}+=#$@!]+|\\*{1}))*$"

  abc_slug:
    type: string
    pattern: "^[a-z0-9_\\-.]*$"

  path_list:
    oneOf:
      - type: array
        items:
          $ref: "#/definitions/path"
      - $ref: "#/definitions/path"

  large_tests_toolchains:
    type: string
    enum:
      - "clang8-darwin-x86_64-maps-mobile"
      - "clang8-ios-x86_64-maps-mobile"
      - "default-android-i686-maps-mobile"
      - "default-android-x86_64-maps-mobile"
      - "default-darwin-x86_64-maps-mobile"
      - "default-darwin-x86_64-release"
      - "default-ios-x86_64-maps-mobile"
      - "default-linux-x86_64-release"
      - "default-linux-x86_64-release-asan"
      - "default-linux-x86_64-release-fuzzing"
      - "default-linux-x86_64-release-jdk15"
      - "default-linux-x86_64-release-jdk16"
      - "default-linux-x86_64-release-msan"
      - "default-linux-x86_64-release-musl"
      - "default-linux-x86_64-release-ubsan"
      - "default-linux-x86_64-relwithdebinfo"
      - "default-linux-x86_64-system-python-27"
      - "default-linux-x86_64-system-python-35"
      - "default-linux-x86_64-system-python-36"
      - "default-win-x86_64-debug"
      - "local-ios-x86_64"

  large_autostart:
    type: object
    required: [ "target" ]
    properties:
      target:
        $ref: "#/definitions/target_path"
      toolchains:
        oneOf:
          - type: array
            items:
              $ref: "#/definitions/large_tests_toolchains"
          - $ref: "#/definitions/large_tests_toolchains"

  large_autostart_simple:
    type: string
    format: uri
