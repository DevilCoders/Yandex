annotations:
  stagectl_epoch: 861
  stagectl_vcs:
    svn_branch: cad82ad57cd64de3c0a29692323b4cb6999083ef
    svn_revision: 9559750
    svn_tag: ''
labels:
  deploy:
    disabled_clusters:
    - man
  deploy_engine: env_controller
  du_patchers_target_revision:
    clickphite: 11
    logshatter: 11
  du_sidecar_target_revision:
    clickphite:
      logbrokerToolsLayer: 2739742779
      podBin: 3006211268
    logshatter:
      logbrokerToolsLayer: 2739742779
      podBin: 3152642956
  notifications_last_timestamp: 1655463344485796000
  tags:
  - stable
  - logshatter
  - health
meta:
  account_id: abc:service:7838
  acl:
  - action: allow
    permissions:
    - read
    - write
    - create
    - ssh_access
    - root_ssh_access
    - read_secrets
    subjects:
    - robot-drug-deploy
  id: ci-health-stable
  inherit_acl: true
  project_id: ci
spec:
  deploy_unit_settings:
    clickphite:
      alerting:
        notification_channels:
          ERROR: ci-common-stable
        state: enabled
    logshatter:
      alerting:
        notification_channels:
          ERROR: ci-common-stable
        state: enabled
  deploy_units:
    clickphite:
      endpoint_sets:
      - port: 80
      logbroker_tools_sandbox_info:
        revision: 2739742779
      multi_cluster_replica_set:
        replica_set:
          clusters:
          - cluster: iva
            spec:
              replica_count: 1
          - cluster: myt
            spec:
              replica_count: 1
          deployment_strategy:
            max_unavailable: 1
          pod_template_spec:
            spec:
              disk_volume_requests:
              - id: disk-0
                labels:
                  used_by_infra: true
                quota_policy:
                  bandwidth_guarantee: 26214400
                  bandwidth_limit: 26214400
                  capacity: 53687091200
                storage_class: ssd
              pod_agent_payload:
                spec:
                  boxes:
                  - id: clickphite
                    rootfs:
                      layer_refs:
                      - linux
                      - simple_http_server
                      - clickphite-app
                      - config
                    static_resources:
                    - mount_point: clickphite/properties.d
                      resource_ref: secrets
                    - mount_point: clickphite/jdk
                      resource_ref: jdk11
                    volumes:
                    - mode: read_write
                      mount_point: /logs
                      volume_ref: logs
                  mutable_workloads:
                  - workload_ref: clickphite
                  resources:
                    layers:
                    - checksum: 'EMPTY:'
                      id: simple_http_server
                      url: sbr:755375039
                    - checksum: 'EMPTY:'
                      id: linux
                      url: sbr:2527306889
                    - checksum: 'EMPTY:'
                      id: clickphite-app
                      url: sbr:2626030278
                    - checksum: MD5:bcddb9146738b71c79c2cccd2ff6f22a
                      id: config
                      meta:
                        sandbox_resource:
                          attributes:
                            backup_task: 'true'
                            branch: trunk
                            build_type: release
                            package_path: ci/internal/infra/health/package.json
                            platform: Linux-4.19.183-42.2mofed-x86_64-with-Ubuntu-12.04-precise
                            resource_name: ci-health
                            resource_version: e2ee9ae724e39c27c55a0909e35327a390e2cb48
                            svn_path: arcadia-arc:/#e2ee9ae724e39c27c55a0909e35327a390e2cb48
                            svn_revision: '9600972'
                            ttl: '30'
                          resource_id: '3221663929'
                          resource_type: CI_HEALTH_CONFIG
                          task_id: '1345762615'
                          task_type: YA_PACKAGE_2
                      url: sbr:3221663929
                    static_resources:
                    - files:
                        files:
                        - file_name: 70_secrets.properties
                          multi_secret_data:
                            format: java
                            secret_alias: ci-health-stable
                      id: secrets
                      verification:
                        check_period_ms: 180000
                        checksum: 'EMPTY:'
                    - id: jdk11
                      url: sbr:1903522585
                      verification:
                        check_period_ms: 180000
                        checksum: 'EMPTY:'
                  volumes:
                  - id: logs
                  workloads:
                  - box_ref: clickphite
                    id: clickphite
                    init:
                    - command_line: ln -s /logs/ /clickphite/log
                    - command_line: tar -xzf /clickphite/jdk/openjdk_*
                    readiness_check:
                      http_get:
                        any: true
                        path: /ping
                        port: 32142
                    start:
                      command_line: /clickphite/bin/clickphite-start.sh --environment=stable
                    transmit_logs: true
              resource_requests:
                anonymous_memory_limit: 8589934592
                memory_guarantee: 10737418240
                memory_limit: 10737418240
                network_bandwidth_guarantee: 10485760
                network_bandwidth_limit: 5242880
                vcpu_guarantee: 2000
                vcpu_limit: 2000
              secret_refs:
                ci-health-stable:
                  secret_id: sec-01fpb4n1ccggaax6514khx7bvr
                  secret_version: ver-01fpwann6egyvgy0jn2p01mwd3
      network_defaults:
        network_id: _CINETS_
      patchers_revision: 11
      pod_agent_sandbox_info:
        revision: 3006211268
      revision: 55
    logshatter:
      endpoint_sets:
      - port: 80
      logbroker_tools_sandbox_info:
        revision: 2739742779
      multi_cluster_replica_set:
        replica_set:
          clusters:
          - cluster: iva
            spec:
              replica_count: 1
          - cluster: myt
            spec:
              replica_count: 1
          deployment_strategy:
            max_unavailable: 1
          pod_template_spec:
            spec:
              disk_volume_requests:
              - id: disk-0
                labels:
                  used_by_infra: true
                quota_policy:
                  bandwidth_guarantee: 26214400
                  bandwidth_limit: 26214400
                  capacity: 53687091200
                storage_class: ssd
              pod_agent_payload:
                spec:
                  boxes:
                  - cgroup_fs_mount_mode: ro
                    id: logshatter
                    rootfs:
                      layer_refs:
                      - linux
                      - logshatter-app
                      - config
                    static_resources:
                    - mount_point: logshatter/properties.d
                      resource_ref: secrets
                    - mount_point: logshatter/jdk
                      resource_ref: jdk11
                    volumes:
                    - mode: read_write
                      mount_point: /logs
                      volume_ref: logs
                  mutable_workloads:
                  - workload_ref: logshatter
                  resources:
                    layers:
                    - checksum: 'EMPTY:'
                      id: linux
                      url: sbr:2527306889
                    - checksum: 'EMPTY:'
                      id: logshatter-app
                      url: sbr:2626030114
                    - checksum: MD5:bcddb9146738b71c79c2cccd2ff6f22a
                      id: config
                      meta:
                        sandbox_resource:
                          attributes:
                            backup_task: 'true'
                            branch: trunk
                            build_type: release
                            package_path: ci/internal/infra/health/package.json
                            platform: Linux-4.19.183-42.2mofed-x86_64-with-Ubuntu-12.04-precise
                            resource_name: ci-health
                            resource_version: e2ee9ae724e39c27c55a0909e35327a390e2cb48
                            svn_path: arcadia-arc:/#e2ee9ae724e39c27c55a0909e35327a390e2cb48
                            svn_revision: '9600972'
                            ttl: '30'
                          resource_id: '3221663929'
                          resource_type: CI_HEALTH_CONFIG
                          task_id: '1345762615'
                          task_type: YA_PACKAGE_2
                      url: sbr:3221663929
                    static_resources:
                    - access_permissions: '660'
                      files:
                        files:
                        - file_name: 70_secrets.properties
                          multi_secret_data:
                            format: java
                            secret_alias: ci-health-stable
                      id: secrets
                      verification:
                        check_period_ms: 180000
                        checksum: 'EMPTY:'
                    - id: jdk11
                      url: sbr:1903522585
                      verification:
                        check_period_ms: 180000
                        checksum: 'EMPTY:'
                  volumes:
                  - id: logs
                  workloads:
                  - box_ref: logshatter
                    id: logshatter
                    init:
                    - command_line: ln -s /logs/ /logshatter/log
                    - command_line: tar -xzf /logshatter/jdk/openjdk_*
                    readiness_check:
                      http_get:
                        any: true
                        path: /ping
                        port: 32184
                    start:
                      command_line: /logshatter/bin/logshatter-start.sh --environment=stable
                    transmit_logs: true
              resource_requests:
                anonymous_memory_limit: 10737418240
                memory_guarantee: 12884901888
                memory_limit: 12884901888
                network_bandwidth_guarantee: 12582912
                network_bandwidth_limit: 10485760
                vcpu_guarantee: 2000
                vcpu_limit: 2000
              secret_refs:
                ci-health-stable:
                  secret_id: sec-01fpb4n1ccggaax6514khx7bvr
                  secret_version: ver-01fpwann6egyvgy0jn2p01mwd3
      network_defaults:
        network_id: _CINETS_
      patchers_revision: 11
      pod_agent_sandbox_info:
        revision: 3152642956
      revision: 62
  revision: 99
  revision_info: {}

