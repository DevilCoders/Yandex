status:
  port: 16301

storages:
  - name: main-storage
    plugin: fs
    config:
      directory: /logs/agent-metrics
      max_partition_size: 1gb

channels:
  - name: main-metrics-channel
    channel:
      pipe:
        - storage_ref:
            name: main-storage
      output:
        plugin: metrics_pull
        id: metrics-pull-output
        config:
          port: 9667
          host: '::'
          max_memory_usage: 300mb

routes:
  - input:
      plugin: linux_metrics
      config:
        resources:
          cpu: advanced
          memory: advanced
          network: basic
          storage: advanced
          io: basic
          kernel: basic
        poll_period: 15s
        project: ci
        service: pull_metrics
    channel:
      channel_ref:
        name: main-metrics-channel
  - input:
      plugin: metrics_pull
      config:
        url: http://localhost:31337/metrics
        http_error_log_priority: WARNING
        format:
          prometheus: {}
        poll_period: 15s
        project: ci
        service: pull_metrics
    channel:
      channel_ref:
        name: main-metrics-channel
