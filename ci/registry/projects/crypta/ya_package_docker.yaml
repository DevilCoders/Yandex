title: Build Docker image
description: Build Docker image with ya package
maintainers: ci

sandbox-task:
  name: YA_PACKAGE_2
  required-parameters:
    - build_system
    - build_type
    - checkout_arcadia_from_url
    - package_type
    - publish_package
    - resource_type
    - run_tests

parameters:
  # build type
  build_system: semi_distbuild
  build_type: relwithdebinfo
  sandbox_container: 773239891  # xenial?

  # arcadia
  checkout_arcadia_from_url: "arcadia-arc:/#${context.target_revision.hash}"
  arc_secret: "${context.secret_uid}#ci.token"
  ya_yt_token_yav_secret: "${context.secret_uid}#ci.token"

  # docker
  package_type: docker
  docker_image_repository: crypta
  docker_user: robot-crypta
  docker_token_vault_name: CRYPTA_DOCKER_REGISTRY_TOKEN
  docker_push_image: true
  resource_type: CRYPTA_DOCKER

  # compatibility
  publish_package: true # makes sense only for deb (?) but required
  run_tests: true

  # Запускаем как бинарную задачу по умолчанию
  binary_executor_release_type: stable

  release_to_ya_deploy: true

requirements:
  sandbox:
    priority:
      class: SERVICE
      subclass: LOW

runtime:
  sandbox:
    notifications:
      - transport: email
        recipients:
          - crypta-ci
        statuses:
          - FAILURE
          - EXCEPTION
          - TIMEOUT