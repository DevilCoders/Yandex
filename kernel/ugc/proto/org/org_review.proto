syntax = "proto3";

package NUgc.NSchema.NOrgs;

import "kernel/ugc/proto/common/author.proto";
import "kernel/ugc/proto/common/moderation.proto";
import "kernel/ugc/proto/common/reaction.proto";
import "kernel/ugc/proto/org/org_photo.proto";
import "kernel/ugc/proto/org/org_business_comment.proto";
import "google/protobuf/timestamp.proto";

message TKeyPhrase {
    message TFragment {
        int32 Position = 1;    // start position of fragment
        int32 Size = 2;        // size of fragment
        string Text = 3;        // fragment text
    }
    string KeyPhrase = 1;      // key phrase
    repeated TFragment Fragment = 2;    // fragment in text
}

// view for user and digest rpc
message TOrgReview {
    enum EType {
        YANDEX = 0;
        PARTNER = 1;
    }

    EType Type = 1;

    // server content, updates only on text changed
    string ReviewId = 2;
    google.protobuf.Timestamp UpdatedTime = 3;

    // server content, empty is anonymous
    TAuthor Author = 4;

    // user content
    bool IsAnonymous = 6;

    // user content
    string Text = 7;

    // server content, generated short text
    string Snippet = 8;

    // robot content, in offline
    TReviewModeration Moderation = 9;

    // user content, rating 1-5
    uint32 Rating = 10;

    // robot content, aggregation in offline
    uint32 LikeCount = 11;
    uint32 DislikeCount = 12;
    uint32 SkipCount = 16;

    // business owner content
    TBusinessComment BusinessComment = 13;

    // user reaction on this review
    TReviewReaction.EType UserReaction = 14;

    // user content
    repeated TOrgPhoto Photos = 15;

    // org permalink from sprav for review object
    string OrgId = 17;

    // key phrase mark
    repeated TKeyPhrase KeyPhrases = 18;

    uint32 CommentCount = 19;

    // user content
    bool IsPublicRating = 20;
    
    // what part of review to highlight with bold about aspect
    repeated TBold Bold = 21;
 
    // what part of review to cut about aspect
    TQuote Quote = 22;
}

// stored inside user org
message TOrgReviewData {
    string ReviewId = 1;
    google.protobuf.Timestamp CreatedTime = 2;
    google.protobuf.Timestamp UpdatedTime = 3;

    bool IsAnonymous = 4;
    string Text = 5;
    TReviewModerationData Moderation = 6;
    uint32 Rating = 7;
    repeated TOrgReviewPhotoData Photos = 9;
}

message TOrgReviewBatch {
    repeated TOrgReview Reviews = 1;
    uint32 Count = 2;
}

message TBold {
    uint64 Position = 1;    // start position of fragment
    uint64 Size = 2;        // size of fragment
}

message TQuote {
    uint64 Position = 1;       // start position of quote
    uint64 Size = 2;           // size of quote
    bool IsSentenceStart = 3;  // do append "..." at the beginning of the quote
    bool IsSentenceEnd = 4;    // do append "..." at the end of the quote
}