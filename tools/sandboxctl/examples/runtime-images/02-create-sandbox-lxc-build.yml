---
apiVersion: '1'
kind: Task
params:
  arch: linux
  custom_fields:
    custom_attrs:
      ttl: inf
      name: LXC_SANDBOX_BIONIC_BUILD
    custom_image: true
    custom_repos: ''
    install_common: true
    resource_description: LXC_SANDBOX_BIONIC_BUILD
    resource_type: LXC_CONTAINER
    set_default: false
    test_result_lxc: false
    ubuntu_release: bionic
    unwanted_packages: juggler-client ^config-juggler
    custom_packages:
      autoconf
      automake
      bash
      bc
      bison
      build-essential
      ca-certificates
      curl
      git
      gettext
      flex
      libaio-dev
      libelf-dev
      libncurses-dev
      libssl-dev
      libtool
      libtool-bin
      python-pip
      pkg-config
      software-properties-common
      tar
      uuid-dev
      xz-utils
      pigz
      xjobs
      zstd

    custom_script: |
      # TODO remove inline ad-hoc script once https://a.yandex-team.ru/review/618817/details commited'
      # echo 'svn export  svn+ssh://arcadia.yandex.ru/arc/trunk/arcadia/tools/sandboxctl/examples/runtime-images/lxc-with-docker'
      ###############
      #apt-get install yandex-internal-root-ca
      #apt-get --yes purge yandex-search-common-apt
      #apt-get update
      unlink /bin/gzip
      ln /usr/bin/pigz  /bin/gzip
      pip install --upgrade pip setuptools
      hash pip
  description: build sandbox lxc with generic build environment
  priority: SERVICE:NORMAL
  type: SANDBOX_LXC_IMAGE
