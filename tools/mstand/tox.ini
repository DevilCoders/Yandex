# vim: et sw=4

[tox]
envlist = small,rnd,fat
skipsdist = true
parallel_show_output = true

[testenv]
basepython = python2.7
sitepackages = false
install_command = pip install -i https://pypi.yandex-team.ru/simple --no-cache-dir {opts} {packages}
skip_install = true
envdir = {toxworkdir}/virtualenv
whitelist_externals =
    /bin/bash
setenv =
    PYTHONPATH = {env:PYTHONPATH:}{:}../../quality/yaqlib
deps =
    -rrequirements.txt
    -rrequirements-yandex.txt

    pytest-xdist

    # TODO: fix pep8 and flakes errors in project
    # pytest-pep8
    # pytest-flakes

    # bug with our pypi
    tornado<4

commands_pre =
    bash -c '[ -d ../../quality/yaqlib ] || (echo "missing directory arcadia/quality/yaqlib; please checkout it" && exit 1)'
    bash -c 'test -f libra.so || bash package/download-external-binaries.sh'

_test_command = {envpython} -m pytest --verbosity 0 -n4

[testenv:small]
commands =
    {[testenv]_test_command} -c pytest.ini {posargs}

[testenv:rnd]
commands =
    {[testenv]_test_command} -c pytest_rnd.ini {posargs}

[testenv:fat]
commands =
    {[testenv]_test_command} -c pytest_fat.ini {posargs}

[testenv:yt]
commands =
    {[testenv]_test_command} -c pytest_yt.ini {posargs}
