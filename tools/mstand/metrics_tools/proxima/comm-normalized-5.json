{
  "confidences": [
    {
      "condition": "GREATER",
      "name": "dup-plag-counts-judged-5",
      "regional": null,
      "requirements": [],
      "threshold": 0.95,
      "yandex": false
    },
    {
      "condition": "GREATER",
      "name": "ecom-assortment-judged-5",
      "regional": null,
      "requirements": [],
      "threshold": 0.3,
      "yandex": false
    },
    {
      "condition": "GREATER",
      "name": "ecom-assortment-judged-normed-5",
      "regional": null,
      "requirements": [],
      "threshold": 0.7,
      "yandex": false
    },
    {
      "condition": "GREATER",
      "name": "ecom-commercial-count-5",
      "regional": null,
      "requirements": [],
      "threshold": 1.0,
      "yandex": false
    },
    {
      "condition": "GREATER",
      "name": "ecom-host-quality-judged-5",
      "regional": null,
      "requirements": [],
      "threshold": 0.3,
      "yandex": false
    },
    {
      "condition": "GREATER",
      "name": "ecom-host-quality-judged-normed-5",
      "regional": null,
      "requirements": [],
      "threshold": 0.95,
      "yandex": false
    },
    {
      "condition": "GREATER",
      "name": "ecom-kernel-vers2-judged-5",
      "regional": null,
      "requirements": [],
      "threshold": 0.9,
      "yandex": false
    },
    {
      "condition": "GREATER",
      "name": "ecom-prices-judged-5",
      "regional": null,
      "requirements": [],
      "threshold": 0.3,
      "yandex": false
    },
    {
      "condition": "GREATER",
      "name": "ecom-prices-judged-normed-5",
      "regional": null,
      "requirements": [],
      "threshold": 0.7,
      "yandex": false
    },
    {
      "condition": "SMALLER",
      "name": "empty-serp",
      "regional": null,
      "requirements": [],
      "threshold": 0.01,
      "yandex": false
    },
    {
      "condition": "SMALLER",
      "name": "empty-serp",
      "regional": null,
      "requirements": [],
      "threshold": 0.001,
      "yandex": true
    },
    {
      "condition": "GREATER",
      "name": "judged-page-marketability-eval-5",
      "regional": null,
      "requirements": [],
      "threshold": 0.995,
      "yandex": false
    },
    {
      "condition": "GREATER",
      "name": "judged-sinsig-kc-no-turbo-judgement-values-5",
      "regional": null,
      "requirements": [],
      "threshold": 0.999,
      "yandex": false
    },
    {
      "condition": "SMALLER",
      "name": "serp-failed",
      "regional": null,
      "requirements": [],
      "threshold": 0.003,
      "yandex": false
    }
  ],
  "configuration": {
    "className": "AlbinKessel",
    "kwargs": {
      "aggregate_script": "sum([result / (index + 1) for index, result in enumerate([x for x, y in zip(D.all_custom_formulas['comm'][:5], D.all_custom_formulas['is_actual_seller'][:5]) if y])]) / (1e-5 + sum([result / (index + 1) for index, result in enumerate([x for x, y in zip(D.all_custom_formulas['comm_sinsig_normalize'][:5], D.all_custom_formulas['is_actual_seller'][:5]) if y])]))",
      "custom_formulas": {
        "assortment": "S.assortment_share - 0.2 if 'assortment_share' in S else 0",
        "ecom_host_quality": "S.host_comm_product - 2.5 if 'host_comm_product' in S else 0",
        "ecomm_kernel_ugc": "S.ppEcom_kernel - 0.5 if 'ppEcom_kernel' in S else 0",
        "fine_super_dup": "0.1 ** S.super_dup_fine",
        "fine_ungrouping": "0.9 ** S.ungrouping_count_no_turbo if int(serp_data.get('query_param.need_certain_host', 0)) else 0.7 ** S.ungrouping_count_no_turbo",
        "is_actual_seller": "float(S.f_type_plus_service == 1)",
        "is_highly_commercial": "float(serp_data.get('query_param.pay_detector', 0.6)) > 0.9",
        "page_marketability": "avg(L.page_marketability_eval_results)",
        "price": "1 - S.price_percentile * 0.01 - 0.4 if 'price_percentile' in S else 0",
        "sinsig": "avg(L.sinsig_kc_no_turbo_judgement_values) + 1.2 * avg([max(0, slider) / 100.0 for slider in L.sinsig_kc_no_turbo_slider_values])"
      },
      "custom_formulas_after_precompute": {
        "comm": "(0.09 * D.custom_formulas['page_marketability'] * D.custom_formulas['is_actual_seller'] * D.custom_formulas['fine_super_dup'] + 0.035 / 0.3 * D.custom_formulas['ecomm_kernel_ugc'] + 0.15 * (0.62 * D.custom_formulas['price'] + 0.38 * D.custom_formulas['assortment']) + 0.065 / 0.25 * D.custom_formulas['ecom_host_quality'] - 0.09 * D.custom_formulas['is_actual_seller']) * D.custom_formulas['fine_ungrouping'] * (0.5 + 0.5 * D.custom_formulas['is_highly_commercial']) * (0.05 * (D.custom_formulas['sinsig'] <= 0.25) * D.custom_formulas['sinsig'] / 0.25 + 0.7 * (0.25 < D.custom_formulas['sinsig'] <= 0.55) + 1. * (0.55 < D.custom_formulas['sinsig'] <= 0.85) + 1.2 * (0.85 < D.custom_formulas['sinsig']))",
        "comm_sinsig_normalize": "(0.05 * (D.custom_formulas['sinsig'] <= 0.25) * D.custom_formulas['sinsig'] / 0.25 + 0.7 * (0.25 < D.custom_formulas['sinsig'] <= 0.55) + 1. * (0.55 < D.custom_formulas['sinsig'] <= 0.85) + 1.2 * (0.85 < D.custom_formulas['sinsig']))"
      },
      "depth": 5,
      "judged": false,
      "label_script": "1.0 * D.custom_formulas['comm'] * D.custom_formulas['is_actual_seller']",
      "max_depth": 10,
      "scale_maps": {
        "page_marketability_eval_results": {
          "MANY_PRODUCTS": 1,
          "NO_PRODUCTS": -1,
          "ONE_PRODUCT": 0.5
        },
        "sinsig_kc_no_turbo_judgement_values": {
          "404": 0,
          "IRREL": 0,
          "RELEVANCE_MINUS_BAD": 0.12,
          "RELEVANCE_MINUS_GOOD": 0.25,
          "SLIDER_GRADE": 0.25,
          "SUBVITAL": 1.3,
          "VITAL_BAD": 1,
          "VITAL_GOOD": 2,
          "__DEFAULT__": null
        }
      },
      "signals": [
        "ecom_assortment",
        "ecom_biz_kernel_enrichment2",
        "ecom_host_quality_enrichment",
        "ecom_prices_competitiveness",
        "page_marketability_eval_results",
        "sinsig_kc_no_turbo_judgement_values",
        "sinsig_kc_no_turbo_slider_values",
        "super_dup_fine"
      ]
    },
    "module": "albinkessel",
    "requirements": [
      "COMPONENT.judgements.ecom_assortment",
      "COMPONENT.judgements.ecom_biz_kernel_enrichment2",
      "COMPONENT.judgements.ecom_host_quality_enrichment",
      "COMPONENT.judgements.ecom_prices_competitiveness",
      "COMPONENT.judgements.page_marketability_eval_results",
      "COMPONENT.judgements.sinsig_kc_no_turbo_judgement_values",
      "COMPONENT.judgements.sinsig_kc_no_turbo_slider_values",
      "COMPONENT.judgements.super_dup_fine",
      "SERP.query_param.need_certain_host",
      "SERP.query_param.pay_detector"
    ],
    "revision": 7412792,
    "url": "svn+ssh://arcadia.yandex.ru/arc/trunk/arcadia/quality/mstand_metrics/offline_production/metrics"
  },
  "deprecated": false,
  "description": "comm part normalized\n\n1.0 * comm * is_actual_seller\n\nhttps://wiki.yandex-team.ru/JandeksPoisk/KachestvoPoiska/AnalyticsAndProductization/offline-metrics/Current-metrics-and-baskets/",
  "greaterBetter": true,
  "name": "comm-normalized-5",
  "owner": "robot-proxima",
  "style": null,
  "type": "mstand"
}