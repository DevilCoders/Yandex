# Juggler проверки YC-Billing

## Общая информация
Здесь лежат juggler проверки биллинга. В зависимости от папки лежат специальные проверки для
каждой инсталляции:

- common — общие проверки для всех инсталляций
- internal — проверки для внутреннего стенда и prestable стенда
- public — проверки для prod и preprod

В каждой папке есть `main.tf` - там проверки собираются и применяются,
`variables.tf` - передаваемые в модуль переменные. Остальные файлы описывают проверки.
`prod/prepod_special` описывают проверки, специфичные только для прода и препрода.

Более подробно про каждый модуль можно прочитать в `Readme.md` в папке выше.

## Как добавить, изменить проверку.
Проверки собраны по группам и генерируются вызовом `check`. Писать по модулю `check` на
проверку строго не рекомендуется. Это сделано, во избежании бесполезной копипасты.
Все хосты проверок, а так же параметризуемые параметры собраны в `locals` выше.
Если требуется добавить проверку, это можно сделать, просто добавив ее в список сервисов
выше.

## Известные особенности и проблемы.

- Проверки старого куба не были перенесены из ansible. Это сделано, поскольку они остались
только в internal-prod и оттуда уже будут вскоре убраны.

- Нотификации генерируются не через проверки, а через Notification Rules в Juggler.
Их можно найти/поменять в соответствующей вкладке по селектору.

- При деплое возможно такое, что `terragrunt plan` ошибок не выдал, а `apply` упал.
Такое происходит из-за особенностей cli, в таком случае рекомендуется скормить json
непосредственно cli, и посмотреть ошибку. Сами json-ы в зависимости от `Deploy Mark`
лежат в `../apply/.checks`
