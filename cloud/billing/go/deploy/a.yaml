service: yandexcloudbilling
title: YC Billing Deploy

arcanum:
  auto_merge:
    requirements:
      - system: arcanum
        type: approved
        override_policy: final
        data:
          min_approvers_count: 0
          ignore_self_ship: true
        filters:
          authors:
            included: ["robot"]

ci:
  secret: sec-01fkd2hqchtde5zanp0m4xt6y9

  runtime:
    sandbox-owner: YC-BILLING

  actions:
    build-tools-image:
      flow: tools-version-updated
      triggers:
        - on: commit
          into: trunk
          filters:
            - sub-paths: ["versions/tools.json"]

  flows:
    tools-version-updated:
      title: Run tools docker image build
      jobs:
        build:
          title: "Run TeamCity Billing/ARC: Build tools docker"
          task: projects/cloud/billing/aw_build
          input:
            build_type:
              id: Billing_ArcBuildToolsDocker
              properties:
                arc-branch: "${context.branch}"
                arc-commit: "${context.target_commit.revision.hash}"
