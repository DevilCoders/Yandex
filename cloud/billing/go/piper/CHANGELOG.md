## CHANGE LOG

### 2022-06-22 (kbespalov)

1. В методе Aggregate() для схемы `s3.api.v1` добавлен тег `handler: {Get Object|Head Object|etc}`. Он не является частью ключа агрегации (group by) и не влияет на резолвинг SKU, однако присутствует в тегах. Все такие кейсы мы должны учитывать и явно описывать в коде.

### 2022-06-21 (kbespalov)

1. Убрана настройка `jwt.use_team_audience: bool`, теперь необходимо явно указывать `jwt.audience: https://...` поскольку появилось больше двух вариантов
2. Добавлена поддержка загрузки файла ключей сервисных аккаунтов `jwt.key_file: /path/to/key.json` в формате `{id: <kms_key_id>, service_account_id: <sa_id>, private_key: <-----BEGIN PRIVATE KEY----->}`
3. В Docker образ piper добавлена установка сертификатов из пакетов ca-certificates  (публичные) & yandex-internal-certificates (внутренние), поскольку не на всех хостах, где запускается Docker есть непустой  `/etc/ssl`


### 2022-06-17 (kbespalov)

1. `aggregation` handler теперь поддерживает группировку метрик по двум схемам - `s3.api.v1` и `dns.requests.v1`
2. в качестве `usage.finish` и `usage.start` группы метрик выбирается `max(usage.finish)`. Для `dns` и `s3` запросов это ожидаемое поведение так как в самих метриках `start == finish`
3. теперь если во время группировки в тегах метрик обнаруживаются неизвестные с тз кода поля, метрики не подвергаются агрегации.  в противном случае агрегация могла бы привести к некорректному резволвингу SKU
