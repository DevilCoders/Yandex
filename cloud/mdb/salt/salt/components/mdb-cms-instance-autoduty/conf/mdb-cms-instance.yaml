mlock:
  host: {{ salt['dbaas.pillar']('data:mlock:address') }}

app:
  logging:
    level: debug
    file: "/var/log/mdb-cms/mdb-cms-instance-autoduty.log"
  instrumentation:
    addr: '[::1]:6060'
    shutdown_timeout: 1s
  service_account:
    id: {{ salt[ 'dbaas.pillar' ]('data:mdb_cms:service_account:id') }}
    key_id: {{ salt[ 'dbaas.pillar' ]('data:mdb_cms:service_account:key_id') }}
    private_key: {{ salt[ 'dbaas.pillar' ]('data:mdb_cms:service_account:private_key') | yaml_encode }}
  environment:
    {{ salt[ 'dbaas.pillar' ]('data:environment') | yaml(False) | indent(4) }}

health:
  host: {{ salt['dbaas.pillar']('data:health:address') }}

auto_duty:
  cmsdb:
    addrs: {{ salt['dbaas.pillar']('data:cmsdb:addrs') }}
    db: "cmsdb"
    user: "cms"
    password: {{ salt['dbaas.pillar']('data:cmsdb:password') }}
    sslmode: "verify-full"
    sslrootcert: "/opt/yandex/allCAs.pem"

  metadb:
    addrs: {{ salt['dbaas.pillar']('data:metadb:addrs') }}
    db: "dbaas_metadb"
    user: "cms"
    password: {{ salt['dbaas.pillar']('data:metadb:password') }}
    sslmode: "verify-full"
    sslrootcert: "/opt/yandex/allCAs.pem"

juggler:
  token: {{ salt['pillar.get']('data:juggler:oauth') }}

deploy:
  token: {{ salt['pillar.get']('data:deploy:token') }}
  uri: https://{{ salt['pillar.get']('data:deploy:api_host') }}

is_compute: {{ salt[ 'dbaas.pillar' ]('data:mdb_cms:is_compute', False) }}

{% set max_concurrent_tasks = salt['pillar.get']('data:mdb_cms:max_concurrent_tasks') %}
{% if max_concurrent_tasks %}
max_concurrent_tasks: {{ max_concurrent_tasks }}
{% endif %}

fqdn_suffixes:
  controlplane: {{ salt['pillar.get']('data:fqdn_suffixes:controlplane', '') }}
  unmanaged_dataplane: {{ salt['pillar.get']('data:fqdn_suffixes:unmanaged_dataplane', '') }}
  managed_dataplane: {{ salt['pillar.get']('data:fqdn_suffixes:managed_dataplane', '') }}

enabled_mw: {{ salt['pillar.get']('data:cms:enabled_mw') }}
