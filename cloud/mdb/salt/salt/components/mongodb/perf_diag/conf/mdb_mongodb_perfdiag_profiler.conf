{% set perfdiag_interval = salt.pillar.get('data:perf_diag:mongodb:interval', 5) | int %}
{% set perfdiag_user = salt.pillar.get('data:perf_diag:mongodb:user', 'monitor') %}
{
    "args": {
        "config": {
            "log_file": "/var/log/mdb-mongodb-perfdiag/mdb-mongodb-perfdiag-profiler.log",
            "profiler_log_file": "/var/log/mdb-mongodb-perfdiag/perfdiag-profiler.log",

            "cluster_id": "{{ salt.pillar.get('data:dbaas:cluster_id') }}",
            "shard": "{{ salt.pillar.get('data:dbaas:shard_name') }}",
            "all_databases": {{ salt.pillar.get('data:perf_diag:mongodb:use_all_databases', True) | json()}},
            "databases": {{ salt.pillar.get('data:perf_diag:mongodb:databases', []) | json() }},
            "exclude_databases": {{ salt.pillar.get('data:perf_diag:mongodb:exclude_databases', ["local", "config", "admin", "mdb_internal"]) | json() }},
            "mongodb_uri": "mongodb://{{ perfdiag_user }}:{{ mongodb.users[perfdiag_user].password }}@{{ mongodb.config.mongod.cli.host }}:{{ mongodb.config.mongod.net.port }}/?authSource=admin&appname=mdb_perfdiag_profiler_collector{{ mongodb.config.mongod.cli.ssl_uri_args }}"
        }
    },
    "id": "mdb_mongodb_perfdiag_profiler",
    "misfire_grace_time": {{ perfdiag_interval }},
    "module": "mdb_mongodb_perfdiag_profiler",
    "schedule": {
        "seconds": {{ perfdiag_interval }},
        "trigger": "interval"
    },
    "timeout": {{ perfdiag_interval + 50 }}
}
