{% for srv in mongodb.services_deployed %}
{% set config = mongodb.config.get(srv) %}

- topic: {{ salt.pillar.get('data:logship:topics:mongodb_logs') }}
  name: {{ config.systemLog.path }}
  pipe: /etc/pushclient/mongodb_log_parser.py -c {{ mongodb.cluster_id }} -o {{ srv }} 2>> /var/log/statbox/mongodb_parser.log
  send_sigusr1: true

{% if salt.mdb_mongodb.version().edition == 'enterprise' %}
- topic: {{ salt.pillar.get('data:logship:topics:mongodb_audit_logs') }}
  name: {{ config.auditLog.path }}
  pipe: /etc/pushclient/log_parser.py -c {{ mongodb.cluster_id }} -o {{ srv }} -i json -f json -d 'ts.$date' 2>> /var/log/statbox/mongodb_audit_parser.log
  send_sigusr1: true
{% endif %}

{% endfor %}
