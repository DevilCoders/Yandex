{% from "components/mdb-report/conf/map.jinja" import lb with context %}
{
    "args": {
        "config": {
            "log_file": "/var/log/dbaas-billing/offline-billing.log",
            "service_log_file": "/var/log/dbaas-billing/offline-service.log",
            "rotate_size": 10485760,
            "backup_count": 1,
            "lb_master_addr": "{{ lb.addr }}",
            "lb_master_port": {{ lb.port }},
            "lb_master_timeout": 1.0,
            "zk_timeout": 1.0,
            "zk_retries": {
                "max_tries": 6,
                "delay": 0.1,
                "backoff": 2,
                "max_jitter": 0.8,
                "max_delay": 60
            },
            "zk_lock_path": "/offline_hosts.lock",
            "zk_state_path": "/offline_hosts",
            "zk_hosts": "{{ salt['pillar.get']('data:mdb_report:zk_hosts') }}",
            "conn_string": "host={{ salt['pillar.get']('data:mdb_report:metadb_hosts') }} dbname=dbaas_metadb user=mdb_report password={{ salt['pillar.get']('data:config:pgusers:mdb_report:password') }} port=6432 sslmode=verify-full target_session_attrs=any",
            "billed_cluster_types": {{ salt['pillar.get']('data:mdb_report:billed_cluster_types', [
                'postgresql_cluster', 'clickhouse_cluster',
                'mongodb_cluster', 'redis_cluster', 'mysql_cluster',
                'sqlserver_cluster', 'kafka_cluster', 'elasticsearch_cluster',
                'greenplum_cluster',
            ]) | tojson }}
        }
    },
    "id": "offline_billing",
    "misfire_grace_time": 10,
    "module": "offline_billing",
    "schedule": {
        "seconds": 60,
        "trigger": "interval"
    },
    "timeout": 175
}
