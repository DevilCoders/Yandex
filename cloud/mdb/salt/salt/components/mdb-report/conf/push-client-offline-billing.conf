{% from "components/mdb-report/conf/map.jinja" import lb with context %}
files:
- topic: {{ salt['pillar.get']('data:mdb_report:offline_billing:topic') }}
  name: /var/log/dbaas-billing/offline-billing.log

logger:
  telemetry_interval: -1
  remote: 0
  level: 5
  mode: file
  file: '/var/log/statbox/pushclient-offline-billing.log'
  timeformat: '%d.%m.%Y-%H.%M.%S'

network:
  proto: pq
  master-addr: {{ lb.addr }}
  master-port: {{ lb.port }}
{% if salt['pillar.get']('data:mdb_report:offline_billing:use_cloud_logbroker') %}
  ssl:
    enabled: 1
  database: {{ salt['pillar.get']('data:yc_logbroker:database') }}
  iam: 1
  iam-key-file: /etc/pushclient/offline-billing.secret
  iam-endpoint: {{ salt['pillar.get']('data:iam:address') }}
{% elif salt['pillar.get']('data:mdb_report:offline_billing:tvm_client_id') %}
  tvm-client-id: {{ salt['pillar.get']('data:mdb_report:offline_billing:tvm_client_id') }}
  tvm-server-id: {{ salt['pillar.get']('data:mdb_report:offline_billing:tvm_server_id') }}
  tvm-secret-file: /etc/pushclient/offline-billing.secret
{% else %}
  ssl:
    enabled: 1
  oauth-secret-file: /etc/pushclient/offline-billing.secret
{% endif %}

watcher:
  state: /var/lib/push-client-offline-billing
