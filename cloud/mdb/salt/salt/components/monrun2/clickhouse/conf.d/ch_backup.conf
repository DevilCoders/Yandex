[ch_backup]
{% set MINUTE = 60 %}
{% set HOUR   = 60 * MINUTE %}
execution_interval={{ 1 * HOUR }}
execution_timeout={{ 5 * MINUTE }}
{% if salt.mdb_clickhouse.backups_enabled() %}
command=/usr/bin/ch-monitoring backup
{% else %}
command=/bin/echo '0;Backups disabled'
{% endif %}
type=backup
{% if salt.pillar.get('data:dbaas:vtype') == 'compute' and salt.pillar.get('data:dbaas:cluster_id') %}
send_for_host={{ salt.dbaas.managed_hostname() }}
{% endif %}
