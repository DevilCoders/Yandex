[ch_keeper_alive]
execution_interval=60
execution_timeout=30
{% if salt.mdb_clickhouse.has_separated_keeper() %}
command=/usr/local/yandex/monitoring/clickhouse_keeper.py alive
{% else %}
command=echo "0;No ClickHouse Keeper on host"
{% endif %}
type=clickhouse_keeper
{% if salt.pillar.get('data:dbaas:vtype') == 'compute' and salt.pillar.get('data:dbaas:cluster_id') %}
send_for_host={{ salt.dbaas.managed_hostname() }}
{% endif %}

{% if salt.mdb_clickhouse.has_separated_keeper() %}
[ch_keeper_avg_latency]
execution_interval=60
execution_timeout=30
command=/usr/local/yandex/monitoring/clickhouse_keeper.py avg_latency
type=clickhouse_keeper
{% if salt.pillar.get('data:dbaas:vtype') == 'compute' and salt.pillar.get('data:dbaas:cluster_id') %}
send_for_host={{ salt.dbaas.managed_hostname() }}
{% endif %}

[ch_keeper_min_latency]
execution_interval=60
execution_timeout=30
command=/usr/local/yandex/monitoring/clickhouse_keeper.py min_latency
type=clickhouse_keeper
{% if salt.pillar.get('data:dbaas:vtype') == 'compute' and salt.pillar.get('data:dbaas:cluster_id') %}
send_for_host={{ salt.dbaas.managed_hostname() }}
{% endif %}

[ch_keeper_max_latency]
execution_interval=60
execution_timeout=30
command=/usr/local/yandex/monitoring/clickhouse_keeper.py max_latency
type=clickhouse_keeper
{% if salt.pillar.get('data:dbaas:vtype') == 'compute' and salt.pillar.get('data:dbaas:cluster_id') %}
send_for_host={{ salt.dbaas.managed_hostname() }}
{% endif %}

[ch_keeper_queue]
execution_interval=60
execution_timeout=30
command=/usr/local/yandex/monitoring/clickhouse_keeper.py queue
type=clickhouse_keeper
{% if salt.pillar.get('data:dbaas:vtype') == 'compute' and salt.pillar.get('data:dbaas:cluster_id') %}
send_for_host={{ salt.dbaas.managed_hostname() }}
{% endif %}

[ch_keeper_descriptors]
execution_interval=60
execution_timeout=30
command=/usr/local/yandex/monitoring/clickhouse_keeper.py descriptors
type=clickhouse_keeper
{% if salt.pillar.get('data:dbaas:vtype') == 'compute' and salt.pillar.get('data:dbaas:cluster_id') %}
send_for_host={{ salt.dbaas.managed_hostname() }}
{% endif %}

[ch_keeper_election]
execution_interval=60
execution_timeout=30
command=/usr/local/yandex/monitoring/keeper_election.sh
type=clickhouse_keeper
{% if salt.pillar.get('data:dbaas:vtype') == 'compute' and salt.pillar.get('data:dbaas:cluster_id') %}
send_for_host={{ salt.dbaas.managed_hostname() }}
{% endif %}
{% endif %}
