{% set args = '' %}
{% if salt.pillar.get('data:service_account_id', None) != None %}
{%     set args = args + ' --present' %}
{% endif %}
[ch_s3_config]
execution_interval=60
execution_timeout=55
start_random_sleep=45
type=clickhouse
{% if salt.pillar.get('data:dbaas:vtype') == 'compute' %}
command=/usr/bin/ch-s3-credentials check {{ args }}
{% else %}
command=/bin/echo '0; OK'
{% endif %}
{% if salt.pillar.get('data:dbaas:vtype') == 'compute' and salt.pillar.get('data:dbaas:cluster_id') %}
send_for_host={{ salt.dbaas.managed_hostname() }}
{% endif %}
