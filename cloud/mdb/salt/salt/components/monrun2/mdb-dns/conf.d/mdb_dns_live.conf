{% set env = salt['pillar.get']('yandex:environment', 'dev') %}
{% if env == "prod" %}
{% set cluster_envs = {'qa': 10, 'prod': 1} %}
{% elif env == "compute-prod" %}
{% set cluster_envs = {'prod': 10, 'compute-prod': 1} %}
{% else %}
{% set cluster_envs = {'dev': 50, 'qa': 10} %}
{% endif %}
[mdb_dns_live]
execution_interval=30
execution_timeout=10
command=/usr/local/yandex/monitoring/mdb_dns_live.py --env={{ env }}
type=mdb-dns

{% for ctype in ('postgresql', 'mysql', 'clickhouse', 'redis', 'elasticsearch'): %}
{% for env, max_update_percent in cluster_envs.items(): %}
[mdb_dns_live_{{ ctype }}_{{ env }}]
execution_interval=30
execution_timeout=10
command=/usr/local/yandex/monitoring/mdb_dns_live.py --env={{ env }} --ctype={{ ctype }}_cluster --max-update-percent={{ max_update_percent }}
type=mdb-dns

{% endfor %}
{% endfor %}
