[pg_counters_queue]
execution_interval=600
execution_timeout=590
start_random_sleep=570
{% if salt['pillar.get']('data:monrun:pg_counters_queue:table', False) %}
{% set dbname = salt['pillar.get']('data:monrun:pg_counters_queue:dbname') %}
{% set schema = salt['pillar.get']('data:monrun:pg_counters_queue:schema') %}
{% set table = salt['pillar.get']('data:monrun:pg_counters_queue:table') %}
{% set warn = salt['pillar.get']('data:monrun:pg_counters_queue:warn') %}
{% set crit = salt['pillar.get']('data:monrun:pg_counters_queue:crit') %}
{% set warn_lag = salt['pillar.get']('data:monrun:pg_counters_queue:warn_lag') %}
{% set crit_lag = salt['pillar.get']('data:monrun:pg_counters_queue:crit_lag') %}
command=/usr/local/yandex/monitoring/pg_counters_queue.py{{' -d '+dbname|string if dbname else ''}}{{' -s '+schema|string if schema else ''}}{{' -t '+table|string if table else ''}}{{' -w '+warn|string if warn else ''}}{{' -c '+crit|string if crit else ''}}{{' --warn-lag '+warn_lag|string if warn_lag else ''}}{{' --crit-lag '+crit_lag|string if crit_lag else ''}} --warn-chunk-size {{ salt['pillar.get']('data:s3db:chunk_splitter:threshold', 100000) * 3 }}
{% else %}
command=echo "0;OK"
{% endif %}
type=postgres
{% if salt['pillar.get']('data:dbaas:vtype') == 'compute' and salt['pillar.get']('data:dbaas:cluster_id') %}
send_for_host={{ salt.dbaas.managed_hostname() }}
{% endif %}
