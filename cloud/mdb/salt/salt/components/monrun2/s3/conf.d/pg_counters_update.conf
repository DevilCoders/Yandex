[pg_counters_update]
execution_interval=600
execution_timeout=590
start_random_sleep=570
{% if salt['pillar.get']('data:monrun:pg_counters_update:dbname', False) %}
{% set dbname = salt['pillar.get']('data:monrun:pg_counters_update:dbname') %}
{% set warn = salt['pillar.get']('data:monrun:pg_counters_update:warn') %}
{% set crit = salt['pillar.get']('data:monrun:pg_counters_update:crit') %}
command=/usr/local/yandex/monitoring/pg_counters_update.py{{' -d '+dbname|string }}{{' -w '+warn|string if warn else ''}}{{' -c '+crit|string if crit else ''}}
{% else %}
command=echo "0;OK"
{% endif %}
type=postgres
{% if salt['pillar.get']('data:dbaas:vtype') == 'compute' and salt['pillar.get']('data:dbaas:cluster_id') %}
send_for_host={{ salt.dbaas.managed_hostname() }}
{% endif %}
