[backup_scheduler_last_run]
execution_interval=180
execution_timeout=30
start_random_sleep=10
command=echo "0;OK"
type=backup

[backup_worker_alive]
execution_interval=60
execution_timeout=55
command=/usr/bin/sudo /usr/local/yandex/monitoring/backup_worker_alive.sh
type=backup

{% for cluster_type in salt.pillar.get('data:mdb-backup:scheduler:schedule_config:cluster_type_rules').keys() %}
[backup_{{ cluster_type }}_scheduler_last_run]
execution_interval=180
execution_timeout=30
start_random_sleep=10
command=/usr/local/yandex/monitoring/backup_scheduler_last_run.sh {{ cluster_type }}
type=backup

[backup_{{ cluster_type }}_lost_running]
execution_interval=60
execution_timeout=55
command=/usr/bin/sudo /usr/local/yandex/monitoring/backup_queue_monitoring.py updated_at_before --interval=1800 --crit=1 --statuses='CREATING,DELETING' --cluster-type={{ cluster_type }} --report-format="Lost running tasks (interval {interval}): {count}. Example: {example}"
type=backup


[backup_{{ cluster_type }}_recent_pending]
execution_interval=60
execution_timeout=55
command=/usr/bin/sudo /usr/local/yandex/monitoring/backup_queue_monitoring.py delayed_until_before --interval=120 --crit=100 --warn=50 --statuses='PLANNED,OBSOLETE' --cluster-type={{ cluster_type }} --report-format="New pending tasks (interval {interval}): {count}. Example: {example}"
type=backup

[backup_{{ cluster_type }}_lost_pending]
execution_interval=60
execution_timeout=55
command=/usr/bin/sudo /usr/local/yandex/monitoring/backup_queue_monitoring.py delayed_until_before --interval=3600 --crit=1 --statuses='PLANNED,OBSOLETE' --cluster-type={{ cluster_type }} --report-format="Old pending tasks (interval {interval}): {count}. Example: {example}"
type=backup


[backup_{{ cluster_type }}_create_error_last_hours]
execution_interval=60
execution_timeout=55
command=/usr/bin/sudo /usr/local/yandex/monitoring/backup_queue_monitoring.py finished_at_after --interval=3600 --crit=100 --warn=10 --statuses='CREATE-ERROR' --cluster-type={{ cluster_type }} --report-format "Failed tasks (interval {interval}): {count}. Example: {example}"
type=backup

[backup_{{ cluster_type }}_delete_error_last_hours]
execution_interval=60
execution_timeout=55
command=/usr/bin/sudo /usr/local/yandex/monitoring/backup_queue_monitoring.py finished_at_after --interval=3600 --crit=100 --warn=10 --statuses='DELETE-ERROR' --cluster-type={{ cluster_type }} --report-format "Failed tasks (interval {interval}): {count}. Example: {example}"
type=backup


[backup_{{ cluster_type }}_create_error_last_days]
execution_interval=300
execution_timeout=55
command=/usr/bin/sudo /usr/local/yandex/monitoring/backup_queue_monitoring.py finished_at_after --interval=86400 --crit=50 --warn=10 --statuses='CREATE-ERROR' --cluster-type={{ cluster_type }} --report-format "Failed tasks (interval {interval}): {count}. Example: {example}"
type=backup

[backup_{{ cluster_type }}_delete_error_last_days]
execution_interval=300
execution_timeout=55
command=/usr/bin/sudo /usr/local/yandex/monitoring/backup_queue_monitoring.py finished_at_after --interval=86400 --crit=50 --warn=10 --statuses='DELETE-ERROR' --cluster-type={{ cluster_type }} --report-format "Failed tasks (interval {interval}): {count}. Example: {example}"
type=backup

{% endfor %}
