[walg_backup_check]
execution_interval=3600
execution_timeout=30
{% set recover_dir = salt['pillar.get']('data:walg-server:recover_dir', '/backups/recover') %}
{% set clusters = salt['pillar.get']('data:walg-server:clusters', []) | join(',') %}
{% set max_delay = salt['pillar.get']('data:monrun2:walg:delay', 172800) %}
{% if clusters %}
command=/usr/local/yandex/monitoring/walg_backup_check.py --clusters {{ clusters }} --recover-dir {{ recover_dir }} --delay {{ max_delay }}
{% else %}
command=echo '0;OK'
{% endif %}
type=backup
