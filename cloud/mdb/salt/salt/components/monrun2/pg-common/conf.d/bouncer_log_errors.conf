{% set yandex_env = salt['pillar.get']('yandex:environment', 'dev') %}
{% set bouncer = salt['pillar.get']('data:connection_pooler', 'odyssey') %}

[bouncer_log_errors]
execution_interval=120
execution_timeout=110
start_random_sleep=90

{% if bouncer != 'pgbouncer' %}

{% set cmd = '/usr/local/yandex/monitoring/bouncer_log_errors.py -w 100 -c 1000' %}

{% if salt['pillar.get']('data:monrun:bouncer_log_errors:exclude', '') != '' %}
{% set cmd = cmd + ' -e ' + salt['pillar.get']('data:monrun:bouncer_log_errors:exclude') %}
{% endif %}

command={{ cmd }}

{% else %}

{% set cmd = '/usr/local/yandex/monitoring/bouncer_log_errors.sh -w ' + salt['pillar.get']('data:monrun:bouncer_log_errors:warn', '100\ 100') + ' -c ' + salt['pillar.get']('data:monrun:bouncer_log_errors:crit', '1000\ 1000') %}
{% if salt['pillar.get']('data:monrun:bouncer_log_errors:exclude', '') != '' %}
{% set cmd = cmd + ' -e ' + salt['pillar.get']('data:monrun:bouncer_log_errors:exclude') %}
{% endif %}

command={{ cmd }}

{% endif %}

type=postgres
{% if salt['pillar.get']('data:dbaas:vtype') == 'compute' and salt['pillar.get']('data:dbaas:cluster_id') %}
send_for_host={{ salt.dbaas.managed_hostname() }}
{% endif %}
