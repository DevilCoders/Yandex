[superusers_check]
execution_interval=900
execution_timeout=55
start_random_sleep=45

{% set cmd = '/usr/local/yandex/monitoring/superusers_check.py' %}
{% set args = [] %}

{% for user, data in salt['pillar.get']('data:config:pgusers').items() %}
{% if data['superuser'] %}
{% do args.append(user) %}
{% endif %}
{% endfor %}

{% if args %}
{% set cmd = cmd + ' -su ' + ' '.join(args) %}
{% endif %}

command={{ cmd }}

type=postgres
{% if salt['pillar.get']('data:dbaas:vtype') == 'compute' and salt['pillar.get']('data:dbaas:cluster_id') %}
send_for_host={{ salt.dbaas.managed_hostname() }}
{% endif %}
