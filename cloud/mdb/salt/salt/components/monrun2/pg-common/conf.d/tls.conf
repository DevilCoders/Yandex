{%- from "components/postgres/pg.jinja" import pg with context -%}
{%- set default_tls_pairs = '5432:/etc/postgresql/ssl/server.crt,6432:/etc/' ~ pg.connection_pooler ~ '/ssl/server.crt' -%}
[tls]
execution_interval=3600
execution_timeout=290
start_random_sleep=270
command=/usr/local/yandex/monitoring/tls.py {{ salt['grains.get']('id') }} --pairs {{ salt['pillar.get']('data:monrun:tls:pairs', default_tls_pairs) }} -w {{ salt['pillar.get']('data:monrun:tls:warn', '30') }} -c {{ salt['pillar.get']('data:monrun:tls:crit', '14') }}
type=postgres
{% if salt['pillar.get']('data:dbaas:vtype') == 'compute' and salt['pillar.get']('data:dbaas:cluster_id') %}
send_for_host={{ salt.dbaas.managed_hostname() }}
{% endif %}
