{% set mongodb = salt.slsutil.renderer('salt://components/mongodb/defaults.py?saltenv=' ~ saltenv) %}
[tls]
execution_interval=3600
execution_timeout=290
start_random_sleep=270
{% if salt.pillar.get('data:mongodb:use_ssl', True) %}
{% set srv = mongodb.services_deployed[0] %}
{% set config = mongodb.config.get(srv) %}
{% set port = config.net.port %}
command=/usr/local/yandex/monitoring/tls.py {{ salt.grains.get('id') }} --pairs {{ salt.pillar.get('data:monrun:tls:pairs', port | string + ':/etc/mongodb/ssl/server.crt') }} -w {{ salt.pillar.get('data:monrun:tls:warn', '30') }} -c {{ salt.pillar.get('data:monrun:tls:crit', '14') }}
{% else %}
command=/bin/echo '0;OK'
{% endif %}
type=mongodb
{% if salt.pillar.get('data:dbaas:vtype') == 'compute' and salt.pillar.get('data:dbaas:cluster_id') %}
send_for_host={{ salt.dbaas.managed_hostname() }}
{% endif %}
