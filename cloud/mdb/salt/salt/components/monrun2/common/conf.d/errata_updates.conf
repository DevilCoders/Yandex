{% set threshs = {'warn': salt.dbaas.errata_warn_threshold(), 'crit': 30} %}
{% if not salt.dbaas.is_dataplane() %}
{% do threshs.update({'warn': threshs['warn'] + 2}) %}
{% endif %}
[errata_updates]
execution_interval=3600
execution_timeout=600
start_random_sleep=3600
command=nice -n 20 /usr/local/yandex/monitoring/errata_updates.py -u {{ salt['pillar.get']('data:errata:url', 'https://errata.s3.yandex.net/errata.json.gz') }} -s trapdoor.yandex.net:514/udp 2>/dev/null -w {{ salt['pillar.get']('data:errata:warn_thresh', threshs['warn']) }} -c {{ salt['pillar.get']('data:errata:crit_thresh', threshs['crit']) }}
type=updates
{% if salt.dbaas.is_compute() and salt.dbaas.is_dataplane() %}
send_for_host={{ salt.dbaas.managed_hostname() }}
{% endif %}
