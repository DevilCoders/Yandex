{% from "mdb_supports.sls" import l2_supports, gp_dba with context %}
User_Alias L2SUPPORT = {{ l2_supports | join(', ') }}
User_Alias GP_DBA = {{ gp_dba | join(', ') }}
# Common sudo rules
L2SUPPORT ALL = NOPASSWD: ALL
L2SUPPORT ALL = NOPASSWD: NOEXEC: /usr/bin/less /var/log/syslog*
L2SUPPORT ALL = NOPASSWD: NOEXEC: /usr/bin/zless /var/log/syslog*
L2SUPPORT ALL = NOPASSWD: NOEXEC: /usr/bin/less /var/log/kern.log*
L2SUPPORT ALL = NOPASSWD: NOEXEC: /usr/bin/zless /var/log/kern.log*
L2SUPPORT ALL = NOPASSWD: NOEXEC: /usr/bin/less /var/log/salt/minion*
L2SUPPORT ALL = NOPASSWD: NOEXEC: /usr/bin/zless /var/log/salt/minion*
L2SUPPORT ALL = NOPASSWD: /bin/cat /var/log/syslog*
L2SUPPORT ALL = NOPASSWD: /bin/zcat /var/log/syslog*
L2SUPPORT ALL = NOPASSWD: /bin/cat /var/log/kern.log*
L2SUPPORT ALL = NOPASSWD: /bin/zcat /var/log/kern.log*
L2SUPPORT ALL = NOPASSWD: /bin/cat /var/log/salt/minion*
L2SUPPORT ALL = NOPASSWD: /bin/zcat /var/log/salt/minion*

# Special database specific sudo rules 
{% if accumulator | default(False) %}
{%   if 'l2_sudoers' in accumulator %}
{%     for line in accumulator['l2_sudoers'] %}
L2SUPPORT {{ line }}
{%     endfor %}
{%   endif %}
{%   if 'gp_dba_sudoers' in accumulator %}
{%     for line in accumulator['gp_dba_sudoers'] %}
GP_DBA {{ line }}
{%     endfor %}
{%   endif %}
{% endif %}
