{%- set fqdn = salt['grains.get']('id') -%}
{%- set nodes = salt['pillar.get']('data:kafka:nodes', {}) -%}
{%- set node = salt['pillar.get']('data:kafka:nodes:'+fqdn, {}) -%}
{%- set replication_factor = 3 if nodes|length > 2 else 1 -%}

{
    "advertised_hostname": "{{ fqdn }}",
    "bootstrap_uri": "{{ fqdn }}:9091",
    "client_id": "sr-{{ node.get('id') }}",
    "compatibility": "BACKWARD",
    "group_id": "schema-registry",
    "host": "{{ fqdn }}",
    "log_level": "INFO",
    "port": 8081,
    "master_eligibility": true,
    "replication_factor": {{ replication_factor }},
    "security_protocol": "SASL_SSL",
    "ssl_cafile": "/etc/kafka/ssl/cert-ca.pem",
    "ssl_certfile": null,
    "ssl_keyfile": null,
    "sasl_mechanism": "SCRAM-SHA-512",
    "sasl_plain_username": "mdb_karapace",
    "sasl_plain_password": "{{ salt['mdb_kafka.monitor_password']() }}",
    "karapace_rest": {{ salt.pillar.get('data:kafka:rest_api_enabled', False) | json }},
    "karapace_registry": true,
    "topic_name": "__schemas",
    "session_timeout_ms": 10000,
    "auth_enabled": true,
    "auth_salt": "{{ salt['mdb_kafka.karapace_password_salt']() }}",
    "auth_users": {{ salt['mdb_kafka.karapace_users']() | json }}
}
