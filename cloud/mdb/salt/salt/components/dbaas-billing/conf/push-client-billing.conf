files:
  - name: /var/log/dbaas-billing/billing.log
{% if salt['pillar.get']('data:billing:ident') %}
    log_type: {{ salt['pillar.get']('data:billing:topic') }}
{% endif %}

{% if salt['pillar.get']('data:billing:ident') %}
ident: {{ salt['pillar.get']('data:billing:ident') }}
{% else %}
topic: {{ salt['pillar.get']('data:billing:topic') }}
{% endif %}

logger:
  telemetry_interval: -1
  remote: 0
  level: 5
  mode: file
  file: '/var/log/statbox/pushclient-billing.log'
  timeformat: '%d.%m.%Y-%H.%M.%S'

network:
  proto: pq
  master-addr: {{ salt['pillar.get']('data:billing:logbroker_host', 'vla.logbroker.yandex.net.') }}
{% if salt['pillar.get']('data:billing:logbroker_host', 'vla.logbroker.yandex.net.').startswith('vla') %}
{# We use advice here for historical reasons on compute vtypes (it allows us to send all data to single DC) #}
  advice: vla
{% endif %}
{# In compute and porto we use TVM #}
{% if salt['pillar.get']('data:billing:tvm_client_id') %}
  master-port: 2135
  tvm-client-id: {{ salt['pillar.get']('data:billing:tvm_client_id') }}
  tvm-server-id: {{ salt['pillar.get']('data:billing:tvm_server_id') }}
  tvm-secret-file: /etc/pushclient/billing.secret
{% else %}
  ssl:
    enabled: 1
  oauth-secret-file: /etc/pushclient/billing.secret
{% endif %}

watcher:
  state: /var/lib/push-client-billing
