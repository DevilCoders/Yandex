{%- set shmall = salt['cmd.shell']('echo $(expr $(getconf _PHYS_PAGES) / 2)') -%}
{%- set shmmax = salt['cmd.shell']('echo $(expr $(getconf _PHYS_PAGES) / 2 \* $(getconf PAGE_SIZE))') -%}
{%- set min_free_kbytes = salt['cmd.shell']('awk \'BEGIN {OFMT = "%.0f";} /MemTotal/ {print $2 * .03;}\' /proc/meminfo') -%}
vm.dirty_expire_centisecs=500
vm.zone_reclaim_mode=0
vm.overcommit_memory=2
kernel.msgmax=65536
net.ipv4.tcp_syncookies=1
net.ipv4.tcp_max_syn_backlog=4096
net.core.somaxconn=65535
kernel.sem=500 2048000 200 4096
net.ipv4.conf.all.arp_filter=1
net.ipv4.ip_local_port_range=10000 65535
kernel.msgmnb=65536
vm.swappiness=10
net.core.netdev_max_backlog=10000
vm.overcommit_ratio=98
kernel.shmmni=4096
vm.dirty_writeback_centisecs=100
net.ipv4.conf.default.accept_source_route=0
kernel.msgmni=2048
kernel.core_uses_pid=1
kernel.sysrq=1
kernel.shmmax={{ shmmax }}
kernel.shmall={{ shmall }}
vm.min_free_kbytes={{ min_free_kbytes }}
net.core.rmem_max=26214400
net.core.rmem_default=26214400
net.core.wmem_max=26214400
net.core.wmem_default=26214400
kernel.core_pattern=/var/cores/core.%p.%e.%s
