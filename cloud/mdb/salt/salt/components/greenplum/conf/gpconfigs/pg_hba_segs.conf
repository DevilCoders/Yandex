{% from "components/greenplum/map.jinja" import gpdbvars with context %}
{%- if salt['pillar.get']('data:dbaas:vtype') == 'compute' and not salt['pillar.get']('data:dbaas:assign_public_ip', False) -%}
{%- set contype = 'host' -%}
{%- else -%}
{%- set contype = 'hostssl' -%}
{%- endif -%}
{% set data_transfer_enabled = salt['pillar.get']('data:access:data_transfer', False) %}
# TYPE  DATABASE        USER            ADDRESS                 METHOD
local   all             gpadmin        ident
host    all             gpadmin        127.0.0.1/28            md5
host    all             gpadmin        ::1/128                 md5
{% for host in salt.pillar.get('data:dbaas:cluster_hosts')|sort %}
host    all             gpadmin        {{ host }}              md5
host    replication     gpadmin        {{ host }}              md5
{% endfor %}
{% if data_transfer_enabled %}
{{ contype }}   all    all    all    md5    yaproject_id={{ gpdbvars.datatransfer_project_id }}
{% endif %}
