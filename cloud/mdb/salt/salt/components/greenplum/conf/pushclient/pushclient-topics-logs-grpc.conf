{% from "components/greenplum/map.jinja" import gpdbvars with context %}
{% if salt['pillar.get']('data:dbaas:subcluster_name', '') == 'master_subcluster' %}
- topic: {{ salt.pillar.get('data:logship:topics:odyssey_logs', 'invalid_topic') }}
  name: /var/log/odyssey/odyssey.log
{% endif %}
{% for segment_log_info in salt['mdb_greenplum.get_segments_log_info']()['segments'] %}
- topic: {{ salt.pillar.get('data:logship:topics:greenplum_logs', 'invalid_topic') }}
  name: {{ segment_log_info['data_dir'] }}
  pipe: /etc/pushclient/greenplum_csv_parser.py -c {{ salt.pillar.get('data:dbaas:cluster_id') }} -t {{ segment_log_info['type'] }} -r {{ segment_log_info['preferred_role'] }}
{% endfor %}
