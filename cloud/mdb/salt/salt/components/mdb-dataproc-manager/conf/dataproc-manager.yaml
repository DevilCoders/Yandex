{%- set config_internal = salt['pillar.get']('data:mdb-dataproc-manager:config:internal-api') -%}
{%- set config_compute = salt['pillar.get']('data:mdb-dataproc-manager:config:compute-service') -%}
{%- set config_instance_group = salt['pillar.get']('data:mdb-dataproc-manager:config:instance-group-service') -%}
{%- set config_iam_token = salt['pillar.get']('data:mdb-dataproc-manager:config:iam-token-service') -%}
{%- set config_redis = salt['pillar.get']('data:mdb-dataproc-manager:redis') -%}
{%- set config_server_listen = salt['pillar.get']('data:mdb-dataproc-manager:server:listen', '0.0.0.0:443') -%}
{%- set config_sentry = salt['pillar.get']('data:mdb-dataproc-manager:config:sentry') -%}
{%- set config_service_account = salt['pillar.get']('data:mdb-dataproc-manager:config:service_account') -%}
server:
    capath: "/opt/yandex/allCAs.pem"
    listen: {{ config_server_listen }}
    iamurl: {{ salt['pillar.get']('data:iam:url') }}
internal-api:
    capath: {{ config_internal.get('capath', '/opt/yandex/allCAs.pem')}}
    url: {{ config_internal['url'] }}
    access_id: {{ config_internal['access_id'] }}
    access_secret: {{ config_internal['access_secret'] }}
redis:
    addrs:
{% for addr in config_redis.get('hosts', {}) %}
        - {{ addr }}
{% endfor %}
    mastername: {{ config_redis['mastername'] }}
    db: {{ config_redis['db'] }}
    password: {{ config_redis['password'] }}
sentry:
    dsn: {{ config_sentry.get('dsn', '__NOSENTRYDSN__') }}
    environment: {{ config_sentry.get('environment', '__NOSENTRYENV__') }}
compute-service:
    capath: "/opt/yandex/allCAs.pem"
    service_url: {{ config_compute['service_url'] }}
    grpc_timeout: {{ config_compute['grpc_timeout'] }}
    token: {{ config_compute['token'] }}
instance-group-service:
    capath: "/opt/yandex/allCAs.pem"
    service_url: {{ config_instance_group['service_url'] }}
    grpc_timeout: {{ config_instance_group['grpc_timeout'] }}
    token: {{ config_instance_group['token'] }}
iam-token-service:
    capath: "/opt/yandex/allCAs.pem"
    service_url: {{ config_iam_token['service_url'] }}
    grpc_timeout: {{ config_iam_token['grpc_timeout'] }}
    token: {{ config_iam_token['token'] }}
    token_cache_timeout: {{ config_iam_token['token_cache_timeout'] }}
service_account:
    id: {{ config_service_account['id'] }}
    key_id: {{ config_service_account['key_id'] }}
    private_key: {{ config_service_account['private_key'] | yaml_encode }}
