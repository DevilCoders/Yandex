{% set producer = salt['pillar.get']('data:mdb-event-producer') %}
config:
    log_level: Debug
    instrumentation:
        addr: ':{{ producer.instrumentation.port }}'
metadb:
    addrs: {{ salt['pillar.get']('data:metadb:hosts') }}
    db: dbaas_metadb
    user: mdb_event_producer
    password: {{ salt['pillar.get']('data:config:pgusers:mdb_event_producer:password') | yaml_encode }}
    sslmode: 'verify-full'
    sslrootcert: '/opt/yandex/allCAs.pem'
logbroker:
    endpoint: {{ salt.pillar.get('data:yc_logbroker:address') }}
    database: {{ salt.pillar.get('data:yc_logbroker:database') }}
    topic: {{ producer.logbroker.topic | yaml_encode }}
    source_id: mdb-event-producer-{{ salt['grains.get']('id') }}
    tls:
        ca_file: '/opt/yandex/allCAs.pem'
    iam:
        token_service:
            endpoint: {{ salt.pillar.get('data:token_service:address') }}
            useragent: 'MDB Event Producer'
        service_account:
            id: {{ producer.service_account.id }}
            key_id: {{ producer.service_account.key_id }}
            private_key: {{ producer.service_account.private_key | yaml_encode }}
