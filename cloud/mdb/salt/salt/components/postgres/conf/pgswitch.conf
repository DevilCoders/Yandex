{% from "components/postgres/pg.jinja" import pg with context %}
[main]
hooks_path = /usr/local/yandex/pgswitch/hooks

[pg]
conn_str = dbname=postgres user=admin password={{ salt['pillar.get']('data:config:pgusers:admin:password', '') }} port=5432 connect_timeout=1
bouncer_sleep = 2
sessions_stop_sleep = 1
replica_attach_check_period = 5
replica_attach_check_retries = 12
bin_path = {{ pg.bin_path }}
postgresql_service_cmd = /usr/sbin/service {{ pg.service }}
gen_recovery_conf_cmd = /usr/local/yandex/populate_recovery_conf.py
{% if pg.connection_pooler == 'odyssey' %}
pooler_cmd = service odyssey
pooler_configs_path = /etc/odyssey/odyssey.conf
{% else %}
pooler_cmd = service pgbouncer
pooler_configs_path = /etc/pgbouncer/pgbouncer.ini, /etc/pgbouncer/userlist.txt
{% endif %}
