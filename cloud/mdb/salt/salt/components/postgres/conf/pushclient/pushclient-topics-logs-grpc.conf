{% if pg.connection_pooler == 'pgbouncer' %}

{% if salt.pillar.get('data:pgbouncer:count', 1) > 1 %}
{%   for count in range(salt.pillar.get('data:pgbouncer:count', 1)) %}
{%     set num="%02d"|format(count|int) %}
- topic: {{ salt.pillar.get('data:logship:topics:pgbouncer_logs', 'invalid_topic') }}
  name: /var/log/postgresql/pgbouncer{{ num }}.log
  pipe: /etc/pushclient/pgbouncer_parser.py -c {{ salt.pillar.get('data:dbaas:cluster_id', salt.grains.get('id').split('.')[0][:-3]) }} -o pgbouncer_ext
{%   endfor %}
{%   for count in range(salt.pillar.get('data:pgbouncer:internal_count', 1)) %}
- topic: {{ salt.pillar.get('data:logship:topics:pgbouncer_logs', 'invalid_topic') }}
  name: /var/log/postgresql/pgbouncer{{ num }}.log
  pipe: /etc/pushclient/pgbouncer_parser.py -c {{ salt.pillar.get('data:dbaas:cluster_id', salt.grains.get('id').split('.')[0][:-3]) }} -o pgbouncer_int
{%   endfor %}
{% else %}
- topic: {{ salt.pillar.get('data:logship:topics:pgbouncer_logs', 'invalid_topic') }}
  name: /var/log/postgresql/pgbouncer.log
  pipe: /etc/pushclient/pgbouncer_parser.py -c {{ salt.pillar.get('data:dbaas:cluster_id', salt.grains.get('id').split('.')[0][:-3]) }} -o pgbouncer
{% endif %}

{% elif pg.connection_pooler == 'odyssey' %}
- topic: {{ salt.pillar.get('data:logship:topics:odyssey_logs', 'invalid_topic') }}
  name: /var/log/odyssey/odyssey.log
{% endif %}

- topic: {{ salt.pillar.get('data:logship:topics:postgresql_logs', 'invalid_topic') }}
  name: /var/log/postgresql/postgresql-{{pg.version.major}}-data.csv
  pipe: /etc/pushclient/postgres_csv_parser.py -c {{ salt.pillar.get('data:dbaas:cluster_id', salt.grains.get('id').split('.')[0][:-3]) }}
