{%- set tvmtool = salt['pillar.get']('data:tvmtool')%}
{%- set clients_conf = salt['pillar.get']('data:tvmtool:config:clients') %}
{
    "port": {{ tvmtool.port | default(0) }},
    "clients": {
{% if clients_conf %}
{% for c_name, c_conf in clients_conf.items() %}
        "{{ c_name }}": {
            "secret": {{ c_conf.secret | json }},
            "self_tvm_id": {{ c_conf.tvm_id }},
            "dsts": {{ c_conf.dsts | json(indent=4) }}
        }{% if loop.nextitem is defined %},{% endif %}
{% endfor %}
{% else %}
        "{{ tvmtool.config.client }}": {
            "secret": {{ tvmtool.config.secret | json }},
            "self_tvm_id": {{ tvmtool.tvm_id }},
            "dsts": {
                "blackbox": {
                    "dst_id": 223
                }
            }
        }
{% endif %}
    }
}

