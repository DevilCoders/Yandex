# Generated by CONFIG REWRITE
sentinel myid {{ salt.grains.get('id').split('.')[0][:40].center(40, '_') }}
sentinel current-epoch 0

{% set redis_master = salt.mdb_redis.get_master_for_sentinel() %}
{% set password = salt.pillar.get('data:redis:config:requirepass') %}
{% set port = salt.mdb_redis.get_redis_replication_port() %}
{% set quorum = salt.pillar.get('data:sentinel:quorum', 2) %}

sentinel monitor {{ master_name }} {{ redis_master }} {{ port }} {{ quorum }}

{% for source, target in salt.pillar.get('data:redis:secrets:renames', {}).items() %}
{% if (source|lower) in ['config', 'slaveof'] %}
sentinel rename-command {{ master_name }} {{ source }} {{ target }}
{% endif %}
{% endfor %}

{% if password %}
sentinel auth-pass {{ master_name }} {{ password|yaml_dquote }}
{% endif %}

{% set client_reconfig_script = salt.pillar.get('data:sentinel:client-reconfig-script') %}
{% if client_reconfig_script %}
sentinel client-reconfig-script {{ master_name }} {{ client_reconfig_script }}
{% endif %}

{% for source, target in salt.pillar.get('data:redis:secrets:sentinel_renames', {}).items() %}
sentinel rename-{{ source|lower }} {{ master_name }} {{ target }}
{% endfor %}

{% for k, v in config.items()|sort %}
{{ k }} {{ v }}
{% endfor %}

{% for k, v in master_config.items()|sort %}
sentinel {{ k }} {{ master_name }} {{ v }}
{% endfor %}
