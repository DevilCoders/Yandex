{% set vtype = salt['pillar.get']('data:dbaas:vtype') %}
table filter {
    chain INPUT {
        policy ACCEPT;

        # connection tracking
        mod state state INVALID REJECT;
        mod state state (ESTABLISHED RELATED) ACCEPT;

        # allow local packets
        interface lo ACCEPT;

        # allow dhcp
        proto udp dport 68 ACCEPT;

        # respond to ping
        proto icmp ACCEPT;

        # disallow jugler-client port
{% if vtype == 'compute' %}
        interface (eth0 eth1) {
{% else %}
        interface eth0 {
{% endif %}
            proto tcp dport 31579 REJECT;
        }
    }
    chain OUTPUT {
        policy ACCEPT;

        mod state state (ESTABLISHED RELATED) ACCEPT;
    }
    chain FORWARD {
        policy DROP;

        # connection tracking
        mod state state INVALID DROP;
        mod state state (ESTABLISHED RELATED) ACCEPT;
    }
}
