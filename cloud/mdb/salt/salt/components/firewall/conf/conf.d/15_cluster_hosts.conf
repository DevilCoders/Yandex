{% set vtype = salt['pillar.get']('data:dbaas:vtype', None) %}
{% set cluster_hosts = salt['pillar.get']('data:dbaas:cluster_hosts', None) %}
{% set cluster_ports = salt['pillar.get']('firewall:ports:cluster', None) %}
{% if cluster_ports is not none and cluster_hosts is not none %}
{%   if vtype == 'porto' %}
@def $CLUSTER_HOSTS = ( {{ cluster_hosts | join(' ') }} );
@def $CLUSTER_PORTS = ( {{ cluster_ports | join(' ') }} );

domain ip6 {
    chain "cluster_hosts" {
        saddr ( $CLUSTER_HOSTS ) ACCEPT;
        DROP;
    }

    table filter {
        chain INPUT {
            interface eth0 {
                proto tcp dport ( $CLUSTER_PORTS ) jump "cluster_hosts";
            }
        }
    }
}
{%   endif %}
{% endif %}
