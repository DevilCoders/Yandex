{% set mongodb = salt.slsutil.renderer('salt://components/mongodb/defaults.py?saltenv=' ~ saltenv) %}
{% for srv in mongodb.services_deployed %}
{%   set config = mongodb.config.get(srv) %}
{#   To be sure nothing is broken, don't rename section in case of mongod #}
{%   if srv == 'mongod' %}
{%     set section_suffix = '' %}
{%   else %}
{%     set section_suffix = '_' + srv %}
{%   endif %}
[mongodb{{section_suffix}}_db_stats]
plugin = common
module = mongodb_command
interval = {{ 60 if not is_burst else (60, min_burst_interval) | max }}
send_interval = {{ 15 if not is_burst else (15, min_burst_interval) | max }}

prefix = db_stats
report_current = True

query = dbStats

conn_pool_name = {{srv}}

yasm_suffix = vmmv,tmmx
yasm_tags_db = {{srv}}
yasm_ttl = 300

use_labels = True

{% endfor %}
