[load_monitor]
plugin = common
module = load_monitor
interval = 15
checks = cpu

pid_file = /var/run/mongodb.pid

# cpu_limit = 0 -> get it from /etc/dbaas.conf
cpu_max_use_1 = 95.0
cpu_max_use_15 = 80.0
cpu_max_use_60 = 80.0
cpu_check_children = false
{% if salt.pillar.get('data:dbaas:vtype') == 'compute' %}
cpu_check_iowait = true
{% else %}
cpu_check_iowait = false
{% endif %}

#Memory check is disabled for mongodb
# memory_limit_mb = 0 -> get it from /etc/dbaas.conf
memory_limit_mb = 0
memory_min_unused_mb_by_db = 512
memory_min_free_percent = 1

{% set ctrl_files_paths = ['/var/run/lock/instance_userfault_broken', '/tmp/admin-marked-as-broken'] %}
{% do ctrl_files_paths.append('/tmp/mdb-mongo-fsync.mongod.locked') %}
{% do ctrl_files_paths.append('/tmp/mdb-mongo-fsync.mongocfg.locked') %}
userfault_broken_ctrl_files = {{ctrl_files_paths | join(',')}}

downtime_duration = 60

yasm_ttl = 300
yasm_suffix = tmmx
