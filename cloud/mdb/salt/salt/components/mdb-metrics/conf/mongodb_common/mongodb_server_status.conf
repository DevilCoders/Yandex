{% set mongodb = salt.slsutil.renderer('salt://components/mongodb/defaults.py?saltenv=' ~ saltenv) %}
{% for srv in mongodb.services_deployed %}
{%   set config = mongodb.config.get(srv) %}
{#   To be sure nothing is broken, don't rename section in case of mongod #}
{%   if srv == 'mongod' %}
{%     set section_suffix = '' %}
{%   else %}
{%     set section_suffix = '_' + srv %}
{%   endif %}
[mongodb{{section_suffix}}_server_status]
plugin = common
module = mongodb_command
interval = {{ 15 if not is_burst else (15, min_burst_interval) | max }}
prefix = server_status
report_current = True
report_rate = True

query = serverStatus
databases = admin

include_all = False
include_prefixes = asserts connections extra_info globalLock logicalSessionRecordCache opLatencies opReadConcernCounters opcounters opcountersRepl transactions twoPhaseCommitCoordinator
include_metrics = wiredTiger.concurrentTransactions.read.out wiredTiger.concurrentTransactions.read.totalTickets wiredTiger.concurrentTransactions.write.out wiredTiger.concurrentTransactions.write.totalTickets wiredTiger.transaction.transaction_begins wiredTiger.transaction.transactions_committed wiredTiger.transaction.transactions_rolled_back wiredTiger.transaction.transaction_checkpoints wiredTiger.transaction.transaction_checkpoint_max_time_msecs wiredTiger.transaction.transaction_checkpoint_min_time_msecs wiredTiger.transaction.transaction_checkpoint_most_recent_time_msecs wiredTiger.cache.bytes_currently_in_the_cache wiredTiger.cache.checkpoint_blocked_page_eviction wiredTiger.cache.maximum_bytes_configured wiredTiger.cache.tracked_dirty_bytes_in_the_cache wiredTiger.cache.unmodified_pages_evicted wiredTiger.cache.modified_pages_evicted metrics.cursor.timedOut metrics.cursor.open.noTimeout metrics.cursor.open.pinned metrics.cursor.open.total metrics.operation.writeConflicts metrics.operation.scanAndOrder metrics.document.inserted metrics.document.updated metrics.document.deleted metrics.document.returned metrics.ttl.passes metrics.ttl.deletedDocuments metrics.cursor.timedOut metrics.cursor.open.noTimeout metrics.cursor.open.pinned metrics.cursor.open.total metrics.operation.writeConflicts metrics.operation.scanAndOrder metrics.document.inserted metrics.document.updated metrics.document.deleted metrics.document.returned metrics.ttl.passes metrics.ttl.deletedDocuments metrics.queryExecutor.scanned metrics.queryExecutor.scannedObjects metrics.queryExecutor.collectionScans.nonTailable metrics.queryExecutor.collectionScans.total metrics.getLastError.wtime.totalMillis repl.ismaster repl.secondary repl.isWritablePrimary

conn_pool_name = {{srv}}

yasm_suffix = vmmv,tmmx
yasm_tags_db = {{srv}}
yasm_ttl = 300

{% endfor %}
