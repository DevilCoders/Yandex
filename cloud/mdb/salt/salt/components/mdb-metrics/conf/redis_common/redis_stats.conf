{% if salt['pillar.get']('data:redis:config:cluster-enabled') == 'yes' %}
[redis_cluster_stats]
{% else %}
[redis_stats]
{% endif %}
plugin = common
module = redis_stats
metrics =
    aof_last_cow_size,
    blocked_clients,
    client_output_normal_hard,
    client_output_normal_soft,
    client_recent_max_input_buffer,
    client_recent_max_output_buffer,
    connected_clients,
    connected_slaves,
    dbsize,
    db_hashtable_overhead,
    evicted_keys,
    hit_rate,
    instantaneous_ops_per_sec,
    io_threaded_reads_processed,
    io_threaded_writes_processed,
    io_threads_active,
    is_master,
    keyspace_hits,
    keyspace_misses,
    master_last_io_seconds_ago,
    maxmemory,
    memory_limit,
    mem_aof_buffer,
    mem_clients_slaves,
    mem_clients_normal,
    mem_replication_backlog,
    module_fork_last_cow_size,
    rdb_last_cow_size,
    repl_backlog_histlen,
    repl_backlog_size,
    total_reads_processed,
    total_writes_processed,
    used_memory,
    used_memory_dataset,
    used_memory_rss,
    used_memory_startup,
    used_memory_scripts

interval = {{ 15 if not is_burst else (15, min_burst_interval) | max}}

yasm_suffix = vmmv,tmmx
yasm_tags_db = redis
yasm_ttl = 300

memory_limit = {{ salt.pillar.get('data:dbaas:flavor:memory_limit', 0) }}
databases = {{ salt.pillar.get('data:redis:config:databases', 16) }}
{% set limits = salt.mdb_redis.get_output_buffer_limits() %}
client_output_normal_hard = {{ limits['hard'] }}
client_output_normal_soft = {{ limits['soft'] }}
