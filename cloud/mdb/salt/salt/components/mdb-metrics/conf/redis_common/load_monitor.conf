[load_monitor]
plugin = common
module = load_monitor
interval = 15
checks = cpu, memory

pid_file = /var/run/redis/redis-server.pid

# cpu_limit = 0 -> get it from /etc/dbaas.conf
cpu_max_use_1 = 99.0
cpu_max_use_15 = 95.0
cpu_max_use_60 = 95.0

# memory_limit_mb = 0 -> get it from /etc/dbaas.conf
memory_limit_mb = 0
# We assume that our tools can use up to 512Mb of memory + 8Mb of free memory
memory_min_unused_mb_by_db = 520
memory_min_free_percent = 1

{% set ctrl_files_paths = ['/var/run/lock/instance_userfault_broken', '/tmp/admin-marked-as-broken'] %}
{% do ctrl_files_paths.append(salt.mdb_metrics.get_redis_no_slots_marker_filename()) %}
{% do ctrl_files_paths.append(salt.mdb_metrics.get_redis_oom_command_state_file()) %}
userfault_broken_ctrl_files = {{ctrl_files_paths | join(',')}}

yasm_ttl = 300
yasm_suffix = tmmx
