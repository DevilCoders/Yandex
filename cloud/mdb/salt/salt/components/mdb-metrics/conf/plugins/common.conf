[common]
plugin_type = common
user = monitor
group = monitor

{% if salt['pillar.get']('data:mongodb', {}) %}
{%  if 'components.mongodb-baremetal' in salt['pillar.get']('data:runlist', []) %}
{%   from "components/mongodb-baremetal/map.jinja" import mongodb with context %}
{%  else %}
{%   set mongodb = salt.slsutil.renderer('salt://components/mongodb/defaults.py?saltenv=' ~ saltenv) %}
{%  endif %}
{%   set monitor = salt['pillar.get']('data:mongodb:users:monitor') %}

connection_pools = {{ mongodb.services_deployed | join(', ')  }}

{%   for srv in mongodb.services_deployed %}
{%     set config = mongodb.config.get(srv) %}
{{ srv }}_conn_pool_type = mongodb
{{ srv }}_conn_pool_dbname = admin
{{ srv }}_conn_pool_options = serverSelectionTimeoutMS=3000&maxPoolSize=10&minPoolSize=1{{ config.cli.ssl_uri_args }}
{{ srv }}_conn_pool_user = monitor
{{ srv }}_conn_pool_password = {{ monitor.password }}
{{ srv }}_conn_pool_port = {{ config.net.port }}
{%   endfor %}
{% endif %}

