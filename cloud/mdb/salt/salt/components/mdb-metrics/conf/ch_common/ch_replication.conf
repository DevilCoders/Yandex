[ch_replication]
plugin = common
module = ch_replication
prefix = ch_replication
interval = {{ 15 if not is_burst else (15, min_burst_interval) | max }}
yasm_ttl = 15

query = SELECT count(*) as tables, sum(future_parts) as future_parts, sum(parts_to_check) as parts_to_check, sum(queue_size) as queue_size, sum(inserts_in_queue) as inserts_in_queue, sum(merges_in_queue) as merges_in_queue, max(absolute_delay) as max_absolute_delay FROM system.replicas FORMAT JSON;
{% if salt['mdb_clickhouse.ssl_enabled']() %}

clickhouse_timeout = 10
clickhouse_user = _metrics
clickhouse_protocol = https
clickhouse_port = 8443
ca_path = {{ salt['mdb_clickhouse.ca_path']() }}
{% endif %}

yasm_suffix = vmmv,tmmx
yasm_tags_db = clickhouse
