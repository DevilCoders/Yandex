[ch_load_monitor]
plugin = common
module = ch_load_monitor
interval = {{ 15 if not is_burst else (15, min_burst_interval) | max }}
checks = cpu, memory, space, io

pid_file = /run/clickhouse-server/clickhouse-server.pid

# cpu_limit = 0 -> get it from /etc/dbaas.conf
cpu_max_use_1 = 98.0
cpu_max_use_15 = 95.0
cpu_max_use_60 = 95.0

memory_limit_mb = {{ salt.mdb_clickhouse.clickhouse_memory_limit() }}
memory_min_unused_mb_by_db = 32
memory_min_free_percent = 1

disk_threshold_percent = 1
data_directory = /var/lib/clickhouse

# io_bytes_limit = 0 -> get it from /etc/dbaas.conf or porto agent
io_max_use_15 = 99
io_max_use_30 = 97
io_max_use_60 = 95

downtime_duration = 60

yasm_ttl = 300
yasm_suffix = tmmx

clickhouse_user = _metrics
{% if salt['mdb_clickhouse.ssl_enabled']() %}
clickhouse_protocol = https
clickhouse_port = 8443
ca_path = {{ salt['mdb_clickhouse.ca_path']() }}
{% endif %}
