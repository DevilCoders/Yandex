[pg_conns_by_role]
plugin = postgres
module = pg_query
interval = 5

rowsignal = 1
query = SELECT usename role_sessions, count(1) sessions FROM pg_stat_activity WHERE backend_type='client backend' AND (usename not in ('admin', 'monitor', 'postgres') AND usename NOT IN (SELECT rolname FROM pg_roles WHERE rolconnlimit<1 OR NOT rolcanlogin OR rolreplication OR rolsuper)) GROUP BY usename; 
databases = postgres
yasm_suffix = vmmv,tmmx

[pg_conn_role_limit]
plugin = postgres
module = pg_query
interval = 5

rowsignal = 1
query = SELECT rolname role_conn_limit, rolconnlimit FROM pg_roles WHERE rolconnlimit>0 AND rolcanlogin AND NOT rolreplication AND NOT rolsuper AND rolname NOT IN ('admin', 'monitor', 'postgres'); 
databases = postgres
yasm_suffix = vmmv,tmmx
