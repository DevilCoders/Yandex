version: '2.4'

services:
  s3db01:
    extends:
      file: base.yml
      service: s3db

  s3db01r:
    extends:
      file: base.yml
      service: s3db
    links:
      - s3db01
    command: [ "replica", "s3db01" ]

  s3db02:
    extends:
      file: base.yml
      service: s3db

  s3db02r:
    extends:
      file: base.yml
      service: s3db
    links:
      - s3db02
    command: [ "replica", "s3db02" ]

  s3meta01:
    extends:
      file: base.yml
      service: s3meta

  s3meta01r:
    extends:
      file: base.yml
      service: s3meta
    links:
      - s3meta01
    command: [ "replica", "s3meta01" ]

  s3meta02:
    extends:
      file: base.yml
      service: s3meta

  s3meta02r:
    extends:
      file: base.yml
      service: s3meta
    links:
      - s3meta02
    command: [ "replica", "s3meta02" ]

  pgmeta:
    extends:
      file: base.yml
      service: pgmeta

  s3proxy:
    extends:
      file: base.yml
      service: s3proxy
    links:
      - s3db01
      - s3db01r
      - s3db02
      - s3db02r
      - s3meta01
      - s3meta01r
      - s3meta02
      - s3meta02r
      - pgmeta

  client:
    extends:
      file: base.yml
      service: client
    links:
      - s3proxy
      - s3db01
      - s3db01r
      - s3db02
      - s3db02r
      - s3meta01
      - s3meta01r
      - s3meta02
      - s3meta02r
      - pgmeta
