version: '2.4'

services:
  s3db01:
    build: docker/s3db
    privileged: true
    hostname: s3db_s3db01
    domainname: s3db_net
    init: true
    networks:
      net:
        ipv4_address: 192.168.148.11
    volumes:
    - ../../:/pg

  s3db02:
    build: docker/s3db
    privileged: true
    hostname: s3db_s3db02
    domainname: s3db_net
    init: true
    networks:
      net:
        ipv4_address: 192.168.148.12
    volumes:
    - ../../:/pg

  s3meta01:
    build: docker/s3meta
    privileged: true
    hostname: s3db_s3meta01
    domainname: s3db_net
    init: true
    networks:
      net:
        ipv4_address: 192.168.148.13
    volumes:
    - ../../:/pg

  pgmeta:
    build: docker/yapostgres
    privileged: true
    hostname: s3db_pgmeta
    domainname: s3db_net
    init: true
    networks:
      net:
        ipv4_address: 192.168.148.15

  s3proxy:
    build: docker/s3proxy
    privileged: true
    hostname: s3db_s3proxy
    domainname: s3db_net
    init: true
    networks:
      net:
        ipv4_address: 192.168.148.16
    volumes:
    - ../../:/pg

  jepsen:
    build: docker/jepsen
    hostname: s3db_jepsen
    domainname: s3db_net
    init: true
    tty: true
    extra_hosts:
     - "s3db_s3db01.s3db_net:192.168.148.11"
     - "s3db_s3db02.s3db_net:192.168.148.12"
     - "s3db_s3meta01.s3db_net:192.168.148.13"
     - "s3db_pgmeta.s3db_net:192.168.148.15"
     - "s3db_s3proxy.s3db_net:192.168.148.16"
    networks:
      net:
        ipv4_address: 192.168.148.17
    volumes:
    - ../../:/pg

networks:
  net:
    driver: bridge
    ipam:
      driver: default
      config:
       - subnet: 192.168.148.0/24
         gateway: 192.168.148.1
