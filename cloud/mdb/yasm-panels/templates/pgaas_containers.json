<% if dbname in ('bitbucketdb', 'idmdb') %>
<% set prj = dbname|replace('db', '') ~ '01' %>
<% elif dbname in ('trust_payments_prod', ) %>
<% set prj = 'paysys-trust01' %>
<% elif dbname in ('trust_payments_load', ) %>
<% set prj = 'paysys-load01' %>
<% elif dbname in ('marketstat_antifraud_prod', ) %>
<% set prj = 'stat-market01' %>
<% elif dbname in ('market_raw_model', ) %>
<% set prj = 'raw-model-market01' %>
<% else %>
<% set prj = dbname|replace('_', '-') ~ '01' %>
<% endif %>

<% set dom0_tags = 'prj=' ~ prj %>
<% set domu_tags = 'prj=' ~ prj %>
<% if tier %>
<% set dom0_tags = dom0_tags ~ ';tier=' ~ tier %>
<% set domu_tags = domu_tags ~ ';tier=' ~ tier %>
<% else %>
<% set dom0_tags = dom0_tags ~ ';tier=primary,replica' %>
<% set domu_tags = domu_tags ~ ';tier=primary,replica' %>
<% endif %>
{
    "title": "<< dbname >>",
    "type": "panel",
    "charts": [
        {
            "id": "cpu",
            "type": "graphic",
            "row": 1,
            "col": 1,
            "yAxis": [
                {
                    "minValue": 0,
                    "maxValue": 24
                },
                {
                    "minValue": 0,
                    "maxValue": 24
                }
            ],
            "signals": [
                {
                    "tag": "itype=mdbdom0;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-cpu_usage_cores_tmmv",
                    "title": "Used",
                    "yAxis": 0
                },
                {
                    "tag": "itype=mdbdom0;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-cpu_guarantee_cores_tmmv",
                    "title": "Guaranteed",
                    "stacked": false,
                    "yAxis": 1
                },
                {
                    "tag": "itype=mdbdom0;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-cpu_limit_cores_tmmv",
                    "title": "Limit",
                    "stacked": false,
                    "yAxis": 1
                },
                {
                    "tag": "itype=mdbdom0;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-cpu_wait_cores_tmmv",
                    "title": "Wait",
                    "yAxis": 0
                }
            ],
            "consts": [],
            "title": "CPU (Cores)",
            "stacked": true,
            "normalize": true
        },
        {
            "id": "mem",
            "type": "graphic",
            "row": 1,
            "col": 3,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mdbdom0;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-memory_usage_gb_tmmv",
                    "title": "Used"
                },
                {
                    "tag": "itype=mdbdom0;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-memory_guarantee_gb_tmmv",
                    "title": "Guaranteed"
                },
                {
                    "tag": "itype=mdbdom0;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-memory_limit_gb_tmmv",
                    "title": "Limit"
                },
                {
                    "tag": "itype=mdbdom0;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-anon_usage_gb_tmmv",
                    "title": "Anon used"
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "Memory (GB)",
            "stacked": false,
            "normalize": true
        },
        {
            "id": "io",
            "type": "graphic",
            "row": 1,
            "col": 5,
            "yAxis": [
                {
                    "minValue": 0,
                    "maxValue": 2000000000
                },
                {
                    "minValue": 0,
                    "maxValue": 2000000000
                }
            ],
            "signals": [
                {
                    "tag": "itype=mdbdom0;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-io_read_bytes_tmmv",
                    "title": "read",
                    "normalizable": true,
                    "yAxis": 0
                },
                {
                    "tag": "itype=mdbdom0;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-io_write_fs_bytes_tmmv",
                    "title": "write",
                    "normalizable": true,
                    "yAxis": 0
                },
                {
                    "tag": "itype=mdbdom0;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-io_limit_bytes_tmmv",
                    "title": "limit",
                    "stacked": false,
                    "normalizable": true,
                    "yAxis": 1
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "I/O (B/s)",
            "stacked": true,
            "normalize": true
        },
        {
            "id": "net",
            "type": "graphic",
            "row": 3,
            "col": 1,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mdbdom0;<< dom0_tags >>",
                    "host": "CON",
                    "name": "sum(portoinst-net_rx_mb_summ, portoinst-net_tx_mb_summ)",
                    "title": "Used"
                },
                {
                    "tag": "itype=mdbdom0;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-net_guarantee_mb_summ",
                    "title": "Guaranteed"
                },
                {
                    "tag": "itype=mdbdom0;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-net_limit_mb_summ",
                    "title": "Limit"
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "Network (MB/s)",
            "stacked": false,
            "normalize": true
        },
        {
            "id": "conn",
            "type": "graphic",
            "row": 3,
            "col": 3,
            "yAxis": [
                {},
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mailpostgresql;<< domu_tags >>",
                    "host": "CON",
                    "name": "push-<< dbname >>_conn_active_vmmv",
                    "yAxis": 0,
                    "title": "active"
                },
                {
                    "tag": "itype=mailpostgresql;<< domu_tags >>",
                    "host": "CON",
                    "name": "push-<< dbname >>_conn_idle_vmmv",
                    "yAxis": 0,
                    "title": "idle"
                },
                {
                    "tag": "itype=mailpostgresql;<< domu_tags >>",
                    "host": "CON",
                    "name": "push-<< dbname >>_conn_idle_in_transaction_vmmv",
                    "yAxis": 0,
                    "title": "idle in transaction"
                },
                {
                    "tag": "itype=mailpostgresql;<< domu_tags >>",
                    "host": "CON",
                    "name": "push-<< dbname >>_conn_aborted_vmmv",
                    "yAxis": 0,
                    "title": "aborted"
                },
                {
                    "tag": "itype=mailpostgresql;<< domu_tags >>",
                    "host": "CON",
                    "name": "push-<< dbname >>_conn_waiting_vmmv",
                    "yAxis": 0,
                    "title": "waiting"
                },
                {
                    "tag": "itype=mailpostgresql;<< domu_tags >>",
                    "host": "CON",
                    "name": "pgbouncer-bouncer_<< dbname >>_tcp_connections_vmmv",
                    "yAxis": 1,
                    "title": "bouncer"
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "Connections",
            "stacked": false,
            "normalize": true
        },
        {
            "id": "avgq",
            "type": "graphic",
            "row": 3,
            "col": 5,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mailpostgresql;<< domu_tags >>",
                    "host": "CON",
                    "name": "pgbouncer-bouncer_<< dbname >>_avg_query_xxxv",
                    "title": "avg query (ms)"
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "Average query (ms)",
            "stacked": false,
            "normalize": true
        },
        {
            "id": "rps",
            "type": "graphic",
            "row": 5,
            "col": 1,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mailpostgresql;<< domu_tags >>",
                    "host": "CON",
                    "name": "sum(pgbouncer-bouncer_<< dbname >>_total_requests_ps_mmmm, pgbouncer-bouncer_<< dbname >>_total_query_count_ps_mmmm)",
                    "title": "rps"
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "RPS",
            "stacked": false,
            "normalize": true
        },
        {
            "id": "size",
            "type": "graphic",
            "row": 5,
            "col": 3,
            "minValue": 0,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mailpostgresql;prj=<< prj >>;tier=primary",
                    "host": "CON",
                    "name": "push-<< dbname >>_pg_database_size_vmmv",
                    "title": "db_size (bytes)"
                },
                {
                    "tag": "itype=mailpostgresql;prj=<< prj >>;tier=primary",
                    "host": "CON",
                    "name": "push-disk-total_bytes_/var/lib/postgresql_vmmv",
                    "title": "total_space (bytes)"
                },
                {
                    "tag": "itype=mailpostgresql;prj=<< prj >>;tier=primary",
                    "host": "CON",
                    "name": "push-disk-used_bytes_/var/lib/postgresql_vmmv",
                    "title": "used_space (bytes)"
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "Database size (on primary)",
            "stacked": false,
            "normalize": true
        },
        {
            "id": "errors",
            "type": "graphic",
            "row": 5,
            "col": 5,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mailpostgresql;<< domu_tags >>",
                    "host": "CON",
                    "name": "postgresql_log-log_db-<< dbname >>-warns_mmmm",
                    "title": "PostgreSQL warnings"
                },
                {
                    "tag": "itype=mailpostgresql;<< domu_tags >>",
                    "host": "CON",
                    "name": "postgresql_log-log_db-<< dbname >>-errors_mmmm",
                    "title": "PostgreSQL errors"
                },
                {
                    "tag": "itype=mailpostgresql;<< domu_tags >>",
                    "host": "CON",
                    "name": "postgresql_log-log_db-<< dbname >>-fatals_mmmm",
                    "title": "PostgreSQL fatals"
                }
            ],
            "consts": [],
            "title": "Log errors",
            "normalize": false,
            "stacked": false
        }
    ]
}
