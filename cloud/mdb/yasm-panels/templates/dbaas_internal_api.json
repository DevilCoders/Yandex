<% set tags = 'itype=mdbapi;ctype=mdb-api-porto-prod' %>
<%
    set databases = {
        'sas': 'meta01h',
        'myt': 'meta01f',
        'man': 'meta01i',
    }
%>
<% if env and env == 'porto-test' %>
<% set tags = 'itype=mdbapi;ctype=mdb-api-porto-test' %>
<%
    set databases = {
        'sas': 'meta-test01h',
        'man': 'meta-test01i',
        'vla': 'meta-test01k',
    }
%>
<% elif env and env == 'compute-prod' %>
<% set tags = 'itype=mdbapi;ctype=mdb-api-compute-prod' %>
<%
    set databases = {
        'myt': 'meta-dbaas01f',
        'sas': 'meta-dbaas01h',
        'vla': 'meta-dbaas01k',
    }
%>
<% elif env and env == 'compute-preprod' %>
<% set tags = 'itype=mdbapi;ctype=mdb-api-compute-preprod' %>
<%
    set databases = {
        'myt': 'meta-dbaas-preprod01f',
        'sas': 'meta-dbaas-preprod01h',
        'vla': 'meta-dbaas-preprod01k',
    }
%>
<% endif %>
<% set all_dbs_open = [] %>
<% set all_dbs_used = [] %>
<% for db in databases.values() %>
<% do all_dbs_open.append('unistat-dbaas_internal_api_db_' + db + '_conn_open_ammv') %>
<% do all_dbs_used.append('unistat-dbaas_internal_api_db_' + db + '_conn_used_ammv') %>
<% endfor %>
<% set dbs_open = 'sum(' + ', '.join(all_dbs_open) + ')' %>
<% set dbs_used = 'sum(' + ', '.join(all_dbs_used) + ')' %>
{
    "title": "DBaaS Internal API",
    "type": "panel",
    "charts": [
        {
            "id": "http_total",
            "type": "graphic",
            "width": 2,
            "height": 2,
            "row": 1,
            "col": 1,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "<< tags >>",
                    "host": "CON",
                    "name": "unistat-dbaas_internal_api_count_2xx_dmmm",
                    "title": "2xx",
                    "color": "#00FF00",
                    "active": true
                },
                {
                    "tag": "<< tags >>",
                    "host": "CON",
                    "name": "unistat-dbaas_internal_api_count_4xx_dmmm",
                    "title": "4xx",
                    "color": "#0000FF",
                    "active": true
                },
                {
                    "tag": "<< tags >>",
                    "host": "CON",
                    "name": "unistat-dbaas_internal_api_count_5xx_dmmm",
                    "title": "5xx",
                    "color": "#4B0082",
                    "active": true
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "HTTP codes",
            "stacked": false,
            "normalize": true
        },
        {
            "id": "http_timings",
            "type": "graphic",
            "width": 2,
            "height": 2,
            "row": 1,
            "col": 3,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "<< tags >>",
                    "host": "CON",
                    "name": "mul(100, div(unistat-dbaas_internal_api_timings_less_100_dmmm, unistat-dbaas_internal_api_count_dmmm))",
                    "title": "0-100ms",
                    "color": "#34c924",
                    "active": true
                },
                {
                    "tag": "<< tags >>",
                    "host": "CON",
                    "name": "mul(100, div(unistat-dbaas_internal_api_timings_less_500_dmmm, unistat-dbaas_internal_api_count_dmmm))",
                    "title": "0-500ms",
                    "color": "#5da130",
                    "active": true
                },
                {
                    "tag": "<< tags >>",
                    "host": "CON",
                    "name": "mul(100, div(unistat-dbaas_internal_api_timings_less_1000_dmmm, unistat-dbaas_internal_api_count_dmmm))",
                    "title": "0-1s",
                    "color": "#1560bd",
                    "active": true
                },
                {
                    "tag": "<< tags >>",
                    "host": "CON",
                    "name": "mul(100, div(unistat-dbaas_internal_api_timings_less_10000_dmmm, unistat-dbaas_internal_api_count_dmmm))",
                    "title": "0-10s",
                    "color": "#c41e3a",
                    "active": true
                }
            ],
            "consts": [],
            "range": 1500,
            "maxValue": 100,
            "minValue": 0,
            "title": "HTTP timings",
            "stacked": false,
            "normalize": false,
        },
        {
            "id": "db_conn",
            "type": "graphic",
            "width": 2,
            "height": 2,
            "row": 1,
            "col": 5,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "<< tags >>",
                    "host": "CON",
                    "name": "<< dbs_used >>",
                    "title": "used",
                    "color": "#0000ff",
                    "active": true
                },
                {
                    "tag": "<< tags >>",
                    "host": "CON",
                    "name": "<< dbs_open >>",
                    "title": "open",
                    "color": "#BA55D3",
                    "active": true
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "DB Connections",
            "stacked": false,
            "normalize": false
        },
        {
            "id": "http_5xx",
            "type": "graphic",
            "width": 2,
            "height": 2,
            "row": 3,
            "col": 1,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "<< tags >>;geo=man",
                    "host": "CON",
                    "name": "unistat-dbaas_internal_api_count_5xx_dmmm",
                    "title": "man",
                    "color": "#0000ff",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=iva",
                    "host": "CON",
                    "name": "unistat-dbaas_internal_api_count_5xx_dmmm",
                    "title": "iva",
                    "color": "#BA55D3",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=myt",
                    "host": "CON",
                    "name": "unistat-dbaas_internal_api_count_5xx_dmmm",
                    "title": "myt",
                    "color": "#F7A100",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=sas",
                    "host": "CON",
                    "name": "unistat-dbaas_internal_api_count_5xx_dmmm",
                    "title": "sas",
                    "color": "#006e4c",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=vla",
                    "host": "CON",
                    "name": "unistat-dbaas_internal_api_count_5xx_dmmm",
                    "title": "vla",
                    "color": "#fe1d0c",
                    "active": true
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "HTTP 5xx errors by DC",
            "stacked": false,
            "normalize": true
        },
        {
            "id": "http_4xx",
            "type": "graphic",
            "width": 2,
            "height": 2,
            "row": 3,
            "col": 3,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "<< tags >>;geo=man",
                    "host": "CON",
                    "name": "unistat-dbaas_internal_api_count_4xx_dmmm",
                    "title": "man",
                    "color": "#0000ff",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=iva",
                    "host": "CON",
                    "name": "unistat-dbaas_internal_api_count_4xx_dmmm",
                    "title": "iva",
                    "color": "#BA55D3",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=myt",
                    "host": "CON",
                    "name": "unistat-dbaas_internal_api_count_4xx_dmmm",
                    "title": "myt",
                    "color": "#F7A100",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=sas",
                    "host": "CON",
                    "name": "unistat-dbaas_internal_api_count_4xx_dmmm",
                    "title": "sas",
                    "color": "#006e4c",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=vla",
                    "host": "CON",
                    "name": "unistat-dbaas_internal_api_count_4xx_dmmm",
                    "title": "vla",
                    "color": "#fe1d0c",
                    "active": true
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "HTTP 4xx replies by DC",
            "stacked": false,
            "normalize": true
        },
        {
            "id": "db_open",
            "type": "graphic",
            "width": 2,
            "height": 2,
            "row": 3,
            "col": 5,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "<< tags >>;geo=man",
                    "host": "CON",
                    "name": "<< dbs_open >>",
                    "title": "man",
                    "color": "#0000ff",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=iva",
                    "host": "CON",
                    "name": "<< dbs_open >>",
                    "title": "iva",
                    "color": "#BA55D3",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=myt",
                    "host": "CON",
                    "name": "<< dbs_open >>",
                    "title": "myt",
                    "color": "#F7A100",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=sas",
                    "host": "CON",
                    "name": "<< dbs_open >>",
                    "title": "sas",
                    "color": "#006e4c",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=vla",
                    "host": "CON",
                    "name": "<< dbs_open >>",
                    "title": "vla",
                    "color": "#fe1d0c",
                    "active": true
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "DB Open connections",
            "stacked": true,
            "normalize": false
        },
        {
            "id": "http_2xx",
            "type": "graphic",
            "width": 2,
            "height": 2,
            "row": 5,
            "col": 1,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "<< tags >>;geo=man",
                    "host": "CON",
                    "name": "unistat-dbaas_internal_api_count_2xx_dmmm",
                    "title": "man",
                    "color": "#0000ff",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=iva",
                    "host": "CON",
                    "name": "unistat-dbaas_internal_api_count_2xx_dmmm",
                    "title": "iva",
                    "color": "#BA55D3",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=myt",
                    "host": "CON",
                    "name": "unistat-dbaas_internal_api_count_2xx_dmmm",
                    "title": "myt",
                    "color": "#F7A100",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=sas",
                    "host": "CON",
                    "name": "unistat-dbaas_internal_api_count_2xx_dmmm",
                    "title": "sas",
                    "color": "#006e4c",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=vla",
                    "host": "CON",
                    "name": "unistat-dbaas_internal_api_count_2xx_dmmm",
                    "title": "vla",
                    "color": "#fe1d0c",
                    "active": true
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "HTTP 2xx replies by DC",
            "stacked": true,
            "normalize": true
        },
        {
            "id": "http_slow",
            "type": "graphic",
            "width": 2,
            "height": 2,
            "row": 5,
            "col": 3,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "<< tags >>;geo=man",
                    "host": "CON",
                    "name": "diff(unistat-dbaas_internal_api_count_dmmm, unistat-dbaas_internal_api_timings_less_1000_dmmm)",
                    "title": "man",
                    "color": "#0000ff",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=iva",
                    "host": "CON",
                    "name": "diff(unistat-dbaas_internal_api_count_dmmm, unistat-dbaas_internal_api_timings_less_1000_dmmm)",
                    "title": "iva",
                    "color": "#BA55D3",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=myt",
                    "host": "CON",
                    "name": "diff(unistat-dbaas_internal_api_count_dmmm, unistat-dbaas_internal_api_timings_less_1000_dmmm)",
                    "title": "myt",
                    "color": "#F7A100",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=sas",
                    "host": "CON",
                    "name": "diff(unistat-dbaas_internal_api_count_dmmm, unistat-dbaas_internal_api_timings_less_1000_dmmm)",
                    "title": "sas",
                    "color": "#006e4c",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=vla",
                    "host": "CON",
                    "name": "diff(unistat-dbaas_internal_api_count_dmmm, unistat-dbaas_internal_api_timings_less_1000_dmmm)",
                    "title": "vla",
                    "color": "#fe1d0c",
                    "active": true
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "HTTP slow queries by DC",
            "stacked": false,
            "normalize": true
        },
        {
            "id": "db_used",
            "type": "graphic",
            "width": 2,
            "height": 2,
            "row": 5,
            "col": 5,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "<< tags >>;geo=man",
                    "host": "CON",
                    "name": "<< dbs_used >>",
                    "title": "man",
                    "color": "#0000ff",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=iva",
                    "host": "CON",
                    "name": "<< dbs_used >>",
                    "title": "iva",
                    "color": "#BA55D3",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=myt",
                    "host": "CON",
                    "name": "<< dbs_used >>",
                    "title": "myt",
                    "color": "#F7A100",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=sas",
                    "host": "CON",
                    "name": "<< dbs_used >>",
                    "title": "sas",
                    "color": "#006e4c",
                    "active": true
                },
                {
                    "tag": "<< tags >>;geo=vla",
                    "host": "CON",
                    "name": "<< dbs_used >>",
                    "title": "vla",
                    "color": "#fe1d0c",
                    "active": true
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "DB Used connections",
            "stacked": true,
            "normalize": false
        }
    ],
    "description": ""
}
