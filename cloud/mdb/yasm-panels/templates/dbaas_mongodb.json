<% set cid_tags = 'ctype=' ~ cid %>

<% if tier %>
<% set dom0_tags = 'tier=' ~ tier %>
<% set domu_tags = 'tier=' ~ tier %>
<% else %>
<% set dom0_tags = 'tier=primary,secondary,unknown' %>
<% set domu_tags = 'tier=primary,secondary,unknown' %>
<% endif %>

<% if geo %>
<% set dom0_tags = dom0_tags ~ ';geo=' ~ geo %>
<% set domu_tags = domu_tags ~ ';geo=' ~ geo %>
<% endif %>
{
<% if dbname %>
    "title": "Cluster: << cid >>; Database: << dbname >>",
<% else %>
    "title": "Cluster: << cid >>",
<% endif %>
    "type": "panel",
    "charts": [
        {
            "id": "cpu",
            "type": "graphic",
            "row": 1,
            "col": 1,
            "yAxis": [
                {
                    "minValue": 0,
                    "maxValue": 24
                },
                {
                    "minValue": 0,
                    "maxValue": 24
                }
            ],
            "signals": [
                {
                    "tag": "itype=mdbdom0;<< cid_tags >>;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-cpu_usage_cores_tmmv",
                    "title": "Used",
                    "yAxis": 0
                },
                {
                    "tag": "itype=mdbdom0;<< cid_tags >>;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-cpu_guarantee_cores_tmmv",
                    "title": "Guaranteed",
                    "stacked": false,
                    "yAxis": 1
                },
                {
                    "tag": "itype=mdbdom0;<< cid_tags >>;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-cpu_limit_cores_tmmv",
                    "title": "Limit",
                    "stacked": false,
                    "yAxis": 1
                },
                {
                    "tag": "itype=mdbdom0;<< cid_tags >>;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-cpu_wait_cores_tmmv",
                    "title": "Wait",
                    "yAxis": 0
                }
            ],
            "consts": [],
            "title": "CPU (Cores)",
            "stacked": true,
            "normalize": true
        },
        {
            "id": "mem",
            "type": "graphic",
            "row": 1,
            "col": 3,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mdbdom0;<< cid_tags >>;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-memory_usage_gb_tmmv",
                    "title": "Used"
                },
                {
                    "tag": "itype=mdbdom0;<< cid_tags >>;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-memory_guarantee_gb_tmmv",
                    "title": "Guaranteed"
                },
                {
                    "tag": "itype=mdbdom0;<< cid_tags >>;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-memory_limit_gb_tmmv",
                    "title": "Limit"
                },
                {
                    "tag": "itype=mdbdom0;<< cid_tags >>;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-anon_usage_gb_tmmv",
                    "title": "Anon used"
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "Memory (GB)",
            "stacked": false,
            "normalize": true
        },
        {
            "id": "io",
            "type": "graphic",
            "row": 1,
            "col": 5,
            "yAxis": [
                {
                    "minValue": 0,
                    "maxValue": 1000000000
                },
                {
                    "minValue": 0,
                    "maxValue": 1000000000
                }
            ],
            "signals": [
                {
                    "tag": "itype=mdbdom0;<< cid_tags >>;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-io_read_fs_bytes_tmmv",
                    "title": "read",
                    "normalizable": true,
                    "yAxis": 0
                },
                {
                    "tag": "itype=mdbdom0;<< cid_tags >>;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-io_write_fs_bytes_tmmv",
                    "title": "write",
                    "normalizable": true,
                    "yAxis": 0
                },
                {
                    "tag": "itype=mdbdom0;<< cid_tags >>;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-io_limit_bytes_tmmv",
                    "title": "limit",
                    "stacked": false,
                    "normalizable": true,
                    "yAxis": 1
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "I/O (B/s)",
            "stacked": true,
            "normalize": true
        },
        {
            "id": "net",
            "type": "graphic",
            "row": 3,
            "col": 1,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mdbdom0;<< cid_tags >>;<< dom0_tags >>",
                    "host": "CON",
                    "name": "sum(portoinst-net_rx_mb_summ, portoinst-net_tx_mb_summ)",
                    "title": "Used"
                },
                {
                    "tag": "itype=mdbdom0;<< cid_tags >>;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-net_guarantee_mb_summ",
                    "title": "Guaranteed"
                },
                {
                    "tag": "itype=mdbdom0;<< cid_tags >>;<< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-net_limit_mb_summ",
                    "title": "Limit"
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "Network (MB/s)",
            "stacked": false,
            "normalize": true
        },
        {
            "id": "conn",
            "type": "graphic",
            "row": 3,
            "col": 3,
            "yAxis": [
                {},
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mdbmongodb;<< cid_tags >>;<< domu_tags >>",
                    "host": "CON",
                    "name": "or(push-server_status_admin_connections.current_tmmx, push-server_status_admin_connections.current_vmmv)",
                    "yAxis": 0,
                    "title": "current"
                },
                {
                    "tag": "itype=mdbmongodb;<< cid_tags >>;<< domu_tags >>",
                    "host": "CON",
                    "name": "or(push-server_status_admin_connections.available_tmmx, push-server_status_admin_connections.available_vmmv)",
                    "yAxis": 0,
                    "title": "available"
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "Connections",
            "stacked": false,
            "normalize": true
        },
        {
            "id": "indexes",
            "type": "graphic",
            "row": 3,
            "col": 3,
            "yAxis": [
                {},
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mdbmongodb;tier=primary;<< cid_tags >>",
                    "host": "CON",
                    "name": "push-db_stats_*_indexSize_tmmx",
                    "yAxis": 0
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "Index Size (on Primary)",
            "stacked": false,
            "normalize": true
        },

        {
            "id": "rps",
            "type": "graphic",
            "row": 5,
            "col": 1,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mdbmongodb;<< cid_tags >>;<< domu_tags >>",
                    "host": "CON",                                  
                    "name": "or(push-server_status_admin_opcounters.command_rate_tmmx, push-server_status_admin_opcounters.command_rate_vmmv)",
                    "title": "command"
                },
                {
                   "tag": "itype=mdbmongodb;<< cid_tags >>;<< domu_tags >>",
                    "host": "CON",                                  
                    "name": "or(push-server_status_admin_opcounters.delete_rate_tmmx, push-server_status_admin_opcounters.delete_rate_vmmv)",
                    "title": "delete"
                },
                {
                    "tag": "itype=mdbmongodb;<< cid_tags >>;<< domu_tags >>",
                    "host": "CON",                                  
                    "name": "or(push-server_status_admin_opcounters.getmore_rate_tmmx, push-server_status_admin_opcounters.getmore_rate_vmmv)",
                    "title": "getmore"
                },
                {
                    "tag": "itype=mdbmongodb;<< cid_tags >>;<< domu_tags >>",
                    "host": "CON",
                    "name": "or(push-server_status_admin_opcounters.insert_rate_tmmx, push-server_status_admin_opcounters.insert_rate_vmmv)",
                    "title": "insert"
                },
                {
                    "tag": "itype=mdbmongodb;<< cid_tags >>;<< domu_tags >>",
                    "host": "CON",                                  
                    "name": "or(push-server_status_admin_opcounters.query_rate_tmmx, push-server_status_admin_opcounters.query_rate_vmmv)",
                    "title": "query"
                },
                {
                    "tag": "itype=mdbmongodb;<< cid_tags >>;<< domu_tags >>",
                    "host": "CON",                                  
                    "name": "or(push-server_status_admin_opcounters.update_rate_tmmx, push-server_status_admin_opcounters.update_rate_vmmv)",
                    "title": "update"
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "RPS",
            "stacked": false,
            "normalize": true
        },
        {
            "id": "size",
            "type": "graphic",
            "row": 5,
            "col": 3,
            "minValue": 0,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mdbmongodb;tier=primary;<< cid_tags >>",
                    "host": "CON",
<% if dbname %>
                    "name": "or(push-db_stats_<<dbname>>_storageSize_tmmx, push-db_stats_<<dbname>>_storageSize_vmmv)",
<% else %>
                    "name": "or(push-db_size_admin_totalSize_tmmx, push-db_size_admin_totalSize_vmmv)",
<% endif %>
                    "title": "db_size (bytes)"
                },
                {
                    "tag": "itype=mdbmongodb;tier=primary;<< cid_tags >>",
                    "host": "CON",
                    "name": "or(push-disk-total_bytes_/var/lib/mongodb_tmmx, push-disk-total_bytes_/var/lib/mongodb_vmmv)",
                    "title": "total_space (bytes)"
                },
                {
                    "tag": "itype=mdbmongodb;tier=primary;<< cid_tags >>",
                    "host": "CON",
                    "name": "or(push-disk-used_bytes_/var/lib/mongodb_tmmx, push-disk-used_bytes_/var/lib/mongodb_vmmv)",
                    "title": "used_space (bytes)"
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "Database size (on primary)",
            "stacked": false,
            "normalize": true
        }
        
        <% if dbname %>
        ,
        {
            "id": "dbstats",
            "type": "graphic",
            "row": 5,
            "col": 3,
            "minValue": 0,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mdbmongodb;tier=primary;<< cid_tags >>",
                    "host": "CON",
                    "name": "or(push-db_stats_<<dbname>>_avgObjSize_tmmx, push-db_stats_<<dbname>>_avgObjSize_vmmv)",
                    "title": "avgObjSize",
                    "yAxis": 0
                },
                {
                    "tag": "itype=mdbmongodb;tier=primary;<< cid_tags >>",
                    "host": "CON",
                    "name": "or(push-db_stats_<<dbname>>_collections_tmmx, push-db_stats_<<dbname>>_collections_vmmv)",
                    "title": "collections"                 ,
                    "yAxis": 1
                },
                {
                    "tag": "itype=mdbmongodb;tier=primary;<< cid_tags >>",
                    "host": "CON",
                    "name": "or(push-db_stats_<<dbname>>_dataSize_tmmx, push-db_stats_<<dbname>>_dataSize_vmmv)",
                    "title": "dataSize"                 ,
                    "yAxis": 0
                },
                {
                    "tag": "itype=mdbmongodb;tier=primary;<< cid_tags >>",
                    "host": "CON",
                    "name": "or(push-db_stats_<<dbname>>_indexSize_tmmx, push-db_stats_<<dbname>>_indexSize_vmmv)",
                    "title": "indexSize"                 ,
                    "yAxis": 0
                },
                {
                    "tag": "itype=mdbmongodb;tier=primary;<< cid_tags >>",
                    "host": "CON",
                    "name": "or(push-db_stats_<<dbname>>_indexes_tmmx, push-db_stats_<<dbname>>_indexes_vmmv)",
                    "title": "indexes"                 ,
                    "yAxis": 1
                },
                {
                    "tag": "itype=mdbmongodb;tier=primary;<< cid_tags >>",
                    "host": "CON",
                    "name": "or(push-db_stats_<<dbname>>_totalSize_tmmx, push-db_stats_<<dbname>>_totalSize_vmmv)",
                    "title": "numExtents"                 ,
                    "yAxis": 1
                },
                {
                    "tag": "itype=mdbmongodb;tier=primary;<< cid_tags >>",
                    "host": "CON",
                    "name": "or(push-db_stats_<<dbname>>_objects_tmmx, push-db_stats_<<dbname>>_objects_vmmv)",
                    "title": "objects"                 ,
                    "yAxis": 1
                },
                {
                    "tag": "itype=mdbmongodb;tier=primary;<< cid_tags >>",
                    "host": "CON",
                    "name": "or(push-db_stats_<<dbname>>_storageSize_tmmx, push-db_stats_<<dbname>>_storageSize_vmmv)",
                    "title": "storageSize"                 ,
                    "yAxis": 0
                },
                {
                    "tag": "itype=mdbmongodb;tier=primary;<< cid_tags >>",
                    "host": "CON",
                    "name": "or(push-db_stats_<<dbname>>_views_tmmx, push-db_stats_<<dbname>>_views_vmmv)",
                    "title": "views"                 ,
                    "yAxis": 1
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "Database stats",
            "stacked": false,
            "normalize": true
        }
        <% endif %>
    ]
}
