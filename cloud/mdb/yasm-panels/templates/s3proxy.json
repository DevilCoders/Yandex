<% set geo_colors = {
    'iva': '#37bff2',
    'myt': '#169833',
    'man': '#c93ead',
    'vla': '#f6ab31',
    'sas': '#ff1b1e',
} %>
<% set second_geo_colors = {
    'iva': '#77eff2',
    'myt': '#8bfb5a',
    'man': '#f99efd',
    'vla': '#f6eb51',
    'sas': '#ff9bae',
} %>
{
    "user": "annkpx",
    "title": "MDS + MDB S3 Proxy",
    "type": "panel",
    "editors": [
        "annkpx",
        "dsarafan"
    ],
    "charts":  [
        <% for i, geo in [(0, 'sas'), (1, 'myt'), (2, 'iva'), (3, 'vla'), (4, 'man')] %>
        {
            "type": "graphic",
            "width": 2,
            "height": 2,
            "row": << i * 3 + 2 >>,
            "col": 1,
            "title": "<< geo | upper >> MDS Proxy modify timings 99%",
            "signals": [
                {
                    "title": "Modify",
                    "color": "<< second_geo_colors[geo] | default(make_color(geo)) >>",
                    "tag": "itype=mdsproxy;ctype=prestable,production;geo=<< geo >>",
                    "host": "CON",
                    "name": "quant(mdsproxy_unistat-s3mds_nginx_modify_timings_hgram, 99)"
                },
                {
                    "title": "Read",
                    "color": "<< geo_colors[geo] | default(make_color(geo)) >>",
                    "tag": "itype=mdsproxy;ctype=prestable,production;geo=<< geo >>",
                    "host": "CON",
                    "name": "quant(mdsproxy_unistat-s3mds_nginx_read_timings_hgram, 99)"
                }
            ],
            "consts": []
        },
        {
            "type": "graphic",
            "width": 2,
            "height": 1,
            "row": << i * 3 + 1 >>,
            "col": 1,
            "title": "<< geo | upper >> Proxy Avg Query Time",
            "signals": [
                {
                    "color": "<< geo_colors[geo] | default(make_color(geo)) >>",
                    "tag": "itype=mailpostgresql;ctype=mail-s3int-proxy;geo=<< geo >>;prj=s3int-proxy",
                    "host": "CON",
                    "name": "pgbouncer-bouncer_s3db_avg_query_time_xxxv"
                }
            ],
            "consts": []
        },
        {
            "type": "graphic",
            "width": 2,
            "height": 1,
            "row": << i * 3 + 3 >>,
            "col": 3,
            "title": "<< geo | upper >> MDS nginx errors",
            "stacked": true,
            "signals": [
                {
                    "title": "Modify",
                    "tag": "itype=mdsproxy;ctype=prestable,production;geo=<< geo >>",
                    "color": "<< second_geo_colors[geo] | default(make_color(geo)) >>",
                    "host": "CON",
                    "name": "sum(mdsproxy_unistat-s3mds_nginx_PUT_5xx_dmmm,mdsproxy_unistat-s3mds_nginx_POST_5xx_dmmm,mdsproxy_unistat-s3mds_nginx_DELETE_5xx_dmmm)"
                },
                {
                    "title": "Read",
                    "tag": "itype=mdsproxy;ctype=prestable,production;geo=<< geo >>",
                    "color": "<< geo_colors[geo] | default(make_color(geo)) >>",
                    "host": "CON",
                    "name": "sum(mdsproxy_unistat-s3mds_nginx_GET_5xx_dmmm,mdsproxy_unistat-s3mds_nginx_HEAD_5xx_dmmm)"
                }
            ],
            "consts": []
        },
        {
            "type": "graphic",
            "width": 2,
            "height": 1,
            "row": << i * 3 + 1 >>,
            "col": 3,
            "title": "<< geo | upper >> Proxy RPS",
            "signals": [
                {
                    "color": "<< geo_colors[geo] | default(make_color(geo)) >>",
                    "tag": "itype=mailpostgresql;ctype=mail-s3int-proxy;geo=<< geo >>;prj=s3int-proxy",
                    "host": "CON",
                    "name": "pgbouncer-bouncer_s3db_total_query_count_ps_mmmm"
                }
            ],
            "consts": []
        },
        {
            "type": "graphic",
            "width": 2,
            "height": 1,
            "row": << i * 3 + 2 >>,
            "col": 3,
            "title": "<< geo | upper >> Proxy errors",
            "stacked": true,
            "signals": [
                {
                    "title": "s3api",
                    "color": "<< second_geo_colors[geo] | default(make_color(geo)) >>",
                    "tag": "itype=mailpostgresql;ctype=mail-s3int-proxy;geo=<< geo >>;prj=s3int-proxy",
                    "host": "CON",
                    "name": "postgresql_log-log_user-s3api-total-errors_mmmm"
                },
                {
                    "title": "s3api_ro",
                    "color": "<< geo_colors[geo] | default(make_color(geo)) >>",
                    "tag": "itype=mailpostgresql;ctype=mail-s3int-proxy;geo=<< geo >>;prj=s3int-proxy",
                    "host": "CON",
                    "name": "postgresql_log-log_user-s3api_ro-total-errors_mmmm"
                }
            ],
            "consts": []
        },
        <% endfor %>
    ]
}
