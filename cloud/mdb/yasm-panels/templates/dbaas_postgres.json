<% set cid_tags = 'ctype=' ~ cid %>
<% set dom0_tags = '' %>
<% set domu_tags = '' %>
<% if tier %>
<% set dom0_tags = dom0_tags ~ ';tier=' ~ tier %>
<% set domu_tags = domu_tags ~ ';tier=' ~ tier %>
<% else %>
<% set dom0_tags = dom0_tags ~ ';tier=primary,replica' %>
<% set domu_tags = domu_tags ~ ';tier=primary,replica' %>
<% endif %>
<% if geo %>
<% set dom0_tags = dom0_tags ~ ';geo=' ~ geo %>
<% set domu_tags = domu_tags ~ ';geo=' ~ geo %>
<% endif %>
{
<% if dbname %>
    "title": "Cluster: << cid >>; Database: << dbname >>",
<% else %>
    "title": "Cluster: << cid >>",
<% endif %>
    "type": "panel",
    "charts": [
        {
            "id": "cpu",
            "type": "graphic",
            "row": 1,
            "col": 1,
            "yAxis": [
                {
                    "minValue": 0,
                    "maxValue": 24
                },
                {
                    "minValue": 0,
                    "maxValue": 24
                }
            ],
            "signals": [
                {
                    "tag": "itype=mdbdom0;<< cid_tags >><< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-cpu_usage_cores_tmmv",
                    "title": "Used",
                    "yAxis": 0
                },
                {
                    "tag": "itype=mdbdom0;<< cid_tags >><< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-cpu_guarantee_cores_tmmv",
                    "title": "Guaranteed",
                    "stacked": false,
                    "yAxis": 1
                },
                {
                    "tag": "itype=mdbdom0;<< cid_tags >><< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-cpu_limit_cores_tmmv",
                    "title": "Limit",
                    "stacked": false,
                    "yAxis": 1
                },
                {
                    "tag": "itype=mdbdom0;<< cid_tags >><< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-cpu_wait_cores_tmmv",
                    "title": "Wait",
                    "yAxis": 0
                }
            ],
            "consts": [],
            "title": "CPU (Cores)",
            "stacked": true,
            "normalize": true
        },
        {
            "id": "mem",
            "type": "graphic",
            "row": 1,
            "col": 3,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mdbdom0;<< cid_tags >><< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-memory_usage_gb_tmmv",
                    "title": "Used"
                },
                {
                    "tag": "itype=mdbdom0;<< cid_tags >><< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-memory_guarantee_gb_tmmv",
                    "title": "Guaranteed"
                },
                {
                    "tag": "itype=mdbdom0;<< cid_tags >><< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-memory_limit_gb_tmmv",
                    "title": "Limit"
                },
                {
                    "tag": "itype=mdbdom0;<< cid_tags >><< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-anon_usage_gb_tmmv",
                    "title": "Anon used"
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "Memory (GB)",
            "stacked": false,
            "normalize": true
        },
        {
            "id": "io",
            "type": "graphic",
            "row": 1,
            "col": 5,
            "yAxis": [
                {
                    "minValue": 0,
                    "maxValue": 1000000000
                },
                {
                    "minValue": 0,
                    "maxValue": 1000000000
                }
            ],
            "signals": [
                {
                    "tag": "itype=mdbdom0;<< cid_tags >><< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-io_read_fs_bytes_tmmv",
                    "title": "read",
                    "normalizable": true,
                    "yAxis": 0
                },
                {
                    "tag": "itype=mdbdom0;<< cid_tags >><< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-io_write_fs_bytes_tmmv",
                    "title": "write",
                    "normalizable": true,
                    "yAxis": 0
                },
                {
                    "tag": "itype=mdbdom0;<< cid_tags >><< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-io_limit_bytes_tmmv",
                    "title": "limit",
                    "stacked": false,
                    "normalizable": true,
                    "yAxis": 1
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "I/O (B/s)",
            "stacked": true,
            "normalize": true
        },
        {
            "id": "net",
            "type": "graphic",
            "row": 3,
            "col": 1,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mdbdom0;<< cid_tags >><< dom0_tags >>",
                    "host": "CON",
                    "name": "sum(portoinst-net_rx_mb_summ, portoinst-net_tx_mb_summ)",
                    "title": "Used"
                },
                {
                    "tag": "itype=mdbdom0;<< cid_tags >><< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-net_guarantee_mb_summ",
                    "title": "Guaranteed"
                },
                {
                    "tag": "itype=mdbdom0;<< cid_tags >><< dom0_tags >>",
                    "host": "CON",
                    "name": "portoinst-net_limit_mb_summ",
                    "title": "Limit"
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "Network (MB/s)",
            "stacked": false,
            "normalize": true
        },
        {
            "id": "conn",
            "type": "graphic",
            "row": 3,
            "col": 3,
            "yAxis": [
                {},
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mailpostgresql;<< cid_tags >><< domu_tags >>",
                    "host": "CON",
<% if dbname %>
                    "name": "push-<< dbname >>_conn_active_vmmv",
<% else %>
                    "name": "push-postgres_conn_active_vmmv",
<% endif %>
                    "yAxis": 0,
                    "title": "active"
                },
                {
                    "tag": "itype=mailpostgresql;<< cid_tags >><< domu_tags >>",
                    "host": "CON",
<% if dbname %>
                    "name": "push-<< dbname >>_conn_idle_tmmx",
<% else %>
                    "name": "push-postgres_conn_idle_tmmx",
<% endif %>
                    "yAxis": 0,
                    "title": "idle"
                },
                {
                    "tag": "itype=mailpostgresql;<< cid_tags >><< domu_tags >>",
                    "host": "CON",
<% if dbname %>
                    "name": "push-<< dbname >>_conn_idle_in_transaction_tmmx",
<% else %>
                    "name": "push-postgres_conn_idle_in_transaction_tmmx",
<% endif %>
                    "yAxis": 0,
                    "title": "idle in transaction"
                },
                {
                    "tag": "itype=mailpostgresql;<< cid_tags >><< domu_tags >>",
                    "host": "CON",
<% if dbname %>
                    "name": "push-<< dbname >>_conn_aborted_tmmx",
<% else %>
                    "name": "push-postgres_conn_aborted_tmmx",
<% endif %>
                    "yAxis": 0,
                    "title": "aborted"
                },
                {
                    "tag": "itype=mailpostgresql;<< cid_tags >><< domu_tags >>",
                    "host": "CON",
<% if dbname %>
                    "name": "push-<< dbname >>_conn_waiting_tmmx",
<% else %>
                    "name": "push-postgres_conn_waiting_tmmx",
<% endif %>
                    "yAxis": 0,
                    "title": "waiting"
                },
                {
                    "tag": "itype=mailpostgresql;<< cid_tags >><< domu_tags >>",
                    "host": "CON",
<% if dbname %>
                    "name": "push-pooler-<< dbname >>_tcp_connections_tmmx",
<% else %>
                    "name": "push-pooler-total_tcp_connections_tmmx",
<% endif %>
                    "yAxis": 1,
                    "title": "bouncer"
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "Connections",
            "stacked": false,
            "normalize": true
        },
        {
            "id": "avgq",
            "type": "graphic",
            "row": 3,
            "col": 5,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mailpostgresql;<< cid_tags >><< domu_tags >>",
                    "host": "CON",
                    "name": "push-pooler-avg_query_time_vmmv",
                    "title": "avg statement, (ms)"
                },
                {
                    "tag": "itype=mailpostgresql;<< cid_tags >><< domu_tags >>",
                    "host": "CON",
                    "name": "push-pooler-avg_xact_time_vmmv",
                    "title": "avg transaction, (ms)"
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "Average query (ms)",
            "stacked": false,
            "normalize": true
        },
        {
            "id": "rps",
            "type": "graphic",
            "row": 5,
            "col": 1,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mailpostgresql;<< cid_tags >><< domu_tags >>",
                    "host": "CON",
<% if dbname %>
                    "name": "push-pooler-<< dbname >>_query_count_tmmx",
<% else %>
                    "name": "push-pooler-query_count_tmmx",
<% endif %>
                    "title": "statements per second"
                },
                {
                    "tag": "itype=mailpostgresql;<< cid_tags >><< domu_tags >>",
                    "host": "CON",
                    "name": "push-pooler-xact_count_vmmv",
                    "title": "transactions per second"
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "RPS",
            "stacked": false,
            "normalize": true
        },
        {
            "id": "size",
            "type": "graphic",
            "row": 5,
            "col": 3,
            "minValue": 0,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mailpostgresql;tier=primary;<< cid_tags >>",
                    "host": "CON",
<% if dbname %>
                    "name": "push-<< dbname >>_pg_database_size_tmmx",
<% else %>
                    "name": "push-postgres_pg_database_size_tmmx",
<% endif %>
                    "title": "db_size (bytes)"
                },
                {
                    "tag": "itype=mailpostgresql;tier=primary;<< cid_tags >>",
                    "host": "CON",
                    "name": "push-disk-total_bytes_pgdata_tmmx",
                    "title": "total_space (bytes)"
                },
                {
                    "tag": "itype=mailpostgresql;tier=primary;<< cid_tags >>",
                    "host": "CON",
                    "name": "push-disk-used_bytes_pgdata_tmmx",
                    "title": "used_space (bytes)"
                },
                {
                    "title": "wal size (bytes)",
                    "tag": "itype=mailpostgresql;tier=primary;<< cid_tags >>",
                    "host": "CON",
                    "name": "push-disk-path-size_pg_wal_bytes_tmmx"
                },
                {
                    "title": "temp file size (bytes)",
                    "tag": "itype=mailpostgresql;tier=primary;<< cid_tags >>",
                    "host": "CON",
                    "name": "push-disk-path-size_pgsql_tmp_bytes_tmmx"
                }
            ],
            "consts": [],
            "range": 1500,
            "title": "Database size (on primary)",
            "stacked": false,
            "normalize": true
        },
        {
            "id": "errors",
            "type": "graphic",
            "row": 5,
            "col": 5,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mailpostgresql;<< cid_tags >><< domu_tags >>",
                    "host": "CON",
<% if dbname %>
                    "name": "postgresql_log-log_db-<< dbname >>-warns_mmmm",
<% else %>
                    "name": "push-postgres-log_warnings_tmmx",
<% endif %>
                    "title": "PostgreSQL warnings"
                },
                {
                    "tag": "itype=mailpostgresql;<< cid_tags >><< domu_tags >>",
                    "host": "CON",
<% if dbname %>
                    "name": "postgresql_log-log_db-<< dbname >>-errors_mmmm",
<% else %>
                    "name": "push-postgres-log_errors_tmmx",
<% endif %>
                    "title": "PostgreSQL errors"
                },
                {
                    "tag": "itype=mailpostgresql;<< cid_tags >><< domu_tags >>",
                    "host": "CON",
<% if dbname %>
                    "name": "postgresql_log-log_db-<< dbname >>-fatals_mmmm",
<% else %>
                    "name": "push-postgres-log_fatals_tmmx",
<% endif %>
                    "title": "PostgreSQL fatals"
                }
            ],
            "consts": [],
            "title": "Log errors",
            "normalize": false,
            "stacked": false
        },
        {
            "id": "wait",
            "type": "graphic",
            "width": 2,
            "height": 2,
            "row": 7,
            "col": 1,
            "minValue": 0,
            "title": "Wait event stat (on primary)",
            "stacked": true,
            "normalize": true,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mailpostgresql;tier=primary;<< cid_tags >>",
                    "host": "CON",
                    "name": "push-postgres_wait_event_*"
                }
            ],
            "consts": [],
            "range": 1500
        },
        {
            "id": "transaction_quantiles",
            "type": "graphic",
            "row": 7,
            "col": 3,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mailpostgresql;<< cid_tags >><< domu_tags >>",
                    "host": "CON",
                    "name": "push-pooler-transaction_0.5_tmmx",
                    "title": "0.5"
                },
                {
                    "tag": "itype=mailpostgresql;<< cid_tags >><< domu_tags >>",
                    "host": "CON",
                    "name": "push-pooler-transaction_0.75_tmmx",
                    "title": "0.75"
                },
                {
                    "tag": "itype=mailpostgresql;<< cid_tags >><< domu_tags >>",
                    "host": "CON",
                    "name": "push-pooler-transaction_0.9_tmmx",
                    "title": "0.9"
                },
                {
                    "tag": "itype=mailpostgresql;<< cid_tags >><< domu_tags >>",
                    "host": "CON",
                    "name": "push-pooler-transaction_0.95_tmmx",
                    "title": "0.95"
                },
                {
                    "tag": "itype=mailpostgresql;<< cid_tags >><< domu_tags >>",
                    "host": "CON",
                    "name": "push-pooler-transaction_0.99_tmmx",
                    "title": "0.99"
                },
            ],
            "consts": [],
            "range": 1500,
            "title": "Transaction quantiles",
            "stacked": false,
            "normalize": true
        },
        {
            "id": "query_quantiles",
            "type": "graphic",
            "row": 7,
            "col": 5,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "tag": "itype=mailpostgresql;<< cid_tags >><< domu_tags >>",
                    "host": "CON",
                    "name": "push-pooler-query_0.5_tmmx",
                    "title": "0.5"
                },
                {
                    "tag": "itype=mailpostgresql;<< cid_tags >><< domu_tags >>",
                    "host": "CON",
                    "name": "push-pooler-query_0.75_tmmx",
                    "title": "0.75"
                },
                {
                    "tag": "itype=mailpostgresql;<< cid_tags >><< domu_tags >>",
                    "host": "CON",
                    "name": "push-pooler-query_0.9_tmmx",
                    "title": "0.9"
                },
                {
                    "tag": "itype=mailpostgresql;<< cid_tags >><< domu_tags >>",
                    "host": "CON",
                    "name": "push-pooler-query_0.95_tmmx",
                    "title": "0.95"
                },
                {
                    "tag": "itype=mailpostgresql;<< cid_tags >><< domu_tags >>",
                    "host": "CON",
                    "name": "push-pooler-query_0.99_tmmx",
                    "title": "0.99"
                },
            ],
            "consts": [],
            "range": 1500,
            "title": "Query quantiles",
            "stacked": false,
            "normalize": true
        },
        {
            "id": "replication_lag",
            "type": "graphic",
            "width": 2,
            "height": 2,
            "row": 9,
            "col": 1,
            "minValue": 0,
            "title": "Replication lag on all replicas (seconds)",
            "stacked": false,
            "normalize": true,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "color": "#e85b4e",
                    "tag": "itype=mailpostgresql;tier=replica;<< cid_tags >>",
                    "host": "CON",
                    "name": "push-postgres-replication_lag_tmmx"
                }
            ],
            "consts": [],
            "range": 1500
        },
        {
            "id": "oldest_transaction",
            "type": "graphic",
            "width": 2,
            "height": 2,
            "row": 9,
            "col": 3,
            "minValue": 0,
            "title": "Age of oldest transaction (seconds)",
            "stacked": false,
            "normalize": true,
            "yAxis": [
                {}
            ],
            "signals": [
                {
                    "color": "#e85b4e",
                    "tag": "itype=mailpostgresql;<< cid_tags >>",
                    "host": "CON",
                    "name": "push-postgres_oldest_transaction_duration_tmmx"
                },
                {
                    "color": "#e85b4e",
                    "tag": "itype=mailpostgresql;<< cid_tags >>",
                    "host": "CON",
                    "name": "push-postgres_oldest_prepared_xact_duration_tmmx"
                }
            ],
            "consts": [],
            "range": 1500
        }
    ]
}
