info: MAJOR update of PRESATBLE MongoDB 3.6 version to 4.0
clusters_selection:
  db: >-
    SELECT
      cid
    FROM dbaas.clusters c JOIN dbaas.pillar p USING(cid) WHERE
      c.type = 'mongodb_cluster'
      AND c.status = 'RUNNING'
      AND CAST(p.value #>> '{data,mongodb,version,major_num}' AS int) = 306
      AND c.env = ANY(CAST('{qa}' AS dbaas.env_type[]))
pillar_change: >-
  UPDATE dbaas.pillar p SET value = jsonb_set(value, '{data,mongodb,version}', '{"major_num":: "400", "major_human":: "4.0", "full_num":: "40025"}') WHERE
     p.cid = :cid
worker:
  operation_type: mongodb_cluster_modify
  task_type: mongodb_cluster_maintenance
  task_args:
    run_highstate: true
    restart: true
  timeout: 24h
max_delay_days: 21
min_days: 7
