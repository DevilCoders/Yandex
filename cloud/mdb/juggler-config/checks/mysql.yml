- juggler_check:
  args: "{{ mysql_common_checks | hash_merge( unreach_pass, item ) }}"
  with_items:
    - service: mysql-ping
      refresh_time: 60
      children:
        service: mysql_ping

- juggler_check:
  args: "{{ mysql_common_checks | hash_merge( mysql_unreach_pass, item ) }}"
  with_items:
    - service: mysql-connections
      flap:
        stable: 180
        critical: 240
      refresh_time: 60
      children:
        service: mysql_connections

- juggler_check:
  args: "{{ mysql_common_checks | hash_merge( mysql_unreach_pass, item ) }}"
  with_items:
    - service: mysql-log-errors
      refresh_time: 180
      children:
        service: mysql_log_errors

- juggler_check:
  args: "{{ mysql_common_checks | hash_merge( mysql_unreach_pass, item ) }}"
  with_items:
    - service: mysql-binlogs-archived
      flap:
        stable: 300
        critical: 600
      refresh_time: 60
      children:
        service: mysql_binlogs_archived

- juggler_check:
  args: "{{ mysql_common_checks | hash_merge( mysql_unreach_pass, item ) }}"
  with_items:
    - service: mysql-backup-age
      refresh_time: 1200
      ttl: 7200
      notifications: "{{ notifications_worktime }}"
      children:
        service: mysql_backup_age
      meta:
        urls:
          - title: "How to handle?"
            url: "https://wiki.yandex-team.ru/mdb/internal/operations/duty-howto/mysql/#nesnimajutsjabjekapynareplikemysql/"
            type: "mdb"

- juggler_check:
  args: "{{ mysql_common_checks | hash_merge( mysql_unreach_pass, item ) }}"
  with_items:
    - service: mysql-replication-lag
      flap:
        stable: 300
        critical: 600
      refresh_time: 60
      children:
        service: mysql_replication_lag
      aggregator_kwargs:
        crit_limit: 15
      meta:
        urls:
          - title: "How to handle?"
            url: "https://wiki.yandex-team.ru/mdb/internal/operations/duty-howto/mysql/#slejjvmysqlotstaet"
            type: "mdb"

- juggler_check:
  args: "{{ mysql_common_checks | hash_merge( mysql_unreach_pass, item ) }}"
  with_items:
    - service: mysql-slave-running
      flap:
        stable: 300
        critical: 600
      refresh_time: 60
      children:
        service: mysql_slave_running

- juggler_check:
  args: "{{ mysql_common_checks | hash_merge( mysql_unreach_pass, item ) }}"
  with_items:
    - service: mysql-semisync-master-wait
      flap:
        stable: 300
        critical: 600
      refresh_time: 60
      children:
        service: mysql_semisync_master_wait

- juggler_check:
  args: "{{ mysql_common_checks | hash_merge( mysql_unreach_pass, item ) }}"
  with_items:
    - service: mysql-semisync-master-clients
      flap:
        stable: 300
        critical: 600
      refresh_time: 60
      children:
        service: mysql_semisync_master_clients

- juggler_check:
  args: "{{ mysql_common_checks | hash_merge( mysql_unreach_pass, item ) }}"
  with_items:
    - service: mysql-master-readonly
      flap:
        stable: 300
        critical: 600
      refresh_time: 60
      children:
        service: mysql_master_readonly

- juggler_check:
  args: "{{ mysql_common_checks | hash_merge( unreach_pass, item ) }}"
  with_items:
    - service: mysync-running
      refresh_time: 60
      children:
        service: mysync_running

- juggler_check:
  args: "{{ mysql_common_checks | hash_merge( unreach_pass, item ) }}"
  with_items:
    - service: mysync-maintenance
      refresh_time: 180
      children:
        service: mysync_maintenance

- juggler_check:
  args: "{{ mysql_common_checks | hash_merge( unreach_pass, item ) }}"
  with_items:
    - service: mysync-switchover
      refresh_time: 180
      children:
        service: mysync_switchover

- juggler_check:
  args: "{{ mysql_common_checks | hash_merge( unreach_pass, item ) }}"
  with_items:
    - service: mysync-emerge
      refresh_time: 180
      children:
        service: mysync_emerge

- juggler_check:
  args: "{{ dict() | hash_replace(mysql_common_checks, dict(aggregator='timed_more_than_limit_is_problem', aggregator_kwargs=dict( limits=( dict(day_start=1, day_end=5, time_start=10, time_end=20, crit=1), dict(day_start=6, day_end=7, time_start=0, time_end=23, warn=1, crit=3), dict(day_start=1, day_end=5, time_start=20, time_end=10, warn=1, crit=3) ) ))) | hash_merge( mysql_unreach_pass, item ) }}"
  with_items:
    - service: tls
      refresh_time: 3600
      ttl: 14400
      children:
        service: tls

- juggler_check:
  args: "{{ mysql_common_checks | hash_merge( mysql_unreach_pass, item ) }}"
  with_items:
    - service: superusers-check
      refresh_time: 600
      children:
        service: superusers_check
      aggregator_kwargs:
        nodata_mode: skip

- juggler_check:
  args: "{{ mysql_common_checks | hash_merge( mysql_unreach_pass, item ) }}"
  with_items:
    - service: mysql-splitbrain
      refresh_time: 60
      children:
        service: mysql_splitbrain
      aggregator_kwargs:
        nodata_mode: skip

- juggler_check:
  args: "{{ mysql_common_checks | hash_merge( mysql_unreach_pass, item ) }}"
  with_items:
    - service: mysql-binlogs-gaps
      refresh_time: 1200
      ttl: 3600
      notifications: "{{ notifications_worktime }}"
      children:
        service: mysql_binlogs_gaps
      meta:
        urls:
          - title: "How to handle?"
            url: "https://wiki.yandex-team.ru/mdb/internal/operations/duty-howto/mysql/#wal-gviditdyruvbinlogax"
            type: "mdb"