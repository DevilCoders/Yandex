- juggler_check:
    host: "{{ host }}"
    service: scheduler_plan
    namespace: "{{ namespace }}"
    notifications: "{{ notifications_backup_create | default(notifications)  }}"
    aggregator: logic_or
    aggregator_kwargs:
      mode: "{{ ( common_checks.aggregator_kwargs | default(dict(mode='CRIT')) ).mode  }}"
    tags:
      - "mdb.{{ installation }}"
    refresh_time: 60
    ttl: 1800
    children:
      name: "(host={{ cgroup }} & service={{ ctype }}_scheduler_plan)"
      type: "EVENTS"
      service: all
      instance: all
    __force__: True
    meta:
      urls:
        - {title: "How to handle?", url: "https://wiki.yandex-team.ru/mdb/internal/operations/duty-howto/backup-service/#schedulerplan", type: "mdb"}

- juggler_check:
    host: "{{ host }}"
    service: scheduler_obsolete
    namespace: "{{ namespace }}"
    notifications: "{{ notifications_backup_delete | default(notifications)  }}"
    aggregator: logic_or
    aggregator_kwargs:
      mode: "{{ ( common_checks.aggregator_kwargs | default(dict(mode='CRIT')) ).mode  }}"
    tags:
      - "mdb.{{ installation }}"
    refresh_time: 60
    ttl: 1800
    children:
      name: "(host={{ cgroup }} & service={{ ctype }}_scheduler_obsolete)"
      type: "EVENTS"
      service: all
      instance: all
    __force__: True
    meta:
      urls:
        - {title: "How to handle?", url: "https://wiki.yandex-team.ru/mdb/internal/operations/duty-howto/backup-service/#schedulerobsolete", type: "mdb"}


- juggler_check:
    host: "{{ host }}"
    service: scheduler_purge
    namespace: "{{ namespace }}"
    notifications: "{{ notifications_backup_delete | default(notifications)  }}"
    aggregator: logic_or
    aggregator_kwargs:
      mode: "{{ ( common_checks.aggregator_kwargs | default(dict(mode='CRIT')) ).mode  }}"
    tags:
      - "mdb.{{ installation }}"
    refresh_time: 60
    ttl: 1800
    children:
      name: "(host={{ cgroup }} & service={{ ctype }}_scheduler_purge)"
      type: "EVENTS"
      service: all
      instance: all
    __force__: True
    meta:
      urls:
        - {title: "How to handle?", url: "https://wiki.yandex-team.ru/mdb/internal/operations/duty-howto/backup-service/#schedulerpurge", type: "mdb"}


- juggler_check:
    host: "{{ host }}"
    service: backup_{{ ctype }}_lost_running
    namespace: "{{ namespace }}"
    notifications: "{{ notifications }}"
    aggregator: logic_or
    aggregator_kwargs:
        nodata_mode: skip
        mode: "{{ ( common_checks.aggregator_kwargs | default(dict(mode='CRIT')) ).mode  }}"
    tags:
        - "mdb.{{ installation }}"
        - backup-tasks
    refresh_time: 300
    ttl: 900
    children:
        name: "{{ cgroup }}"
        type: "CGROUP"
        service: backup_{{ ctype }}_lost_running
    __force__: True
    meta:
      urls:
        - {title: "How to handle?", url: "https://wiki.yandex-team.ru/mdb/internal/operations/duty-howto/backup-service/#lostrunning", type: "mdb"}


- juggler_check:
      host: "{{ host }}"
      service: backup_{{ ctype }}_recent_pending
      namespace: "{{ namespace }}"
      notifications: "{{ notifications }}"
      aggregator: logic_or
      aggregator_kwargs:
          nodata_mode: skip
          mode: "{{ ( common_checks.aggregator_kwargs | default(dict(mode='CRIT')) ).mode  }}"
      tags:
          - "mdb.{{ installation }}"
          - backup-tasks
      refresh_time: 300
      ttl: 900
      children:
          name: "{{ cgroup }}"
          type: "CGROUP"
          service: backup_{{ ctype }}_recent_pending
      __force__: True
      meta:
        urls:
          - {title: "How to handle?", url: "https://wiki.yandex-team.ru/mdb/internal/operations/duty-howto/backup-service/#recentpending", type: "mdb"}


- juggler_check:
      host: "{{ host }}"
      service: backup_{{ ctype }}_lost_pending
      namespace: "{{ namespace }}"
      notifications: "{{ notifications }}"
      aggregator: logic_or
      aggregator_kwargs:
          nodata_mode: skip
          mode: "{{ ( common_checks.aggregator_kwargs | default(dict(mode='CRIT')) ).mode  }}"
      tags:
          - "mdb.{{ installation }}"
          - backup-tasks
      refresh_time: 300
      ttl: 900
      children:
          name: "{{ cgroup }}"
          type: "CGROUP"
          service: backup_{{ ctype }}_lost_pending
      __force__: True
      meta:
        urls:
          - {title: "How to handle?", url: "https://wiki.yandex-team.ru/mdb/internal/operations/duty-howto/backup-service/#pendingtaskslost", type: "mdb"}


- juggler_check:
      host: "{{ host }}"
      service: backup_{{ ctype }}_create_error_last_hours
      namespace: "{{ namespace }}"
      notifications: "{{ notifications_backup_create | default(notifications)  }}"
      aggregator: logic_or
      aggregator_kwargs:
          nodata_mode: skip
          mode: "{{ ( common_checks.aggregator_kwargs | default(dict(mode='CRIT')) ).mode  }}"
      tags:
          - "mdb.{{ installation }}"
          - backup-tasks
      refresh_time: 300
      ttl: 900
      children:
          name: "{{ cgroup }}"
          type: "CGROUP"
          service: backup_{{ ctype }}_create_error_last_hours
      __force__: True
      meta:
        urls:
          - {title: "How to handle?", url: "https://wiki.yandex-team.ru/mdb/internal/operations/duty-howto/backup-service/#errorlasthours", type: "mdb"}


- juggler_check:
    host: "{{ host }}"
    service: backup_{{ ctype }}_delete_error_last_hours
    namespace: "{{ namespace }}"
    notifications: "{{ notifications_backup_delete | default(notifications)  }}"
    aggregator: logic_or
    aggregator_kwargs:
      nodata_mode: skip
      mode: "{{ ( common_checks.aggregator_kwargs | default(dict(mode='CRIT')) ).mode  }}"
    tags:
      - "mdb.{{ installation }}"
      - backup-tasks
    refresh_time: 300
    ttl: 900
    children:
      name: "{{ cgroup }}"
      type: "CGROUP"
      service: backup_{{ ctype }}_delete_error_last_hours
    __force__: True
    meta:
      urls:
        - {title: "How to handle?", url: "https://wiki.yandex-team.ru/mdb/internal/operations/duty-howto/backup-service/#errorlasthours", type: "mdb"}

- juggler_check:
    host: "{{ host }}"
    service: backup_{{ ctype }}_create_error_last_days
    namespace: "{{ namespace }}"
    notifications: "{{ notifications_worktime }}"
    aggregator: logic_or
    aggregator_kwargs:
      nodata_mode: skip
      mode: "{{ ( common_checks.aggregator_kwargs | default(dict(mode='CRIT')) ).mode  }}"
    tags:
      - "mdb.{{ installation }}"
      - backup-tasks
    refresh_time: 300
    ttl: 900
    children:
      name: "{{ cgroup }}"
      type: "CGROUP"
      service: backup_{{ ctype }}_create_error_last_days
    __force__: True
    meta:
      urls:
        - {title: "How to handle?", url: "https://wiki.yandex-team.ru/mdb/internal/operations/duty-howto/backup-service/#errorlastdays", type: "mdb"}

- juggler_check:
    host: "{{ host }}"
    service: backup_{{ ctype }}_delete_error_last_days
    namespace: "{{ namespace }}"
    notifications: "{{ notifications_worktime }}"
    aggregator: logic_or
    aggregator_kwargs:
      nodata_mode: skip
      mode: "{{ ( common_checks.aggregator_kwargs | default(dict(mode='CRIT')) ).mode  }}"
    tags:
      - "mdb.{{ installation }}"
      - backup-tasks
    refresh_time: 300
    ttl: 900
    children:
      name: "{{ cgroup }}"
      type: "CGROUP"
      service: backup_{{ ctype }}_delete_error_last_days
    __force__: True
    meta:
      urls:
        - {title: "How to handle?", url: "https://wiki.yandex-team.ru/mdb/internal/operations/duty-howto/backup-service/#errorlastdays", type: "mdb"}
