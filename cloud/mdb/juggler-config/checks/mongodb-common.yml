- juggler_check:
  args: "{{ mongodb_common_checks | hash_merge( unreach_pass, item ) }}"
  with_items:
    - service: mongodb-ping
      flap:
        stable: 180
        critical: 240
      refresh_time: 60
      tags:
        - "mdb.{{ installation }}"
      children:
        service: mongodb_ping
      meta:
        urls:
          - { title: "How to handle?", url: "https://wiki.yandex-team.ru/mdb/internal/operations/duty-howto/mongodb/#mongodb-ping", type: "mdb" }

- juggler_check:
  args: "{{ mongodb_common_checks | hash_merge( mongodb_unreach_pass, item ) }}"
  with_items:
    - service: mongodb-locked-queue
      flap:
        stable: 180
        critical: 240
      refresh_time: 60
      tags:
        - "mdb.{{ installation }}"
      children:
        service: mongodb_locked_queue
      meta:
        urls:
          - { title: "How to handle?", url: "https://wiki.yandex-team.ru/mdb/internal/operations/duty-howto/mongodb/#mongodb-locked-queue", type: "mdb" }

- juggler_check:
  args: "{{ mongodb_common_checks | hash_merge( mongodb_unreach_pass, item ) }}"
  with_items:
    - service: mongodb-primary-exists
      flap:
        stable: 180
        critical: 240
      refresh_time: 60
      tags:
        - "mdb.{{ installation }}"
      children:
        service: mongodb_primary_exists
      meta:
        urls:
          - { title: "How to handle?", url: "https://wiki.yandex-team.ru/mdb/internal/operations/duty-howto/mongodb/#mongodb-primary-exists", type: "mdb" }

- juggler_check:
  args: "{{ mongodb_common_checks | hash_merge( mongodb_unreach_pass, item ) }}"
  with_items:
    - service: mongodb-role-changed
      flap:
        stable: 180
        critical: 240
      refresh_time: 60
      tags:
        - "mdb.{{ installation }}"
      children:
        service: mongodb_role_changed
      meta:
        urls:
          - { title: "How to handle?", url: "https://wiki.yandex-team.ru/mdb/internal/operations/duty-howto/mongodb/#mongodb-role-changed", type: "mdb" }

- juggler_check:
  args: "{{ mongodb_common_checks | hash_merge( mongodb_unreach_pass, item ) }}"
  with_items:
    - service: mongodb-replication-lag
      flap:
        stable: 300
        critical: 600
      refresh_time: 60
      tags:
        - "mdb.{{ installation }}"
      children:
          service: mongodb_replication_lag
      meta:
        urls:
          - { title: "How to handle?", url: "https://wiki.yandex-team.ru/mdb/internal/operations/duty-howto/mongodb/#mongodb-replication-lag", type: "mdb" }

- juggler_check:
  args: "{{ mongodb_workhours_checks | hash_merge( mongodb_unreach_pass, item ) | hash_merge( sms_only, item ) }}"
  with_items:
    - service: walg-backup-age
      refresh_time: 1200
      tags:
        - "mdb.{{ installation }}"
      ttl: 3600
      children:
        service: walg_backup_age
      meta:
        urls:
          - { title: "How to handle?", url: "https://wiki.yandex-team.ru/mdb/internal/operations/duty-howto/mongodb/#walg-backup-age", type: "mdb" }

- juggler_check:
  args: "{{ mongodb_workhours_checks | hash_merge( mongodb_unreach_pass, item ) }}"
  with_items:
    - service: walg-oplog-push
      refresh_time: 60
      tags:
        - "mdb.{{ installation }}"
      flap:
        stable: 120
        critical: 1800
      ttl: 3600
      children:
        service: walg_oplog_push
      meta:
        urls:
          - { title: "How to handle?", url: "https://wiki.yandex-team.ru/mdb/internal/operations/duty-howto/mongodb/#walg-oplog-push", type: "mdb" }

- juggler_check:
  args: "{{ dict() | hash_replace(mongodb_common_checks, dict(aggregator='logic_or', aggregator_kwargs=dict(mode='WARN'))) | hash_merge( mongodb_unreach_pass, item ) }}"
  with_items:
    - service: mongodb-session-count
      refresh_time: 60
      tags:
        - "mdb.{{ installation }}"
      ttl: 3600
      children:
        service: mongodb_session_count
      meta:
        urls:
          - { title: "How to handle?", url: "https://wiki.yandex-team.ru/mdb/internal/operations/duty-howto/mongodb/#mongodb-session-count", type: "mdb" }

- juggler_check:
  args: "{{ mongodb_important_checks | hash_merge( mongodb_unreach_pass, item ) }}"
  with_items:
    - service: mongodb-shard-primaries
      flap:
        stable: 1200
        critical: 2400
      refresh_time: 300
      tags:
        - "mdb.{{ installation }}"
      ttl: 3600
      children:
        service: mongodb_shard_primaries
      meta:
        urls:
          - { title: "How to handle?", url: "https://wiki.yandex-team.ru/mdb/internal/operations/duty-howto/mongodb/#mongodbshardprimaries", type: "mdb" }
