let total = avg(group_lines('sum', {cluster='<< metadb_cluster_name >>', service='<< metadb_service_id >>', project='<< project_id >>', host='by_node', node='primary', dc='by_node', shard='<< metadb_shard_name >>', name='dbaas_metadb_task_timings_hadoop_cluster_create/*'}));

let t10 = {cluster='<< metadb_cluster_name >>', service='<< metadb_service_id >>', project='<< project_id >>', host='by_node', node='primary', dc='by_node', shard='<< metadb_shard_name >>', name='dbaas_metadb_task_timings_hadoop_cluster_create/10min'};

let t20 = {cluster='<< metadb_cluster_name >>', service='<< metadb_service_id >>', project='<< project_id >>', host='by_node', node='primary', dc='by_node', shard='<< metadb_shard_name >>', name='dbaas_metadb_task_timings_hadoop_cluster_create/20min'};

let t30 = {cluster='<< metadb_cluster_name >>', service='<< metadb_service_id >>', project='<< project_id >>', host='by_node', node='primary', dc='by_node', shard='<< metadb_shard_name >>', name='dbaas_metadb_task_timings_hadoop_cluster_create/30min'};

let t30_c = (count(t30) > 0) ? avg(t30) : 0;
let t20_c = (count(t20) > 0) ? avg(t20) - t30_c : 0;
let t10_c = (count(t10) > 0) ? avg(t10) - t20_c - t30_c : 0;

let is_yellow = (t20_c + t30_c) / total >= 0.1;
let is_red =  (t20_c + t30_c) / total >= 0.5;
let trafficColor = is_red ? 'red' : (is_yellow ? 'yellow' : 'green');
let over20 = 0 + t20_c + t30_c;
let over45 = 0;
alarm_if(is_red);
warn_if(is_yellow);
