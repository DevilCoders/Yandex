let t20 = {cluster='<< metadb_cluster_name >>', service='<< metadb_service_id >>', project='<< project_id >>', host='by_node', node='primary', dc='by_node', shard='<< metadb_shard_name >>', name='dbaas_metadb_task_timings_redis_cluster_create/20min'};

let t30 = {cluster='<< metadb_cluster_name >>', service='<< metadb_service_id >>', project='<< project_id >>', host='by_node', node='primary', dc='by_node', shard='<< metadb_shard_name >>', name='dbaas_metadb_task_timings_redis_cluster_create/30min'};

let t45 = {cluster='<< metadb_cluster_name >>', service='<< metadb_service_id >>', project='<< project_id >>', host='by_node', node='primary', dc='by_node', shard='<< metadb_shard_name >>', name='dbaas_metadb_task_timings_redis_cluster_create/45min'};

let t60 = {cluster='<< metadb_cluster_name >>', service='<< metadb_service_id >>', project='<< project_id >>', host='by_node', node='primary', dc='by_node', shard='<< metadb_shard_name >>', name='dbaas_metadb_task_timings_redis_cluster_create/60min'};

let total = avg(group_lines('sum', {cluster='<< metadb_cluster_name >>', service='<< metadb_service_id >>', project='<< project_id >>', host='by_node', node='primary', dc='by_node', shard='<< metadb_shard_name >>', name='dbaas_metadb_task_timings_redis_cluster_create/*'}));

let t60_c = (count(t60) > 0) ? max(t60) : 0;
let t45_c = (count(t45) > 0) ? max(t45)-t60_c : 0;
let t30_c = (count(t30) > 0) ? max(t30)-t45_c-t60_c : 0;
let t20_c = (count(t20) > 0) ? max(t20)-t30_c-t45_c-t60_c : 0;
let t20_ca = (count(t20) > 0) ? max(t20) : 0;

let is_yellow = (t20_c + t30_c + t60_c + t45_c) / total >= 0.1;
let is_red = (t60_c + t45_c) / total  >= 0.08;
let trafficColor = is_red ? 'red' : (is_yellow ? 'yellow' : 'green');
let over20 = 0 + t20_c + t30_c + t45_c + t60_c;
let over45 = 0 + t45_c + t60_c;
alarm_if(is_red);
warn_if(is_yellow);

