{
    "variables": {
        "image_family": "dataproc-image-{{ user `version` | replace_all `.` `-` }}",
        "commit": "{{ env `COMMIT` }}",
        "branch": "{{ env `YA_BRANCH` | lower }}"
    },
    "builders": [
        {
            "disk_size_gb": "15",
            "disk_type": "network-hdd",
            "endpoint": "{{ user `endpoint` }}",
            "subnet_id": "{{ user `subnet_id` }}",
            "folder_id": "{{ user `folder_id` }}",
            "image_description": "Yandex Cloud Dataproc base image version {{ user `version` }}",
            "image_family": "{{ user `image_family` }}-base",
            "image_labels": {
                "branch": "{{ user `branch` }}",
                "commit": "{{ user `commit` }}"
            },
            "image_name": "{{ user `image_family` }}-base-{{ timestamp }}",
            "instance_mem_gb": "8",
            "platform_id": "standard-v2",
            "source_image_family": "ubuntu-1604-lts",
            "ssh_username": "ubuntu",
            "state_timeout": "10m",
            "type": "yandex",
            "use_ipv4_nat": "{{ user `use_ipv4_nat` }}",
            "use_ipv6": "{{ user `use_ipv6` }}",
            "zone": "{{ user `zone` }}"
        }
    ],
    "provisioners": [
        {
            "environment_vars": [
                "ENABLE_GPU={{ user `enable_gpu` }}"
            ],
            "execute_command": "chmod +x {{ .Path }}; sudo {{ .Vars }} {{ .Path }}",
            "script": "scripts/bootstrap-base-1604.sh",
            "timeout": "30m",
            "type": "shell"
        }
    ]
}
