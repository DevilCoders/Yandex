version: '2.2'

services:
  zookeeper1:
    build:
      context: ./docker/zookeeper
      args:
        - VERSION=${ZK_VERSION}
    privileged: true
    hostname: gpsync_zookeeper1_1
    domainname: gpsync_gpsync_net
    init: true
    networks:
      gpsync_net:
        ipv4_address: 192.168.233.10
  zookeeper2:
    build:
      context: ./docker/zookeeper
      args:
        - VERSION=${ZK_VERSION}
    privileged: true
    hostname: gpsync_zookeeper2_1
    domainname: gpsync_gpsync_net
    init: true
    networks:
      gpsync_net:
        ipv4_address: 192.168.233.11
  zookeeper3:
    build:
      context: ./docker/zookeeper
      args:
        - VERSION=${ZK_VERSION}
    privileged: true
    hostname: gpsync_zookeeper3_1
    domainname: gpsync_gpsync_net
    init: true
    networks:
      gpsync_net:
        ipv4_address: 192.168.233.12
  postgresql1:
    build: ./docker/gpsync
    privileged: true
    hostname: gpsync_postgresql1_1
    domainname: gpsync_gpsync_net
    init: true
    extra_hosts:
     - "gpsync_postgresql2_1.gpsync_gpsync_net:192.168.233.14"
     - "gpsync_postgresql3_1.gpsync_gpsync_net:192.168.233.15"
     - "gpsync_zookeeper1_1.gpsync_gpsync_net:192.168.233.10"
     - "gpsync_zookeeper2_1.gpsync_gpsync_net:192.168.233.11"
     - "gpsync_zookeeper3_1.gpsync_gpsync_net:192.168.233.12"
    networks:
      gpsync_net:
        ipv4_address: 192.168.233.13
  postgresql2:
    build: ./docker/gpsync
    privileged: true
    hostname: gpsync_postgresql2_1
    domainname: gpsync_gpsync_net
    init: true
    extra_hosts:
     - "gpsync_postgresql1_1.gpsync_gpsync_net:192.168.233.13"
     - "gpsync_postgresql3_1.gpsync_gpsync_net:192.168.233.15"
     - "gpsync_zookeeper1_1.gpsync_gpsync_net:192.168.233.10"
     - "gpsync_zookeeper2_1.gpsync_gpsync_net:192.168.233.11"
     - "gpsync_zookeeper3_1.gpsync_gpsync_net:192.168.233.12"
    networks:
      gpsync_net:
        ipv4_address: 192.168.233.14
  postgresql3:
    build: ./docker/gpsync
    privileged: true
    hostname: gpsync_postgresql3_1
    domainname: gpsync_gpsync_net
    init: true
    extra_hosts:
     - "gpsync_postgresql1_1.gpsync_gpsync_net:192.168.233.13"
     - "gpsync_postgresql2_1.gpsync_gpsync_net:192.168.233.14"
     - "gpsync_zookeeper1_1.gpsync_gpsync_net:192.168.233.10"
     - "gpsync_zookeeper2_1.gpsync_gpsync_net:192.168.233.11"
     - "gpsync_zookeeper3_1.gpsync_gpsync_net:192.168.233.12"
    networks:
      gpsync_net:
        ipv4_address: 192.168.233.15
  jepsen:
    build: ./docker/jepsen
    hostname: gpsync_jepsen_1
    domainname: gpsync_gpsync_net
    init: true
    extra_hosts:
     - "gpsync_postgresql1_1.gpsync_gpsync_net:192.168.233.13"
     - "gpsync_postgresql2_1.gpsync_gpsync_net:192.168.233.14"
     - "gpsync_postgresql3_1.gpsync_gpsync_net:192.168.233.15"
     - "gpsync_zookeeper1_1.gpsync_gpsync_net:192.168.233.10"
     - "gpsync_zookeeper2_1.gpsync_gpsync_net:192.168.233.11"
     - "gpsync_zookeeper3_1.gpsync_gpsync_net:192.168.233.12"
    networks:
      gpsync_net:
        ipv4_address: 192.168.233.16

networks:
  gpsync_net:
    driver: bridge
    ipam:
      driver: default
      config:
       - subnet: 192.168.233.0/24
         gateway: 192.168.233.1
