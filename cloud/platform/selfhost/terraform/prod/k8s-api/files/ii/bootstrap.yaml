write_files:
# SKM FTW!
- path: /etc/skm.yaml
  metadata_key: skm-config

# Configs
- path: /etc/k8sapi/k8sapi.yaml
  metadata_key: k8sapi-config

- path: /etc/k8s-api-proxy/config.yaml
  metadata_key: k8sapi-proxy-config

- path: /etc/metricsagent/metricsagent.yaml
  metadata_key: metricsagent-config

- path: /etc/yandex/statbox-push-client/push-client.yaml
  metadata_key: push-client-config

# Hack
- path: /usr/bin/base64decode_secrets.sh
  metadata_key: base64-decoder-sh
  permissions: "0755"

- path: /etc/k8sapi/ssl/certs/allCAs.pem
  metadata_key: yandex-ca

# Secrets
- path: /etc/k8sapi/kubeconfig.yaml.enc.b64
  metadata_key: kubeconfig

- path: /etc/k8sapi/yc-sa-key.json.enc.b64
  metadata_key: service-sa-key

- path: /etc/k8sapi/ssl/certs/server.crt.enc.b64
  metadata_key: server-crt

- path: /etc/k8sapi/ssl/private/server.key.enc.b64
  metadata_key: server-key

- path: /var/lib/kubelet/config.json.enc.b64
  metadata_key: registry-auth

- path: /etc/metricsagent/oauth_token.enc.b64
  metadata_key: metricsagent-auth


run_cmd:
- path: /usr/bin/base64decode_secrets.sh
- path: systemctl
  args:
  - restart
  - skm
- path: systemctl
  args:
  - restart
  - kubelet
