# Update:
#
#  $ ycp --profile=prod load-balancer network-load-balancer update b7rfqdak0ues2m8i8rce -r files/l3-v4-nlb.yaml
#

# Executed command:
# $ ycp load-balancer network-load-balancer create -r files/l3-v4-nlb.yaml --profile prod
# done (9s)
# id: b7rfqdak0ues2m8i8rce
# region_id: "ru-central1"
# type: EXTERNAL
# folder_id: "b1gjdkej39hkol2v3kue"

update_mask: {paths: [attached_target_groups]} # Extra safety.

name: "platform-l7-serverless-gateway-v4-lb"
description: "LB for Serverless API Gateway (v4)"
labels: {}
listener_specs:
  - name: "tls"
    port: 443
    target_port: 2443
    protocol: TCP
    external_address_spec:
      ip_version: IPV4
      address: "84.201.185.129" # address with enabled DDoS protection
  - name: "plaintext"
    port: 80
    target_port: 2080
    protocol: TCP
    external_address_spec:
      address: "84.201.185.129" # address with enabled DDoS protection
      ip_version: IPV4
attached_target_groups:
  - target_group_id: "b7rnq8999f4ujjsd660a"
    health_checks:
      - name: "envoy"
        timeout: 1s
        interval: 2s
        unhealthy_threshold: 2
        healthy_threshold: 2
        http_options:
          port: 30080
          path: /ready/no_drain