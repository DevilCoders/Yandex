# id: cl14gtcf0qibrnjvuhfu
name: serverless-gateway-ig-prod
labels:
  environment: prod
instance_template:
  labels:
    abc_svc: ycl7
    env: prod
    environment: prod
    layer: paas
    conductor-group: l7-serverless-gateway
    conductor-role: serverless-gateway
    yandex-dns: ig
  platform_id: standard-v1
  resources_spec:
    memory: 4g
    cores: 2
    core_fraction: 100
  metadata:
    # ./update_instance_group.sh will fill other metadata keys.
    environment: prod
    internal-hostname: serverless-gateway-prod-{instance.internal_dc}{instance.index_in_zone}
    internal-name: serverless-gateway-prod-{instance.internal_dc}{instance.index_in_zone}
    nsdomain: "{instance.internal_dc}.ycp.cloud.yandex.net"
    ma_cluster: cloud_prod_serverless_apigw
    yandex-dns: serverless-gateway-prod-{instance.internal_dc}{instance.index_in_zone}
    osquery_tag: ycloud-svc-l7-config
    internal-remove-target-after-stop: true
    kms-endpoint: kms.yandex
    push-client-ident: yc_api
    k8s-runtime-bootstrap-yaml: "---"
    skm: "{api_endpoint: xxx, kms_key_uri: yc-kms://xxx, encrypted_dek: AAAA}"
  boot_disk_spec:
    mode: READ_WRITE
    disk_spec:
      type_id: network-hdd
      size: 40g
      image_id: "fd80n4195viemfp2v1tv" # CLOUD-53121, 09.09.2020
  secondary_disk_specs:
  - mode: READ_WRITE
    device_name: data
    disk_spec:
      type_id: network-hdd
      size: 40g
  network_interface_specs:
  - network_id: enpo52300rfbh5a8hfmo # cloud-l7-prod-nets
    subnet_ids:
    - e9bi9drqb7rddf4od5jk # a
    - e2lo6auqjjfru2tfnorm # b
    - b0c3id3uje06qohkgmlg # c
    primary_v4_address_spec:
      name: ig-v4addr
    primary_v6_address_spec:
      name: ig-v6addr
  scheduling_policy:
    termination_grace_period: 600s
  service_account_id: ajemild2rlv99oio3827 # sa-l7-serverless-gateway-kms
scale_policy:
  fixed_scale:
    size: 6
deploy_policy:
  max_unavailable: 1
  max_deleting: 1
  max_creating: 6
  startup_duration: 0s
allocation_policy:
  zones:
  - zone_id: ru-central1-a
  - zone_id: ru-central1-b
  - zone_id: ru-central1-c
load_balancer_spec:
  target_group_spec:
    name: serverless-gateway-targetgroup-prod
    address_names:
    - ig-v4addr
    - ig-v6addr
service_account_id: ajeu2jq3rt54kkaarack

