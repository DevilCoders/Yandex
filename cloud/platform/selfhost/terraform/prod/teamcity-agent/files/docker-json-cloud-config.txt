#cloud-config
runcmd:
 - hostnamectl set-hostname ${fqdn}
 - mkdir /root/.docker || true
 - /usr/sbin/agent.sh || true

preserve_hostname: true
fqdn: ${fqdn}
hostname: ${fqdn}

write_files:
    - content: |
        {
          "auths": {
            "registry.yandex.net": {
              "auth": "${docker_auth}"
            },
            "cr.yandex": {
              "auth": "${docker_auth_cr_yandex}"
            },
            "cr.cloud-preprod.yandex.net": {
              "auth": "${docker_auth_cr_yandex_preprod}"
            }
          },
          "HttpHeaders": {
            "User-Agent": "Docker-Client/19.03.8-ce (linux) Teamcity agent (https://nda.ya.ru/3VnuTW)"
          }
        }
      owner: root:root
      path: /root/.docker/config.json
      permissions: '0600'