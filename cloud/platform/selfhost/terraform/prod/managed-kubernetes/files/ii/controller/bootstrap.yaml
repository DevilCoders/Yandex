write_files:
# SKM FTW!
- path: /etc/skm.yaml
  metadata_key: skm-config

# Configs
- path: /etc/mk8s-controller/mk8s-controller.yaml
  metadata_key: controller-config

- path: /etc/metricsagent/metricsagent.yaml
  metadata_key: metricsagent-config

- path: /root/.config/yandex-cloud/config.yaml
  metadata_key: yc-config

- path: /root/.config/ycp/config.yaml
  metadata_key: ycp-config

# Hack
- path: /usr/bin/base64decode_secrets.sh
  metadata_key: base64-decoder-sh
  permissions: "0755"

- path: /usr/bin/setup_kubectl.sh
  metadata_key: setup-kubectl-sh
  permissions: "0755"

# Secrets
- path: /etc/mk8s-controller/kubeconfig.yaml.enc.b64
  metadata_key: kubeconfig

- path: /etc/mk8s-controller/yc-sa-key.json.enc.b64
  metadata_key: service-sa-key

- path: /etc/mk8s-controller/s3_viewer_service_account_key.json.enc.b64
  metadata_key: addons-s3-viewer

- path: /etc/mk8s-controller/s3_editor_service_account_key.json.enc.b64
  metadata_key: addons-s3-editor

- path: /etc/mk8s-controller/cr-yandex-sa-key.json.enc.b64
  metadata_key: cr-yandex-sa-key

- path: /etc/mk8s-controller/deks/initial.enc.b64
  metadata_key: deks-initial

- path: /var/lib/kubelet/config.json.enc.b64
  metadata_key: registry-auth

- path: /etc/metricsagent/oauth_token.enc.b64
  metadata_key: metricsagent-auth


run_cmd:
- path: /usr/bin/base64decode_secrets.sh
- path: /usr/bin/setup_kubectl.sh
- path: systemctl
  args:
  - restart
  - skm
- path: systemctl
  args:
  - restart
  - kubelet
