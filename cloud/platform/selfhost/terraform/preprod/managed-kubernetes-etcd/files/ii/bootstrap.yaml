write_files:
# SKM FTW!
- path: /etc/skm.yaml
  metadata_key: skm-config

# Configs
- path: /etc/metricsagent/metricsagent.yaml
  metadata_key: metricsagent-config

# Configs
- path: /etc/kubelet.d/etcd.yaml
  metadata_key: etcd-pod
- path: /etc/kubelet.d/etcd-events.yaml
  metadata_key: etcd-events-pod

# Hack
- path: /usr/bin/base64decode_secrets.sh
  metadata_key: base64-decoder-sh
  permissions: "0755"

# Secrets
- path: /etc/kubernetes/pki/etcd/ca.crt.enc.b64
  metadata_key: ca-crt
- path: /etc/kubernetes/pki/etcd/healthcheck-client.crt.enc.b64
  metadata_key: healthcheck-client-crt
- path: /etc/kubernetes/pki/etcd/healthcheck-client.key.enc.b64
  metadata_key: healthcheck-client-key
- path: /etc/kubernetes/pki/etcd/peer.crt.enc.b64
  metadata_key: peer-crt
- path: /etc/kubernetes/pki/etcd/peer.key.enc.b64
  metadata_key: peer-key
- path: /etc/kubernetes/pki/etcd/server.crt.enc.b64
  metadata_key: server-crt
- path: /etc/kubernetes/pki/etcd/server.key.enc.b64
  metadata_key: server-key

- path: /var/lib/kubelet/config.json.enc.b64
  metadata_key: registry-auth

- path: /etc/metricsagent/oauth_token.enc.b64
  metadata_key: metricsagent-auth


run_cmd:
- path: /usr/bin/base64decode_secrets.sh
- path: systemctl
  args:
  - restart
  - skm
- path: systemctl
  args:
  - restart
  - kubelet
