node:
  cluster: apigateway
  id: ${id}
  locality:
    region: ${region}
    zone: ${zone}

admin:
  access_log_path: /dev/stdout
  address:
    socket_address:
      address: 127.0.0.1
      port_value: 9901

stats_config:
  use_all_default_tags: true

stats_sinks:
- name: envoy.statsd
  config:
    address:
      socket_address: { address: 127.0.0.1, port_value: 9125 }

tracing:
  http:
    name: envoy.dynamic.ot
    typed_config:
      "@type": type.googleapis.com/envoy.config.trace.v2.DynamicOtConfig
      library: /usr/local/lib/libjaegertracing_plugin.so
      config:
        service_name: api-router
        sampler: { type: const, param: 1 }
        reporter: { localAgentHostPort: 127.0.0.1:5775 }

cluster_manager:
  outlier_detection:
    event_log_path: /var/log/envoy/outlier_detection.log

dynamic_resources:
  ads_config:
    api_type: GRPC
    grpc_services:
    - envoy_grpc:
        cluster_name: xds_cluster
  cds_config:
    ads: {}
  lds_config:
    ads: {}

static_resources:
  secrets:
  - name: frontend_cert
    tls_certificate:
      certificate_chain:
        filename: /etc/envoy/ssl/certs/frontend.crt
      private_key:
        filename: /etc/envoy/ssl/private/frontend.key

  clusters:
  - name: sds
    connect_timeout: 0.25s
    http2_protocol_options: {}
    type: STATIC
    hosts:
    - pipe: { path: /tmp/sds/sock }
  - name: xds_cluster
    connect_timeout: 1s
    http2_protocol_options: {}
    common_http_protocol_options:
      idle_timeout: 30s
    upstream_connection_options:
      tcp_keepalive:
        keepalive_probes: 1
        keepalive_time: 10
        keepalive_interval: 10
    type: STATIC
    hosts:
    - socket_address:
        address: "2a02:6b8:c0e:501:0:f806:0:30"
        port_value: 443
    - socket_address:
        address: "2a02:6b8:c02:901:0:f806:0:30"
        port_value: 443
    - socket_address:
        address: "2a02:6b8:c03:501:0:f806:0:30"
        port_value: 443
    tls_context:
      sni: "xds.ycp.cloud-preprod.yandex.net"
      common_tls_context:
        tls_certificate_sds_secret_configs:
        - name: xds_client_cert
          sds_config:
            api_config_source:
              api_type: GRPC
              grpc_services:
                envoy_grpc: { cluster_name: sds }
        validation_context:
          trusted_ca:
            filename: /etc/envoy/ssl/certs/allCAs.pem

  - name: als
    connect_timeout: 0.25s
    http2_protocol_options: {}
    common_http_protocol_options:
      idle_timeout: 30s
    upstream_connection_options:
      tcp_keepalive:
        keepalive_probes: 1
        keepalive_time: 10
        keepalive_interval: 10
    type: STATIC
    hosts:
    - socket_address:
        address: 127.0.0.1
        port_value: 4436
