apiVersion: v1
kind: PodList
items:
${infra_pod_spec}
- apiVersion: v1
  kind: Pod
  metadata:
    name: api-router
    namespace: kube-system
    annotations:
      config_digest: ${config_digest}
      scheduler.alpha.kubernetes.io/critical-pod: ""
  spec:
    priority: 2000000001
    priorityClassName: system-cluster-critical
    hostNetwork: true
    initContainers:
    - name: deploy-configs
      image: registry.yandex.net/cloud/api/metadata:eee4b74b1
      volumeMounts:
      - name: all-configs
        mountPath: /etc
        terminationGracePeriodSeconds: 30
    containers:
    - name: envoy
      image: registry.yandex.net/cloud/api/envoy:v1.12.2-6-g82c84cd
      env:
      volumeMounts:
      - mountPath: /etc/envoy/
        name: envoy-config
        readOnly: true
      - mountPath: /etc/envoy/ssl/certs/
        name: envoy-certs
        readOnly: true
      - mountPath: /etc/envoy/ssl/private/
        name: envoy-keys
        readOnly: true
      - mountPath: /var/log/envoy
        name: envoy-logs
        terminationGracePeriodSeconds: 30
      - mountPath: /tmp/sds
        name: sds-sock
    - name: sds
      image: registry.yandex.net/cloud/api/sds:e03cac85c
      volumeMounts:
      - mountPath: /tmp/sds/
        name: sds-sock
      - mountPath: /etc/sds/
        name: sds-config
        readOnly: true
      - mountPath: /etc/envoy/
        name: envoy-config
        readOnly: true
    - name: statsd-exporter
      image: registry.yandex.net/cloud/api/statsd-exporter:v0.6.0
    - name: jaeger-agent
      image: jaegertracing/jaeger-agent:1.12.0
      args:
      - --reporter.grpc.host-port=jaeger-collector.private-api.ycp.cloud-preprod.yandex.net:443
      - --reporter.grpc.tls
      - --reporter.grpc.tls.ca=/etc/envoy/ssl/certs/allCAs.pem
      - --reporter.grpc.retry.max=100
      volumeMounts:
      - mountPath: /etc/envoy/ssl/certs/
        name: envoy-certs
        readOnly: true
    - name: api-als
      image: registry.yandex.net/cloud/api/als:eee4b74b1
      volumeMounts:
      - name: als-logs
        mountPath: /var/log/als
        terminationGracePeriodSeconds: 30
      - name: als-configs
        mountPath: /etc/als
        readOnly: true
      - name: etc-passwd
        mountPath: /etc/passwd
        readOnly: true
    - name: envoy-config-dumper
      image: registry.yandex.net/cloud/api/envoyconfigdumper:e03cac85c
      volumeMounts:
      - name: envoyconfigdumper-config
        mountPath: /etc/envoyconfigdumper/envoyconfigdumper.yaml
        readOnly: true
    volumes:
    - hostPath:
        path: /etc
        type: DirectoryOrCreate
      name: all-configs
    - hostPath:
        path: /etc/l7/configs/envoy
        type: DirectoryOrCreate
      name: envoy-config
    - hostPath:
        path: /etc/l7/configs/envoy/ssl/certs
        type: DirectoryOrCreate
      name: envoy-certs
    - hostPath:
        path: /etc/l7/configs/envoy/ssl/private
        type: DirectoryOrCreate
      name: envoy-keys
    - hostPath:
        path: /etc/l7/configs/envoyconfigdumper/envoyconfigdumper.yaml
      name: envoyconfigdumper-config
    - hostPath:
        path: /var/log/als
        type: DirectoryOrCreate
      name: als-logs
    - hostPath:
        path: /var/log/envoy
        type: DirectoryOrCreate
      name: envoy-logs
    - hostPath:
        path: /etc/l7/configs/als
        type: DirectoryOrCreate
      name: als-configs
    - hostPath:
        path: /etc/passwd
      name: etc-passwd
    - hostPath:
        path: /etc/l7/configs/sds
      name: sds-config
    - hostPath:
        path: /tmp/sds/
        type: DirectoryOrCreate
      name: sds-sock
