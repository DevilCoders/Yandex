version: 2
automerge: true
projects:
  - name: boilerplate
    workflow: production
    dir: prod/boilerplate
    autoplan:
      when_modified: ["*.tf", "../modules/**.tf"]
      enabled: true
    apply_requirements: [mergeable, approved]

workflows:
  production:
    plan:
      steps:
        - run: rm -rf .terraform
        - init:
            extra_args: ['-backend-config="secret_key=$(ya vault get version sec-01cwtqr1fsz56yx166hj319sqb -o secret_key)"']
        - plan:
            extra_args: [-var yc_token=$YC_TOKEN -var yandex_token=$YANDEX_TOKEN]
