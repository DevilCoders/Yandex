version: '3'
services:
  teamcity-agent:
    image: "{{ image }}:{{ tag }}"
    volumes:
      - /root/.docker/config.json:/root/.docker/config.json:ro
      - /var/run/docker.sock:/var/run/docker.sock
      - /opt/buildagent/conf:/data/teamcity_agent/conf
      - /opt/buildagent/work:/opt/buildagent/work
      - /opt/buildagent/temp:/opt/buildagent/temp
      - /opt/buildagent/tools:/opt/buildagent/tools
      - /opt/buildagent/plugins:/opt/buildagent/plugins
      - /opt/buildagent/system:/opt/buildagent/system
      - /etc/compose/add-agent-properties.sh:/services/add-agent-properties.sh
    env_file:
      - .env
    environment:
      - SERVER_URL=https://teamcity.yandex-team.ru/
    restart: always
    network_mode: "host"
    dns: 2a02:6b8:0:3400::5005
