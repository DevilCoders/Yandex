---
- hosts: localhost
  gather_facts: false
  pre_tasks:
    - juggler_facts:  jserver_api={{ jserver_api }}
      tags:
        - always
  post_tasks:
    - juggler_cleanup:

  tasks:
################################ CLOUD LOGS ###################################
    - name: jaeger__preprod
      include_role:
        name: jaeger
      vars:
        app: "jaeger"
        env: "preprod"
        cgroup: "{{ v.conductor_group }}"
        unreachable_host: "{{ v.conductor_group }}"
        service_responsibles: "{{ responsibles.jaeger }}"
        tags:
          - "yc-jaeger"
          - "yc-jaeger-{{ env }}"
          - "yc-jaeger-{{ env }}-{{ v.tag_suffix }}"
      loop_control:
        loop_var: v
      with_items:
        - conductor_group: cloud_preprod_jaeger_collector
          tag_suffix: collector
        - conductor_group: cloud_preprod_jaeger_lb_reader
          tag_suffix: lb-reader
        - conductor_group: cloud_preprod_jaeger_query
          tag_suffix: query
    - name: jaeger__prod
      include_role:
        name: jaeger
      vars:
        app: "jaeger"
        env: "prod"
        cgroup: "{{ v.conductor_group }}"
        unreachable_host: "{{ v.conductor_group }}"
        service_responsibles: "{{ responsibles.jaeger }}"
        tags:
          - "yc-jaeger"
          - "yc-jaeger-{{ env }}"
          - "yc-jaeger-{{ env }}-{{ v.tag_suffix }}"
      loop_control:
        loop_var: v
      with_items:
        - conductor_group: cloud_prod_jaeger_collector
          tag_suffix: collector
        - conductor_group: cloud_prod_jaeger_query
          tag_suffix: query
        - conductor_group: cloud_prod_jaeger_lb_reader
          tag_suffix: lb-reader

