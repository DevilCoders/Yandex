---
- hosts: localhost
  gather_facts: false
  pre_tasks:
    - juggler_facts:  jserver_api={{ jserver_api }}
      tags:
        - always

  post_tasks:
    - juggler_cleanup:

  vars:
    app: "api-gateway"
    notification_methods: []
    tags: "{{ duty_tags }} + ['{{ apiteam_tag }}']"

  roles:
    - role: gateway
      vars:
        env: "preprod"
        host: "cloud_{{ env }}_{{ app }}"
        children:
        - 'CGROUP%{{ host }}_tf'
        unreachable_host: '{{ host }}'

    - role: gateway
      vars:
        env: "prod"
        solomon_alert_host: '{{ host }}_solomon'
        host: "cloud_{{ env }}_{{ app }}"
        children:
        - 'CGROUP%{{ host }}_tf'
        unreachable_host: '{{ host }}'
