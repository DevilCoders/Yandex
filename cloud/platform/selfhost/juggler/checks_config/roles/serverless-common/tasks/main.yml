---
- include: tasks/common.yml
  tags: ["serverless"]

- name: 'juggler_check : {{ app }}-https'
  juggler_check: ''
  args: "{{ default_check | hash_merge(item, timed_limits_32perc_crit_unreach_force_ok) }}"
  with_items:
    - service: "{{ app }}-https"
      https:
        port: "{{ check_port }}"
        path: "/"
        ok_codes: [404]
        warn_expire: 14
        crit_expire: 7
      tags: "{{ tags }}"
  when: "{{ check_type == 'https' }}"

- name: 'juggler_check : {{ app }}-http'
  juggler_check: ''
  args: "{{ default_check | hash_merge(item, timed_limits_32perc_crit_unreach_force_ok) }}"
  with_items:
    - service: "{{ app }}-http"
      http:
        port: "{{ check_port }}"
        path: "/"
        ok_codes: [200]
      tags: "{{ tags }}"
  when: "{{ check_type == 'http' }}"

- name: 'juggler_check : {{ app }}-tls'
  juggler_check: ''
  args: "{{ default_check | hash_merge(item, timed_limits_32perc_crit_unreach_force_ok) }}"
  with_items:
    - service: "{{ app }}-tls"
      https_cert:
        port: "{{ check_port }}"
        warn_expire: 14
        crit_expire: 7
      tags: "{{ tags }}"
  when: "{{ check_type == 'tls' }}"

