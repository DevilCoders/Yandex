service_account_id: bfbsle5rb0iiukap9v2k # iot-deployer
name: iot-tank
description: IG-managed IoT tank
scale_policy:
  fixed_scale:
    size: 0
deploy_policy:
  max_unavailable: 1
  max_expansion: 0
allocation_policy:
  zones:
    - zone_id: ru-central1-a
    - zone_id: ru-central1-b
    - zone_id: ru-central1-c
instance_template:
  name: iot-tank-{instance.index}-{instance.internal_dc}
  hostname: iot-tank-{instance.index}-{instance.internal_dc}
  platform_id: standard-v2
  service_account_id: bfbsorobhv829cs3fu76 # iot-tank
  labels:
    yandex-dns: ig
    conductor-group: iot-tank
    layer: iaas
    abc_svc: ycmqtt
    env: pre-prod
    environment: preprod
  resources_spec:
    memory: 2G
    cores: 2
    core_fraction: 20
  boot_disk_spec:
    mode: READ_WRITE
    disk_spec:
      image_id: ${IMAGE_ID}
      type_id: network-ssd
      size: 10g
  secondary_disk_specs:
    - mode: READ_WRITE
      device_name: data
      disk_spec:
        type_id: network-hdd
        size: 10g
  network_interface_specs:
    - subnet_ids: ['bucpba0hulgrkgpd58qp', 'bltueujt22oqg5fod2se', 'fo27jfhs8sfn4u51ak2s']
      primary_v4_address_spec: {}
      primary_v6_address_spec: {}
  metadata:
    osquery_tag: ycloud-svc-iot
    user-data: |
      #cloud-config
      bootcmd:
        - dhclient -6 -v eth0
      disk_setup:
        /dev/disk/by-id/virtio-data:
          table_type: mbr
          layout: [50, 50]
          overwrite: false
      fs_setup:
        - filesystem: ext4
          device: /dev/disk/by-id/virtio-data
          partition: 1
          overwrite: false
        - filesystem: ext4
          device: /dev/disk/by-id/virtio-data
          partition: 2
          overwrite: false
      mounts:
        - ["/dev/disk/by-id/virtio-data-part1", "/var/log", "auto", "defaults", "0", "0"]
        - ["/dev/disk/by-id/virtio-data-part2", "/var/loadtest", "auto", "defaults", "0", "0"]
