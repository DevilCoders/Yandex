
healthCheck:
  port: 9981
  path: /ping
  shutdownDelay: 15

grpcServer:
  certificatePemFile: '/etc/yc/token-service/certs/server.pem'
  maxConcurrentRequests: 512
  reflectionEnabled: true
  port: 4282
  permitKeepAliveWithoutCalls: true
  permitKeepAliveTime: PT10S
  maxConnectionAge: PT3H

cluster:
  clusterId: fmd

metrics:
  pullPort: 6060

kikimr:
  database: /ru-central1/b1gnp66fsfvnvthvfovt/etn033klt4t6rh5m9cbn
  tablespace: /ru-central1/b1gnp66fsfvnvthvfovt/etn033klt4t6rh5m9cbn/
  discoveryEndpoint: lb.etn033klt4t6rh5m9cbn.ydb.mdb.yandexcloud.net:2135
  useSSL: true
  auth:
    type: JWT
    jwt:
      endpoint: https://iam.api.cloud.yandex.net/iam/v1/tokens
      keyId: ajedqof8r1smn1bvu0n7
      serviceAccountId: ajedjer51tra9fbro4gt
      privateKeyPath: '/etc/yc/token-service/secrets/ydb-sa-private.key'
      ttl: PT5M
    tokenServiceClient:
      usePublicAPI: True
      host: iam.api.cloud.yandex.net
      port: 443
      maxRetries: 10
      timeout: PT10S
      tls: True

##################
# Access Service #
##################

authClient:
  host: as.private-api.yandex.datacloud.net
  port: 4286
  tls: True
  maxRetries: 7
  timeout: PT2S

repository:
  bootstrapMode: DO_NOTHING
  cacheImplementation: CAFFEINE
  retryCount: 33 # XXX: Return an adequate value after https://st.yandex-team.ru/CLOUD-46108
  isolationLevel: SERIALIZABLE_READ_WRITE

tokenServer:
  maxClockSkew: PT15M
  checkEula: true

jwt:
  maxLifetime: PT60M
  audience:
    - https://iam.api.cloud.yandex.net/iam/v1/tokens
  supportedAlgorithms:
    - PS256
  restrictedAlgorithms:
    - RS256

iamToken:
  lifetime: PT12H
  version: V1
  cache:
    maxSize: 100000
    expire: PT1H

iamTokenEdDsaSigner:
  keyRotation:
    rotationInterval: PT24H
    validityInterval: PT48H

iamCookie:
  lifetime: PT12H
  version: V1
  cache:
    maxSize: 100000
    expire: PT1H

iamCookieEdDsaSigner:
  keyRotation:
    rotationInterval: PT24H
    validityInterval: PT48H

##########
# caches #
##########

#
# Parameters batchSize and pageSize are limited to kikimr _ResultRowsLimit
# with default value of 1000 rows
#

# 2K bytes per item
serviceAccountCache:
  maxSize: 196608
  expire: P7D
  reload:
    interval: PT5S
    batchSize: 1000
    shardBatchSize: 1000

# 2K bytes per item
passportUserAccountCache:
  maxSize: 196608
  expire: P7D

# 2K bytes per item
serviceAccountKeyCache:
  maxSize: 196608
  expire: P7D
  reload:
    interval: PT5S
    batchSize: 1000
    shardBatchSize: 1000

# 2K bytes per item
userAccountKeyCache:
  maxSize: 196608
  expire: P7D
  reload:
    interval: PT5S
    batchSize: 1000
    shardBatchSize: 1000

# 2K bytes per item
samlFederatedUserCache:
  maxSize: 196608
  expire: P7D
  reload:
    interval: PT5S
    batchSize: 1000
    shardBatchSize: 1000

# 2K bytes per item
samlFederationCache:
  maxSize: 196608
  expire: P7D
  reload:
    interval: PT5S
    batchSize: 1000
    shardBatchSize: 1000

# 2K bytes per item
oAuthFederationCache:
  maxSize: 196608
  expire: P7D
  reload:
    interval: PT5S
    batchSize: 1000
    shardBatchSize: 1000

# 2K bytes per item
subjectCache:
  maxSize: 196608
  expire: P7D
  reload:
    interval: PT5S
    batchSize: 1000
    shardBatchSize: 1000

#########
# pools #
#########

aesGcmCipherPool:
  maxTotal: 128

tokenSignerSignaturePool:
  maxTotal: 64

cookieSignVerifierSignaturePool:
  maxTotal: 64

cookieSignerSignaturePool:
  maxTotal: 64
