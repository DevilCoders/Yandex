{
    "id": "${CLUSTER_NAME}-internal-errors",
    "projectId": "${PROJECT_ID}",
    "name": "${CLUSTER_NAME} internal errors",
    "groupByLabels": [
      "method",
      "path"
    ],
    "type": {
        "expression": {
            "program": "let errors_count = sum(group_lines('sum', drop_below(diff({cluster='${CLUSTER_NAME}', project='${PROJECT_ID}', service='${SERVICE_NAME}', service_name='${SERVICE_NAME}', host='iam-*', metric='api_request_count', status_code='500', path!='all', method!='all'}), 0)));let errors_count_pretty = to_fixed(errors_count, 0);",
            "checkExpression": "errors_count > 0"
        }
    },
    "annotations": {
        "description": "{{alert.name}} has {{expression.errors_count_pretty}} INTERNAL error(s) in endpoint ({{labels.method}}) {{labels.path}}",
        "url": "https://${SOLOMON_ENDPOINT}/admin/projects/${PROJECT_ID}/alerts/${CLUSTER_NAME}-internal-errors"
    },
    "windowSecs": 900,
    "delaySecs": 0,
    "channels": ${CHANNELS}
}

