{
  "id": "${CLUSTER_NAME}-internal-errors",
  "projectId": "${PROJECT_ID}",
  "name": "${CLUSTER_NAME} internal errors",
  "groupByLabels": [
    "method"
  ],
  "type": {
    "expression": {
      "program": "let errors_count = sum(group_lines('sum', drop_below(diff({cluster='${CLUSTER_NAME}', project='${PROJECT_ID}', service='${SERVICE_NAME}', host='iam-*', app='*_server', method!='all', sensor='grpc_statuses|servlet_statuses', status='UNKNOWN|INTERNAL|DATA_LOSS|500'}), 0)));let errors_count_pretty = to_fixed(errors_count, 0);",
      "checkExpression": "errors_count > 0"
    }
  },
  "annotations": {
    "description": "{{alert.name}} has {{expression.errors_count_pretty}} INTERNAL error(s) for method {{labels.method}}",
    "url": "https://${SOLOMON_ENDPOINT}/admin/projects/${PROJECT_ID}/alerts/${CLUSTER_NAME}-internal-errors/subAlerts"
  },
  "windowSecs": 300,
  "delaySecs": 0,
  "channels": ${CHANNELS}
}
