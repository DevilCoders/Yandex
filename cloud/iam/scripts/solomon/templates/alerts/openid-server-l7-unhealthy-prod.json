{
    "id": "openid-server-l7-unhealthy-prod",
    "name": "openid-server l7 unhealthy targets PROD",
    "type": {
        "expression": {
            "program": "let healthy = min(group_lines('min',group_by_labels({cluster=\"cloud_prod_api-router\", service=\"api_envoy_tags_ma\", name=\"alb_membership_healthy\", backend_group_id=\"ds7g2igeg2ac63c3gq8j\", host='api-router-*', project='platform'},'zone',v -> group_lines('max', v))));\nlet total = max(group_lines('max',{cluster=\"cloud_prod_api-router\", service=\"api_envoy_tags_ma\", name=\"alb_membership_total\", backend_group_id=\"ds7g2igeg2ac63c3gq8j\", host='api-router-*', project='platform'}) );\nlet unhealthy = total - healthy;\nunhealthy;",
            "checkExpression": "unhealthy > 1"
        }
    },
    "annotations": {
        "description": "Status not equal to OK means too many unhealthy targets in l7-balancer. https://solomon.cloud.yandex-team.ru/admin/projects/yc.iam.service-cloud/alerts/openid-server-l7-unhealthy-prod"
    },
    "windowSecs": 60,
    "delaySecs": 0,
    "channels": ${CHANNELS}
}
