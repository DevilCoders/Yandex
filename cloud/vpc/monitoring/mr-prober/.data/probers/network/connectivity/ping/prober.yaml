name: "[Network] Ping"
slug: network-ping
description: Ping
runner:
  type: BASH
  command: for i in `seq 1 $VAR_count`; do /bin/ping -W1 -c 1 $VAR_host && break; done
files: []
configs:
  - is_prober_enabled: true
    # NOTE (andgein): There is a reference to this setting (interval_seconds: 60) in custom solomon alerts:
    # https://bb.yandex-team.ru/projects/CLOUD/repos/yc-monitoring/browse/solomon/mr-prober/alerts/network/ping-internal-targets.j2.
    # Keep it consistently.
    interval_seconds: 60
    timeout_seconds: 15
    s3_logs_policy: FAIL
    default_routing_interface: eth0
    matrix:
      # TODO (syringa): In case of changes host's count change --target-count in e2e-tests-permnet-connectivity
      # See https://bb.yandex-team.ru/projects/CLOUD/repos/salt-formula/browse/e2e-tests/compute-node-vpc/mon/bin/e2e-tests-permnet-connectivity
      host:
        # Yandex targets
        - 77.88.55.70     # yandex.ru
        - 213.180.204.186 # music.yandex.ru
        - 77.88.21.37     # mail.yandex.net
        # Border target
        - 84.201.191.156  # https://st.yandex-team.ru/CLOUD-94920
        # Additional internal targets in each AZ
        - 10.1.250.250    # target-ru-central1-a-1-v4.ru-central1.internal
        - 10.1.250.251    # target-ru-central1-a-2-v4.ru-central1.internal
        - 10.2.250.250    # target-ru-central1-b-1-v4.ru-central1.internal
        - 10.2.250.251    # target-ru-central1-b-2-v4.ru-central1.internal
        - 10.3.250.250    # target-ru-central1-c-1-v4.ru-central1.internal
        - 10.3.250.251    # target-ru-central1-c-2-v4.ru-central1.internal
    variables:
      host: ${matrix.host}
      count: 2
    clusters:
      - clusters/testing/meeseeks/cluster.yaml
      - clusters/preprod/meeseeks/cluster.yaml
      - clusters/prod/meeseeks/cluster.yaml
  - is_prober_enabled: true
    interval_seconds: 60
    timeout_seconds: 15
    s3_logs_policy: FAIL
    default_routing_interface: eth0
    matrix:
      # TODO (syringa): In case of changes host's count change --target-count in e2e-tests-permnet-connectivity
      # See https://bb.yandex-team.ru/projects/CLOUD/repos/salt-formula/browse/e2e-tests/compute-node-vpc/mon/bin/e2e-tests-permnet-connectivity
      host:
        # Yandex targets
        - 77.88.55.70     # yandex.ru
        - 213.180.204.186 # music.yandex.ru
        - 77.88.21.37     # mail.yandex.net
        # Additional internal targets in each AZ
        - 10.1.250.250    # target-il1-a-1-v4.ru-central1.internal
        - 10.1.250.251    # target-il1-a-2-v4.ru-central1.internal
    variables:
      host: ${matrix.host}
      count: 2
    clusters:
      - clusters/israel/meeseeks/cluster.yaml
  - is_prober_enabled: true
    interval_seconds: 60
    timeout_seconds: 15
    s3_logs_policy: FAIL
    default_routing_interface: eth0
    matrix:
      host:
        - 10.1.250.250 # target-ru-central1-a-1-v4.ru-central1.internal
        - 10.2.250.250 # target-ru-central1-b-1-v4.ru-central1.internal
        - 10.3.250.250 # target-ru-central1-c-1-v4.ru-central1.internal
    variables:
      host: ${matrix.host}
      count: 2
    clusters:
      - clusters/*/meeseeks-staging/cluster.yaml
  - is_prober_enabled: true
    # NOTE (andgein): There is a reference to this setting (interval_seconds: 20) in custom solomon alerts:
    # https://bb.yandex-team.ru/projects/CLOUD/repos/yc-monitoring/browse/solomon/mr-prober/alerts/network/ping-external-targets.j2.
    # Keep it consistently.
    interval_seconds: 20
    timeout_seconds: 5
    s3_logs_policy: FAIL
    default_routing_interface: eth0
    matrix:
      host:
        # TODO (andgein): Store hosts list as FQDNs, but resolve them only once, and cache IP addresses for some time
        # as in yc-e2e-tests: https://bb.yandex-team.ru/projects/CLOUD/repos/e2e-tests/browse/e2e_tests/yc_e2e_tests/test_ext_conn.py#24-29
        - 8.8.8.8         # dns.google
        - 91.109.200.200  # https://www.atlex.ru/baza-znanij/rukovodstva/ip-adresa-dlya-ping-traceroute-testovye-fajly-dlya-skachivaniya/
        - 142.251.1.102   # google.com
        - 77.88.55.70     # yandex.ru
        - 82.165.229.83   # web.de
        - 62.138.239.100  # t-online.de
        - 195.50.178.200  # welt.de
        - 151.101.1.140   # reddit.com
        - 1.1.1.1         # one.one.one.one, Cloudflare
        - 84.201.191.156  # Border target, https://st.yandex-team.ru/CLOUD-94920
    variables:
      host: ${matrix.host}
      count: 2
    clusters:
      - clusters/*/world/*/cluster.yaml

