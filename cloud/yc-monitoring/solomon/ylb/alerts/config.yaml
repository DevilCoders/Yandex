menu: "[YLB] Alerts"
menu_type: admin
api_path: /alerts/
tags:
  - ylb
  - alerts

{%- set project_id_prefix = project_id if env not in ('hw-cgw-dev-lab', 'hw-cgw-ci-lab', 'israel')  else 'ylb' %}

entities:
  hc-ctrl-gc-cycles:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_gc_healthcheck_ctrl"
    template: gc-cycles.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_gc_cycles_healthcheck_ctrl"

  hc-ctrl-ydb-session-pool-overflows:
    id: "{{ project_id_prefix }}-{{ env }}-ydb-session-pool-overflows-hc-ctrl"
    template: ydb-session-pool-overflows.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_ydb-session-pool-overflows-hc-ctrl"
      service: healthcheck_ctrl
      red_threshold: 0.11
      yellow_threshold: 0.05

  hc-ctrl-proxy-ydb-session-pool-overflows:
    id: "{{ project_id_prefix }}-{{ env }}-ydb-session-pool-overflows-hc-ctrl-proxy"
    template: ydb-session-pool-overflows.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_ydb-session-pool-overflows-hc-ctrl-proxy"
      service: healthcheck_ctrl_proxy
      red_threshold: 0.11
      yellow_threshold: 0.05
      service_suffix: "-proxy"

  lb-ctrl-ydb-session-pool-overflows:
    id: "{{ project_id_prefix }}-{{ env }}-ydb-session-pool-overflows-lb-ctrl"
    template: ydb-session-pool-overflows.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_ydb-session-pool-overflows-lb-ctrl"
      service: loadbalancer_ctrl
      red_threshold: 0.11
      yellow_threshold: 0.05

  {% for service in ['loadbalancer-ctrl', 'loadbalancer-node', 'healthcheck-ctrl', 'healthcheck-node'] %}
  {{ service }}-heap-obj-lives:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_heap_obj_lives_{{ service }}"
    template: heap-obj-lives.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_heap_obj_lives_{{ service }}"
      service: {{ service }}
  {% endfor %}

  hc-ctrl-log-errors:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_log_errors_healthcheck_ctrl"
    template: log-errors.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_log_errors_healthcheck_ctrl"
      unit: yc-healthcheck-ctrl
      service: hc-ctrl-log-errors
      red_threshold: 40
      yellow_threshold: 30

  hc-node-log-errors:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_log_errors_healthcheck_node"
    template: log-errors.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_log_errors_healthcheck_node"
      unit: yc-healthcheck-node
      service: hc-node-log-errors
      red_threshold: 200
      yellow_threshold: 250

  lb-ctrl-log-errors:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_log_errors_loadbalancer_ctrl"
    template: log-errors.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_log_errors_loadbalancer_ctrl"
      unit: yc-loadbalancer-ctrl
      service: lb-ctrl-log-errors
      red_threshold: 12
      yellow_threshold: 6

  lb-node-log-errors:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_log_errors_loadbalancer_node"
    template: log-errors.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_log_errors_loadbalancer_node"
      unit: yc-loadbalancer-node
      service: lb-node-log-errors
      red_threshold: 1.5
      yellow_threshold: 1.0

  vsop-log-errors:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_log_errors_vsop"
    template: log-errors.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_log_errors_vsop"
      unit: yc-vsop
      service: vsop-log-errors
      red_threshold: 2
      yellow_threshold: 1.0

  billbro-log-errors:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_log_errors_billbro"
    template: log-errors.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_log_errors_billbro"
      unit: yc-billbro
      service: billbro-log-errors
      red_threshold: 60
      yellow_threshold: 50

  hc-ctrl-ydb-errors:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_ydb_errors_healthcheck_ctrl"
    template: ydb-errors.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_ydb_errors_healthcheck_ctrl"
      service: healthcheck_ctrl

  hc-ctrl-proxy-ydb-errors:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_ydb_errors_healthcheck_ctrl-proxy"
    template: ydb-errors.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_ydb_errors_healthcheck_ctrl-proxy"
      service: healthcheck_ctrl_proxy
      service_suffix: "-proxy"

  lb-ctrl-ydb-errors:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_ydb_errors_loadbalancer_ctrl"
    template: ydb-errors.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_ydb_errors_loadbalancer_ctrl"
      service: loadbalancer_ctrl

  hc-ctrl-grpc-restricted:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_grpc_restricted_hc-ctrl"
    template: grpc-restricted.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_grpc_restricted_hc-ctrl"
      service: healthcheck_ctrl

  hc-proxy-grpc-restricted:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_grpc_restricted_hc-ctrl-proxy"
    template: grpc-restricted.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_grpc_restricted_hc-ctrl-proxy"
      service: healthcheck_ctrl_proxy
      service_suffix: "-proxy"

  lb-ctrl-grpc-restricted:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_grpc_restricted_lb-ctrl"
    template: grpc-restricted.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_grpc_restricted_lb-ctrl"
      service: loadbalancer_ctrl

  hc-ctrl-ydb-timings:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_ydb_timings_healthcheck_ctrl"
    template: ydb-timings.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_ydb_timings_healthcheck_ctrl"
      service: healthcheck_ctrl
      red_threshold: 12.4
      yellow_threshold: 10.5

  hc-ctrl-proxy-ydb-timings:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_ydb_timings_healthcheck_ctrl-proxy"
    template: ydb-timings.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_ydb_timings_healthcheck_ctrl-proxy"
      service: healthcheck_ctrl_proxy
      red_threshold: 12.4
      yellow_threshold: 7.2
      service_suffix: "-proxy"

  lb-ctrl-ydb-timings:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_ydb_timings_loadbalancer_ctrl"
    template: ydb-timings.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_ydb_timings_loadbalancer_ctrl"
      service: loadbalancer_ctrl
      red_threshold: 12.4
      yellow_threshold: 7.2

  hc-ctrl-ydb_open_conns:
    id: "{{ project_id_prefix }}-{{ env }}_ydb_open_conns_hc-ctrl"
    template: ydb_open_conns.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_ydb_open_conns_hc-ctrl"
      service: healthcheck_ctrl

  hc-ctrl-proxy-ydb_open_conns:
    id: "{{ project_id_prefix }}-{{ env }}_ydb_open_conns_hc-ctrl-proxy"
    template: ydb_open_conns.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_ydb_open_conns_hc-ctrl-proxy"
      service: healthcheck_ctrl_proxy
      service_suffix: "-proxy"

  lb-ctrl-ydb_open_conns:
    id: "{{ project_id_prefix }}-{{ env }}_ydb_open_conns_lb-ctrl"
    template: ydb_open_conns.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_ydb_open_conns_lb-ctrl"
      service: loadbalancer_ctrl

  hc-ctrl-grpc-perm-error-rate:
    id: "{{ project_id_prefix }}-{{ env }}_grpc_perm_error_rate_hc_ctrl"
    template: grpc-perm-error-rate.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_grpc_perm_error_rate_hc_ctrl"
      service: healthcheck_ctrl
      red_threshold: 0.05
      yellow_threshold: 0.01
      abs_red_threshold: 1.0
      abs_yellow_threshold: 0.5

  hc-ctrl-proxy-grpc-perm-error-rate:
    id: "{{ project_id_prefix }}-{{ env }}_grpc_perm_error_rate_hc_ctrl-proxy"
    template: grpc-perm-error-rate.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_grpc_perm_error_rate_hc_ctrl-proxy"
      service: healthcheck_ctrl_proxy
      service_suffix: "-proxy"
      red_threshold: 0.05
      yellow_threshold: 0.01
      abs_red_threshold: 1.0
      abs_yellow_threshold: 0.5

  hc-ctrl-grpc-perm-denied-rate:
    id: "{{ project_id_prefix }}-{{ env }}_grpc_perm_denied_rate_hc_ctrl"
    template: grpc-perm-denied-rate.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_grpc_perm_denied_rate_hc_ctrl"
      service: healthcheck_ctrl
      abs_red_threshold: 1.0
      abs_yellow_threshold: 0.5

  hc-ctrl-proxy-grpc-perm-denied-rate:
    id: "{{ project_id_prefix }}-{{ env }}_grpc_perm_denied_rate_hc_ctrl-proxy"
    template: grpc-perm-denied-rate.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_grpc_perm_denied_rate_hc_ctrl-proxy"
      service: healthcheck_ctrl_proxy
      service_suffix: "-proxy"
      abs_red_threshold: 1.0
      abs_yellow_threshold: 0.5

  hc-ctrl-grpc-server-error-rate:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_grpc_server_error_rate_healthcheck_ctrl"
    template: grpc-error-rate.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_grpc_server_error_rate_healthcheck_ctrl"
      type: server
      service: healthcheck_ctrl
      red_threshold: 0.1
      yellow_threshold: 0.05
      abs_red_threshold: 5
      abs_yellow_threshold: 3

  hc-ctrl-poll-fail-rate:
    id: "{{ project_id_prefix }}-{{ env }}-poll-fail-rate-hc-ctrl"
    template: hc-ctrl-poll-fail-rate.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_poll_fail_rate_hc_ctrl"
      service: healthcheck_ctrl
      red_threshold: 10
      yellow_threshold: 5

  hc-node-grpc-client-error-rate:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_grpc_client_error_rate_healthcheck_node"
    template: grpc-error-rate.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_grpc_client_error_rate_healthcheck_node"
      type: client
      service: healthcheck_node
      red_threshold: 0.1
      yellow_threshold: 0.05
      abs_red_threshold: 5
      abs_yellow_threshold: 3

  hc-node-alive-targets-perc:
    id: "{{ project_id_prefix }}-{{ env }}_alive_tagets_perc_healthcheck_node"
    template: alive-targets-perc.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_alive_targets_perc_healthcheck_node"
      red_threshold: 100
      yellow_threshold: 99
    env_context:
      prod:
        red_threshold: 30
        yellow_threshold: 23
      preprod:
        red_threshold: 95
        yellow_threshold: 80
      testing:
        red_threshold: 100
        yellow_threshold: 99
      israel:
        red_threshold: 30
        yellow_threshold: 23

  hc-node-checks-per-node:
    id: "{{ project_id_prefix }}-{{ env }}_hc-node-checks-per-node"
    template: hc-node-checks-per-node.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_hc-node-checks-per-node"
      checks_per_second_yellow: 1500
      checks_per_second_red: 1800
      unique_checks_yellow: 8500
      unique_checks_red: 9425

  hc-node-update-target-status:
    id: "{{ project_id_prefix }}-{{ env }}_update_target_status_healthcheck_node"
    template: hc-node-update-target-status.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_update_target_status_healthcheck_node"
    env_context:
      hw-cgw-dev-lab:
        red_threshold: "2.0"
        yellow_threshold: "1.0"
      hw-cgw-ci-lab:
        red_threshold: "2.0"
        yellow_threshold: "1.0"
      hw-6dxlx-lab:
        red_threshold: "2.0"
        yellow_threshold: "1.0"
      testing:
        red_threshold: "2.0"
        yellow_threshold: "1.0"
      preprod:
        red_threshold: "2.0"
        yellow_threshold: "1.0"
      prod:
        red_threshold: "1.0"
        yellow_threshold: "0.7"
      israel:
        red_threshold: "1.0"
        yellow_threshold: "0.7"

  hc-node-tick-drops:
    id: "{{ project_id_prefix }}-{{ env }}_node_tick_drops_healthcheck_node"
    template: hc-node-tick-drops.json.j2
    context:
      name: "{{ project_id }}-{{ env }}_node_tick_drops_healthcheck_node"
      red_threshold: 1
      yellow_threshold: 0.5

  hc-node-target-tick-drops:
    id: "{{ project_id_prefix }}-{{ env }}_target_tick_drops_healthcheck_node"
    template: hc-node-target-tick-drops.json.j2
    context:
      name: "{{ project_id }}-{{ env }}_target_tick_drops_healthcheck_node"
      red_threshold: 5
      yellow_threshold: 1

  hc-node-hedged-checks-perc:
    id: "{{ project_id_prefix }}-{{ env }}_hedged_checks_perc_healthcheck_node"
    template: hedged-checks-perc.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_hedged_checks_perc_healthcheck_node"
    env_context:
      preprod:
        red_threshold: 2
        yellow_threshold: 1
      prod:
        red_threshold: 2
        yellow_threshold: 1
      israel:
        red_threshold: 2
        yellow_threshold: 1
      testing:
        red_threshold: 2
        yellow_threshold: 1
      hw-cgw-ci-lab:
        red_threshold: 2
        yellow_threshold: 1
      hw-cgw-dev-lab:
        red_threshold: 2
        yellow_threshold: 1
      hw-6dxlx-lab:
        red_threshold: 2
        yellow_threshold: 1

  hc-ctrl-proxy-grpc-client-error-rate:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_grpc_client_error_rate_hc_ctrl_proxy"
    template: grpc-error-rate.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_grpc_client_error_rate_hc_ctrl_proxy"
      service: healthcheck_ctrl_proxy
      service_suffix: "-proxy"
      type: client
      red_threshold: 0.1
      yellow_threshold: 0.05
      abs_red_threshold: 5
      abs_yellow_threshold: 3

  hc-ctrl-proxy-grpc-server-error-rate:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_grpc_server_error_rate_hc_ctrl_proxy"
    template: grpc-error-rate.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_grpc_server_error_rate_hc_ctrl_proxy"
      service: healthcheck_ctrl_proxy
      service_suffix: "-proxy"
      type: server
      red_threshold: 0.1
      yellow_threshold: 0.05
      abs_red_threshold: 5
      abs_yellow_threshold: 3

  lb-ctrl-grpc-perm-error-rate:
    id: "{{ project_id_prefix }}-{{ env }}_grpc_perm_error_rate_lb_ctrl"
    template: grpc-perm-error-rate.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_grpc_perm_error_rate_lb_ctrl"
      service: loadbalancer_ctrl
      red_threshold: 0.05
      yellow_threshold: 0.01
      abs_red_threshold: 1.0
      abs_yellow_threshold: 0.5

  lb-ctrl-grpc-perm-denied-rate:
    id: "{{ project_id_prefix }}-{{ env }}_grpc_perm_denied_rate_lb_ctrl"
    template: grpc-perm-denied-rate.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_grpc_perm_denied_rate_lb_ctrl"
      service: loadbalancer_ctrl
      abs_red_threshold: 1.0
      abs_yellow_threshold: 0.5

  lb-ctrl-grpc-server-error-rate:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_grpc_server_error_rate_loadbalancer_ctrl"
    template: grpc-error-rate.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_grpc_server_error_rate_loadbalancer_ctrl"
      type: server
      service: loadbalancer_ctrl
      red_threshold: 0.1
      yellow_threshold: 0.05
      abs_red_threshold: 1.0
      abs_yellow_threshold: 0.5

  lb-ctrl-grpc-client-error-rate:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_grpc_client_error_rate_loadbalancer_ctrl"
    template: grpc-error-rate.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_grpc_client_error_rate_loadbalancer_ctrl"
      type: client
      service: loadbalancer_ctrl
      red_threshold: 0.1
      yellow_threshold: 0.05
      abs_red_threshold: 1.0
      abs_yellow_threshold: 0.5

  lb-node-grpc-client-error-rate:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_grpc_client_error_rate_loadbalancer_node"
    template: grpc-error-rate.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_grpc_client_error_rate_loadbalancer_node"
      type: client
      service: loadbalancer_node
      red_threshold: 0.1
      yellow_threshold: 0.05
      abs_red_threshold: 5
      abs_yellow_threshold: 3

  lb-node-unknown-vips:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_unknown_vips_loadbalancer_node"
    template: lb-node-unknown-vips.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_unknown_vips_loadbalancer_node"

  lb-node-unknown-rips:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_unknown_rips_loadbalancer_node"
    template: lb-node-unknown-rips.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_unknown_rips_loadbalancer_node"

  lb-node-announce-flaps:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_announce_flaps_loadbalancer_node"
    template: lb-node-announce-flaps.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_announce_flaps_loadbalancer_node"

  vpp-cpu-load:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_vpp_cpu_load"
    template: vpp-cpu-load.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_vpp_cpu_load"

  vpp-api-bytes-used:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_vpp_api_bytes_used"
    template: vpp-api-bytes-used.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_vpp_api_bytes_used"

  billbro-grpc-client-error-rate:
    id: "{{ project_id_prefix }}-{{ env }}_ylb_grpc_client_error_rate_billbro"
    template: grpc-error-rate.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_grpc_client_error_rate_billbro"
      type: client
      service: billbro
      service_suffix: "-billbro"
      red_threshold: 0.06
      yellow_threshold: 0.03
      abs_red_threshold: 0.06  # there is 0.066 rps according to solomon, so there is no reason in abs thresholds
      abs_yellow_threshold: 0.03

  cgw-mem-available:
    id: "{{ project_id_prefix }}-{{ env }}_cgw_mem_available"
    template: cgw-mem-available.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_cgw_mem_available"
      red_abs_mb: 350
      yellow_abs_mb: 500
      red_relative: 0.10
      yellow_relative: 0.20

  rts-count-compute-api:
    id: "{{ project_id_prefix }}-{{ env }}_rts_count_compute_api"
    template: rts-count.json.j2
    context:
      name: "{{ project_id }}_ylb_{{ env }}_rts_count_compute_api"
      red_threshold: 400000
      yellow_threshold: 350000

  logshatter-clickhouse-free-space-perc:
    id: "{{ project_id_prefix }}-{{ env }}_logshatter-clickhouse-free-space-perc"
    template: clickhouse-free-space.json.j2
    exclude:
      env:
        - testing
        - hw-cgw-dev-lab
        - hw-cgw-ci-lab
        - israel
    context:
      name: "{{ project_id }}_ylb_{{ env }}_logshatter_clickhouse_free_space"
    env_context:
      preprod:
        mdb_cluster_id: e4ue6f2st2vuh6qrost9
        red_threshold: 5
        yellow_threshold: 20
      prod:
        mdb_cluster_id: c9qhej15oj834d30taek
        red_threshold: 10
        yellow_threshold: 20

  # salt_versions_diff alerts
  {% for br in ['loadbalancer-ctrl', 'loadbalancer-node', 'healthcheck-ctrl', 'healthcheck-node', 'e2e-launcher'] %}
  {% for az in zones_by_env[env] %}
  # per dc alerts
  salt_versions_diff_ylb_{{ br }}_{{ az.prefix }}:
    menu: "{{ br | upper }} salt-versions-diff @ {{ env }}"
    template: ../../common/alerts/cloudgate/salt-versions-diff.json.j2
    context:
      name: "{{ project_id_prefix }}-{{ env }}-ylb_salt_versions_diff_{{ br }}_{{ az.prefix }}"
      cluster: "cloud_{{ env }}_ylb"
      bootstrap_role: "{{ br }}"
      salt_role: "{{ salt_by_bootstrap_role[br] }}"
      tags: "yc-{{ env }}, visible, yc-{{ az.prefix }}"
      dc: "{{ az.prefix }}"
      host: "ylb_{{ br }}_{{ env }}_{{ az.prefix }}"
  {% endfor %}
  # cross dc alerts
  salt_versions_diff_ylb_{{ br }}:
    menu: "{{ br | upper }} salt-versions-diff @ {{ env }}"
    template: ../../common/alerts/cloudgate/salt-versions-diff.json.j2
    context:
      name: "{{ project_id }}-{{ env }}-ylb_salt_versions_diff_{{ br }}"
      cluster: "cloud_{{ env }}_ylb"
      bootstrap_role: "{{ br }}"
      salt_role: "{{ salt_by_bootstrap_role[br] }}"
      tags: "yc-{{ env }}, visible"
      dc: "*"
      host: "ylb_{{ br }}_{{ env }}"
  {% endfor %}

  ydb-resources-storage:
    id: {{ project_id_prefix }}-{{ env }}-ydb-resources-storage
    template: ../../common/alerts/ydb/ydb-resources-storage.json.j2
    context:
      name: {{ project_id }}_ylb_{{ env }}-ydb-resources-storage
      host: yc_cloudgate_az_{{ env }}
      red_threshold: 85.0
      yellow_threshold: 75.0
    exclude:
      env:
        - hw-cgw-dev-lab
        - hw-cgw-ci-lab
    env_context:
      testing:
        cluster: yandexcloud_testing_global
        database: /testing_global/loadbalancer
      preprod:
        cluster: yandexcloud_preprod_global
        database: /pre-prod_global/loadbalancer
      prod:
        cluster: yandexcloud_prod_global
        database: /global/loadbalancer
      israel:
        cluster: israel_global
        database: /israel_global/loadbalancer

  ydb-resources-cpu:
    id: {{ project_id_prefix }}-{{ env }}-ydb-resources-cpu
    template: ../../common/alerts/ydb/ydb-resources-cpu.json.j2
    context:
      name: {{ project_id }}_ylb_{{ env }}-ydb-resources-cpu
      host: yc_cloudgate_az_{{ env }}
      red_threshold: 85.0
      yellow_threshold: 75.0
    exclude:
      env:
        - hw-cgw-dev-lab
        - hw-cgw-ci-lab
    env_context:
      testing:
        cluster: yandexcloud_testing_global
        database: /testing_global/loadbalancer
      preprod:
        cluster: yandexcloud_preprod_global
        database: /pre-prod_global/loadbalancer
      prod:
        cluster: yandexcloud_prod_global
        database: /global/loadbalancer
      israel:
        cluster: israel_global
        database: /israel_global/loadbalancer

  ydb-table-datashard:
    id: {{ project_id_prefix }}-{{ env }}-ydb-table-datashard
    template: ../../common/alerts/ydb/ydb-table-datashard.json.j2
    context:
      name: {{ project_id }}_ylb_{{ env }}-ydb-table-datashard
      host: yc_cloudgate_az_{{ env }}
      red_threshold: 80.0
      yellow_threshold: 60.0
    exclude:
      env:
        - hw-cgw-dev-lab
        - hw-cgw-ci-lab
    env_context:
      testing:
        cluster: yandexcloud_testing_global
        database: /testing_global/loadbalancer
      preprod:
        cluster: yandexcloud_preprod_global
        database: /pre-prod_global/loadbalancer
      prod:
        cluster: yandexcloud_prod_global
        database: /global/loadbalancer
      israel:
        cluster: israel_global
        database: /israel_global/loadbalancer

  ydb-tx-rw-latency-p99:
    id: {{ project_id_prefix }}-{{ env }}-ydb-tx-rw-latency-p99
    template: ../../common/alerts/ydb/ydb-tx-rw-latency-p99.json.j2
    context:
      name: {{ project_id }}_ylb_{{ env }}-ydb-tx-rw-latency-p99
      host: yc_cloudgate_az_{{ env }}
      red_threshold: 5000.0
      yellow_threshold: 3000.0
    exclude:
      env:
        - hw-cgw-dev-lab
        - hw-cgw-ci-lab
    env_context:
      testing:
        cluster: yandexcloud_testing_global
        database: /testing_global/loadbalancer
      preprod:
        cluster: yandexcloud_preprod_global
        database: /pre-prod_global/loadbalancer
      prod:
        cluster: yandexcloud_prod_global
        database: /global/loadbalancer
      israel:
        cluster: israel_global
        database: /israel_global/loadbalancer

  ydb-tx-wo-latency-p99:
    id: {{ project_id_prefix }}-{{ env }}-ydb-tx-wo-latency-p99
    template: ../../common/alerts/ydb/ydb-tx-wo-latency-p99.json.j2
    context:
      name: {{ project_id }}_ylb_{{ env }}-ydb-tx-wo-latency-p99
      host: yc_cloudgate_az_{{ env }}
      red_threshold: 5000.0
      yellow_threshold: 3000.0
    exclude:
      env:
        - hw-cgw-dev-lab
        - hw-cgw-ci-lab
    env_context:
      testing:
        cluster: yandexcloud_testing_global
        database: /testing_global/loadbalancer
      preprod:
        cluster: yandexcloud_preprod_global
        database: /pre-prod_global/loadbalancer
      prod:
        cluster: yandexcloud_prod_global
        database: /global/loadbalancer
      israel:
        cluster: israel_global
        database: /israel_global/loadbalancer

  ydb-tx-ro-latency-p99:
    id: {{ project_id_prefix }}-{{ env }}-ydb-tx-ro-latency-p99
    template: ../../common/alerts/ydb/ydb-tx-ro-latency-p99.json.j2
    context:
      name: {{ project_id }}_ylb_{{ env }}-ydb-tx-ro-latency-p99
      host: yc_cloudgate_az_{{ env }}
      red_threshold: 3000.0
      yellow_threshold: 1000.0
    exclude:
      env:
        - hw-cgw-dev-lab
        - hw-cgw-ci-lab
    env_context:
      testing:
        cluster: yandexcloud_testing_global
        database: /testing_global/loadbalancer
      preprod:
        cluster: yandexcloud_preprod_global
        database: /pre-prod_global/loadbalancer
      prod:
        cluster: yandexcloud_prod_global
        database: /global/loadbalancer
      israel:
        cluster: israel_global
        database: /israel_global/loadbalancer
