menu: "[ConfigPlane] Graphs"
menu_type: preview
api_path: /graphs/
tags: ["cfg"]
entities:
  # Sysinfo /proc based graphs
  vpc-api-system-mem:
    template: ../../common/graphs/system/mem.json.j2
    context: &graphs_defaults
      team: VPC API
      prefix: vpc-api
  vpc-api-system-cpu:
    template: ../../common/graphs/system/cpu.json.j2
    context:
      <<: *graphs_defaults
  vpc-api-system-io:
    template: ../../common/graphs/system/io.json.j2
    context:
      <<: *graphs_defaults
  vpc-api-system-net:
    template: ../../common/graphs/system/net.json.j2
    context:
      <<: *graphs_defaults
  vpc-api-system-disk:
    template: ../../common/graphs/system/disk.json.j2
    context:
      <<: *graphs_defaults

  network-api-calls:
    template: network-api-calls.j2
  network-ydb-calls:
    template: network-ydb-calls.j2
  vpc-api-latency:
    template: vpc-api-latency.j2
  vpc-api-latency-by-dc:
    template: vpc-api-latency-by-dc.j2
  vpc-api-latency-by-method:
    template: vpc-api-latency-by-method.j2
  vpc-api-requests:
    template: vpc-api-requests.j2
  vpc-api-grpc-errors:
    template: vpc-api-grpc-errors.j2
  vpc-api-grpc-errors-by-method:
    template: vpc-api-grpc-errors-by-method.j2
  vpc-api-grpc-client-errors:
    template: vpc-api-grpc-client-errors.j2
  vpc-api-grpc-client-latency:
    template: vpc-api-grpc-client-latency.j2
  vpc-api-grpc-long-requests:
    template: vpc-api-grpc-long-requests.j2
  vpc-api-grpc-heavy-requests:
    template: vpc-api-grpc-heavy-requests.j2
  vpc-api-requests-by-dc:
    template: vpc-api-requests-by-dc.j2
  vpc-api-tx-retries:
    template: vpc-api-tx_retries.j2
  vpc-api-tx-retries-by-tx-name:
    template: vpc-api-tx_retries_by_tx_name.j2
  vpc-api-db-statistics-by-sensor:
    template: vpc-api-db-statistics-by-sensor.j2
  vpc-api-jobs-rate:
    template: vpc-api-jobs-rate.j2
  vpc-api-jobs-tx-phases-duration:
    template: vpc-api-jobs-tx-phases-duration.j2
  vpc-api-jobs-duration:
    template: vpc-api-jobs-duration.j2
  vpc-api-task-delay:
    template: vpc-api-task-delay.j2
  vpc-api-ops-done:
    template: vpc-api-ops-done.j2
  vpc-api-ops-failed:
    template: vpc-api-ops-failed.j2
  vpc-api-ops-duration:
    template: vpc-api-ops-duration.j2
  vpc-api-ops-slow:
    template: vpc-api-ops-slow.j2
  vpc-api-contrail-pinger:
    template: vpc-api-contrail-pinger.j2
  vpc-api-contrail-long-durations:
    template: vpc-api-contrail-long-durations.j2
  vpc-api-contrail-durations:
    template: vpc-api-contrail-durations.j2
  vpc-api-contrail-statuses:
    template: vpc-api-contrail-statuses.j2
  vpc-api-contrail-errors:
    template: vpc-api-contrail-errors.j2
  vpc-api-allocator_resources:
    template: vpc-api-allocator_resources.j2
  vpc-api-jvm-memory:
    template: vpc-api-jvm-memory.j2
  vpc-api-jvm-threads:
    template: vpc-api-jvm-threads.j2

  {% if env in ["prod", "preprod"] %}
  # NB: этот график живет там же, где L7 platform - в cloud-соломоне для PROD, PREPROD
  vpc-api-l7-requests:
    template: vpc-api-l7-requests.j2

  # Logbroker
  vpc-api-logbroker-messages-read:
    template: ../../common/graphs/logbroker/messages_read.j2
    context: &logbroker_defaults
      <<: *graphs_defaults
      account: yc.vpc.api
      topic_path: yc.vpc.api/vpc/{% if env == 'preprod' %}pre-prod{% else %}{{ env }}{% endif %}/api/yc-vpc-config-plane-*-log
  vpc-api-logbroker-messages-written:
    template: ../../common/graphs/logbroker/messages_written.j2
    context:
      <<: *logbroker_defaults
  vpc-api-logbroker-partition-max-write-quota-used:
    template: ../../common/graphs/logbroker/partition_max_write_quota_used.j2
    context:
      <<: *logbroker_defaults
  vpc-api-logbroker-partition-write-quota-wait:
    template: ../../common/graphs/logbroker/partition_write_quota_wait.j2
    context:
      <<: *logbroker_defaults
  vpc-api-logbroker-read-time-lag:
    template: ../../common/graphs/logbroker/read_time_lag.j2
    context:
      <<: *logbroker_defaults
  vpc-api-logbroker-time-since-last-read:
    template: ../../common/graphs/logbroker/time_since_last_read.j2
    context:
      <<: *logbroker_defaults
  vpc-api-logbroker-topic-write-quota-wait:
    template: ../../common/graphs/logbroker/topic_write_quota_wait.j2
    context:
      <<: *logbroker_defaults
  {% endif %}
