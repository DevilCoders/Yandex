{% import "vars.yaml" as vars with context %}
{% set ydb_service_port = 8765 %}

api_path: /services/
entities:
  utils:
    project_id: "{{ vars.project_id }}"
    template: ../../base/service.j2
    context:
      no_project_id_prefix: false
      interval: 15
      ttl_days: 7
      grid_sec: 15
      port: {{ ydb_service_port }}
      path: "/counters/counters=utils/spack"
      aggrRules:
        - cond: "host=*"
          target: "host=cluster"
        - cond: "DC=*"
          target: "host=[[DC]]"
        - cond: "activity=*"
          target: "activity=total"
        - cond: "host=*,location=*"
          target: "host=cluster,location=cluster"
  auth:
    project_id: "{{ vars.project_id }}"
    template: ../../base/service.j2
    context:
      no_project_id_prefix: false
      interval: 15
      ttl_days: 7
      grid_sec: 15
      port: {{ ydb_service_port }}
      path: "/counters/counters=auth/spack"
      aggrRules:
        - cond: "host=*"
          target: "host=cluster"
        - cond: "slot=*"
          target: "slot=cluster"
        - cond: "slot=*,host=*"
          target: "slot=cluster,host=cluster"
        - cond: "request=*,slot=*,host=*"
          target: "request=total,slot=cluster,host=cluster"
        - cond: "database=*,slot=*,host=*"
          target: "database=total,slot=cluster,host=cluster"
  coordinator:
    project_id: "{{ vars.project_id }}"
    template: ../../base/service.j2
    context:
      no_project_id_prefix: false
      interval: 15
      ttl_days: 7
      grid_sec: 15
      port: {{ ydb_service_port }}
      path: "/counters/counters=coordinator/spack"
      aggrRules:
        - cond: "host=*"
          target: "host=cluster"
        - cond: "DC=*"
          target: "host=[[DC]]"
        - cond: "pdisk=*"
          target: "pdisk=total"
        - cond: "vdisk=*"
          target: "vdisk=total"
        - cond: "pdisk=*,host=*"
          target: "pdisk=total,host=cluster"
        - cond: "vdisk=*,host=*"
          target: "vdisk=total,host=cluster"
        - cond: "slot=*"
          target: "slot=cluster"
        - cond: "slot=*,host=*"
          target: "slot=cluster,host=cluster"
  dsproxynode:
    project_id: "{{ vars.project_id }}"
    template: ../../base/service.j2
    context:
      no_project_id_prefix: false
      interval: 30
      ttl_days: 7
      grid_sec: 30
      port: {{ ydb_service_port }}
      path: "/counters/counters=dsproxynode/spack"
      aggrRules:
        - cond: "host=*"
          target: "host=cluster"
        - cond: "host=*"
          target: "host=[[DC]]"
        - cond: "slot=*,host=*"
          target: "slot=cluster,host=cluster"
        - cond: "slot=*,host=*,database=*,sizeClass=*"
          target: "slot=cluster,host=cluster,database=total,sizeClass=total"
        - cond: "host=*,sizeClass=*"
          target: "host=cluster,sizeClass=total"
        - cond: "host=*,storagePool=*"
          target: "host=cluster,storagePool=total"
        - cond: "host=*,sizeClass=*,storagePool=*"
          target: "host=cluster,sizeClass=total,storagePool=total"
        - cond: "storagePool=*"
          target: "storagePool=total"
        - cond: "sizeClass=*,storagePool=*"
          target: "sizeClass=total,storagePool=total"
        - cond: "slot=*,host=*,database=*,sizeClass=*,storagePool=*"
          target: "slot=cluster,host=cluster,database=total,sizeClass=total,storagePool=total"
  grpc:
    project_id: "{{ vars.project_id }}"
    template: ../../base/service.j2
    context:
      no_project_id_prefix: false
      interval: 15
      ttl_days: 7
      grid_sec: 15
      port: {{ ydb_service_port }}
      path: "/counters/counters=grpc/spack"
      aggrRules:
        - cond: "host=*"
          target: "host=cluster"
        - cond: "slot=*"
          target: "slot=cluster"
        - cond: "slot=*,host=*"
          target: "slot=cluster,host=cluster"
        - cond: "request=*,slot=*,host=*"
          target: "request=total,slot=cluster,host=cluster"
        - cond: "database=*,slot=*,host=*"
          target: "database=total,slot=cluster,host=cluster"
  interconnect:
    project_id: "{{ vars.project_id }}"
    template: ../../base/service.j2
    context:
      no_project_id_prefix: false
      interval: 60
      ttl_days: 7
      grid_sec: 60
      port: {{ ydb_service_port }}
      path: "/counters/counters=interconnect/spack"
      aggrRules:
        - cond: "host=*"
          target: "host=cluster"
        - cond: "DC=*"
          target: "host=[[DC]]"
        - cond: "peer=*,host=*"
          target: "peer=total,host=cluster"
        - cond: "peer=*"
          target: "peer=total"
        - cond: "database=*,slot=*,host=*"
          target: "database=total,slot=cluster,host=cluster"
  kqp:
    project_id: "{{ vars.project_id }}"
    template: ../../base/service.j2
    context:
      no_project_id_prefix: false
      interval: 15
      ttl_days: 7
      grid_sec: 15
      port: {{ ydb_service_port }}
      path: "/counters/counters=kqp/spack"
      aggrRules:
        - cond: "host=*"
          target: "host=cluster"
        - cond: "host=*"
          target: "host=[[DC]]"
        - cond: "tenant=*"
          target: "tenant=cluster"
        - cond: "database=*,host=*"
          target: "database=total,host=cluster"
  pdisks:
    project_id: "{{ vars.project_id }}"
    template: ../../base/service.j2
    context:
      no_project_id_prefix: false
      interval: 15
      ttl_days: 7
      grid_sec: 15
      port: {{ ydb_service_port }}
      path: "/counters/counters=pdisks/spack"
      aggrRules:
        - cond: "host=*"
          target: "host=cluster"
        - cond: "pdisk=*,host=*"
          target: "pdisk=total,host=cluster"
        - cond: "pdisk=*,host=*,media=*"
          target: "pdisk=total,host=cluster,media=total"
        - cond: "pdisk=*"
          target: "pdisk=total"
  datastreams:
    project_id: "{{ vars.project_id }}"
    template: ../../base/service.j2
    context:
      no_project_id_prefix: false
      interval: 15
      ttl_days: 7
      grid_sec: 15
      port: {{ ydb_service_port }}
      path: "/counters/counters=datastreams/spack"
      aggrRules:
        - cond: "host=*"
          target: "host=-"
  sqs:
    project_id: "{{ vars.project_id }}"
    template: ../../base/service.j2
    context:
      no_project_id_prefix: false
      interval: 15
      ttl_days: 7
      grid_sec: 15
      port: {{ ydb_service_port }}
      path: "/counters/counters=sqs/spack"
      aggrRules:
        - cond: "host=*"
          target: "host=cluster"
          #        - cond: "host=*,sensor=ConnectionsCount"
          #          target: "host={{host}},sensor=PerHostConnectionsCount"
  proxy:
    project_id: "{{ vars.project_id }}"
    template: ../../base/service.j2
    context:
      no_project_id_prefix: false
      interval: 15
      ttl_days: 7
      grid_sec: 15
      port: {{ ydb_service_port }}
      path: "/counters/counters=proxy/spack"
      aggrRules:
        - cond: "host=*"
          target: "host=cluster"
        - cond: "DC=*"
          target: "host=[[DC]]"
        - cond: "pdisk=*"
          target: "pdisk=total"
        - cond: "vdisk=*"
          target: "vdisk=total"
        - cond: "pdisk=*,host=*"
          target: "pdisk=total,host=cluster"
        - cond: "vdisk=*,host=*"
          target: "vdisk=total,host=cluster"
        - cond: "slot=*"
          target: "slot=cluster"
        - cond: "slot=*,host=*"
          target: "slot=cluster,host=cluster"
        - cond: "slot=*,host=*,database=*"
          target: "slot=cluster,host=cluster,database=total"
        - cond: "slot=*,host=*,database=*,range=*"
          target: "slot=cluster,host=cluster,database=total,range=all"
  storage_pool_stat:
    project_id: "{{ vars.project_id }}"
    template: ../../base/service.j2
    context:
      no_project_id_prefix: false
      interval: 15
      ttl_days: 7
      grid_sec: 0
      port: {{ ydb_service_port }}
      path: "/counters/counters=storage_pool_stat/spack"
      aggrRules:
        - cond: "host=*"
          target: "host=cluster"
  sys:
    project_id: "{{ vars.project_id }}"
    template: ../../base/service.j2
    context:
      no_project_id_prefix: false
      interval: 15
      ttl_days: 7
      grid_sec: 15
      port: 3443
      path: "/pbbin?net.intf=eth.*"
      aggrRules:
        - cond: "host=*"
          target: "host=cluster"
        - cond: "DC=*"
          target: "host=[[DC]]"
  tablets:
    project_id: "{{ vars.project_id }}"
    template: ../../base/service.j2
    context:
      no_project_id_prefix: false
      interval: 30
      ttl_days: 7
      grid_sec: 30
      port: {{ ydb_service_port }}
      path: "/counters/counters=tablets/spack"
      aggrRules:
        - cond: "host=*"
          target: "host=cluster"
        - cond: "range=*"
          target: "range=total"
        - cond: "range=*,host=*"
          target: "range=total,host=cluster"
        - cond: "slot=*,host=*"
          target: "slot=cluster,host=cluster"
        - cond: "slot=*,host=*,database=*"
          target: "slot=cluster,host=cluster,database=total"
  vdisks:
    project_id: "{{ vars.project_id }}"
    template: ../../base/service.j2
    context:
      no_project_id_prefix: false
      interval: 30
      ttl_days: 7
      grid_sec: 30
      port: {{ ydb_service_port }}
      path: "/counters/counters=vdisks/spack"
      aggrRules:
        - cond: "group=*,orderNumber=*,storagePool=*"
          target: "group=total,orderNumber=total,storagePool=total"
        - cond: "group=*,orderNumber=*,media=*,pdisk=*"
          target: "group=total,orderNumber=total,media=total,pdisk=total"
        - cond: "host=*,group=*,orderNumber=*,pdisk=*,storagePool=*"
          target: "host=cluster,group=total,orderNumber=total,pdisk=total,storagePool=total"
        - cond: "host=*,group=*,orderNumber=*,pdisk=*,media=*"
          target: "host=cluster,group=total,orderNumber=total,pdisk=total,media=total"
#  ydb:
#    project_id: "{{ vars.project_id }}"
#    template: ../../base/service.j2
#    context:
#      no_project_id_prefix: false
#      interval: 15
#      ttl_days: 7
#      grid_sec: 15
#      port: {{ ydb_service_port }}
#      path: "/counters/counters=ydb/spack"
#      aggrRules:
#        - cond: "host=*"
#          target: "host=cluster"
#  unified-agent:
#    project_id: "{{ vars.project_id }}"
#    template: ../../base/service.j2
#    context:
#      no_project_id_prefix: false
#      interval: 15
#      ttl_days: 7
#      grid_sec: 15
#      port: 16300
#      path: "/counters/spack"
#      aggrRules:
#        - cond: "host=*"
#          target: "host=cluster"

