api_path: /services/
entities:

  compute_head:
    template: ../../base/service.j2
    context:
      grid_sec: 15
      interval: 15
      ttl_days: 30
      aggrRules:
        - {cond: "host=*",                                   target: "host=cluster"}
        - {cond: "grpc_method=*",                            target: "grpc_method=All"}
        - {cond: "host=*,grpc_method=*",                     target: "host=cluster,grpc_method=All"}
        - {cond: "grpc_service=*",                           target: "grpc_service=All"}
        - {cond: "host=*,grpc_service=*",                    target: "host=cluster,grpc_service=All"}
        - {cond: "grpc_method=*,grpc_service=*",             target: "grpc_method=All,grpc_service=All"}
        - {cond: "host=*,grpc_method=*,grpc_service=*",      target: "host=cluster,grpc_method=All,grpc_service=All"}
        - {cond: "grpc_code=*,grpc_method=*,grpc_service=*", target: "grpc_code=All,grpc_method=All,grpc_service=All"}
        - {cond: "http_status_code=*,http_method=*",         target: "http_status_code=All,http_method=All"}

  compute_metadata:
    template: ../../base/service.j2
    context:
      grid_sec: 60
      interval: 15
      ttl_days: 30
      aggrRules:
        - {cond: "host=*",              target: "host=cluster"}
        - {cond: "host=*",              target: "host=[[DC]]"}
        - {cond: "http_status_code=*",  target: "http_status_code=All"}

  compute_tasks:
    template: ../../base/service.j2
    context:
      grid_sec: 10
      interval: 10
      ttl_days: 30
      aggrRules:
        - {cond: "host=*",               target: "host=cluster"}
        - {cond: "type=*",               target: "type=All"}  
        - {cond: "function_id=*",        target: "function_id=All"}
        - {cond: "host=*,type=*",        target: "host=cluster,type=All"}
        - {cond: "host=*,function_id=*", target: "host=cluster,function_id=All"}

  # Устаревший общий сервис. Когда метрики перестанут поступать - удалить.
  internals:
    template: ../../base/service.j2
    context:
      grid_sec: 30
      interval: 60
      ttl_days: 30
      aggrRules:
        - {cond: "cloud_id=*,instance_id=*",        target: "cloud_id=total,instance_id=total"}
        - {cond: "host=*",                          target: "host=cluster"}
        - {cond: "host=*,cloud_id=*",               target: "host=cluster,cloud_id=total"}
        - {cond: "instance_id=*,status=*,host=*",   target: "instance_id=all,status=all,host=cluster"}
        - {cond: "host=*,cloud_id=*,instance_id=*", target: "host=cluster,cloud_id=total,instance_id=all"}
        - {cond: "method=*,host=*,status=*",        target: "method=all,host=cluster,status=all"}
        - cond: "method=*,host=*,status=*,status_code=*"
          target: "method=all,host=cluster,status=all,status_code=all"
        - cond: "method=*,bucket=*,host=*,status=*"
          target: "method=all,bucket=all,host=cluster,status=all"
        - cond: "bucket=*,path=*,method=*,status=*,host=*"
          target: "bucket=all,path=all,method=all,status=all,host=cluster"
        - cond: "bucket=*,status_code=*,method=*,status=*,host=*"
          target: "bucket=all,status_code=all,method=all,status=all,host=cluster"

  # Общий сервис. Кандидат на удаление, https://st.yandex-team.ru/CLOUD-2515, т.к. не используется.
  logs:
    template: ../../base/service.j2
    context:
      grid_sec: 60
      ttl_days: 7
      aggrRules:
        - {cond: "host=*",      target: "host=cluster"}
        - {cond: "host=vla*",   target: "host=cluster-vla" }
        - {cond: "host=sas*",   target: "host=cluster-sas" }
        - {cond: "host=myt*",   target: "host=cluster-myt" }

  # Общий сервис.
  solomon_agent:
    template: ../../base/service.j2
    context:
      port: 8081
      path: "/counters/spack"
      grid_sec: 15
      interval: 15
      ttl_days: 7
      aggrRules:
        - {cond: "host=*",      target: "host=cluster"}

  # Общий сервис.
  sys:
    template: ../../base/service.j2
    context:
      ttl_days: 14
      grid_sec: 30
      interval: 30
      aggrRules:
        - {cond: "host=*",      target: "host=cluster"}
        - {cond: "cpu=*",       target: "cpu=all"}
