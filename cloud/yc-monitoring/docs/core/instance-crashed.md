[Алерт в Solomon](https://solomon.yandex-team.ru/admin/projects/yandexcloud/alerts?text=alert+on+core+crashed+instances).

## instance-crashed, instance-error
Загорается при переходе инстансов в статусы `crashed/error`.

## Подробности
Метка `reason` определяет причину падения.
Ниже - список всех возможных причин.

## Диагностика

#### 1. broken-qmp-connection

Проблемы с QMP-соединением. Вероятнее всего - таймаут при ожидании ответа от QMP.

**Как реагировать?**

Читать логи/dmesg - искать причину залипания QEMU.

#### 2. failed-incoming-migration

Incoming-миграция завершилась с ошибкой.

**Как реагировать?**

Читать логи QEMU (прикапываются в логи инстанса) - там вероятнее всего будет причина фейла миграции.

#### 3. guest-panic

Гостевая паника. Вероятнее всего, проблема в самом госте.

**Как реагировать?**

По идее, этот код имеет смысл игнорировать для единичных инстансов и обращать внимание только на массовые срабатывания.

#### 4. hypervisor-startup-error

Гипервизор не смог запуститься за отведенный таймаут, либо вовсе упал при старте. К примеру, как следствие фрагментации THP.

**Как реагировать?**

Сначала смотрим в логи QEMU. Дальше уже разбираем индивидуально.

#### 5. hypervisor-termination-error

Не смогли убить гипервизор за отведенный таймаут.

**Как реагировать?**

Стоит посмотреть dmesg на наличие каких-то проблем на хосте. Например, зависания диска.
Если проблем на хосте не видно, посмотреть логи QEMU.

#### 6. qmp-error

Получили отказ в выполнении QMP-команды там, где Compute предполагает всегда успешное ее выполнение.

**Как реагировать?**

Смотрим логи инстанса - какая команда посылалась, какой ответ получили.

#### 7. unexpected-hypervisor-shutdown

Гипервизор завершился не по нашей инициативе - к примеру, OOM.

**Как реагировать?**

Сначала смотрим в dmesg, предполагая OOM, если нет - уже в логи и пр. ООМ может быть связано с проблемой
в THP, которую уже починили, но еще не донесли на все хосты, тикет - https://st.yandex-team.ru/CLOUD-84980.
В этом случае можно попросить инфру расселить вируталки с ноды.

## Ссылки
- [Исходный код алерта](https://bb.yandex-team.ru/projects/CLOUD/repos/yc-monitoring/browse/solomon/core/alerts/core_crashed_instances.j2)
- [Тикет на создание этого алерта](https://st.yandex-team.ru/CLOUD-70221)
