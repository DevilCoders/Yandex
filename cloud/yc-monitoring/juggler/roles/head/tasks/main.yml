---
- include: tasks/common.yml
  tags: ["compute", "yc-compute-api-team"]
  vars:
    host: "yc_common_head_{{ env }}"
    unreachable_host: "yc_common_head_{{ env }}"
    silent_checks: ["oom-killer", "salt-minion_version", "coredump_common", "reboot-count", "solomon-agent"]
    telegram_chat_id: ComputeAPIDuty
    custom_notifications: "{{ telegram_notification }}"
    check_tags: ['yc-head', 'yc-compute', 'yc-compute-api-team']

- include: push-client.yml
  tags: ["compute", "yc-compute-api-team"]
  vars:
    host: "yc_common_head_{{ env }}"
    unreachable_host: "yc_common_head_{{ env }}"
    telegram_chat_id: ComputeAPIDuty
    check_tags: ['yc-head', 'yc-compute', 'yc-compute-api-team']

- include: scheduler.yml
  tags: ["compute", "yc-compute-node-team"]
  vars:
    host: "yc_compute_head_{{ env }}"
    unreachable_host: "yc_common_head_{{ env }}"
    telegram_chat_id: ComputeNodeDuty
    check_tags: ['yc-head', 'yc-compute', 'yc-compute-node-team']

- include: compute-api.yml
  tags: ["compute", "yc-compute-api-team"]
  vars:
    host: "yc_compute_head_{{ env }}"
    unreachable_host: "yc_common_head_{{ env }}"
    telegram_chat_id: ComputeAPIDuty
    check_tags: ['yc-head', 'yc-compute', 'yc-compute-api-team']

- include: solomon-quotas-dc.yml
  tags: ["compute", "yc-compute-api-team"]
  vars:
    host: "yc_compute_head_{{ env }}"
    unreachable_host: "yc_common_head_{{ env }}"
    telegram_chat_id: ComputeAPIDuty
    check_tags: [ 'yc-head', 'yc-compute', 'yc-compute-api-team' ]
  with_items: "{{ datacenters | default(omit) }}"
  loop_control:
      loop_var: dc

- include: tasks/local-lb.yml
  tags: ["compute", "yc-compute-api-team"]
  when: env in ["testing"]  # we use local_lb only in testing now
  vars:
    host: "yc_common_head_{{ env }}"
    unreachable_host: "yc_common_head_{{ env }}"
    check_tags: [ 'yc-head', 'yc-compute', 'yc-compute-api-team' ]
    telegram_chat_id: ComputeAPIDuty

- include: tasks/compute-metaproxy.yml
  tags: ["compute", "yc-compute-api-team"]
  vars:
    host: "yc_compute_head_{{ env }}"
    unreachable_host: "yc_common_head_{{ env }}"
    telegram_chat_id: ComputeAPIDuty
    check_tags: ['yc-head', 'yc-compute', 'yc-compute-api-team']
