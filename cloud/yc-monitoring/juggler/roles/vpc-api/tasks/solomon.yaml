- name: 'juggler_check: many ready tasks'
  juggler_check: ''
  args: "{{ default_check | hash_merge(item, default_timed_limits) }}"
  with_items:
    - service: vpc-api-ready-tasks

- name: 'juggler_check: failed tasks'
  juggler_check: ''
  args: "{{ default_check | hash_merge(item, default_timed_limits) }}"
  with_items:
    - service: vpc-api-failed-tasks

- name: 'juggler_check: interrupted tasks'
  juggler_check: ''
  args: "{{ default_check | hash_merge(item, default_timed_limits) }}"
  with_items:
    - service: vpc-api-interrupted-tasks

- name: 'juggler_check: failed periodic tasks'
  juggler_check: ''
  args: "{{ default_check | hash_merge(item, default_timed_limits) }}"
  with_items:
    - service: vpc-api-failed-periodic-tasks

- name: 'juggler_check: tasks with too many retries'
  juggler_check: ''
  args: "{{ default_check | hash_merge(item, default_timed_limits) }}"
  with_items:
    - service: vpc-api-many-retries-tasks

- name: 'juggler_check: not processing tasks'
  juggler_check: ''
  args: "{{ default_check | hash_merge(item, default_timed_limits) }}"
  with_items:
    - service: vpc-api-not-processing-tasks

- name: 'juggler_check: task with too long duration'
  juggler_check: ''
  args: "{{ default_check | hash_merge(item, default_timed_limits) }}"
  with_items:
    - service: vpc-api-long-duration-tasks

- name: 'juggler_check: operations with too long duration'
  juggler_check: ''
  args: "{{ silent_check | hash_merge(item, default_timed_limits) }}"
  with_items:
    - service: vpc-api-long-duration-ops

- name: 'juggler_check: L7 balancer observes vpc-api errors'
  juggler_check: ''
  when: env in ["prod", "preprod"]  # no l7 at testing clusters
  args: "{{ default_check | hash_merge(item, default_timed_limits) }}"
  with_items:
    - service: vpc-api-l7-errors

- name: 'juggler_check: limits by JVM gc timings'
  juggler_check: ''
  args: "{{ default_check | hash_merge(item, default_timed_limits) }}"
  with_items:
    - service: vpc-api-gc-timings

- name: 'juggler_check: grpc latency for read methods'
  juggler_check: ''
  args: "{{ default_check | hash_merge(item, default_timed_limits) }}"
  with_items:
    - service: vpc-api-grpc-latency-read

- name: 'juggler_check: grpc latency for write methods'
  juggler_check: ''
  args: "{{ default_check | hash_merge(item, default_timed_limits) }}"
  with_items:
    - service: vpc-api-grpc-latency-write

- name: 'juggler_check: vpc-api-unparsed-search-docs'
  juggler_check: ''
  when: env in ["prod", "preprod"]  # YC Search works only in prod, preprod CLOUD-67377
  args: "{{ default_check | hash_merge(item, default_timed_limits) }}"
  with_items:
    - service: vpc-api-unparsed-search-docs
      children:
        - host: "tag=vpc-api-yc-search & host=cloud_{{ env }}_vpc-api_solomon"
          service: all
          instance: all
          type: EVENTS
      meta:
        urls:
          - title: Description
            url: 'https://wiki.yandex-team.ru/cloud/devel/sdn/duty/juggler/#vpc-api-unparsed-search-docs'

# Logbroker checks
- name: 'juggler_check: limits by Logbroker MessagesRead'
  juggler_check: ''
  when: env in ["prod", "preprod"]
  args: "{{ default_check | hash_merge(item, default_timed_limits) }}"
  with_items:
    - service: vpc-api-logbroker-messages-read

- name: 'juggler_check: limits by Logbroker MessagesWrittenOriginal'
  juggler_check: ''
  when: env in ["prod", "preprod"]
  args: "{{ default_check | hash_merge(item, default_timed_limits) }}"
  with_items:
    - service: vpc-api-logbroker-messages-written

- name: 'juggler_check: limits by Logbroker PartitionMaxWriteQuotaUsage'
  juggler_check: ''
  when: env in ["prod", "preprod"]
  args: "{{ default_check | hash_merge(item, default_timed_limits) }}"
  with_items:
    - service: vpc-api-logbroker-partition-max-write-quota-used

- name: 'juggler_check: limits by Logbroker PartitionWriteQuotaWaitOriginal'
  juggler_check: ''
  when: env in ["prod", "preprod"]
  args: "{{ default_check | hash_merge(item, default_timed_limits) }}"
  with_items:
    - service: vpc-api-logbroker-partition-write-quota-wait

- name: 'juggler_check: limits by Logbroker QuotaConsumed'
  juggler_check: ''
  when: env in ["prod", "preprod"]
  args: "{{ default_check | hash_merge(item, default_timed_limits) }}"
  with_items:
    - service: vpc-api-logbroker-quota-consumed

- name: 'juggler_check: limits by Logbroker ReadTimeLagMs'
  juggler_check: ''
  when: env in ["prod", "preprod"]
  args: "{{ default_check | hash_merge(item, default_timed_limits) }}"
  with_items:
    - service: vpc-api-logbroker-read-time-lag

- name: 'juggler_check: limits by Logbroker TimeSinceLastReadMs'
  juggler_check: ''
  when: env in ["prod", "preprod"]
  args: "{{ default_check | hash_merge(item, default_timed_limits) }}"
  with_items:
    - service: vpc-api-logbroker-time-since-last-read

- name: 'juggler_check: limits by Logbroker TopicWriteQuotaWaitOriginal'
  juggler_check: ''
  when: env in ["prod", "preprod"]
  args: "{{ default_check | hash_merge(item, default_timed_limits) }}"
  with_items:
    - service: vpc-api-logbroker-topic-write-quota-wait
