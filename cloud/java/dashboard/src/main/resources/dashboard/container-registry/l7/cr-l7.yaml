uid: ycr-l7
refresh: 3m
title: Container registry L7 dashboard

tags: [ 'ycp', 'ycp-cr', 'ycp-duty']

graphDefaults:
  datasource: 'Solomon Cloud'
  width: 8
  height: 6

variables:
  ui:
    cluster: { values: [prod, preprod] }

queryDefaults: { labels: 'host=!cluster' }


rows:
  - title: 'Viewer L7 balancer'
    queryDefaults: { dropNan: true, labels: 'project=platform, service=api_envoy_tags_ma, host=*, cluster=cloud_${cluster}_container_registry, backend_group_id=a5d3ia940b23fl1h2no5|ds7djfit426tpf3t9764'}
    drilldowns:
      - subUid: 'dd-viewer-dc'
        tags: [ 'ycp', 'ycp-cr', 'ycp-duty' ]
        ui:
          cluster: cluster
          host:
            multi: true
            values: [ '*-myt*', '*-sas*', '*-vla*']
            titles: [ 'DC myt', 'DC sas', 'DC vla']
        uiRepeat: host
        labels: 'host=$host'
    panels:
      - type: graph
        templates: [{ name: rps, rate: ui, sumLines: [name] }, { name: alias, alias: rate }]
        title: 'Backend RPS $rateUnit'
        display: { legend: false, fill: 0 }
        yAxes: [ { min: 0, decimals: 1 } ]
        queries:
          - params: { labels: 'name=alb_upstream_rq_total, host!=cluster' }

      - type: graph
        templates: { name: errors }
        title: 'Backend errors'
        queries:
          - params: { labels: 'name=alb_upstream_rq_xx, alb_response_code_class=5, host!=cluster' }
          - params: { labels: 'name=alb_upstream_rq, alb_response_code=503, host!=cluster' }
          - params: { labels: 'name=alb_upstream_rq_xx, alb_response_code_class=4, host!=cluster' }
        draw:
          - { alias: '5xx', color: '#b20', at: right }
          - { alias: '503', color: '#da7', at: right }
          - { alias: '4xx', color: '#147', at: left }

      - type: graph
        templates: { name: percentile, groupLines: true, format: solomon }
        title: 'Request time histogram'
        display: { legend: false, fill: 0 }
        yAxes: [ { format: ms, min: 0, decimals: 1 } ]
        queries:
          - params: { labels: 'name=alb_upstream_rq_time, host!=cluster' }

  - title: 'Uploader L7 balancer'
    queryDefaults: { dropNan: true, labels: 'project=platform, service=api_envoy_tags_ma, host=*, cluster=cloud_${cluster}_container_registry, backend_group_id=a5danlcppagph631db3f|ds7o8alq7s26j0pmapm3'}
    drilldowns:
      - subUid: 'dd-uploader-dc'
        tags: [ 'ycp', 'ycp-cr', 'ycp-duty' ]
        ui:
          cluster: cluster
          host:
            multi: true
            values: [ '*-myt*', '*-sas*', '*-vla*']
            titles: [ 'DC myt', 'DC sas', 'DC vla']
        uiRepeat: host
        labels: 'host=$host'
    panels:
      - type: graph
        templates: [{ name: rps, rate: ui, sumLines: [name] }, { name: alias, alias: rate }]
        title: 'Backend RPS $rateUnit'
        display: { legend: false, fill: 0 }
        yAxes: [ { min: 0, decimals: 1 } ]
        queries:
          - params: { labels: 'name=alb_upstream_rq_total, host!=cluster' }

      - type: graph
        templates: { name: errors }
        title: 'Backend errors'
        queries:
          - params: { labels: 'name=alb_upstream_rq_xx, alb_response_code_class=5, host!=cluster' }
          - params: { labels: 'name=alb_upstream_rq, alb_response_code=503, host!=cluster' }
          - params: { labels: 'name=alb_upstream_rq_xx, alb_response_code_class=4, host!=cluster' }
        draw:
          - { alias: '5xx', color: '#b20', at: right }
          - { alias: '503', color: '#da7', at: right }
          - { alias: '4xx', color: '#147', at: left }

      - type: graph
        templates: { name: percentile, groupLines: true, format: solomon }
        title: 'Request time histogram'
        display: { legend: false, fill: 0 }
        yAxes: [ { format: ms, min: 0, decimals: 1 } ]
        queries:
          - params: { labels: 'name=alb_upstream_rq_time, host!=cluster' }

  - title: 'Manager L7 balancer'
    queryDefaults: { dropNan: true, labels: 'project=platform, service=api_envoy_tags_ma, host=*, cluster=cloud_${cluster}_cpl, backend_group_id=a5de6bmslcn1oa8q4spb|ds703jbrs65kh0502nue'}
    drilldowns:
      - subUid: 'dd-manager-dc'
        tags: [ 'ycp', 'ycp-cr', 'ycp-duty' ]
        ui:
          cluster: cluster
          host:
            multi: true
            values: [ '*-myt*', '*-sas*', '*-vla*']
            titles: [ 'DC myt', 'DC sas', 'DC vla']
        uiRepeat: host
        labels: 'host=$host'
    panels:
      - type: graph
        templates: [{ name: rps, rate: ui, sumLines: [name] }, { name: alias, alias: rate }]
        title: 'Backend RPS $rateUnit'
        display: { legend: false, fill: 0 }
        yAxes: [ { min: 0, decimals: 1 } ]
        queries:
          - params: { labels: 'name=alb_upstream_rq_total, host!=cluster' }

      - type: graph
        templates: { name: errors }
        title: 'Backend errors'
        queries:
          - params: { labels: 'name=alb_upstream_rq_xx, alb_response_code_class=5, host!=cluster' }
          - params: { labels: 'name=alb_upstream_rq, alb_response_code=503, host!=cluster' }
          - params: { labels: 'name=alb_upstream_rq_xx, alb_response_code_class=4, host!=cluster' }
        draw:
          - { alias: '5xx', color: '#b20', at: right }
          - { alias: '503', color: '#da7', at: right }
          - { alias: '4xx', color: '#147', at: left }

      - type: graph
        templates: { name: percentile, groupLines: true, format: solomon }
        title: 'Request time histogram'
        display: { legend: false, fill: 0 }
        yAxes: [ { format: ms, min: 0, decimals: 1 } ]
        queries:
          - params: { labels: 'name=alb_upstream_rq_time, host!=cluster' }
