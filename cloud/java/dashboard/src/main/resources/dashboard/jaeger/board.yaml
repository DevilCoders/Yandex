uid: ycp-jaeger
title: Jaeger dashboard

variables:
  ui:
    cluster: { values: [preprod, prod] }

queryDefaults: { labels: 'project=jaeger, service=jaeger_service' }

rows:
  - title: Collector Service
    graphDefaults: { datasource: 'Solomon Cloud', width: 12, height: 6 }
    queryDefaults: { labels: 'cluster=jaeger_collector_${cluster}, host=jaeger-collector-agent-${cluster}-*' }
    panels:
      - type: graph
        templates: { name: rps, sumLines: [host] }
        display: { stack: true }
        title: Received span/s ($cluster)
        queries:
          - params: { labels: 'sensor=jaeger_collector_spans_received_total, format=*, svc=*, debug=false' }
        yAxes: [{ label: 'span/s' }]
      - type: graph
        templates: { name: rps, sumLines: [host] }
        display: { stack: true }
        title: Inserted span/s ($cluster)
        queries:
          - params: { labels: 'sensor=jaeger_spans_inserted_total' }
      - type: graph
        templates: { name: rps, sumLines: [host] }
        display: { stack: true }
        title: Saved span/s by host ($cluster)
        queries:
          - params: { labels: 'sensor=jaeger_collector_spans_saved_by_svc_total, svc=*, debug=false' }
      - type: graph
        templates: { name: rps, sumLines: [svc] }
        title: Saved span/s by service ($cluster)
        queries:
          - params: { labels: 'sensor=jaeger_collector_spans_saved_by_svc_total, host=*, debug=false' }
      - type: graph
        templates: { name: rps, sumLines: [host] }
        title: Rejected span/s ($cluster)
        params: { width: 8 }
        display: { stack: true }
        queries:
          - params: { labels: 'sensor=jaeger_collector_spans_rejected_total, format=*, svc=*, debug=false' }
      - type: graph
        templates: { name: rps, sumLines: [host] }
        display: { stack: true }
        title: Dropped span/s ($cluster)
        params: { width: 8 }
        queries:
          - params: { labels: 'sensor=jaeger_collector_spans_dropped_total' }
      - type: graph
        title: Queue length ($cluster)
        params: { width: 8 }
        queries:
          - params: { labels: 'sensor=jaeger_collector_queue_length' }
            select: { group_by_labels: [sum, host], diff: [], drop_below: [0] }
      - type: graph
        templates: { name: rps, sumLines: [host] }
        display: { stack: true }
        title: Received trace/s ($cluster)
        queries:
          - params: { labels: 'sensor=jaeger_collector_traces_received_total, format=*, svc=*, debug=false' }
      - type: graph
        title: Rejected trace/s ($cluster)
        templates: { name: rps, sumLines: [host] }
        display: { stack: true }
        queries:
          - params: { labels: 'sensor=jaeger_collector_traces_rejected_total, format=*, svc=*, debug=false' }
      - type: graph
        templates: { name: rps, sumLines: [host] }
        display: { stack: true }
        title: Saved trace/s by host ($cluster)
        queries:
          - params: { labels: 'sensor=jaeger_collector_traces_saved_by_svc_total, svc=*, debug=false' }
      - type: graph
        templates: { name: rps, sumLines: [svc] }
        title: Saved trace/s by service ($cluster)
        queries:
          - params: { labels: 'sensor=jaeger_collector_traces_saved_by_svc_total, svc=*, debug=false' }
      - type: graph
        templates: { name: rps, sumLines: [host] }
        display: { stack: true }
        title: Errors per second ($cluster)
        queries:
          - params: { labels: 'sensor=jaeger_errors_total' }
      - type: graph
        templates: { name: rps, sumLines: [host] }
        display: { stack: true }
        title: Fatal errors per second ($cluster)
        queries:
          - params: { labels: 'sensor=jaeger_fatal_errors_total' }

  - title: Agent Service
    graphDefaults: { datasource: 'Solomon Cloud', width: 8, height: 6 }
    queryDefaults: { labels: 'cluster=jaeger_collector_${cluster}, host=jaeger-collector-agent-${cluster}-*' }
    panels:
      - type: graph
        templates: { name: rps, sumLines: [host] }
        display: { stack: true }
        title: Submitted span/s ($cluster)
        queries:
          - params: { labels: 'sensor=jaeger_agent_reporter_spans_submitted_total, format=*, protocol=*' }
      - type: graph
        templates: { name: rps, sumLines: [host] }
        display: { stack: true }
        title: Failures span/s ($cluster)
        queries:
          - params: { labels: 'sensor=jaeger_agent_reporter_spans_failures_total, format=*, protocol=*' }
      - type: graph
        templates: { name: rps, sumLines: [host] }
        display: { stack: true }
        title: Submitted batch/s ($cluster)
        queries:
          - params: { labels: 'sensor=jaeger_agent_reporter_batches_submitted_total, format=*, protocol=*' }
      - type: graph
        templates: { name: rps, sumLines: [host] }
        display: { stack: true }
        title: Processed udp packets per second ($cluster)
        queries:
          - params: { labels: 'sensor=jaeger_agent_thrift_udp_server_packets_processed_total, protocol=compact, model=*' }
      - type: graph
        templates: { name: rps, sumLines: [host] }
        display: { stack: true }
        title: Dropped thrift udp server packets per second ($cluster)
        queries:
          - params: { labels: 'sensor=jaeger_agent_thrift_udp_server_packets_dropped_total, protocol=compact, model=*' }
      - type: graph
        templates: { name: rps, sumLines: [host] }
        display: { stack: true }
        title: Read thrift udp server errors per second ($cluster)
        queries:
          - params: { labels: 'sensor=jaeger_agent_thrift_udp_server_read_errors_total, protocol=compact, model=*' }

  - title: Query Service
    graphDefaults: { datasource: 'Solomon Cloud', width: 12, height: 6 }
    queryDefaults: { labels: 'cluster=jaeger_query_${cluster}, host=jaeger-query-${cluster}-*' }
    panels:
      - type: graph
        templates: { name: rps, sumLines: [host], rate: rpm }
        display: { stack: true }
        title: HTTP requests (total) ($cluster)
        queries:
          - params: { labels: 'sensor=jaeger_rpc_http_requests_total, status_code=*' }
      - type: graph
        templates: { name: rps, sumLines: [host], rate: rpm }
        display: { stack: true }
        title: HTTP requests (5xx) ($cluster)
        queries:
          - params: { labels: 'sensor=jaeger_rpc_http_requests_total, status_code=5xx' }

  - title: System monitors
    graphDefaults: { datasource: 'Solomon Cloud', width: 8, height: 6 }
    panels:
      - type: graph
        title: Collector Available memory
        queries:
          - params: { labels: 'path=/Memory/MemAvailable, host=jaeger-collector-agent-${cluster}-*, cluster=jaeger_collector_${cluster}' }
            groupByTime: { max: default }
            select: { drop_below: '0', alias: '{{host}}'}
        yAxes: [{ format: bytes, min: 0 }]
      - type: graph
        title: Collector Free Space
        queries:
          - params: { labels: 'path=/Filesystem/FreeB, mountpoint=*, host=jaeger-collector-agent-${cluster}-*, cluster=jaeger_collector_${cluster}' }
            select: { group_by_labels: [sum, host] }
        yAxes: [{ format: bytes, min: 0 }]
      - type: graph
        title: Collector LA
        queries:
          - params: { labels: 'path=/Proc/La, host=jaeger-collector-agent-${cluster}-*, cluster=jaeger_collector_${cluster}' }
            groupByTime: { max: default }
            select: { drop_below: '0', alias: '{{host}}'}
        yAxes: [{ min: 0, decimals: 1 }]
      - type: graph
        title: Query Available memory
        queries:
          - params: { labels: 'path=/Memory/MemAvailable, host=jaeger-query-${cluster}-*, cluster=jaeger_query_${cluster}' }
            groupByTime: { max: default }
            select: { drop_below: '0', alias: '{{host}}'}
        yAxes: [{ format: bytes, min: 0 }]
      - type: graph
        title: Query Free Space
        queries:
          - params: { labels: 'path=/Filesystem/FreeB, mountpoint=*, host=jaeger-query-${cluster}-*, cluster=jaeger_query_${cluster}' }
            select: { group_by_labels: [sum, host] }
        yAxes: [{ format: bytes, min: 0 }]
      - type: graph
        title: Query LA
        queries:
          - params: { labels: 'path=/Proc/La, host=jaeger-query-${cluster}-*, cluster=jaeger_query_${cluster}' }
            groupByTime: { max: default }
            select: { drop_below: '0', alias: '{{host}}'}
        yAxes: [{ min: 0, decimals: 1 }]
