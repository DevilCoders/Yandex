uid: ycpIoTHWStatus
refresh: 10m
title: IoT instances status
tags: [ 'ycp', 'ycp-iot' ]

variables:
  ui:
    cluster: { values: [prod, preprod] }
  repeat:
    service:
      values: ['mqtt-broker-ma', 'events-broker-ma', 'device-management-ma']
      titles: ['MQTT', 'Events', 'Devices']

graphDefaults: { datasource: 'Solomon Cloud', width: 8, height: 6 }
queryDefaults: { labels: 'project=cloud_iot, host=*-*, application=system' }

rows:
  - title: '@{service:title}'
    repeat: service
    queryDefaults: { labels: 'service=@{service}, cluster=${cluster}' }
    graphDefaults: { width: 6 }
    panels:

      - type: graph
        title: 'Available memory'
        queries:
          - params: { labels: 'name=node_memory_MemAvailable_bytes' }
            groupByTime: { max: default }
            select: { drop_below: '0', alias: '{{host}}' }
        yAxes: [{ format: bytes, min: 0 }]

      - type: graph
        title: 'LA'
        queries:
          - params: { labels: 'name=node_load1' }
            groupByTime: { max: default }
            select: { drop_below: '0', alias: '{{host}}' }
        yAxes: [{ min: 0, decimals: 1 }]

      - type: graph
        title: 'CPU'
        queries:
          - params: { labels: 'name=node_cpu_seconds_total, mode=system|user|nice|softirq' }
            groupByTime: { avg: default }
            select: { diff: [], drop_below: '0', group_by_labels: ['sum', 'host'], alias: '{{host}}' }
        yAxes: [{ min: 0, decimals: 0 }]

      - type: graph
        title: 'Disk read'
        queries:
          - params: { labels: 'name=node_disk_reads_completed_total' }
            groupByTime: { max: default }
            select: { diff: [], drop_below: '0', group_by_labels: ['sum', 'host'], alias: '{{host}}' }
        yAxes: [{ min: 0, decimals: 0 }]
