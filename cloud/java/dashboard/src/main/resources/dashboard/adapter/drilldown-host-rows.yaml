id: 139232
uid: c2keVA3mk
refresh: 3m
title: API adapter drilldown (by host - rows)

#pointerSharing: tooltip
tags: [ 'ycp', 'ycp-adapter', 'ycp-duty', 'ycp-drilldown' ]

variables:
  ui:
    cluster: { values: [prod, preprod] }
    adapter_host:
      multi: true
      values: [
        'cluster', '*-*',
        '*-myt*', '*-sas*', '*-vla*',
        '*-myt1', '*-sas1',  '*-vla1', '*-myt2', '*-sas2', '*-vla2'
      ]
      titles: [
        'cluster (summary)', 'cluster (by hosts)',
        'DC myt', 'DC sas', 'DC vla',
        'host myt1', 'host sas1',  'host vla1', 'host myt2', 'host sas2', 'host vla2'
      ]
  replacement:
    !include ../include/errors.yaml

graphDefaults:
  datasource: Solomon
  width: 8
  height: 6
queryDefaults: { labels: 'project=yandexcloud, cluster=cloud_${cluster}_api-adapter, service=api_adapter, app=cloud-api-adapter_server, method=all, host=$adapter_host' }

rows:

  - title: 'Adapter - $cluster - $adapter_host'
    uiRepeat: adapter_host
    panels:

      - type: graph
        templates: [{ name: rps, sumLines: false }, { name: alias, alias: '{{host}}' }]
        title: 'Adapter rps'
        display: { legend: false, stack: true }
        queries:
          - params: { labels: 'sensor=grpc_requests, meter_type=count' }

      - type: graph
        templates: { name: errors }
        title: 'Adapter errors'
        queryDefaults: { defaultTimeWindow: '15s' }
        queries:
          - params: { labels: 'sensor=grpc_statuses, status=@4xx' }
          - params: { labels: 'sensor=grpc_statuses, status=@503' }
          - params: { labels: 'sensor=grpc_statuses, status=@5xx' }
        draw: [{ alias: '4xx', color: '#147', at: right }, { alias: '503', color: '#da7', at: left }, { alias: '5xx', color: '#b20', at: left }]

      - type: graph
        templates: { name: percentile, levels: [50, 75, 90, 99], groupLines: true }
        display: { decimals: 1 }
        title: 'Adapter response'
        queries:
          - params: { labels: 'sensor=grpc_durations' }
