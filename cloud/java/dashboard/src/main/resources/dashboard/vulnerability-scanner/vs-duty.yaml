folderId: 569316
uid: yc-vs-duty
refresh: 3m
title: Vulnerability Scanner Duty Dashboard

tags: [ 'ycp', 'ycp-vs', 'ycp-duty']
links:
  - { title: 'Source spec', url: 'https://a.yandex-team.ru/arc/trunk/arcadia/cloud/java/dashboard/src/main/resources/dashboard/vulnerability-scanner/vs-duty.yaml' }
  - title: Drilldown
    tags: [ 'ycp-vs-drilldown' ]

variables:
  ds:
    solomon:
      type: 'grafana-solomon-datasource'
      regex: '^Solomon Cloud( Preprod)?$'
  replacement:
    !include ../include/errors.yaml

graphDefaults:
  datasource: '$solomon'
  width: 8
  height: 6

rows:
  - title: Controller
    queryDefaults: { labels: 'project=yc.vulnerability-scanner.cloud, cluster=yc.vs.metrics, host!=cluster, service=controller-ma, app=vulnerability-scanner-controller_server, method=!all' }
    drilldowns:
      - subUid: dd_vs_controller_host
        tags: [ 'ycp', 'ycp-vs', 'ycp-duty' ]
        ui:
          host:
            multi: true
            values: [ '*-*', '*-myt*', '*-sas*', '*-vla*', '*-1-myt', '*-1-sas', '*-1-vla' , '*-2-myt', '*-2-sas', '*-2-vla' ]
            titles: [ 'Cluster', 'DC myt', 'DC sas', 'DC vla', 'Host IG myt1', 'Host IG sas1', 'Host IG vla1', 'Host IG myt2', 'Host IG sas2', 'Host IG vla2' ]
        uiRepeat: host
        labels: 'host=$host'
      - subUid: dd_vs_controller_method
        tags: [ 'ycp', 'ycp-vs', 'ycp-duty' ]
        ui:
          method:
            multi: true
            values: [ 'vulnerabilityscanner.v1.ScannerService/DeleteScanHistory', 'vulnerabilityscanner.v1.ScannerService/Get', 'vulnerabilityscanner.v1.ScannerService/List', 'vulnerabilityscanner.v1.ScannerService/ListLastScanResultForImages', 'vulnerabilityscanner.v1.ScannerService/ListVulnerabilities', 'vulnerabilityscanner.v1.ScannerService/Scan' ]
        uiRepeat: method
        labels: 'method=$method'
    panels:
      - type: graph
        templates: { name: rps, rate: ui }
        title: 'Controller $rateUnit'
        queries:
          - params: { labels: 'name=grpc_requests, meter_type=count' }
      - type: graph
        templates: { name: errors }
        title: 'Controller errors'
        queryDefaults: { defaultTimeWindow: '15s' }
        queries:
          - params: { labels: 'name=grpc_statuses, status=@4xx' }
          - params: { labels: 'name=grpc_statuses, status=@5xx503' }
        draw:
          - { alias: '4xx', color: '#147', at: right }
          - { alias: '5xx & 503', color: '#b20', at: left }
      - type: graph
        templates: { name: percentile, groupLines: true, format: solomon }
        title: 'Controller duration'
        queries:
          - params: { labels: 'name=grpc_durations' }
  - title: Analyzer
    queryDefaults: { labels: 'project=yc.vulnerability-scanner.cloud, cluster=yc.vs.metrics, host!=cluster, service=analyzer-ma' }
    drilldowns:
      - subUid: dd_vs_analyzer_host
        tags: [ 'ycp', 'ycp-vs', 'ycp-duty' ]
        ui:
          host:
            multi: true
            values: [ '*-*', '*-myt*', '*-sas*', '*-vla*', '*-1-myt', '*-1-sas', '*-1-vla' , '*-2-myt', '*-2-sas', '*-2-vla' ]
            titles: [ 'Cluster', 'DC myt', 'DC sas', 'DC vla', 'Host IG myt1', 'Host IG sas1', 'Host IG vla1', 'Host IG myt2', 'Host IG sas2', 'Host IG vla2' ]
        uiRepeat: host
        labels: 'host=$host'
      - subUid: dd_vs_analyzer_method
        tags: [ 'ycp', 'ycp-vs', 'ycp-duty' ]
        ui:
          method:
            multi: true
            values: [ 'vulnerabilityscanner.v1.analyzer.AnalyzerService/Analyze' ]
        uiRepeat: method
        labels: 'method=$method'
    panels:
      - type: graph
        templates: { name: rps, rate: ui }
        title: 'Analyzer $rateUnit'
        queries:
          - params: { labels: 'app=vulnerability-scanner-analyzer_server, method=!all, name=grpc_requests, meter_type=count' }
      - type: graph
        templates: { name: errors }
        title: 'Analyzer errors'
        queryDefaults: { defaultTimeWindow: '15s' }
        queries:
          - params: { labels: 'app=vulnerability-scanner-analyzer_server, method=!all, name=grpc_statuses, status=@4xx' }
          - params: { labels: 'app=vulnerability-scanner-analyzer_server, method=!all, name=grpc_statuses, status=@5xx503' }
        draw:
          - { alias: '4xx', color: '#147', at: right }
          - { alias: '5xx & 503', color: '#b20', at: left }
      - type: graph
        templates: { name: percentile, groupLines: true, format: solomon }
        title: 'Analyzer duration'
        queries:
          - params: { labels: 'app=vulnerability-scanner-analyzer_server, method=!all, name=grpc_durations' }
      - type: graph
        title: 'Image preparation duration'
        templates: { name: percentile, groupLines: true, format: solomon }
        queries:
          - params: { labels: 'name=durations, phase="prepare"' }
      - type: graph
        title: 'Image analysis duration'
        templates: { name: percentile, groupLines: true, format: solomon }
        queries:
          - params: { labels: 'name=durations, phase="analysis"' }
