# Variables:
# @1 - topic
# @2 - consumer
# @3 - name suffix

- title: Read from CLOUD @1 @3
  queryDefaults: { labels: 'ConsumerPath=${account}/@2, TopicPath=${account}/@1, project=${project}, Account=${account}, cluster=global-data-plane' }
  panels:
    - type: graph
      title: Bytes read from CLOUD @1
      queries:
        - params: { labels: 'sensor=BytesRead, service=pqproxy_readSession, host=${host}, OriginDC=${host}' }
          select: { alias: 'bytes' }
      draw:
        - { color: '#3c4', alias: 'bytes' }
      display: { stack: false }
      yAxes: [ { min: 0, format: decbytes } ]
    - type: graph
      title: Messages read from CLOUD @1
      queries:
        - params: { labels: 'sensor=MessagesRead, service=pqproxy_readSession, host=${host}, OriginDC=${host}' }
          select: { alias: 'messages' }
      draw:
        - { color: '#3dd', alias: 'messages' }
      display: { stack: false }
      yAxes: [ { min: 0 } ]
    - type: graph
      title: Time since last read in CLOUD @1
      queries:
        - params: { labels: 'sensor=TimeSinceLastReadMs, service=pqtabletAggregatedCounters' }
      display: { stack: false }
      yAxes: [ { min: 0, format: ms } ]
    - type: graph
      title: Total time lag by last read in CLOUD @1
      queries:
        - params: { labels: 'sensor=TotalTimeLagMsByLastRead, service=pqtabletAggregatedCounters' }
          select: { alias: 'time ms' }
      draw:
        - { color: '#e33', alias: 'time ms' }
      display: { stack: true }
      yAxes: [ { min: 0, format: ms } ]
    - type: graph
      title: Read lag in CLOUD @1
      queries:
        - params: { labels: 'sensor=ReadTimeLagMs, service=pqtabletAggregatedCounters' }
          select: { alias: 'time ms' }
      draw:
        - { color: '#e33', alias: 'time ms' }
      display: { stack: true }
      yAxes: [ { min: 0, format: ms } ]
    - type: graph
      title: Unread messages in CLOUD @1
      queries:
        - params: { labels: 'sensor=TotalMessageLagByLastRead, service=pqtabletAggregatedCounters' }
          select: { alias: 'messages' }
      draw:
        - { color: '#ee3', alias: 'messages' }
      display: { stack: true }
      yAxes: [ { min: 0 } ]
