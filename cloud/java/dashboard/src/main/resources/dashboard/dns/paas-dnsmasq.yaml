uid: ycDnsPaasDnsmasq
refresh: 1m
title: Dnsmasq paas base

tags: [ 'ycp', 'ycp-dns', 'ycp-dns-paas-dnsmasq', 'ycp-duty', 'ycp-top', 'ycp-drilldown' ]

links:
  - { tags: [ 'ycp-dns' ] }
  - { title: 'SLO', vars: false, url: 'https://grafana.private-api.ycp.cloud.yandex.net/d/7j62UsGGk/dns' }
  - { title: 'V-routers Summary', vars: false, url: 'https://solomon.yandex-team.ru/?project=yandexcloud&dashboard=compute_node_dns_${cluster}' }
  - { title: 'User vm health', vars: false, url: 'https://solomon.yandex-team.ru/?project=yandexcloud&cluster=cloud_${cluster}_compute&service=compute&dashboard=compute-instance-health&l.instance_id=ef3ba66b6vm1fnloilto&b=1h&e=' }

variables:
  ui:
    project:
      values: [ dns, instance-group, api-adapter, mdb-adapter]
    cluster:
      values: [ prod, preprod ]

graphDefaults:
  datasource: 'Solomon Cloud'
  width: 8
  height: 6

queryDefaults:
  dropNan: true
  labels: 'cluster=${cluster}, host=*'

rows:
  - title: Dnsmasq metrics all services
    panels:
      - type: graph
        title: 'Queries by target'
        description: 'DNS queries on upstream server'
        queryDefaults: { defaultTimeWindow: '15s' }
        queries:
          - params: { labels: 'project=dns, service=dnsmasq-exporter-all-vms_ma, name=dnsmasq_servers_queries' }
            groupByTime: { max: 'default' }
            select: { non_negative_derivative: [ ], group_by_labels: [ 'sum', 'server' ], alias: '{{server}}' }
        display: { decimals: 1, empty: false, stack: false }
      - type: graph
        title: 'Cache hits'
        description: 'DNS queries answered locally (cache hits)'
        queryDefaults: { defaultTimeWindow: '15s' }
        queries:
          - params: { labels: 'project=dns, service=dnsmasq-exporter-all-vms_ma, name=dnsmasq_hits' }
            groupByTime: { max: 'default' }
            select: { non_negative_derivative: [ ], alias: '{{host}}' }
        display: { decimals: 1, empty: false, stack: false }
      - type: graph
        title: 'Cache misses'
        description: 'DNS cache misses: queries which had to be forwarded'
        queryDefaults: { defaultTimeWindow: '15s' }
        queries:
          - params: { labels: 'project=dns, service=dnsmasq-exporter-all-vms_ma, name=dnsmasq_misses' }
            groupByTime: { max: 'default' }
            select: { non_negative_derivative: [ ], alias: '{{host}}' }
        display: { decimals: 1, empty: false, stack: false }
      - type: graph
        title: 'Failed queries by target'
        description: 'DNS queries failed on upstream server'
        queryDefaults: { defaultTimeWindow: '15s' }
        queries:
          - params: { labels: 'project=dns, service=dnsmasq-exporter-all-vms_ma, name=dnsmasq_servers_queries_failed' }
            groupByTime: { max: 'default' }
            select: { non_negative_derivative: [ ], group_by_labels: [ 'sum', 'server' ], alias: '{{server}}' }
        display: { decimals: 1, empty: false, stack: false }
      - type: graph
        title: 'Cache exictions'
        description: 'DNS cache exictions: numbers of entries which replaced an unexpired cache entry'
        queryDefaults: { defaultTimeWindow: '15s' }
        queries:
          - params: { labels: 'project=dns, service=dnsmasq-exporter-all-vms_ma, name=dnsmasq_evictions' }
            groupByTime: { max: 'default' }
            select: { non_negative_derivative: [ ], alias: '{{host}}' }
        display: { decimals: 1, empty: false, stack: false }
      - type: graph
        title: 'Cache insertions'
        description: 'DNS cache insertions'
        queryDefaults: { defaultTimeWindow: '15s' }
        queries:
          - params: { labels: 'project=dns, service=dnsmasq-exporter-all-vms_ma, name=dnsmasq_insertions' }
            groupByTime: { max: 'default' }
            select: { non_negative_derivative: [ ], alias: '{{host}}' }
        display: { decimals: 1, empty: false, stack: false }
  - title: Dnsmasq metrics by service
    panels:
      - type: graph
        title: 'Queries by target'
        description: 'DNS queries on upstream server'
        queryDefaults: { defaultTimeWindow: '15s' }
        queries:
          - params: { labels: 'project=${project}, service=dnsmasq-exporter_ma, name=dnsmasq_servers_queries' }
            groupByTime: { max: 'default' }
            select: { non_negative_derivative: [ ], group_by_labels: [ 'sum', 'server' ], alias: '{{server}}' }
        display: { decimals: 1, empty: false, stack: false }
      - type: graph
        title: 'Cache hits'
        description: 'DNS queries answered locally (cache hits)'
        queryDefaults: { defaultTimeWindow: '15s' }
        queries:
          - params: { labels: 'project=${project}, service=dnsmasq-exporter_ma, name=dnsmasq_hits' }
            groupByTime: { max: 'default' }
            select: { non_negative_derivative: [ ], alias: '{{host}}' }
        display: { decimals: 1, empty: false, stack: false }
      - type: graph
        title: 'Cache misses'
        description: 'DNS cache misses: queries which had to be forwarded'
        queryDefaults: { defaultTimeWindow: '15s' }
        queries:
          - params: { labels: 'project=${project}, service=dnsmasq-exporter_ma, name=dnsmasq_misses' }
            groupByTime: { max: 'default' }
            select: { non_negative_derivative: [ ], alias: '{{host}}' }
        display: { decimals: 1, empty: false, stack: false }
      - type: graph
        title: 'Failed queries by target'
        description: 'DNS queries failed on upstream server'
        queryDefaults: { defaultTimeWindow: '15s' }
        queries:
          - params: { labels: 'project=${project}, service=dnsmasq-exporter_ma, name=dnsmasq_servers_queries_failed' }
            groupByTime: { max: 'default' }
            select: { non_negative_derivative: [ ], group_by_labels: [ 'sum', 'server' ], alias: '{{server}}' }
        display: { decimals: 1, empty: false, stack: false }
      - type: graph
        title: 'Cache exictions'
        description: 'DNS cache exictions: numbers of entries which replaced an unexpired cache entry'
        queryDefaults: { defaultTimeWindow: '15s' }
        queries:
          - params: { labels: 'project=${project}, service=dnsmasq-exporter_ma, name=dnsmasq_evictions' }
            groupByTime: { max: 'default' }
            select: { non_negative_derivative: [ ], alias: '{{host}}' }
        display: { decimals: 1, empty: false, stack: false }
      - type: graph
        title: 'Cache insertions'
        description: 'DNS cache insertions'
        queryDefaults: { defaultTimeWindow: '15s' }
        queries:
          - params: { labels: 'project=${project}, service=dnsmasq-exporter_ma, name=dnsmasq_insertions' }
            groupByTime: { max: 'default' }
            select: { non_negative_derivative: [ ], alias: '{{host}}' }
        display: { decimals: 1, empty: false, stack: false }
