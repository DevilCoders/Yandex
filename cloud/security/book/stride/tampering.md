## Tampering

Угрозы связанные с подделкой или несанкционированной модификацией информации.

### Сетевой уровень

Необходимо проверить, что для всех коммуникаций используется шифрование при передаче, то есть Encryption in Transit (смотри соответствующий раздел). В нашей модели угроз мы считаем сеть недоверенной и во всех местах полагаемся на TLS для шифрования и защиты целостности передаваемой информации. В ряде случаев, может применяться IPSEC или другие протоколы организации защищенного канала.

### Взаимодействие с другими сервисами - уровень приложения

Уместно задать вопрос - насколько мы доверяем информации, которая приходит от других сервисов Облака.

При моделировании угроз необходимо проверить используется ли аутентификация при межсервисном взаимодействии, а также нужна ли дополнительная проверка информации, которая приходит из другого сервиса (в случае сомнений - нужна). По-умолчанию, ни один сервис не должен доверять другому сервису и всегда должен проверять корректность данных, переданных в запросе.

{% note alert %}

В настоящий момент рекомендуемым способом межсервисной аутентификации является использование сервисного аккаунта и проверка его полномочий и в IAM.

{% endnote %}

### Уровень CI/CD - Проверка целостности артефактов при деплое

Угрозы tampering также могут исходить из систем, которые так или иначе участвуют в процессах CI/CD. При проверке безопасности сервиса следует учитывать этот риск и проверять подпись артефактов, которые деплоятся в прод сервиса.

Так, например, с точки зрения Облака dist Яндекса или upstream Ubuntu не является доверенным по-умолчанию. В Облаке можно устанавливать только пакеты, которые были подписаны при сборке в Сборочном Цехе, а также необходимо настроить APT на проверку подписи пакетов.

Как настроить APT можно прочитать в:

**TBD**

При использовании docker контейнеров также необходимо проверять их подпись. Сделать это можно следующим образом:

**TBD**

Также необходимо обратить внимание на угрозы, связанные с rollback attacks, когда злоумышленник пытается установить в систему подписанную старую версию какого-либо пакета, в котором есть известные уязвимости, позволяющие поднять привелегии.

Примеры инцидентов:

**TBD**

### Уровень операционной системы

#### Контроль целостности на уровне операционной системы

Угрозы tampering могут также быть на уровне операционной системы, когда один процесс пытается повысить свои привелегии через подделку файлов, которые использует другой процесс.

При оценке безопасности сервиса необходимо убедиться, что права в FS настроены правильно, а также работают или запланированы к реализации процессы контроля целостности (например, расчет и сверка хешей исполняемых файлов, или же read-only fs с файлами приложения).

{% note alert %}

Митигация угроз целостности исполняемых файлов приложения требуется во многих стандартах безопасности, например, в PCI DSS и SOX.

{% endnote %}

Пример повышения привелегий через некорректные ACL в файловой системе можно посмотреть в [CLOUD-17822](https://st.yandex-team.ru/CLOUD-17822).

#### Выполнение команд, переданных через метаданные

Часто при деплое неизменяемыми образами (immutable images) необходимо параметризовать образ на этапе развертывания, то есть разложить секреты, добавить нужных пользователей и т.д. Иногда это делают через метаданные передавая скрипт или набор команд, которые будут выполнены через cloud-init или же app-bootstrapper.

Такой подход создает риск того, что если злоумышленник получит доступ к модификации метаданных образа (например, через статические маршруты - смотри spoofing), то он может выполнить произвольный код в виртуальных машинах сервиса.

Эти угрозы необходимо учесть при моделировании. Вот несколько способов действий:

1. Отказаться от использования cloud-init или app-bootstrapper в пользу скриптов сервиса, которые могут настроить нужные параметры, но не дают выполнять произвольный код (более предпочтительный).
2. Использовать электронную подпись и подписывать код, который должен быть выполнен для параметризации образа (менее предпочтительный, так как тут надо следить за корректностью и rollback attacks и т.д.)

### Процедуры доверенной загрузки

TBD
