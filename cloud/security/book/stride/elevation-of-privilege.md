## Elevation of Privilege

Угрозы связанные с возможностью злоумышленника повысить свои привилегии в различных системах. В первую очередь эти угрозы связаны с некорректной авторизацией.

### Уровень организации

На уровне Облака как организации к нам применимы угрозы

* доступа сотрудника Яндекса, но не сотрудника Облака к данным Облака;
* доступа сотрудника одного сервиса Облака к данным другого сервиса Облака;

Мы митигируем эти угрозы при помощи использования корпоративных инструментов (динамический FW), а также тем, что используем гранулярную модель доступов в IAM.

{% note alert %}

Интеграция с IAM обязательна для всех сервисов Облака.

{% endnote %}

Также для нас, как для организации применимы угрозы phishing и spear phishing. Мы защищаемся от них при помощи обязательной двухфакторной аутентификации, а также движением в сторону webauthn - способа, который эффективно противостоит фишингу.

### Уровень сервиса

#### Интеграция с IAM

На уровне сервиса в первую очередь необходимо интрегрироваться с IAM для проведения авторизации всех вызовов API.

Для каждой операции должен быть создан свой permission, внутренние операции необходимо прятать за internal permissions.

{% note tip %}

Permissions должны быть "линейно независимы", то есть если есть permission на read и write, то не надо создавать третий permission readWrite.

{% endnote %}

С точки зрения ролей в сервисе должны быть

1. Набор общих сервисных ролей `service.admin`, `service.editor` и так далее.
2. Специфичные для сервиса роли, в IAM это например `iam.tokenCreator`.
3. Роли для Oncall: `service.onСall` и `service.onСallAdmin`
4. Роли для Support: `service.support` и `service.supportAdmin`

Подробнее про роли можно почитать в Этушке:

* [пост про сервисные роли в Облаке](https://clubs.at.yandex-team.ru/ycp/2969)
* [пост про изменение прав доступа дежурных](https://clubs.at.yandex-team.ru/ycp/4060)

Примеры инцидентов:

* [CLOUDINC-1788](https://st.yandex-team.ru/CLOUDINC-1788)

#### Использование статических credentials сервисных аккаунтов

В Облаке сервисные аккаунты могут иметь следующие типы статических credentials:

* ключи сервисных аккаунтов - позволяют выполнять действия от имени этих сервисных аккаунтов из любого места;
* credentials для доступа к AWS API севрисов в Облаке - креды типа access key id и access secret, которые используются для доступа к сервисам типа Object Storage (S3), YMQ (наш аналог AWS SQS), YDS (наш аналог AWS Kinesis).

{% note alert %}

Создавать статические credentials необходимо только в исключительных случаях, и только после аппрува команды Security и IAM, а также оформления соотвествующего риска и создания процедур регулярной ротации таких credentials.

{% endnote %}

Лучшей практикой является использование механизма биндинга сервисных аккаунтов на виртуальную машину и получение токена этого SA через метаданные виртуальной машины. Сервисы Object Storage и Container Registry умеют работать с IAM токенами.

{% note alert %}

Помните, что некорректное использование статических credentials может привести к возможности злоумышленнику повысить свои привелегии до уровня сервиса (то есть манипулировать данными всех пользователей сервиса) или же до уровня Облака (манипулировать данными всех пользователей Облака).

{% endnote %}

Примеры инцидентов:

* [CLOUDINC-2450](https://st.yandex-team.ru/CLOUDINC-2450).
* [CLOUDINC-2488](https://st.yandex-team.ru/CLOUDINC-2488).

#### Использование системных сервисных аккаунтов с повышенными привилегиями

**TBD**

#### Некорректная работа с секретами

**TBD**

### Уровень операционной системы

#### Повышение привилегий на уровне операционной системы

**TBD**

#### Сервис метаданных, атаки типа Server-Side Request Forgery

**TBD**
