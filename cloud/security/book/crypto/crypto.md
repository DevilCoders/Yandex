## Использование шифрования

Шифрование - одна из важнейших data protection мер. Обычно, применительно к инфраструктуре и приложениям шифрование разделяют на следующие виды:

* Encryption at Rest - шифрование при хранении данных
* Encryption in Transit - шифрование при передаче данных
* Encryption in Use - шифровние при использовании данных

### Encryption at Rest

Шифрование при хранении данных используют для того, чтобы защититься от:

* случаев сбоя процедур очистки физических дисков и, тем самым, утечки пользовательской информации через передачу диска другому сервису или третьим лицам;
* кражи диска с данными из дата-центра;

В Облаке мы используем два режима шифрования данных at rest:

* default encryption на ключах, которые управляются Облаком;
* шифрование на ключах KMS ([Key Management Service](https://cloud.yandex.ru/services/kms)), которыми управляет пользователь;

{% note alert %}

Процедуры шифрования настолько стойки, насколько стойки процедуры управления ключами. Во всех случаях для управления ключами неообходимо использовать сервис KMS и интегрироваться с ним для шифрования данных at rest.

{% endnote %}

Шифрование данных необходимо использовать не только для защиты пользовательских данных в своем сервисе, но также и для защиты служебных объектов сервиса, например, terraform state при деплое через terraform.

{% note tip %}

Часто удобно использовать встроенное в Object Storage (s3) [шифрование данных](https://cloud.yandex.ru/docs/storage/operations/buckets/encrypt) при помощи ключей KMS.

{% endnote %}

Для того, чтобы корректно встроить шифрование в свой сервис, обратитесь за помощью к команде [Cryptography Services](https://staff.yandex-team.ru/departments/yandex_exp_9053_dep07673/).

### Encryption in Transit

Шифрование при передаче используется для защиты данных при их передаче по сети. В Облаке для этой цели мы используем TLS, который должен быть внедрен для всех коммуникаций в сервисе.

Для всех коммуникаций означает:

* для коммуникаций в пределах одного дата-центра, а также между дата-центрами;
* для коммуникаций между разными микросервисами одного сервиса;
* для коммуникаций от L7-балансировщика до его рилов (или же от Application Load Balancer до рилов);

Шифрование при передаче не требуется:

* для коммуникации процессов в пределах хоста, если сервис доступен только с localhost;
* для коммуникации процессв в пределах хоста при использовании unix sockets;

{% note alert %}

Для шифрования данных при передаче необходимо использовать протокол TLS 1.2 и выше. Если вы используете gRPC, то это требование выполняется автоматически за счет того, что gRPC это http2 и protobufs, а в http2 по стандарту должен использоваться TLS 1.2 и выше.

{% endnote %}

### Управление TLS сертификатами

Для автоматизации выписки сертификатов в Облаке необходимо использовать сервис Certificate Manager, который поддерживает работу с внутренними сертификаторами Яндекса. Подробнее о процессе, а также в целом о работе с сертификатами в Облаке нужно почитать в [посте в Этушке](https://clubs.at.yandex-team.ru/ycp/4189).

### Одобренные алгоритмы для TLS

**TBD**

### Encryption in Use

Шифрование при использовании данных. Пока это некоторый звездолет, который для нас недостижим. Сейчас в индустрии два направления мысли по поводу Encryption in Use:

* использование разного рода secure enclaves - аппаратных технологий, которые не позволяют сдампить определенные регионы памяти: Intel SGX, TDX, AMD SEV, ARM TrustZone и так далее.
* использование гомоморфного шифрования.

В Облаке мы следим в какую сторону идет индустрия, но пока не делаем активных движений в этом направлении. Почему? Гомоморфное шифрование пока доступно только на уровне медленно работающих прототипов, а Intel SGX регулярно ломают, причем так, что это целиком компрометирует технологию (сливают аттестационные ключи и т.д.).

В общем, мы ведем наблюдение за этой областью.
