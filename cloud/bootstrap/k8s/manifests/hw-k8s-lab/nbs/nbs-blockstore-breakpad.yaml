apiVersion: datadoghq.com/v1alpha1
kind: ExtendedDaemonSet
metadata:
  name: nbs-blockstore-breakpad
  namespace: nbs
  label: nbs

spec:
  strategy:
    canary:
      replicas: 1
  template:
    metadata:
      labels:
        name: nbs-blockstore-breakpad
    spec:
      nodeSelector:
        compute-node: "1"
        nbs-blockstore-breakpad: "1"
      hostNetwork: true
      containers:
      - name: nbs-blockstore-breakpad
        image: cr.yandex/yc-bootstrap/blocktore_breakpad:7053557.trunk.712502663
        command: ["/usr/bin/yc-nbs-breakpad-sender", "--nbs-config", "/Berkanavt/nbs-server/cfg/nbs-breakpad-sender.json"]
        volumeMounts:
          - mountPath: /Berkanavt/nbs-server/cfg
            name: cfg-path
          # TODO remove log dirs mounts after infra pods for this services will be added CLOUD-67552
          - mountPath: /var/log
            name: var-log
            readOnly: false
          - mountPath: /dev/log
            name: dev-log
            readOnly: false
          - mountPath: /var/run/systemd/journal/socket
            name: journal-socket
            readOnly: false
          - mountPath: /var/crashes
            name: crashes
            readOnly: false
      volumes:
        - hostPath:
            path: /Berkanavt/nbs-server/cfg
            type: Directory
          name: cfg-path
        - hostPath:
            path: /var/log
            type: Directory
          name: var-log
        - hostPath:
            path: /dev/log
            type: Socket
          name: dev-log
        - hostPath:
            path: /var/run/systemd/journal/socket
            type: Socket
          name: journal-socket
        - hostPath:
            path: /var/crashes
            type: Directory
          name: crashes
