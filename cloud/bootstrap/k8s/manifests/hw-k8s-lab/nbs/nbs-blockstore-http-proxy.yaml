apiVersion: datadoghq.com/v1alpha1
kind: ExtendedDaemonSet
metadata:
  name: nbs-blockstore-http-proxy
  namespace: nbs
  label: nbs

spec:
  strategy:
    canary:
      replicas: 1
  template:
    metadata:
      labels:
        name: nbs-blockstore-http-proxy
    spec:
      nodeSelector:
        compute-node: "1"
        nbs-blockstore-http-proxy: "1"
      hostNetwork: true
      containers:
      - name: nbs-blockstore-http-proxy
        image: cr.yandex/yc-bootstrap/blocktore_http_proxy:49.tags.releases.nbs.stable-20-4-15-1
        command: ["/usr/bin/blockstore-http-proxy", "--config=/Berkanavt/nbs-server/cfg/nbs-http-proxy.txt"]
        volumeMounts:
          - mountPath: /Berkanavt/nbs-server/cfg
            name: cfg-path
          # TODO remove log dirs after infra pods for this services will be added CLOUD-67552
          - mountPath: /var/log
            name: var-log
            readOnly: false
          - mountPath: /dev/log
            name: dev-log
            readOnly: false
          - mountPath: /var/run/systemd/journal/socket
            name: journal-socket
            readOnly: false
          - mountPath: /var/lib/yc
            name: lib-yc
            readOnly: false
          - mountPath: /var/crashes
            name: crashes
            readOnly: false
      volumes:
        - hostPath:
            path: /Berkanavt/nbs-server/cfg
            type: Directory
          name: cfg-path
        - hostPath:
            path: /var/log
            type: Directory
          name: var-log
        - hostPath:
            path: /dev/log
            type: Socket
          name: dev-log
        - hostPath:
            path: /var/run/systemd/journal/socket
            type: Socket
          name: journal-socket
        - hostPath:
            path: /var/lib/yc
            type: Directory
          name: lib-yc
        - hostPath:
            path: /var/crashes
            type: Directory
          name: crashes
