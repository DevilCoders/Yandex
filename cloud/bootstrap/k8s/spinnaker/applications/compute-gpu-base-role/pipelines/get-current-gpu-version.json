{
    "appConfig": {},
    "application": "compute-gpu-base-role",
    "id": "96a4f8e0-324d-43f7-9288-8cc19c6e50be",
    "index": 8,
    "keepWaitingPipelines": false,
    "limitConcurrent": true,
    "name": "get-current-gpu-version",
    "parameterConfig": [],
    "spelEvaluator": "v4",
    "stages": [
        {
            "actions": [
                {
                    "actionId": "435ddf4f-323b-43f9-a464-384b44159720",
                    "actionName": "Get GPU packages",
                    "actionType": "readFile",
                    "bitbucketProfile": "bb.yandex-team.ru",
                    "branch": "master",
                    "filePath": "pillar/packages/16.04/compute_gpu.yaml",
                    "outputVariable": "computeGPUSalt",
                    "project": "cloud",
                    "repo": "salt-formula"
                }
            ],
            "failOnFailedExpressions": true,
            "name": "[get-current-gpu-version] Get pillar file",
            "refId": "1",
            "requisiteStageRefIds": [],
            "type": "bitbucket"
        },
        {
            "failOnFailedExpressions": true,
            "name": "[get-current-gpu-version] Parse pillar file",
            "refId": "2",
            "requisiteStageRefIds": [
                "1"
            ],
            "type": "evaluateVariables",
            "variables": [
                {
                    "key": "fileGpuVersion",
                    "value": "${ #readYaml(computeGPUSalt)['_aliases']['gpu_version'] }"
                }
            ]
        },
        {
            "failOnFailedExpressions": true,
            "name": "[get-current-gpu-version] Check parsed value",
            "refId": "3",
            "requisiteStageRefIds": [
                "2"
            ],
            "stageEnabled": {
                "expression": "fileGpuVersion.matches(\"^[0-9]\\.[0-9]\\.[0-9]-[0-9]+\\.[0-9]+$\")",
                "type": "expression"
            },
            "type": "evaluateVariables",
            "variables": [
                {
                    "key": "currGpuVersion",
                    "value": "${ fileGpuVersion }"
                }
            ]
        }
    ],
    "triggers": []
}
