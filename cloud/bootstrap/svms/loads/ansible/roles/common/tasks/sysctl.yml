---

- name: Restore default /etc/sysctl.conf
  copy: src="sysctl.conf" dest="/etc/sysctl.conf"
  tags: sysctl

- name: Copy sysctl configs to /etc/sysctl.d
  template: src="sysctl/{{ item }}.j2" dest="/etc/sysctl.d/{{ item }}"
  register: sysctl
  with_items:
    - "20-coredumps.conf"
    - "20-network.conf"
    - "20-vm.conf"
  tags: sysctl

- name: Apply sysctl config
  shell: "sysctl -p /etc/sysctl.d/{{ item }}"
  when: sysctl | changed
  with_items:
    - "20-coredumps.conf"
    - "20-network.conf"
    - "20-vm.conf"
  tags: sysctl

