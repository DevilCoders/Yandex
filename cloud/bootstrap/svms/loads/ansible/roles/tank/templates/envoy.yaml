node:
  cluster: load
  id: {{ ansible_hostname }}

stats_config:
  use_all_default_tags: true

admin:
  access_log_path: /dev/stdout
  address:
    socket_address: { address: "127.0.0.1", port_value: 9901 }

static_resources:
  listeners:
    - name: underlay-service
      address:
        socket_address: {
          address: '127.0.0.1', port_value: 80, ipv4_compat: true
          }
      filter_chains:
        - filters:
          - name: envoy.tcp_proxy
            config:
              stat_prefix: ingress_tcp
              cluster: underlay-service_cluster
  clusters:
    - name: underlay-service_cluster
      connect_timeout: 1s
      type: STRICT_DNS
      lb_policy: ROUND_ROBIN
      common_lb_config: { healthy_panic_threshold: { value: 10.0 } }
      hosts:
        - { socket_address: { address: 'target-selfhost-underlay.on.cloud-preprod.yandex.net', port_value: 80}}
      health_checks:
        timeout: 1s
        interval: 10s
        unhealthy_threshold: 1
        healthy_threshold: 3
        tcp_health_check: {}
        always_log_health_check_failures: true
        event_log_path: "/dev/stdout"
