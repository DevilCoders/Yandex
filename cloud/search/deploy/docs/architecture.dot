digraph G {
  rankdir ="LR";
  node[shape="box"];
  ranksep="1";
  infra_svc [label="infrastructure service"];
  data_svc [label="data platform service"];
  dev_svc [label="YC Dev Tools service"];
  native_svc [label="Cloud native service"];
  access_svc [label="YC Access services"];
  ymq_svc [label="YMQ service"];
  s3_svc [label="S3 service"];


  subgraph cluster_0 {
    style=filled;
    node [style=filled, color=white];
    label = "Logbroker, topics";
    t_infrasucture [label="search-infrastructure"];
    t_data [label="search-data-services"];
    t_dev [label="search-dev-services "];
    t_native [label="search-cloud-native-services"];
    t_access [label="search-access"];
    t_s3 [label="search-s3"];
    t_ymq [label="search-ymq"];
  }

  infra_svc -> t_infrasucture;
  data_svc -> t_data;
  dev_svc -> t_dev;
  native_svc -> t_native;
  access_svc -> t_access;
  ymq_svc -> t_ymq;
  s3_svc -> t_s3;
  
  subgraph cluster_1 {
    style=filled;
    node [style=filled, color=gray];
    label = "Search VPC";
    {rank=same; backend indexer proxy};
    backend;
    indexer -> backend [constraint=true; weight=0];
    proxy -> backend;
  }

  ui_backend [label ="UI backend"];
  access_servce [label="Access Service (IAM)"];
  proxy -> access_servce;
  ui_backend -> proxy [constraint=true; weight=100];
  monitoring_consumer [label="Monitorin consumer"];

  {rank=same; ui_backend monitoring_consumer access_servce}

  
  t_data -> monitoring_consumer;
  t_infrasucture -> monitoring_consumer;
  t_dev -> monitoring_consumer;
  t_native -> monitoring_consumer;
  t_access -> monitoring_consumer;
  t_ymq -> monitoring_consumer;

  t_infrasucture -> indexer;
  t_data -> indexer;
  t_dev -> indexer;
  t_native -> indexer;
  t_access -> indexer;
  t_s3 -> indexer;
  t_ymq -> indexer;
}