[SERVICE]
    Flush        3
    Log_Level    info

[INPUT]
    Name systemd
    Tag mkt.systemd.*

    Path /var/log/journal
    Read_From_Tail on

    Max_Entries 100

    Systemd_Filter _SYSTEMD_UNIT=nginx.service
    Systemd_Filter _SYSTEMD_UNIT=docker.service

    Systemd_Filter CONTAINER_NAME=marketplace-v2
    Systemd_Filter CONTAINER_NAME=marketplace-v2-worker
    Systemd_Filter CONTAINER_NAME=marketplace-v2-solomon

    Systemd_Filter CONTAINER_NAME=mkt-license-check
    Systemd_Filter CONTAINER_NAME=marketplace-license-check

    Systemd_Filter _COMM=uwsgi
    Systemd_Filter _COMM=yc-marketplace-

    Lowercase On

    Mem_Buf_Limit 32M

[FILTER]
    Name rewrite_tag
    Match mkt.systemd.*

    Emitter_Mem_Buf_Limit 32M

    Rule $message ^\[marketplace-v2 mkt.backends.api false
    Rule $_systemd_unit docker.service mkt.backends.docker false


[FILTER]
    Name modify
    Match mkt.*

    Rename _hostname host
    Remove_wildcard _
    Remove_wildcard syslog_

    Remove_wildcard container_id
    Remove container_tag

    Remove proccess_name
    Remove priority
    Remove created
    Remove message_id
    Remove message_raw
    Remove relative_ts
    Remove errno
    Remove pid
    Remove_wildcard thread
    Remove_wildcard code_

[OUTPUT]
    Name ${YC_PLUGIN_NAME}
    Match mkt.*

    endpoint ${YC_ENDPOINT}
    group_id ${YC_LOGGING_GROUP_DEFAULT}
    message_key message
    level_key level
    authorization instance-service-account

    resource_type systemd
    resource_id marketplace-systemd

    default_level info
    ca_file ${YC_CACERT}

[OUTPUT]
    Name ${YC_PLUGIN_NAME}
    Match mkt.backends.*

    endpoint ${YC_ENDPOINT}
    group_id ${YC_LOGGING_GROUP_BACKENDS}

    resource_type docker
    resource_id marketplace-docker

    message_key message
    level_key level
    authorization instance-service-account
    default_level info
    ca_file ${YC_CACERT}

[OUTPUT]
    Name ${YC_PLUGIN_NAME}
    Match mkt.systemd.nginx.service

    resource_type nginx
    resource_id marketplace-nginx

    endpoint ${YC_ENDPOINT}
    group_id ${YC_LOGGING_GROUP_ACCESS}
    message_key message
    level_key level
    authorization instance-service-account
    default_level info
    ca_file ${YC_CACERT}

# TODO: Factory logging group output
