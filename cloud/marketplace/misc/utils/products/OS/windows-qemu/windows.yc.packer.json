{
  "__comment": "only to make ad-hoc conversion into datacenter and standard from eval (coz of dism interactive nature), connect and customize via PowerShell",
  "variables":
  {
    "folder_id": "{{env `YC_FOLDER_ID`}}",
    "token": "{{env `YC_TOKEN`}}",
    
    "zone": "{{env `YC_ZONE`}}",
    "subnet_id": "{{env `YC_SUBNET_ID`}}",

    "username": "Administrator",
    "generated_password": "{{ split uuid \"-\" 4 }}P@s$!1"
  },
  "builders":
  [
    {
      "name": "windows-2019-dc",
      "type": "yandex",
      "token": "{{user `token`}}",
      "folder_id": "{{user `folder_id`}}",

      "source_image_name": "windows-2019-std-gvlk-qemu",
      "source_image_folder_id": "{{user `folder_id`}}",

      "image_name": "{{build_name}}-base-{{isotime \"060102-1504\"}}",
      "image_family": "{{build_name}}-gvlk",
      "image_description": "Ad-hoc clean images",

      "instance_name": "{{build_name}}-{{isotime \"060102-1504\"}}",
      "platform_id": "standard-v2",
      "instance_cores": "4",
      "instance_mem_gb": "8",
      "disk_size_gb": 50,
      "disk_type": "network-ssd",
      "zone": "{{user `zone`}}",
      "subnet_id": "{{user `subnet_id`}}",
      "use_ipv4_nat": true,

      "metadata": { "user-data": "net user Administrator \"{{user `generated_password`}}\"" },

      "communicator": "winrm",
      "winrm_username": "{{user `username`}}",
      "winrm_password": "{{user `generated_password`}}",
      "winrm_use_ssl": "true",
      "winrm_insecure": "true",
      "winrm_use_ntlm": "true"
    },
    {
      "name": "windows-2019-std",
      "type": "yandex",
      "token": "{{user `token`}}",
      "folder_id": "{{user `folder_id`}}",

      "source_image_name": "windows-2019-std-gvlk-qemu",
      "source_image_folder_id": "{{user `folder_id`}}",

      "image_name": "{{build_name}}-base-{{isotime \"060102-1504\"}}",
      "image_family": "{{build_name}}-gvlk",
      "image_description": "Ad-hoc clean images",

      "instance_name": "{{build_name}}-{{isotime \"060102-1504\"}}",
      "platform_id": "standard-v2",
      "instance_cores": "4",
      "instance_mem_gb": "8",
      "disk_size_gb": 50,
      "disk_type": "network-ssd",
      "zone": "{{user `zone`}}",
      "subnet_id": "{{user `subnet_id`}}",
      "use_ipv4_nat": true,

      "metadata": { "user-data": "net user Administrator \"{{user `generated_password`}}\"" },

      "communicator": "winrm",
      "winrm_username": "{{user `username`}}",
      "winrm_password": "{{user `generated_password`}}",
      "winrm_use_ssl": "true",
      "winrm_insecure": "true",
      "winrm_use_ntlm": "true"
    },
    {
      "name": "windows-2016-dc",
      "type": "yandex",
      "token": "{{user `token`}}",
      "folder_id": "{{user `folder_id`}}",

      "source_image_name": "windows-2016-std-gvlk-qemu",
      "source_image_folder_id": "{{user `folder_id`}}",

      "image_name": "{{build_name}}-base-{{isotime \"060102-1504\"}}",
      "image_family": "{{build_name}}-gvlk",
      "image_description": "Ad-hoc clean images",

      "instance_name": "{{build_name}}-{{isotime \"060102-1504\"}}",
      "platform_id": "standard-v2",
      "instance_cores": "4",
      "instance_mem_gb": "8",
      "disk_size_gb": 50,
      "disk_type": "network-ssd",
      "zone": "{{user `zone`}}",
      "subnet_id": "{{user `subnet_id`}}",
      "use_ipv4_nat": true,

      "metadata": { "user-data": "net user Administrator \"{{user `generated_password`}}\"" },

      "communicator": "winrm",
      "winrm_username": "{{user `username`}}",
      "winrm_password": "{{user `generated_password`}}",
      "winrm_use_ssl": "true",
      "winrm_insecure": "true",
      "winrm_use_ntlm": "true"
    },
    {
      "name": "windows-2016-std",
      "type": "yandex",
      "token": "{{user `token`}}",
      "folder_id": "{{user `folder_id`}}",

      "source_image_name": "windows-2016-std-gvlk-qemu",
      "source_image_folder_id": "{{user `folder_id`}}",

      "image_name": "{{build_name}}-base-{{isotime \"060102-1504\"}}",
      "image_family": "{{build_name}}-gvlk",
      "image_description": "Ad-hoc clean images",

      "instance_name": "{{build_name}}-{{isotime \"060102-1504\"}}",
      "platform_id": "standard-v2",
      "instance_cores": "4",
      "instance_mem_gb": "8",
      "disk_size_gb": 50,
      "disk_type": "network-ssd",
      "zone": "{{user `zone`}}",
      "subnet_id": "{{user `subnet_id`}}",
      "use_ipv4_nat": true,

      "metadata": { "user-data": "net user Administrator \"{{user `generated_password`}}\"" },

      "communicator": "winrm",
      "winrm_username": "{{user `username`}}",
      "winrm_password": "{{user `generated_password`}}",
      "winrm_use_ssl": "true",
      "winrm_insecure": "true",
      "winrm_use_ntlm": "true"
    },
    {
      "name": "windows-2012r2-dc",
      "type": "yandex",
      "token": "{{user `token`}}",
      "folder_id": "{{user `folder_id`}}",

      "source_image_name": "windows-2012r2-std-gvlk-qemu",
      "source_image_folder_id": "{{user `folder_id`}}",

      "image_name": "{{build_name}}-base-{{isotime \"060102-1504\"}}",
      "image_family": "{{build_name}}-gvlk",
      "image_description": "Ad-hoc clean images",

      "instance_name": "{{build_name}}-{{isotime \"060102-1504\"}}",
      "platform_id": "standard-v2",
      "instance_cores": "4",
      "instance_mem_gb": "8",
      "disk_size_gb": 50,
      "disk_type": "network-ssd",
      "zone": "{{user `zone`}}",
      "subnet_id": "{{user `subnet_id`}}",
      "use_ipv4_nat": true,

      "metadata": { "user-data": "net user Administrator \"{{user `generated_password`}}\"" },

      "communicator": "winrm",
      "winrm_username": "{{user `username`}}",
      "winrm_password": "{{user `generated_password`}}",
      "winrm_use_ssl": "true",
      "winrm_insecure": "true",
      "winrm_use_ntlm": "true"
    },
    {
      "name": "windows-2012r2-std",
      "type": "yandex",
      "token": "{{user `token`}}",
      "folder_id": "{{user `folder_id`}}",

      "source_image_name": "windows-2012r2-std-gvlk-qemu",
      "source_image_folder_id": "{{user `folder_id`}}",

      "image_name": "{{build_name}}-base-{{isotime \"060102-1504\"}}",
      "image_family": "{{build_name}}-gvlk",
      "image_description": "Ad-hoc clean images",

      "instance_name": "{{build_name}}-{{isotime \"060102-1504\"}}",
      "platform_id": "standard-v2",
      "instance_cores": "4",
      "instance_mem_gb": "8",
      "disk_size_gb": 50,
      "disk_type": "network-ssd",
      "zone": "{{user `zone`}}",
      "subnet_id": "{{user `subnet_id`}}",
      "use_ipv4_nat": true,

      "metadata": { "user-data": "net user Administrator \"{{user `generated_password`}}\"" },

      "communicator": "winrm",
      "winrm_username": "{{user `username`}}",
      "winrm_password": "{{user `generated_password`}}",
      "winrm_use_ssl": "true",
      "winrm_insecure": "true",
      "winrm_use_ntlm": "true",
      "winrm_timeout": "60m"
    }
  ],
  "provisioners":
  [
    {
      "type": "powershell",
      "environment_vars": "GENERATED_PASSWORD={{ user `generated_password` }}",
      "inline": ["Write-Host \"Automatically generated password is: $ENV:GENERATED_PASSWORD\""]
    },
    {
      "type": "breakpoint",
      "note": "shazam!"
    }
  ]
}
