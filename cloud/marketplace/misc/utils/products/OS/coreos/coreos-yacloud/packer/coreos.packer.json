{
  "variables": {
    "channel": "stable",
    "version": "current",
    "checksum_type": "md5",
    "checksum": "758b1d8bd38d16dbe3ba26f9cefa9455"
  },
  "builders": [
    {
    "name": "coreos",
    "type": "qemu",
    "machine_type": "q35",
    "use_default_display": true,
    "vnc_bind_address": "0.0.0.0",
    "communicator": "none",
    "boot_command": [
        "sudo -i<enter>",
        "systemctl stop sshd.socket<enter>",
        "wget http://{{ .HTTPIP }}:{{ .HTTPPort }}/oem.sh<enter>",
        "coreos-install -d /dev/vda -C {{user `channel`}} <enter>",
        "chmod +x oem.sh<enter>",
        "./oem.sh<enter>",
        "shutdown -h now<enter>"
    ],
    "qemuargs": [
        ["-parallel", "none"],
        [ "-m", "4096M" ],
        [ "-smp", "cpus=2" ]
      ],
    "accelerator": "kvm",
    "iso_checksum": "{{user `checksum`}}",
    "iso_checksum_type": "{{user `checksum_type`}}",
    "iso_url": "http://{{user `channel`}}.release.core-os.net/amd64-usr/{{user `version`}}/coreos_production_iso_image.iso",
    "http_directory": "http",

    "disk_compression": true,
    "disk_size": 5120,
    "format": "qcow2",
    "boot_wait": "90s",
    "shutdown_timeout": "90m",
    "output_directory": "output/packer-coreos-{{user `channel`}}-{{user `version`}}"
    }
   ]
}

