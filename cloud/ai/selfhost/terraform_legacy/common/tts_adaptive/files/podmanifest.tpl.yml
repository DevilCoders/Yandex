apiVersion: v1
kind: PodList
items:
- apiVersion: v1
  kind: Pod
  metadata:
    name: app-tts
    namespace: kube-system
    annotations:
      config_digest: ${config_digest}
      scheduler.alpha.kubernetes.io/critical-pod: ""
  spec:
    priority: 2000000001
    priorityClassName: system-cluster-critical
    hostNetwork: true
    initContainers:
    - name: deploy-configs
      image: registry.yandex.net/cloud/api/metadata:${metadata_version}
      volumeMounts:
      - name: all-configs
        mountPath: /etc
        terminationGracePeriodSeconds: 30
    containers:
    - name: cadvisor
      image:  cr.yandex/crppns4pq490jrka0sth/cadvisor:${cadvisor_version}
      ports:
      - containerPort: 17008
      command:
        [ /usr/bin/cadvisor, -logtostderr, --port=17008 ]
      volumeMounts:
      - name: root
        mountPath: /rootfs
        readOnly: true
      - name: var-run
        mountPath: /var/run
        readOnly: true
      - name: sys
        mountPath: /sys
        readOnly: true
      - name: var-lib-docker
        mountPath: /var/lib/docker
        readOnly: true
      - name: dev-disk
        mountPath: /dev/disk
        readOnly: true
    - name: tts-adaptive-server
      image: cr.yandex/crppns4pq490jrka0sth/tts-poc:${tts_poc_version}
      ports:
      - containerPort: 80
    - name: solomon-agent
      image: registry.yandex.net/cloud-ai/solomon-agent:${solomon_version}
      resources:
        requests:
          memory: "384Mi"
        limits:
          memory: "384Mi"
      volumeMounts:
      - name: solomon-agent-config
        mountPath: /etc/solomon-agent/
        readOnly: true
    - name: logrotate
      image: cr.yandex/crppns4pq490jrka0sth/logrotate:${logrotate_version}
      volumeMounts:
      - name: logrotate-config
        mountPath: /etc/logrotate.d
        readOnly: true
    volumes:
    - name: all-configs
      hostPath:
        path: /etc
        type: DirectoryOrCreate
    - name: solomon-agent-config
      hostPath:
        path: /etc/solomon-agent
    - name: logrotate-config
      hostPath:
        path: /etc/logrotate.d
    - name: root
      hostPath:
        path: /
    - name: var-run
      hostPath:
        path: /var/run
    - name: sys
      hostPath:
        path: /sys
    - name: var-lib-docker
      hostPath:
        path: /var/lib/docker
    - name: dev-disk
      hostPath:
        path: /dev/disk
    - name: run-prometheus
      hostPath:
        path: /run/prometheus
