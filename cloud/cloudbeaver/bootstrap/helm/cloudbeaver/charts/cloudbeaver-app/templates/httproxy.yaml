---
apiVersion: projectcontour.io/v1
kind: HTTPProxy
metadata:
  name: basic
spec:
  virtualhost:
    fqdn: {{ .Values.httpproxy.hostname }}
    tls:
      secretName: cloudbeaver-contour-tls
  routes:
    - conditions:
      - prefix: /
      services:
        - name: cloudbeaver-app
          port: 80
      loadBalancerPolicy:
        strategy: Cookie

    {{- if .Values.global.nginx_devhost_proxy.enabled }}
    - conditions:
      - prefix: /devhost_proxy
      services:
        - name: nginx-devhost-proxy
          port: 80
      pathRewritePolicy:
        replacePrefix:
        - replacement: /
    {{- end }}
