syntax = "proto3";

package yandex.cloud.priv.cic.v1.inner.service;

import "yandex/cloud/api/operation.proto";
import "google/protobuf/field_mask.proto";

import "yandex/cloud/priv/operation/operation.proto";
import "yandex/cloud/priv/validation.proto";

import "yandex/cloud/priv/cic/v1/inner/service/public_connection.proto";
import "yandex/cloud/priv/cic/v1/inner/service/peering.proto";
import "yandex/cloud/priv/cic/v1/inner/service/debug.proto";

option go_package = "a.yandex-team.ru/cloud/bitbucket/private-api/yandex/cloud/priv/cic/v1/inner/service;cic";
option java_outer_classname = "CICPUCS";

service PublicConnectionService {

    rpc Get (GetPublicConnectionRequest) returns (PublicConnection);

    rpc List (ListPublicConnectionRequest) returns (ListPublicConnectionResponse);

    rpc Create (PublicConnection) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
            metadata: "CreatePublicConnectionMetadata"
            response: "PublicConnection"
        };
    }

    rpc Update (PublicConnection) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
            metadata: "UpdatePublicConnectionMetadata"
            response: "PublicConnection"
        };
    }

    rpc UpdateByMask (UpdatePublicConnectionRequest) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
            metadata: "UpdatePublicConnectionMetadata"
            response: "PublicConnection"
        };
    }

    rpc Delete (DeletePublicConnectionRequest) returns (operation.Operation) {
        option (yandex.cloud.api.operation) = {
            metadata: "DeletePublicConnectionMetadata"
            response: "google.protobuf.Empty"
        };
    }

    rpc ListOperations (ListPublicConnectionOperationsRequest) returns (ListPublicConnectionOperationsResponse);

}

message GetPublicConnectionRequest {
    string public_connection_id = 1 [(required) = true, (length) = "<=50"];
}

message ListPublicConnectionRequest {
    string folder_id = 1 [(required) = true, (length) = "<=50"];
    int64 page_size = 2;
    string page_token = 3;
    string filter = 4;
}

message ListPublicConnectionResponse {
    repeated PublicConnection public_connections = 1;
    string next_page_token = 2;
}

message UpdatePublicConnectionRequest {
    string public_connection_id = 1;
    google.protobuf.FieldMask update_mask = 2;

    string name = 3;
    string description = 4;
    string cloud_id = 5;
    string folder_id = 6;
    string region_id = 7;
    string trunk_connection_id = 8;
    // Not used in connections over partners-II
    oneof optional_vlan_id {
        int64 vlan_id = 9;
    }

    Peering ipv4_peering = 10;
    Peering ipv6_peering = 11;

    repeated PublicConnection.YandexCloudServiceType ipv4_allowed_service_types = 12;
    repeated PublicConnection.YandexCloudServiceType ipv6_allowed_service_types = 13;

    repeated string ipv4_peer_announced_prefixes = 14;
    repeated string ipv6_peer_announced_prefixes = 15;

    oneof optional_subinterface {
        int64 subinterface = 16;
    }

    DebugAcl ipv4_debug_acl = 17;
    DebugAcl ipv6_debug_acl = 18;

    string customer_name = 19;
}

message CreatePublicConnectionMetadata {
    string public_connection_id = 1;
}

message UpdatePublicConnectionMetadata {
    string public_connection_id = 1;
}

message DeletePublicConnectionRequest {
    string public_connection_id = 1 [(required) = true, (length) = "<=50"];
}

message DeletePublicConnectionMetadata {
    string public_connection_id = 1;
}

message ListPublicConnectionOperationsRequest {
    string public_connection_id = 1 [(required) = true, (length) = "<=50"];
    int64 page_size = 2;
    string page_token = 3;
}

message ListPublicConnectionOperationsResponse {
    repeated operation.Operation operations = 1;
    string next_page_token = 2;
}
