{%- from 'opencontrail/map.jinja' import oct_conf_servers -%}

upstream discovery {
   {%- for server in oct_conf_servers|sort %}
          server {{ grains['cluster_map']['hosts'][server]['ipv4']['addr'] }}:5998;
   {%- endfor %}
}

server {
    listen 127.0.0.1:5998;

    access_log /var/log/nginx/contrail-discovery_short.log log_for_robot;
    access_log /var/log/nginx/contrail-discovery_access.log log_debug;
    error_log /var/log/nginx/contrail-discovery_error.log;

    location / {
        proxy_pass http://discovery;
        include proxy_params;
        proxy_read_timeout 30;
    }
}
