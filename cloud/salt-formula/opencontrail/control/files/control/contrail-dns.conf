{%- set default_log_settings = salt['pillar.get']('oct:log_settings:defaults') -%}
{%- set log_settings = salt['pillar.get']('oct:log_settings:contrail-dns', default=default_log_settings, merge=True) -%}
#
# Copyright (c) 2014 Juniper Networks, Inc. All rights reserved.
#
# DNS configuration options
#

[DEFAULT]
# collectors= # Provided by discovery server
# dns_config_file=dns_config.xml
# named_config_file=contrail-named.conf                 # named config file
# named_config_directory=/etc/contrail/dns              # named config directory
named_log_file_size_m = {{ log_settings['file_size_mb'] }}m
named_log_files_count = {{ log_settings['files_count'] }}
named_log_level = {{ log_settings['named_level'] }}
# rndc_config_file=contrail-rndc.conf                   # rndc config file
  rndc_secret={{ salt['hashutil.base64_encodestring'](salt['grains.get']('uuid', 'sUpr0zwdf')) }}
  {%- set hostname = grains['nodename'] -%}

# named_max_cache_size=32M # max-cache-size (bytes) per view, can be in K or M
# CLOUD-13591 missing DNS records at contrail-named due to lost updates from contrail-dns
# CLOUD-17650 dynamic updates from contrail-dns may be lost when named has no zone yet
#   max_retransmission * retransmission_intervals MUST be > reconfig_interval (5 min) + max_reconfig_time (1 min)
#   // 6000 * 100 msec = 600 sec = 10 min > 5 min + 1 min
#   Check:
#     reconfig_interval: https://bb.yandex-team.ru/projects/CLOUD/repos/salt-formula/browse/pillar/common/init.sls#289
#     max_reconfig_time: https://bb.yandex-team.ru/projects/CLOUD/repos/salt-formula/browse/opencontrail/control/mon/bin/contrail-dns#25
named_max_retransmissions=6000
named_retransmission_interval=100 # msec
# resolv_conf_file= # Absolute path to file containing nameservers list
# /etc/resolv.conf is used as default if none specified.
  hostip={{ ipv4 }}
  hostname={{ hostname }}
# http_server_port=8092
# dns_server_port=53
# statistics_server_port=8053
# log_disable=0

log_level={{ log_settings['sandesh_level'] }}
log_local=1
log_property_file=/etc/contrail/contrail-dns_log4cplus.properties
# log_category must be unset or set to empty string to log all messages
# log_category=

# test_mode=0
# xmpp_dns_auth_enable=0
# xmpp_server_cert=/etc/contrail/ssl/certs/server.pem
# xmpp_server_key=/etc/contrail/ssl/private/server-privkey.pem
# xmpp_ca_cert=/etc/contrail/ssl/certs/ca-cert.pem

# Sandesh send rate limit can be used to throttle system logs transmitted per
# second. System logs are dropped if the sending rate is exceeded
sandesh_send_rate_limit={{ log_settings['sandesh_send_rate_limit'] }}

[DISCOVERY]
  port=5998
  server=127.0.0.1

[IFMAP]
  certs_store=
  password={{ salt['grains.get']("host", "")[-22:] }}-dns
  user={{ salt['grains.get']("host", "")[-22:] }}-dns
# server_url= # Provided by discovery server, e.g. https://127.0.0.1:8443
# stale_entries_cleanup_timeout=300 # in seconds
# end_of_rib_timeout=10 # in seconds
# peer_response_wait_time=60 # in seconds

