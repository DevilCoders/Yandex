{%- set default_log_settings = salt['pillar.get']('oct:log_settings:defaults') -%}
{%- set log_settings = salt['pillar.get']('oct:log_settings:contrail-discovery', default=default_log_settings, merge=True) -%}
[DEFAULTS]
zk_server_ip={% for server in oct_db_servers %}{{ grains['cluster_map']['hosts'][server]['ipv4']['addr'] }}{% if not loop.last %},{% endif %}{% endfor %}
zk_server_port=2181
listen_ip_addr={{ ipv4 }}
listen_port=5998
#log_local=True
log_file=/var/log/contrail/contrail-discovery.log
cassandra_server_list={% for server in oct_db_servers %}{{ grains['cluster_map']['hosts'][server]['ipv4']['addr'] }}:9160 {% endfor %}

log_level={{ log_settings['sandesh_level'] }}
# Set log_local to empty string to disable, setting to 0 or False doesn't work
log_local=1
# log_category must be unset or set to empty string to log all messages
#log_category=
# log_file is not used in the logger class below
#log_file=
logger_class=pysandesh.sandesh_logger.SandeshConfigLogger
logging_conf=/etc/contrail/contrail-discovery.logging.conf
sandesh_send_rate_limit={{ log_settings['sandesh_send_rate_limit'] }}

# number of retry of cassandra request failure
# cass_max_retries = 5

# timeout for the cassandra request
# cass_timeout = 0.5

# minimim time to allow client to cache service information (seconds)
ttl_min=300

# maximum time to allow client to cache service information (seconds)
ttl_max=1800

# health check ping interval <=0 for disabling
hc_interval=5

# maximum hearbeats to miss before server will declare publisher out of
# service.
hc_max_miss=3

# use short TTL for agressive rescheduling if all services are not up
ttl_short=1

######################################################################
# Other service specific knobs ...

# use short TTL for agressive rescheduling if all services are not up
# ttl_short=1

# specify policy to use when assigning services
# policy = [load-balance | round-robin | fixed]
######################################################################

# for DNS service, we use fixed policy
# even when the cluster has more than two control nodes, only two of these
# should provide the DNS service
[DNS-SERVER]
policy=fixed
