{%- set default_log_settings = salt['pillar.get']('oct:log_settings:defaults') -%}
{%- set log_settings = salt['pillar.get']('oct:log_settings:contrail-api', default=default_log_settings, merge=True) -%}
[DEFAULTS]
ifmap_server_ip={{ ipv4 }}
ifmap_server_port=8443
ifmap_username={{ salt['grains.get']("host", "")[-22:] }}-api
ifmap_password={{ salt['grains.get']("host", "")[-22:] }}-api
cassandra_server_list={% for server in oct_db_servers %}{{ grains['cluster_map']['hosts'][server]['ipv4']['addr'] }}:9160 {% endfor %}
listen_ip_addr={{ ipv4 }}
listen_port=8082
multi_tenancy=true

log_level={{ log_settings['sandesh_level'] }}
# Set log_local to empty string to disable, setting to 0 or False doesn't work
log_local=1
# log_category must be unset or set to empty string to log all messages
#log_category=
# log_file is not used in the logger class below
#log_file=
logger_class=pysandesh.sandesh_logger.SandeshConfigLogger
logging_conf=/etc/contrail/contrail-api.logging.conf
sandesh_send_rate_limit={{ log_settings['sandesh_send_rate_limit'] }}

disc_server_ip=127.0.0.1
disc_server_port=5998
zk_server_ip={% for server in oct_db_servers %}{{ grains['cluster_map']['hosts'][server]['ipv4']['addr'] }}:2181{% if not loop.last %},{% endif %}{% endfor %}
rabbit_server={% for server in oct_db_servers %}{{ grains['cluster_map']['hosts'][server]['ipv4']['addr'] }}{% if not loop.last %},{% endif %}{% endfor %}
rabbit_ha_mode=True
rabbit_port=5672
rabbit_user=contrail
rabbit_password=contrail

# CLOUD-12472: increase stale_lock_seconds to avoid duplicates in contrail db
#   Duplicates arise when disk I/O is blocked for a long time (>stale_lock_seconds seconds)
#   and API request is retried to create object with the same fq_name.
# default value is 5
stale_lock_seconds=1800

# (StrOpt) default encoding to use for string resources.
# this is optional variable. Define it if you want to override
# the default encoder returned by sys.getdefaultencoding()
# default_encoding = <encoding name>
# Eg. to set ascii as the encoder
# default_encoding = ascii
# Eg. to set utf-8 as the encoder
# default_encoding = utf-8


# Enable optimizations to list resources. Be careful, resources created on
# release under R1.05 does not support that optimization (especially for port)
# list_optimization_enabled = False

#[SECURITY]
#use_certs=False
#keyfile=/etc/contrail/ssl/private_keys/apiserver_key.pem
#certfile=/etc/contrail/ssl/certs/apiserver.pem
#ca_certs=/etc/contrail/ssl/certs/ca.pem

[IFMAP_SERVER]
# # IF-MAP server configuration
# # Listen IP and port
ifmap_listen_ip = {{ ipv4 }}
