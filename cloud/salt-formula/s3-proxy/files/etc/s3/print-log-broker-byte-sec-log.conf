{%- import "common/kikimr/init.sls" as vars with context %}
{
    "batch_size": 100,
    "db": {
        "data_center": 4047,
        "endpoints": [
            {
                "host": "localhost",
                "port": 2135
            }
        ],
        "pool": {
            "size": 4,
            "max_size": 8
        },
        "schema_prefix": "/{{ vars.ydb_domain }}/{{ vars.s3proxy_database }}/"
    },
    "job_timeout_min": 1,
    "jobs_count": 50,
    "lock_refresh_period": 10,
    "logging": {
        "disable_existing_loggers": false,
        "filters": {
            "request_context": {
                "()": "s3mds.logger.RequestContextFilter"
            }
        },
        "formatters": {
            "db_request_log": {
                "()": "s3mds.logger.BaseFormatter",
                "datefmt": "%Y-%m-%dT%H:%M:%S",
                "format": "timestamp=%(asctime)s\trequest_id=%(request_id)s\tbucket=%(bucket)s\tquery=%(query)s\trowcount=%(rowcount)s\terror_code=%(error_code)s\tattempt=%(attempt)s\trequest_time=%(request_time).3f"
            },
            "default": {
                "()": "s3mds.logger.BaseFormatter",
                "datefmt": "%Y-%m-%dT%H:%M:%S",
                "format": "%(asctime)s.%(msecs)03d %(request_id)s %(levelname)s: %(message)s"
            }
        },
        "handlers": {
            "db_request_log": {
                "class": "logging.handlers.WatchedFileHandler",
                "filename": "/var/log/s3/print-log-broker-byte-sec-log/db-request.log",
                "filters": [
                    "request_context"
                ],
                "formatter": "db_request_log",
                "level": "DEBUG"
            },
            "default": {
                "class": "logging.handlers.WatchedFileHandler",
                "filename": "/var/log/s3/print-log-broker-byte-sec-log/print-log-broker-byte-sec-log.log",
                "filters": [
                    "request_context"
                ],
                "formatter": "default",
                "level": "DEBUG"
            },
            "log_broker_log": {
                "class": "logging.handlers.WatchedFileHandler",
                "filename": "/var/log/s3/print-log-broker-byte-sec-log/log-broker.log",
                "level": "DEBUG"
            }
        },
        "loggers": {
            "": {
                "handlers": [
                    "default"
                ],
                "level": "DEBUG",
                "propagate": true
            },
            "kikimr.public": {
                "level": "CRITICAL",
                "propagate": false
            },
            "log_broker": {
                "handlers": [
                    "log_broker_log"
                ],
                "level": "INFO",
                "propagate": false
            },
            "s3mds.db.request_log": {
                "handlers": [
                    "db_request_log"
                ],
                "level": "INFO",
                "propagate": false
            }
        },
        "version": 1
    }
}
