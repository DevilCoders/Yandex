{%- import "common/kikimr/init.sls" as vars with context %}
{
    "batch_size": 100,
    "db": {
        "endpoints": [
            {
                "host": "localhost",
                "port": 2135
            }
        ],
        "schema_prefix": "/{{ vars.ydb_domain }}/{{ vars.s3proxy_database }}/",
        "pool": {
            "size": 2
        }
    },
    "mds": {
        "key_version": 3,
        "read_endpoint": "{{ salt['pillar.get']('s3:mds_endpoint:read', '') }}",
        "write_endpoint": "{{ salt['pillar.get']('s3:mds_endpoint:write', '') }}",
        "connect_timeout": 7,
        "read_range_size_mb": 40,
        "upload_session_version": "json_v2",
        "namespace_resolver": {
            "secret_file": "/etc/s3-mds-proxy-arc/mds_secret.token"
        }
    },
    "job_timeout_min": 60,
    "lock_refresh_period": 60,
    "logging": {
        "disable_existing_loggers": false,
        "filters": {
            "request_context": {
                "()": "s3mds.logger.RequestContextFilter"
            }
        },
        "formatters": {
            "db_request_log": {
                "()": "s3mds.logger.BaseFormatter",
                "datefmt": "%Y-%m-%dT%H:%M:%S",
                "format": "timestamp=%(asctime)s\trequest_id=%(request_id)s\tbucket=%(bucket)s\tquery=%(query)s\trowcount=%(rowcount)s\terror_code=%(error_code)s\tattempt=%(attempt)s\trequest_time=%(request_time).3f"
            },
            "default": {
                "()": "s3mds.logger.BaseFormatter",
                "datefmt": "%Y-%m-%dT%H:%M:%S",
                "format": "%(asctime)s.%(msecs)03d %(request_id)s %(levelname)s: %(message)s"
            }
        },
        "handlers": {
            "db_request_log": {
                "class": "logging.handlers.WatchedFileHandler",
                "filename": "/var/log/s3/clean-storage-delete-queue/db-request-arc.log",
                "filters": [
                    "request_context"
                ],
                "formatter": "db_request_log",
                "level": "INFO"
            },
            "default": {
                "class": "logging.handlers.WatchedFileHandler",
                "filename": "/var/log/s3/clean-storage-delete-queue/clean-storage-delete-queue.log",
                "filters": [
                    "request_context"
                ],
                "formatter": "default",
                "level": "INFO"
            }
        },
        "loggers": {
            "": {
                "handlers": [
                    "default"
                ],
                "level": "INFO",
                "propagate": true
            },
            "kikimr.public": {
                "level": "CRITICAL",
                "propagate": false
            },
            "s3mds.db.request_log": {
                "handlers": [
                    "db_request_log"
                ],
                "level": "INFO",
                "propagate": false
            }
        },
        "version": 1
    },
    "remove_after_days": 14
}
