{%- from "api/gateway/map.jinja" import api_gateway, load_balancer with context -%}

log:
  level: WARN
  file:
    path: /var/log/gateway/error.log
    mode:
      bits: [ WRITE_USER, READ_USER, READ_GROUP, READ_ALL ]
    user: yc-api-gateway
    group: yc-api-gateway

healthcheck:
  enabled: true

balancer_healthcheck:
  server:
    listeners:
      - listener:
          tcp:
            port: 9895

prometheus_http:
  server:
    listeners:
      - listener:
          tcp:
            port: 9998

services:
  access_log:
    file:
      path: /var/log/gateway/access.log
      mode:
        bits: [ WRITE_USER, READ_USER, READ_GROUP, READ_ALL ]
      user: yc-api-gateway
      group: yc-api-gateway
    fields:
      add_unixtime: true

      time_format: ISO8601_MILLIS
      duration_unit: MILLISECOND
      duration_format: UINT64

      log_request: true
      request_max_size_bytes: 65536
      log_response: true
      response_max_size_bytes: 65536

  server:
    listeners:
      - listener:
          tcp:
            port: 9894
  config_server_endpoint: localhost:4435
