{%- set collector_settings = salt['pillar.get']('network-billing-collector') -%}
{% from 'compute-node-vpc/common/flow_log.jinja' import flow_log_prefix, flow_log_directory -%}

worker_count: {{ collector_settings.worker_count }}
wake_up_interval_seconds: {{ collector_settings.wake_up_sec }}
gc_interval_seconds: {{ collector_settings.gc_sec }}

vrouter_flows:
  dir: {{ flow_log_directory }}
  log_prefix: {{ flow_log_prefix }}

# If "processed_flows" is specified, all processed logs will be moved to that dir
# (take care of its cleanup!). If not specified, processed logs will be removed.
#processed_flows:
#  dir: examples/processed_flows


results:
  accounting:
    log_file: {{ collector_settings.accounting.log_file }}
    rotation_max_bytes: {{ collector_settings.accounting.rotation_max_bytes }}
    backup_count: {{ collector_settings.accounting.backup_count }}
  antifraud:
    log_file: {{ collector_settings.antifraud.log_file }}
    rotation_max_bytes: {{ collector_settings.antifraud.rotation_max_bytes }}
    backup_count: {{ collector_settings.antifraud.backup_count }}

compute_meta_dir: {{ collector_settings.network_attachment_info_dir }}

categories:
  balancer:
    local_vnet_affixes:
      - vnet
    remote_vnet_affixes:
      - ri-lb-ri
    tags:
      type: inet
      nlb: True
  inet:
    local_fip_buckets:
      - public
    remote_vnet_affixes:
      - unresolved
    tags:
      type: inet
  yandex:
    local_fip_buckets:
      - martian
    remote_vnet_affixes:
      - unresolved
    tags:
      type: yandex
  qrator:
    local_fip_buckets:
      - qrator
    remote_vnet_affixes:
      - unresolved
    tags:
      type: inet
      ddos_protection:
        - qrator
