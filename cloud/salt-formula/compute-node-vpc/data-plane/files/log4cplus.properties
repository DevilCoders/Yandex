{%- set log_format='{"timestamp": "%D{%Y-%m-%d %H:%M:%S,%q}", "level": "%p", "message": "%m"}' -%}
{%- set log_settings = salt['pillar.get']('oct:log_settings:defaults') -%}
{%- set flow_log_format='%d{%s} %m' -%}

log4cplus.rootLogger={{ log_settings['log4cplus_level'] }}, contrail_appender, flow_appender

log4cplus.appender.contrail_appender=log4cplus::FileAppender
log4cplus.appender.contrail_appender.File={{ log_file }}
log4cplus.appender.contrail_appender.Append=true
log4cplus.appender.contrail_appender.ImmediateFlush=true
log4cplus.appender.contrail_appender.layout=log4cplus::EscapedPatternLayout
log4cplus.appender.contrail_appender.layout.ConversionPattern={{ log_format }}%n
{#- Prevent flows from appearing in "normal" logs. #}
log4cplus.appender.contrail_appender.filters.1=log4cplus::spi::StringMatchFilter
log4cplus.appender.contrail_appender.filters.1.StringToMatch=FlowLogDataObject
log4cplus.appender.contrail_appender.filters.1.AcceptOnMatch=false

log4cplus.appender.flow_appender=log4cplus::DailyRollingFileAppender
log4cplus.appender.flow_appender.File={{ flow_log_file }}
log4cplus.appender.flow_appender.Append=true
log4cplus.appender.flow_appender.ImmediateFlush=false
log4cplus.appender.flow_appender.UseLockFile=false
log4cplus.appender.flow_appender.layout=log4cplus::PatternLayout
log4cplus.appender.flow_appender.layout.ConversionPattern={{ flow_log_format }}%n
log4cplus.appender.flow_appender.filters.1=log4cplus::spi::StringMatchFilter
log4cplus.appender.flow_appender.filters.1.StringToMatch=FlowLogDataObject
log4cplus.appender.flow_appender.filters.1.AcceptOnMatch=true
log4cplus.appender.flow_appender.filters.2=log4cplus::spi::DenyAllFilter
log4cplus.appender.flow_appender.Schedule=MINUTELY
{#- Shouldn't normally happen: see https://nda.ya.ru/3UVM9u #}
log4cplus.appender.flow_appender.MaxBackupIndex=8
