definitions:
  - &alert_id "{{.ID}}_nbs_disks_suffer"
  - &alert_name "{{.Name}} NBS Disks Suffer"
  - &alert_window_secs 240
  - &alert_description "Aggregated read/write suffer of NBS disks"
  - &alert_content "{{alert.name}} is in {{status.code}} state. R: {{expression.r}}. W: {{expression.w}}. "
alerts:
  - id: *alert_id
    name: *alert_name
    window_secs: *alert_window_secs
    description: *alert_description
    channels:
      - id: telegram
    annotations:
      content: *alert_content
    clusters:
      - preprod
    expression:
      program: |-
        let read_suffer = {project='{{.SolomonProjectID}}', cluster='{{.SolomonCluster}}', service='service',  sensor='ReadSuffer', host='cluster', type='-'};
        let write_suffer = {project='{{.SolomonProjectID}}', cluster='{{.SolomonCluster}}', service='service',  sensor='WriteSuffer', host='cluster', type='-'};

        let r = avg(read_suffer);
        let w = avg(write_suffer);
      check: |-
        r > 100 || w > 100
  - id: *alert_id
    name: *alert_name
    window_secs: *alert_window_secs
    description: *alert_description
    channels:
      - id: telegram
    annotations:
      content: *alert_content
    clusters:
      - prod_vla
    expression:
      program: |-
        let read_suffer = {project='{{.SolomonProjectID}}', cluster='{{.SolomonCluster}}', service='service',  sensor='ReadSuffer', host='cluster', type='-'};
        let write_suffer = {project='{{.SolomonProjectID}}', cluster='{{.SolomonCluster}}', service='service',  sensor='WriteSuffer', host='cluster', type='-'};

        let r = avg(read_suffer);
        let w = avg(write_suffer);
      check: |-
        r > 100 || w > 300

  - id: *alert_id
    name: *alert_name
    window_secs: *alert_window_secs
    description: *alert_description
    channels:
      - id: telegram
    annotations:
      content: *alert_content
    clusters:
      - prod_sas
      - prod_myt
      - israel
    expression:
      program: |-
        let read_suffer = {project='{{.SolomonProjectID}}', cluster='{{.SolomonCluster}}', service='service',  sensor='ReadSuffer', host='cluster', type='-'};
        let write_suffer = {project='{{.SolomonProjectID}}', cluster='{{.SolomonCluster}}', service='service',  sensor='WriteSuffer', host='cluster', type='-'};

        let r = avg(read_suffer);
        let w = avg(write_suffer);
      check: |-
        r > 100 || w > 250
