
vhost_home="${vhost_home:-"/Berkanavt/nfs-server"}"
vhost_config="${vhost_home}/cfg"
vhost_config_file="${vhost_config}/nfs-vhost.txt"
vhost_breakpad_file="${vhost_config}/nfs-breakpad.json"

vhost_mon_address="localhost"
vhost_mon_port="8768"

[ -s /etc/default/nfs_vhost.custom ] && . /etc/default/nfs_vhost.custom

vhost_arg="${vhost_arg}${vhost_config_file:+ --vhost-file ${vhost_config_file}}"
vhost_arg="${vhost_arg} --mon-port ${vhost_mon_port}"
if [ ! -z "${vhost_mon_address}" ]; then
    vhost_arg="${vhost_arg}${vhost_mon_address:+ --mon-address ${vhost_mon_address}}"
else
    echo "Monitoring address is not defined."
fi

if [ -f "${vhost_restarts_count_file}" ]; then
    vhost_arg="${vhost_arg}${vhost_restarts_count_file:+ --restarts-count-file ${vhost_restarts_count_file}}"
fi

if [ -f "${vhost_breakpad_file}" ] && [ $(jq .enable ${vhost_breakpad_file}) = true ]; then
    nfs_breakpad_dir="/var/tmp/breakpad-nfs"
    nfs_breakpad_arg="${nfs_breakpad_arg} --breakpad-enable --datadir=$nfs_breakpad_dir --breakpad-coredir=$nfs_breakpad_dir"
    vhost_log="${vhost_home}/log/nfs-vhost.log"
    nfs_breakpad_arg="${nfs_breakpad_arg}${vhost_log:+ --log ${vhost_log}}"
fi
