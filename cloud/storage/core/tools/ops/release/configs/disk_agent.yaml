name: disk_agent
description: "DiskAgent"
definitions:
  - &prod-telegram-chat-id "-1001286817181"
  - &prod-qmssngr-chat-id "1/0/c1066948-3a77-4e1a-b9d6-a270dc110f3b"
  - &testing-telegram-chat-id "-1001335463048"
  - &testing-qmssngr-chat-id "1/0/85b6e495-1d27-4ac2-9dc2-7fc5b4325ee6"
  - &disk-agent-juggler-namespace "ycloud"
  - &disk-agent-alerts
    - solomon_alert_disk_agent_server_restarts
    - solomon_alert_disk_agent_server_version
  - &disk-agent-binary-packages
    - yandex-cloud-blockstore-disk-agent
  - &disk-agent-services
    - name: blockstore-disk-agent
      restart_delay: 5s
  - &disk-agent-infra-service-id 322
clusters:
  hw-nbs-stable-lab:
    global:
      telegram:
        chat_id: *testing-telegram-chat-id
      qmssngr:
        chat_id: *testing-qmssngr-chat-id
      infra:
        service_id: *disk-agent-infra-service-id
        environment_id: 498
      juggler:
      targets:
        - name: nbs
          tags:
            - check-backward-compatibility
          binary_packages: *disk-agent-binary-packages
          config_package: yandex-search-kikimr-nbs-conf-hw-nbs-stable-lab-global
          services: *disk-agent-services
          z2:
            meta_group: YCLOUD_HW_NBS_STABLE_LAB_NBS
            group: YCLOUD_HW_NBS_STABLE_LAB_NBS_GLOBAL
            config_meta_group: YCLOUD_HW_NBS_STABLE_LAB_NBS_GLOBAL_CONF
  testing:
    {{- range (seq "sas" "vla" "myt")}}
    {{.}}:
      telegram:
        chat_id: *testing-telegram-chat-id
      qmssngr:
        chat_id: *testing-qmssngr-chat-id
      infra:
        service_id: *disk-agent-infra-service-id
        environment_id: 521
      juggler:
        host: solomon-alert-cloud_testing_nbs_{{.}}
        alerts: *disk-agent-alerts
        namespace: *disk-agent-juggler-namespace
      targets:
        - name: nbs
          tags:
            - check-backward-compatibility
          binary_packages: *disk-agent-binary-packages
          config_package: yandex-search-kikimr-nbs-conf-testing-{{.}}
          services: *disk-agent-services
          z2:
            meta_group: YCLOUD_TESTING_NBS
            group: YCLOUD_TESTING_NBS_{{.|ToUpper}}
            config_meta_group: YCLOUD_TESTING_NBS_{{.|ToUpper}}_CONF
    {{end}}
  preprod:
    {{- range (seq "sas" "vla")}}
    {{.}}:
      telegram:
        chat_id: *testing-telegram-chat-id
      qmssngr:
        chat_id: *testing-qmssngr-chat-id
      infra:
        service_id: *disk-agent-infra-service-id
        environment_id: 497
      juggler:
        host: solomon-alert-cloud_preprod_nbs_{{.}}
        alerts: *disk-agent-alerts
        namespace: *disk-agent-juggler-namespace
      targets:
        - name: nbs
          tags:
            - check-backward-compatibility
          binary_packages: *disk-agent-binary-packages
          config_package: yandex-search-kikimr-nbs-conf-pre-prod-{{.}}
          services: *disk-agent-services
          z2:
            meta_group: YCLOUD_PREPROD_NBS
            group: YCLOUD_PREPROD_NBS_{{.|ToUpper}}
            config_meta_group: YCLOUD_PREPROD_NBS_{{.|ToUpper}}_CONF
    {{end}}
    myt:
      telegram:
        chat_id: *testing-telegram-chat-id
      qmssngr:
        chat_id: *testing-qmssngr-chat-id
      infra:
        service_id: *disk-agent-infra-service-id
        environment_id: 497
      juggler:
        host: solomon-alert-cloud_preprod_nbs_myt
        alerts: *disk-agent-alerts
        namespace: *disk-agent-juggler-namespace
      targets:
        - name: nbs
          tags:
            - check-backward-compatibility
          binary_packages: *disk-agent-binary-packages
          config_package: yandex-search-kikimr-nbs-conf-pre-prod-myt
          services: *disk-agent-services
          z2:
            meta_group: YCLOUD_PROD_NBS
            group: YCLOUD_PREPROD_NBS_MYT
            config_meta_group: YCLOUD_PREPROD_NBS_MYT_CONF
  prod:
    vla: &common-prod-params
      telegram:
        chat_id: *prod-telegram-chat-id
      qmssngr:
        chat_id: *prod-qmssngr-chat-id
      infra:
        service_id: *disk-agent-infra-service-id
        environment_id: 496
      juggler:
        host: solomon-alert-cloud_prod_nbs_vla
        alerts: *disk-agent-alerts
        namespace: *disk-agent-juggler-namespace
      targets:
        - name: nbs
          binary_packages: *disk-agent-binary-packages
          config_package: yandex-search-kikimr-nbs-conf-prod-vla
          services: *disk-agent-services
          z2:
            meta_group: YCLOUD_PROD_NBS
            canary_group: YCLOUD_PROD_DISK_AGENT_VLA_CANARY
            group: YCLOUD_PROD_NBS_VLA
            config_meta_group: YCLOUD_PROD_NBS_VLA_CONF
    sas:
      <<: *common-prod-params
      juggler:
        host: solomon-alert-cloud_prod_nbs_sas
        alerts: *disk-agent-alerts
        namespace: *disk-agent-juggler-namespace
      targets:
        - name: nbs
          binary_packages: *disk-agent-binary-packages
          config_package: yandex-search-kikimr-nbs-conf-prod-sas
          services: *disk-agent-services
          z2:
            meta_group: YCLOUD_PROD_NBS
            group: YCLOUD_PROD_NBS_SAS
            config_meta_group: YCLOUD_PROD_NBS_SAS_CONF
    myt:
      <<: *common-prod-params
      juggler:
        host: solomon-alert-cloud_prod_nbs_myt
        alerts: *disk-agent-alerts
        namespace: *disk-agent-juggler-namespace
      targets:
        - name: nbs
          binary_packages: *disk-agent-binary-packages
          config_package: yandex-search-kikimr-nbs-conf-prod-myt
          services: *disk-agent-services
          z2:
            meta_group: YCLOUD_PROD_NBS
            group: YCLOUD_PROD_NBS_MYT
            config_meta_group: YCLOUD_PROD_NBS_MYT_CONF
  israel:
    m1a:
      telegram:
        chat_id: *prod-telegram-chat-id
      qmssngr:
        chat_id: *prod-qmssngr-chat-id
      infra:
        service_id: *disk-agent-infra-service-id
        environment_id: 6612
      juggler:
        host: solomon-alert-cloud_israel_nbs
        alerts: *disk-agent-alerts
        namespace: *disk-agent-juggler-namespace
      targets:
        - name: nbs
          binary_packages: *disk-agent-binary-packages
          config_package: yandex-search-kikimr-nbs-conf-israel-m1a
          services: *disk-agent-services
          z2:
            meta_group: YCLOUD_ISRAEL_NBS
            group: YCLOUD_ISRAEL_NBS_AZ1
            config_meta_group: YCLOUD_ISRAEL_NBS_AZ1_CONF
