version: "3.7"
services:
  tvm:
    command:
      ["-c", "/etc/tvmtool/tvmtool.conf", "--cache-dir", "/var/cache/tvmtool/"]
    environment:
      - TVMTOOL_LOCAL_AUTHTOKEN=${tvm_token}
    image: cr.yandex/crp1m3ip7sn09t6912j9/tvm:1.3.7
    network_mode: "host"
    restart: always
    volumes:
      - type: bind
        source: ${tvm_config_path}
        target: /etc/tvmtool/tvmtool.conf
  gore:
    depends_on:
      - tvm
    environment:
      - MONGO_CA_FILE=/usr/local/share/ca-certificates/Yandex/YandexInternalRootCA.crt
      - MONGO_HOST=${mongo_host}
      - MONGO_USER=${mongo_user}
      - MONGO_PASSWORD=${mongo_password}
      - QLOUD_TVM_TOKEN=${tvm_token}
    image: cr.yandex/crp1m3ip7sn09t6912j9/gore:${version}
    network_mode: "host"
    # restart: always  
    restart: on-failure
    volumes:
      - type: bind
        source: ${gore_config_path}
        target: /etc/gore/config.json
