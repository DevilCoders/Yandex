version: "3.7"
services:
  telegram:
    image: cr.yandex/crpkne7bucbk4155b9uf/dutybot:${version}
    environment:
      - MESSENGER=telegram
      - ENVIRONMENT=${environment}
      - TELEGRAM_WEBHOOK_URL=${telegram_webhook_url}
      - USE_WEBHOOK=True
      - RUN_REGULAR_JOBS_ON_AZ=ru-central1-a
    network_mode: "host"
    restart: on-failure
  %{ if run_yandex_messenger_bot }
  yandex_messenger:
    image: cr.yandex/crpkne7bucbk4155b9uf/dutybot:${version}
    environment:
      - MESSENGER=yandex
      - ENVIRONMENT=${environment}
      - YANDEX_MESSENGER_WEBHOOK_URL=${yandex_messenger_webhook_url}
      - USE_WEBHOOK=True
      - RUN_REGULAR_JOBS_ON_AZ=none
    network_mode: "host"
    restart: on-failure
  %{ endif }
