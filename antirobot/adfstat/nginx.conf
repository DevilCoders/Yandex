daemon                  off;
worker_processes        auto;
worker_rlimit_nofile    8192;
pid                     nginx-pid;
error_log               /logs/current-logs-nginx-error.log info;

events {
    worker_connections  8192;
    use                 epoll;
}

http {
    default_type  application/octet-stream;
    more_clear_headers Server;
    server_tokens off;

    server_names_hash_bucket_size 256;

    sendfile         on;
    tcp_nopush       on;
    tcp_nodelay      on;
    keepalive_timeout  0;

    ssl_certificate cert/adfstat.yandex.ru.pem;
    ssl_certificate_key cert/adfstat.yandex.ru.pem;
    ssl_session_timeout 10m;

    gzip                on;
    gzip_proxied        any;
    gzip_min_length     1100;
    gzip_http_version   1.0;
    gzip_buffers        4 8k;
    gzip_comp_level     9;
    gzip_types          text/plain text/css application/x-javascript text/xml application/xml application/xml+rss text/javascript application/json;

    variables_hash_max_size 1024;
    variables_hash_bucket_size 128;

    log_format json_combined escape=json '{"timestamp":"$msec","time_iso8601":"$time_iso8601","host":"$host","remote_addr":"$remote_addr","remote_user":"$remote_user","request_method":"$request_method","request_uri":"$request_uri","status":"$status","body_bytes_sent":"$body_bytes_sent","request_time":"$request_time","http_referrer":"$http_referer","http_user_agent":"$http_user_agent","http_cookie":"$http_cookie","connection":"$connection,$connection_requests,$connections_active,$connections_reading,$connections_waiting,$connections_writing","tcp_syn_options":"$tcp_syn_options"}';

    access_log /logs/current-logs-nginx-access.log json_combined buffer=16k flush=5s;
    error_log /logs/current-logs-nginx-error.log error;

    server {
        server_name adfstat.yandex.ru;
        listen *:443 ssl tcp_save_syn default_server;
        listen [::]:443 ssl tcp_save_syn default_server;
        listen *:80 tcp_save_syn default_server;
        listen [::]:80 tcp_save_syn default_server;

        include nginx_include_ssl-options;

        add_header Strict-Transport-Security "max-age=604800";

        access_log /logs/current-logs-nginx-adfstat-access.log json_combined buffer=16k flush=5s;
        error_log /logs/current-logs-nginx-adfstat-error.log info;

		include common.locations;

        location /ping {
            access_log /logs/current-logs-nginx-ping-adfstat-access.log json_combined buffer=16k flush=5s;
            default_type text/html;
            return 200 "Pong.\n";
        }
    }
	server {
        server_name adstat.yandex.ru;
        listen *:443 ssl tcp_save_syn;
        listen [::]:443 ssl tcp_save_syn;
        listen *:80 tcp_save_syn;
        listen [::]:80 tcp_save_syn;

        include nginx_include_ssl-options;

        add_header Strict-Transport-Security "max-age=604800";

        access_log /logs/current-logs-nginx-adstat-access.log json_combined buffer=16k flush=5s;
        error_log /logs/current-logs-nginx-adstat-error.log info;

		include common.locations;

        location /ping {
            access_log /logs/current-logs-nginx-ping-adstat-access.log json_combined buffer=16k flush=5s;
            default_type text/html;
            return 200 "Pong.\n";
        }
    }
}