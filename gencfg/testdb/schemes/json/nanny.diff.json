{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "title" : "Full diff for nanny",

    "definitions" : {
        "old_new_string_value" : {
            "description" : "Pairs of <old_value, new_value>",
            "type" : "object",
            "properties" : {
                "oldvalue" : {
                    "type" : "string"
                },
                "newvalue" : {
                    "type" : "string"
                }
            },
            "additionalProperties": false
        },
        "old_new_number_value" : {
            "description" : "Pairs of <old_value, new_value>",
            "type" : "object",
            "properties" : {
                "oldvalue" : {
                    "type" : "number"
                },
                "newvalue" : {
                    "type" : "number"
                }
            },
            "additionalProperties": false
        },
        "old_new_boolean_value" : {
            "description" : "Pairs of <old_value, new_value>",
            "type" : "object",
            "properties" : {
                "oldvalue" : {
                    "type" : "boolean"
                },
                "newvalue" : {
                    "type" : "boolean"
                }
            },
            "additionalProperties": false
        },
        "added_replaced_removed_values" : {
            "description" : "Changes as triplet (<added values>, <removed values>, <replaced values>)",
            "type" : "object",
            "properties" : {
                "added" : {
                    "description" : "List of hosts added to group",
                    "type" : "array",
                    "item" : { "type" : "string" },
                    "uniqueItems" : true
                },
                "removed" : {
                    "description" : "List of hosts removed from group",
                    "type" : "array",
                    "item" : { "type" : "string" },
                    "uniqueItems" : true
                },
                "replaced" : {
                    "description" : "List of pairs of replaced hosts",
                    "type" : "array",
                    "item" : {
                        "description" : "Pairs of <old_host, new_host>",
                        "type" : "object",
                        "properties" : {
                            "oldvalue" : {
                                "type" : "string"
                            },
                            "newvalue" : {
                                "type" : "string"
                            }
                        },
                        "additionalProperties": false
                    },
                    "uniqueItems" : true
                }
            },
            "additionalProperties": false
        }
    },

    "description": "Full diff for nanny (including groups/hosts/...)",
    "type": "object",
    "properties": {
        "diff_props" : {
            "description" : "Some meta information on diff",
            "type" : "object",
            "properties" : {
                "newtag" : {
                    "description" : "New tag in format stable-81/r32",
                    "type" : "string"
                },
                "oldtag" : {
                    "description" : "Previous tag in format stable-81/r32",
                    "type" : "string"
                },
                "sandbox_url" : {
                    "description" : "Url to sandbox task, generated new tag",
                    "type" : ["string", "null"]
                },
                "version" : {
                    "description" : "Version of diffbuilder",
                    "type" : "string"
                }
            },
            "additionalProperties": false
        },
        "diff_result" : {
            "description" : "Array with diff entries (including group entries, host entries, commit entries, ...)",
            "type" : "array",
            "items" : {
                "description" : "Diff entry",
                "type" : "object",
                "properties" : {
                    "diff_type" : {
                        "description" : "Diff type (group diff, hw diff, commit diff, ...)",
                        "enum" : ["group_diff"]
                    },
                    "groupname" : {
                        "description" : "Group name",
                        "type" : "string"
                    },
                    "mastername" : {
                        "description" : "Group master name (do we need it?)",
                        "type" : "string"
                    },
                    "status" : {
                        "description" : "Group status (changed, removed or added)",
                        "enum" : ["CHANGED", "ADDED", "REMOVED"]
                    },
                    "hosts" : {
                        "$ref" : "#/definitions/added_replaced_removed_values"
                    },
                    "card" : {
                        "description" : "Card changes in specified group",
                        "type" : "object",
                        "properties" : {
                            "power" : {
                                "description" : "Group power",
                                "$ref" : "#/definitions/old_new_number_value"
                            },
                            "owners" : {
                                "description" : "Group owners",
                                "$ref" : "#/definitions/added_replaced_removed_values"
                            },
                            "intlookups" : {
                                "description" : "Group intlookups",
                                "$ref" : "#/definitions/added_replaced_removed_values"
                            },
                            "ctype" : {
                                "description" : "Group ctype (in format <a_>)",
                                "$ref" : "#/definitions/old_new_string_value"
                            },
                            "itype" : {
                                "description" : "Group itype (in format <a_>)",
                                "$ref" : "#/definitions/old_new_string_value"
                            },
                            "prj" : {
                                "description" : "List of group prjs (in format <a_>",
                                "$ref" : "#/definitions/added_replaced_removed_values"
                            },
                            "metaprj" : {
                                "description" : "Group metaprj (in format <a_>)",
                                "$ref" : "#/definitions/old_new_string_value"
                            },
                            "itag" : {
                                "description" : "List of group itags (custom tag set on every instance in <itag_> format)",
                                "$ref" : "#/definitions/added_replaced_removed_values"
                            },
                            "nonsearch" : {
                                "description" : "Bool field showing whether group is nonsearch or not",
                                "$ref" : "#/definitions/old_new_boolean_value"
                            },
                            "extra_disk_size" : {
                                "description" : "Extra disk size of group on every host",
                                "$ref" : "#/definitions/old_new_number_value"
                            },
                            "extra_disk_size_per_instance" : {
                                "description" : "Extra disk size per instance",
                                "$ref" : "#/definitions/old_new_number_value"
                            },
                            "expires" : {
                                "description" : "Expiration date",
                                "$ref" : "#/definitions/old_new_string_value"
                            },
                            "memory_per_instance" : {
                                "description" : "Memory per instance (in bytes)",
                                "$ref" : "#/definitions/old_new_number_value"
                            }
                        },
                        "additionalProperties": false
                    }
                },
                "additionalProperties": false
            }
        }
    },
    "additionalProperties": false
}
