{
  "opts": {
    "name": "media-rim",
    "domain": "*",
    "reuse_port": true,
    "cache": false,
    "ban": false,
    "rr": true,
    "cors": true,
    "sd_client_name": "images-rim-balancer",
    "sd_update_frequency": "10m",
    "stats_attr_balancer": "rim_balancer",
    "stats_attr_backend": "rim_backend"
  },
  "index_types": {
    "main": {
      "name": "main",
      "regexp": [
        {
          "match": "url",
          "template": "/rim\\\\?(.*&)?docid=([a-fA-F0-9]+)(&.*)?"
        }
      ],
      "rewrite": "/rim?docid=%2&%1%3",
      "id_regexp": "docid=([a-fA-F0-9]+)",
      "stats_attr": "main",
      "weight_file": "heavy.weight",
      "fallback_weight_file": "main_fallback.weight",
      "shardFunc": "consistent_hashing",
      "sharded": true,
      "thdb_file": "rimdb.version"
    }
  },
  "instances": {
    "backends": {
      "main": {
        "prod": {
          "sas": {
            "enable": true,
            "rr": true,
            "name": [
              {
                "type": "yp_endpointset",
                "cluster": "sas",
                "template": "sas-imgs-rim.sas-imgs-rim.{num}.rimdaemon",
                "shards": 3000
              }
            ]
          },
          "man": {
            "enable": true,
            "rr": true,
            "name": [
              {
                "type": "yp_endpointset",
                "cluster": "man",
                "template": "man-imgs-rim.man-imgs-rim.{num}.rimdaemon",
                "shards": 3000
              }
            ]
          },
          "vla": {
            "enable": true,
            "rr": true,
            "name": [
              {
                "type": "yp_endpointset",
                "cluster": "vla",
                "template": "vla-imgs-rim.vla-imgs-rim.{num}.rimdaemon",
                "shards": 3000
              }
            ]
          }
        },
        "on_error": {
          "prod": {
            "sas": {
              "name": [
                {
                  "type": "yp_endpointset",
                  "cluster": "vla",
                  "template": "vla-imgs-rim.vla-imgs-rim.{num}.rimdaemon",
                  "shards": 3000
                },
                {
                  "type": "yp_endpointset",
                  "cluster": "man",
                  "template": "man-imgs-rim.man-imgs-rim.{num}.rimdaemon",
                  "shards": 3000
                }
              ]
            },
            "man": {
              "name": [
                {
                  "type": "yp_endpointset",
                  "cluster": "sas",
                  "template": "sas-imgs-rim.sas-imgs-rim.{num}.rimdaemon",
                  "shards": 3000
                },
                {
                  "type": "yp_endpointset",
                  "cluster": "vla",
                  "template": "vla-imgs-rim.vla-imgs-rim.{num}.rimdaemon",
                  "shards": 3000
                }
              ]
            },
            "vla": {
              "name": [
                {
                  "type": "yp_endpointset",
                  "cluster": "sas",
                  "template": "sas-imgs-rim.sas-imgs-rim.{num}.rimdaemon",
                  "shards": 3000
                },
                {
                  "type": "yp_endpointset",
                  "cluster": "man",
                  "template": "man-imgs-rim.man-imgs-rim.{num}.rimdaemon",
                  "shards": 3000
                }
              ]
            }
          }
        }
      }
    }
  }
}
