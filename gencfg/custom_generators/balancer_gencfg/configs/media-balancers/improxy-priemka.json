{
  "opts": {
    "name": "imgs",
    "domain": "imtub-test.search.yandex.net",
    "reuse_port": true,
    "cache": false,
    "ban": true,
    "rr": false,
    "fallback": false,
    "webp": true,
    "http2": true,
    "http2_alpn_freq": 1.0,
    "stats_attr_balancer": "improxy_balancer",
    "stats_attr_backend": "improxy_backend",
    "rs_hosts": {
      "sas": "sas2-0623-sas-imgs-improxy-priemka-32317.gencfg-c.yandex.net"
    },
    "cors": true,
    "http": {
        "http2": true,
        "http2_alpn_freq": 1.0
    }
  },
  "ssl": {
    "enable": true,
    "certKey": "secrets/key",
    "cert": "secrets/cert"
  },
  "index_types": {
    "imglth": {
      "name": "imgs-large",
      "regexp": [
        {
          "match": "url",
          "template": "/i\\\\?(.*&)?id=([a-fA-F0-9]+)-(\\\\d+-\\\\d+)?(l|srl)-?\\\\d*(&.*)?"
        }
      ],
      "rewrite": "/i?id=%2&%1%5",
      "id_regexp": "id=([a-fA-F0-9]+)",
      "stats_attr": "images_large",
      "weight_file": "heavy.weight",
      "shardFunc": "consistent_hashing",
      "sharded": true,
      "thdb_file": "imglth.version"
    }
  },
  "instances": {
    "balancers": {
      "sas": {
        "enable": true,
        "group": ["SAS_IMGS_IMPROXY_PRIEMKA"]
      }
    },
    "bans": {
      "id_regexp": "\\\\?.*id=([a-fA-F0-9]+)",
      "backends": {
        "prod": {
          "sas": {
            "host": "localhost",
            "port_group": "SAS_IMGS_IMPROXY_BAN",
            "connect_timeout": "5ms",
            "backend_timeout": "10ms",
            "keepalive_count": 16,
            "attempts": 1
          },
          "man": {
            "host": "localhost",
            "port_group": "MAN_IMGS_IMPROXY_BAN",
            "connect_timeout": "5ms",
            "backend_timeout": "10ms",
            "keepalive_count": 16,
            "attempts": 1
          },
          "vla": {
            "host": "localhost",
            "port_group": "SAS_IMGS_IMPROXY_BAN",
            "connect_timeout": "5ms",
            "backend_timeout": "10ms",
            "keepalive_count": 16,
            "attempts": 1
          }
        },
        "on_error": {
          "prod": {
            "sas": {
              "name": ["SAS_IMGS_IMPROXY_BAN"],
              "connect_timeout": "20ms",
              "backend_timeout": "50ms",
              "keepalive_count": 4,
              "attempts": 3
            },
            "man": {
              "name": ["MAN_IMGS_IMPROXY_BAN"],
              "connect_timeout": "20ms",
              "backend_timeout": "50ms",
              "keepalive_count": 4,
              "attempts": 3
            },
            "vla": {
              "name": ["VLA_IMGS_IMPROXY_BAN"],
              "connect_timeout": "20ms",
              "backend_timeout": "50ms",
              "keepalive_count": 4,
              "attempts": 3
            }
          }
        }
      }
    },
    "backends": {
      "imglth": {
        "prod": {
          "sas": {
            "enable": true,
            "name": ["SAS_IMGS_LARGE_THUMB_NIDX", "MAN_IMGS_LARGE_THUMB_NIDX"],
            "disable_fallback": true,
            "is_shift_ports": false
          }
        }
      }
    }
  }
}
