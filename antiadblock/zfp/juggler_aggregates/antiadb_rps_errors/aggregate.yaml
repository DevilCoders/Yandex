antiadb_rps_errors:all_services:
  ttl: 3600
  aggregator_kwargs:
    limits:
      - crit: 146%
        day_end: 7
        day_start: 1
        time_start: 23
        time_end: 08
      - crit: 30%
        day_end: 7
        day_start: 1
        time_start: 09
        time_end: 22
    nodata_mode: skip
    hold_crit: 600
    crit_desc: |
      Проблемы с RPS сразу на нескольких сервисах

      График: https://solomon.yandex-team.ru/?cluster=cryprox-prod&project=Antiadblock&service=cryprox_actions&l.http_code=ERROR&l.service_id=*&l.host=cluster&l.action=fetch_content&l.sensor=action_error_counter&b=1h&l.http_host=ALL&graph=auto&filter=top&filterLimit=12&legend=1

      Пожаловаться: https://st.yandex-team.ru/createTicket?queue=ANTIADBALERTS&priority=2&summary=antiadb_rps_errors%3Aall_services&type=2&tags[0]=false_positive
  children:
    - child:
        host: razladki_rps_crit
        service: autoru
    - child:
        host: razladki_rps_crit
        service: docviewer.yandex.ru
    - child:
        host: razladki_rps_crit
        service: kinopoisk.ru
    - child:
        host: razladki_rps_crit
        service: turbo.yandex.ru
    - child:
        host: razladki_rps_crit
        service: yandex_images
    - child:
        host: razladki_rps_crit
        service: yandex_player
    - child:
        host: razladki_rps_crit
        service: yandex_afisha
    - child:
        host: razladki_rps_crit
        service: zen.yandex.ru
    - child:
        host: razladki_rps_crit
        service: yandex_video
    - child:
        host: razladki_rps_crit
        service: yandex_tv
    - child:
        host: razladki_rps_crit
        service: yandex_sport
    - child:
        host: razladki_rps_crit
        service: yandex_realty
    - child:
        host: razladki_rps_crit
        service: yandex_pogoda
    - child:
        host: razladki_rps_crit
        service: yandex_afisha
    - child:
        host: razladki_rps_crit
        service: yandex_news
    - child:
        host: razladki_rps_crit
        service: yandex_morda
    - child:
        host: razladki_rps_crit
        service: yandex_mail
  aggregator: timed_more_than_limit_is_problem
  notifications:
    - TELEGRAM
    - DAY_PHONE
  pronounce: На нескольких внутренних сервисах резко изменились RPS
  flaps_config:
    stable: 180
    critical: 540
  mark: cryprox-rps
  namespace: antiadb


antiadb_rps_errors:all_services_night:
  ttl: 3600
  aggregator_kwargs:
    limits:
      - crit: 30%
        day_end: 7
        day_start: 1
        time_start: 23
        time_end: 08
      - crit: 146%
        day_end: 7
        day_start: 1
        time_start: 09
        time_end: 22
    nodata_mode: skip
    hold_crit: 600
  children:
    - child:
        host: razladki_rps_crit
        service: autoru
    - child:
        host: razladki_rps_crit
        service: docviewer.yandex.ru
    - child:
        host: razladki_rps_crit
        service: kinopoisk.ru
    - child:
        host: razladki_rps_crit
        service: turbo.yandex.ru
    - child:
        host: razladki_rps_crit
        service: yandex_images
    - child:
        host: razladki_rps_crit
        service: yandex_player
    - child:
        host: razladki_rps_crit
        service: yandex_afisha
    - child:
        host: razladki_rps_crit
        service: zen.yandex.ru
    - child:
        host: razladki_rps_crit
        service: yandex_video
    - child:
        host: razladki_rps_crit
        service: yandex_tv
    - child:
        host: razladki_rps_crit
        service: yandex_sport
    - child:
        host: razladki_rps_crit
        service: yandex_realty
    - child:
        host: razladki_rps_crit
        service: yandex_pogoda
    - child:
        host: razladki_rps_crit
        service: yandex_afisha
    - child:
        host: razladki_rps_crit
        service: yandex_news
    - child:
        host: razladki_rps_crit
        service: yandex_morda
    - child:
        host: razladki_rps_crit
        service: yandex_mail
  aggregator: timed_more_than_limit_is_problem
  notifications:
    - NIGHT_PHONE
  pronounce: На нескольких внутренних сервисах резко изменились RPS
  flaps_config:
    stable: 600
    critical: 1200
  mark: cryprox-rps
  namespace: antiadb

antiadb_rps_errors:*:
  ttl: 3600
  aggregator_kwargs:
    nodata_mode: skip
    unreach_checks:
      - antiadb_rps_errors:all_services
      - antiadb_rps_errors:all_services_night
    crit_desc: |
      На сервисе {service_id} резко изменились RPS

      График: https://solomon.yandex-team.ru/?project=Antiadblock&cluster=cryprox-prod&service=cryprox_actions&dashboard=Antiadblock_system_partner_dashboard&b=1h&l.service_id={service_id}
      Отключить звонок: https://juggler.yandex-team.ru/check_details/?host=antiadb_rps_errors&service={service_id}&last=1DAY
      Пожаловаться: https://st.yandex-team.ru/createTicket?queue=ANTIADBALERTS&priority=2&summary=antiadb_rps_errors%3A{service_id}&type=2&tags[0]=false_positive
  children:
    - child:
        host: razladki_rps_crit
  aggregator: logic_or
  notifications:
    - TELEGRAM
  flaps_config:
    stable: 240
    critical: 720
  mark: cryprox-rps
  format_description:
    service_id: service_id
  namespace: antiadb

antiadb_rps_errors:*_call:
  ttl: 3600
  aggregator_kwargs:
    nodata_mode: skip
    unreach_checks:
      - antiadb_rps_errors:all_services
      - antiadb_rps_errors:all_services_night
  children:
    - child:
        host: razladki_rps_crit
  aggregator: logic_or
  notifications:
    - DAY_PHONE
  flaps_config:
    stable: 540
    critical: 900
  pronounce: На сервисе {service_id} резко изменились RPS
  mark: cryprox-rps
  format_description:
    service_id: service_id
  namespace: antiadb
