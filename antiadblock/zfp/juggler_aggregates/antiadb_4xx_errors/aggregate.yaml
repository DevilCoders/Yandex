antiadb_4xx_errors:all_dc_fix_threshold:
  ttl: 3600
  aggregator_kwargs:
    limits:
      -
        crit: 146%
        day_end: 7
        day_start: 1
        time_start: 23
        time_end: 08
      -
        crit: 100%
        day_end: 7
        day_start: 1
        time_start: 09
        time_end: 22
    nodata_mode: force_crit
    hold_crit: 1200
    crit_desc: |
      Во всех ДЦ выросли 4xx ошибки
      Дашборд: https://solomon.yandex-team.ru/?project=Antiadblock&dashboard=Antiadblock_Overall&b=1h

      Пожаловаться: https://st.yandex-team.ru/createTicket?queue=ANTIADBALERTS&priority=2&summary=antiadb_4xx_errors%3Aall_dc_fix_threshold&type=2&tags[0]=false_positive
  children:
    - child:
        host: errors_4XX_per_dc
        service: man
    - child:
        host: errors_4XX_per_dc
        service: sas
    - child:
        host: errors_4XX_per_dc
        service: iva
    - child:
        host: errors_4XX_per_dc
        service: myt
    - child:
        host: errors_4XX_per_dc
        service: vla
  aggregator: timed_more_than_limit_is_problem
  notifications:
    - TELEGRAM
    - DAY_PHONE
  pronounce: Во всех ДЦ выросли четырехсотые ошибки
  flaps_config:
    stable: 120
    critical: 360
  mark: cryprox-4xx-errors
  namespace: antiadb

antiadb_4xx_errors:all_dc_fix_threshold_night:
  ttl: 3600
  aggregator_kwargs:
    limits:
      -
        crit: 100%
        day_end: 7
        day_start: 1
        time_start: 23
        time_end: 08
      -
        crit: 146%
        day_end: 7
        day_start: 1
        time_start: 09
        time_end: 22
    nodata_mode: force_crit
    hold_crit: 1200
  children:
    - child:
        host: errors_4XX_per_dc
        service: man
    - child:
        host: errors_4XX_per_dc
        service: sas
    - child:
        host: errors_4XX_per_dc
        service: iva
    - child:
        host: errors_4XX_per_dc
        service: myt
    - child:
        host: errors_4XX_per_dc
        service: vla
  aggregator: timed_more_than_limit_is_problem
  notifications:
    - NIGHT_PHONE
  pronounce: Во всех ДЦ выросли четырехсотые ошибки
  flaps_config:
    stable: 600
    critical: 1200
  mark: cryprox-4xx-errors
  namespace: antiadb

antiadb_4xx_errors:man_fix_threshold:
  ttl: 3600
  aggregator_kwargs:
    limits:
      - crit: 146%
        day_end: 7
        day_start: 1
        time_start: 23
        time_end: 08
      - crit: 100%
        day_end: 7
        day_start: 1
        time_start: 09
        time_end: 22
    nodata_mode: force_crit
    unreach_checks:
      - antiadb_4xx_errors:all_dc_fix_threshold
    hold_crit: 1200
    crit_desc: |
      В ДЦ man выросли 4xx ошибки
      Дашборд: https://solomon.yandex-team.ru/?project=Antiadblock&dashboard=Antiadblock_Overall&b=1h

      Пожаловаться: https://st.yandex-team.ru/createTicket?queue=ANTIADBALERTS&priority=2&summary=antiadb_4xx_errors%3Aman_fix_threshold&type=2&tags[0]=false_positive
  children:
    - child:
        host: errors_4XX_per_dc
        service: man
  aggregator: timed_more_than_limit_is_problem
  notifications:
    - TELEGRAM
    - DAY_PHONE
  pronounce: В ДЦ man выросли четырехсотые ошибки
  flaps_config:
    stable: 120
    critical: 360
  mark: cryprox-4xx-errors
  namespace: antiadb

antiadb_4xx_errors:man_fix_threshold_night:
  ttl: 3600
  aggregator_kwargs:
    limits:
      - crit: 100%
        day_end: 7
        day_start: 1
        time_start: 23
        time_end: 08
      - crit: 146%
        day_end: 7
        day_start: 1
        time_start: 09
        time_end: 22
    nodata_mode: force_crit
    unreach_checks:
      - antiadb_4xx_errors:all_dc_fix_threshold
    hold_crit: 1200
  children:
    - child:
        host: errors_4XX_per_dc
        service: man
  aggregator: timed_more_than_limit_is_problem
  notifications:
    - NIGHT_PHONE
  pronounce: В ДЦ man выросли четырехсотые ошибки
  flaps_config:
    stable: 600
    critical: 1200
  mark: cryprox-4xx-errors
  namespace: antiadb

antiadb_4xx_errors:sas_fix_threshold:
  ttl: 3600
  aggregator_kwargs:
    limits:
      - crit: 146%
        day_end: 7
        day_start: 1
        time_start: 23
        time_end: 08
      - crit: 100%
        day_end: 7
        day_start: 1
        time_start: 09
        time_end: 22
    nodata_mode: force_crit
    unreach_checks:
      - antiadb_4xx_errors:all_dc_fix_threshold
    hold_crit: 1200
    crit_desc: |
      В ДЦ sas выросли 4xx ошибки
      Дашборд: https://solomon.yandex-team.ru/?project=Antiadblock&dashboard=Antiadblock_Overall&b=1h

      Пожаловаться: https://st.yandex-team.ru/createTicket?queue=ANTIADBALERTS&priority=2&summary=antiadb_4xx_errors%3Asas_fix_threshold&type=2&tags[0]=false_positive
  children:
    - child:
        host: errors_4XX_per_dc
        service: sas
  aggregator: timed_more_than_limit_is_problem
  notifications:
    - TELEGRAM
    - DAY_PHONE
  pronounce: В ДЦ sas выросли четырехсотые ошибки
  flaps_config:
    stable: 120
    critical: 360
  mark: cryprox-4xx-errors
  namespace: antiadb

antiadb_4xx_errors:sas_fix_threshold_night:
  ttl: 3600
  aggregator_kwargs:
    limits:
      - crit: 100%
        day_end: 7
        day_start: 1
        time_start: 23
        time_end: 08
      - crit: 146%
        day_end: 7
        day_start: 1
        time_start: 09
        time_end: 22
    nodata_mode: force_crit
    unreach_checks:
      - antiadb_4xx_errors:all_dc_fix_threshold
    hold_crit: 1200
  children:
    - child:
        host: errors_4XX_per_dc
        service: sas
  aggregator: timed_more_than_limit_is_problem
  notifications:
    - NIGHT_PHONE
  pronounce: В ДЦ sas выросли четырехсотые ошибки
  flaps_config:
    stable: 600
    critical: 1200
  mark: cryprox-4xx-errors
  namespace: antiadb

antiadb_4xx_errors:myt_fix_threshold:
  ttl: 3600
  aggregator_kwargs:
    limits:
      - crit: 146%
        day_end: 7
        day_start: 1
        time_start: 23
        time_end: 08
      - crit: 100%
        day_end: 7
        day_start: 1
        time_start: 09
        time_end: 22
    nodata_mode: force_crit
    unreach_checks:
      - antiadb_4xx_errors:all_dc_fix_threshold
    hold_crit: 1200
    crit_desc: |
      В ДЦ myt выросли 4xx ошибки
      Дашборд: https://solomon.yandex-team.ru/?project=Antiadblock&dashboard=Antiadblock_Overall&b=1h

      Пожаловаться: https://st.yandex-team.ru/createTicket?queue=ANTIADBALERTS&priority=2&summary=antiadb_4xx_errors%3Amyt_fix_threshold&type=2&tags[0]=false_positive
  children:
    - child:
        host: errors_4XX_per_dc
        service: myt
  aggregator: timed_more_than_limit_is_problem
  notifications:
    - TELEGRAM
    - DAY_PHONE
  pronounce: В ДЦ myt выросли четырехсотые ошибки
  flaps_config:
    stable: 120
    critical: 360
  mark: cryprox-4xx-errors
  namespace: antiadb

antiadb_4xx_errors:myt_fix_threshold_night:
  ttl: 3600
  aggregator_kwargs:
    limits:
      - crit: 100%
        day_end: 7
        day_start: 1
        time_start: 23
        time_end: 08
      - crit: 146%
        day_end: 7
        day_start: 1
        time_start: 09
        time_end: 22
    nodata_mode: force_crit
    unreach_checks:
      - antiadb_4xx_errors:all_dc_fix_threshold
    hold_crit: 1200
  children:
    - child:
        host: errors_4XX_per_dc
        service: myt
  aggregator: timed_more_than_limit_is_problem
  notifications:
    - NIGHT_PHONE
  pronounce: В ДЦ myt выросли четырехсотые ошибки
  flaps_config:
    stable: 600
    critical: 1200
  mark: cryprox-4xx-errors
  namespace: antiadb

antiadb_4xx_errors:iva_fix_threshold:
  ttl: 3600
  aggregator_kwargs:
    limits:
      - crit: 146%
        day_end: 7
        day_start: 1
        time_start: 23
        time_end: 08
      - crit: 100%
        day_end: 7
        day_start: 1
        time_start: 09
        time_end: 22
    nodata_mode: force_crit
    unreach_checks:
      - antiadb_4xx_errors:all_dc_fix_threshold
    hold_crit: 1200
    crit_desc: |
      В ДЦ iva выросли 4xx ошибки
      Дашборд: https://solomon.yandex-team.ru/?project=Antiadblock&dashboard=Antiadblock_Overall&b=1h

      Пожаловаться: https://st.yandex-team.ru/createTicket?queue=ANTIADBALERTS&priority=2&summary=antiadb_4xx_errors%3Aiva_fix_threshold&type=2&tags[0]=false_positive
  children:
    - child:
        host: errors_4XX_per_dc
        service: iva
  aggregator: timed_more_than_limit_is_problem
  notifications:
    - TELEGRAM
    - DAY_PHONE
  pronounce: В ДЦ iva выросли четырехсотые ошибки
  flaps_config:
    stable: 120
    critical: 360
  mark: cryprox-4xx-errors
  namespace: antiadb

antiadb_4xx_errors:iva_fix_threshold_night:
  ttl: 3600
  aggregator_kwargs:
    limits:
      - crit: 100%
        day_end: 7
        day_start: 1
        time_start: 23
        time_end: 08
      - crit: 146%
        day_end: 7
        day_start: 1
        time_start: 09
        time_end: 22
    nodata_mode: force_crit
    unreach_checks:
      - antiadb_4xx_errors:all_dc_fix_threshold
    hold_crit: 1200
  children:
    - child:
        host: errors_4XX_per_dc
        service: iva
  aggregator: timed_more_than_limit_is_problem
  notifications:
    - NIGHT_PHONE
  pronounce: В ДЦ iva выросли четырехсотые ошибки
  flaps_config:
    stable: 600
    critical: 1200
  mark: cryprox-4xx-errors
  namespace: antiadb

antiadb_4xx_errors:vla_fix_threshold:
  ttl: 3600
  aggregator_kwargs:
    limits:
      - crit: 146%
        day_end: 7
        day_start: 1
        time_start: 23
        time_end: 08
      - crit: 100%
        day_end: 7
        day_start: 1
        time_start: 09
        time_end: 22
    nodata_mode: force_crit
    unreach_checks:
      - antiadb_4xx_errors:all_dc_fix_threshold
    hold_crit: 1200
    crit_desc: |
      В ДЦ vla выросли 4xx ошибки
      Дашборд: https://solomon.yandex-team.ru/?project=Antiadblock&dashboard=Antiadblock_Overall&b=1h

      Пожаловаться: https://st.yandex-team.ru/createTicket?queue=ANTIADBALERTS&priority=2&summary=antiadb_4xx_errors%3Avla_fix_threshold&type=2&tags[0]=false_positive
  children:
    - child:
        host: errors_4XX_per_dc
        service: vla
  aggregator: timed_more_than_limit_is_problem
  notifications:
    - TELEGRAM
    - DAY_PHONE
  pronounce: В ДЦ vla выросли четырехсотые ошибки
  flaps_config:
    stable: 120
    critical: 360
  mark: cryprox-4xx-errors
  namespace: antiadb

antiadb_4xx_errors:vla_fix_threshold_night:
  ttl: 3600
  aggregator_kwargs:
    limits:
      - crit: 100%
        day_end: 7
        day_start: 1
        time_start: 23
        time_end: 08
      - crit: 146%
        day_end: 7
        day_start: 1
        time_start: 09
        time_end: 22
    nodata_mode: force_crit
    unreach_checks:
      - antiadb_4xx_errors:all_dc_fix_threshold
    hold_crit: 1200
  children:
    - child:
        host: errors_4XX_per_dc
        service: vla
  aggregator: timed_more_than_limit_is_problem
  notifications:
    - NIGHT_PHONE
  pronounce: В ДЦ vla выросли четырехсотые ошибки
  flaps_config:
    stable: 600
    critical: 1200
  mark: cryprox-4xx-errors
  namespace: antiadb

antiadb_4xx_errors:all_services:
  ttl: 3600
  aggregator_kwargs:
    limits:
      -
        crit: 146%
        day_end: 7
        day_start: 1
        time_end: 08
        time_start: 23
      -
        crit: 30%
        day_end: 7
        day_start: 1
        time_end: 22
        time_start: 09
    nodata_mode: skip
    unreach_checks:
      - antiadb_4xx_errors:all_dc_fix_threshold
      - antiadb_4xx_errors:man_fix_threshold
      - antiadb_4xx_errors:sas_fix_threshold
      - antiadb_4xx_errors:vla_fix_threshold
      - antiadb_4xx_errors:myt_fix_threshold
      - antiadb_4xx_errors:iva_fix_threshold
    hold_crit: 600
    crit_desc: |
      Проблемы с 4xx сразу на нескольких сервисах

      График: https://solomon.yandex-team.ru/?cluster=cryprox-prod&project=Antiadblock&service=cryprox_actions&l.http_code=ERROR&l.service_id=*&l.host=cluster&l.action=fetch_content&l.sensor=action_error_counter&b=1h&l.http_host=ALL&graph=auto&filter=top&filterLimit=12&legend=1

      Пожаловаться: https://st.yandex-team.ru/createTicket?queue=ANTIADBALERTS&priority=2&summary=antiadb_4xx_errors%3Aall_services&type=2&tags[0]=false_positive
  children:
    - child:
        host: razladki_4xx_crit
        service: autoru
    - child:
        host: razladki_4xx_crit
        service: docviewer.yandex.ru
    - child:
        host: razladki_4xx_crit
        service: kinopoisk.ru
    - child:
        host: razladki_4xx_crit
        service: turbo.yandex.ru
    - child:
        host: razladki_4xx_crit
        service: yandex_images
    - child:
        host: razladki_4xx_crit
        service: yandex_player
    - child:
        host: razladki_4xx_crit
        service: yandex_afisha
    - child:
        host: razladki_4xx_crit
        service: zen.yandex.ru
    - child:
        host: razladki_4xx_crit
        service: yandex_video
    - child:
        host: razladki_4xx_crit
        service: yandex_tv
    - child:
        host: razladki_4xx_crit
        service: yandex_sport
    - child:
        host: razladki_4xx_crit
        service: yandex_realty
    - child:
        host: razladki_4xx_crit
        service: yandex_pogoda
    - child:
        host: razladki_4xx_crit
        service: yandex_afisha
    - child:
        host: razladki_4xx_crit
        service: yandex_news
    - child:
        host: razladki_4xx_crit
        service: yandex_morda
    - child:
        host: razladki_4xx_crit
        service: yandex_mail
  aggregator: timed_more_than_limit_is_problem
  notifications:
    - TELEGRAM
    - DAY_PHONE
  pronounce: На нескольких внутренних сервисах выросли четырехсотые ошибки
  flaps_config:
    stable: 180
    critical: 540
  mark: cryprox-4xx-errors
  namespace: antiadb


antiadb_4xx_errors:all_services_night:
  ttl: 3600
  aggregator_kwargs:
    limits:
      -
        crit: 30%
        day_end: 7
        day_start: 1
        time_end: 08
        time_start: 23
      -
        crit: 146%
        day_end: 7
        day_start: 1
        time_end: 22
        time_start: 09
    nodata_mode: skip
    unreach_checks:
      - antiadb_4xx_errors:all_dc_fix_threshold_night
      - antiadb_4xx_errors:man_fix_threshold_night
      - antiadb_4xx_errors:sas_fix_threshold_night
      - antiadb_4xx_errors:vla_fix_threshold_night
      - antiadb_4xx_errors:myt_fix_threshold_night
      - antiadb_4xx_errors:iva_fix_threshold_night
    hold_crit: 600
  children:
    - child:
        host: razladki_4xx_crit
        service: autoru
    - child:
        host: razladki_4xx_crit
        service: docviewer.yandex.ru
    - child:
        host: razladki_4xx_crit
        service: kinopoisk.ru
    - child:
        host: razladki_4xx_crit
        service: turbo.yandex.ru
    - child:
        host: razladki_4xx_crit
        service: yandex_images
    - child:
        host: razladki_4xx_crit
        service: yandex_player
    - child:
        host: razladki_4xx_crit
        service: yandex_afisha
    - child:
        host: razladki_4xx_crit
        service: zen.yandex.ru
    - child:
        host: razladki_4xx_crit
        service: yandex_video
    - child:
        host: razladki_4xx_crit
        service: yandex_tv
    - child:
        host: razladki_4xx_crit
        service: yandex_sport
    - child:
        host: razladki_4xx_crit
        service: yandex_realty
    - child:
        host: razladki_4xx_crit
        service: yandex_pogoda
    - child:
        host: razladki_4xx_crit
        service: yandex_afisha
    - child:
        host: razladki_4xx_crit
        service: yandex_news
    - child:
        host: razladki_4xx_crit
        service: yandex_morda
    - child:
        host: razladki_4xx_crit
        service: yandex_mail
  aggregator: timed_more_than_limit_is_problem
  notifications:
    - NIGHT_PHONE
  pronounce: На нескольких внутренних сервисах выросли четырехсотые ошибки
  flaps_config:
    stable: 600
    critical: 1200
  mark: cryprox-4xx-errors
  namespace: antiadb


antiadb_403_errors:*:
  ttl: 3600
  aggregator_kwargs:
    nodata_mode: skip
    crit_desc: |
      На сервисе {service_id} выросли 403 ошибки

      График: https://solomon.yandex-team.ru/?project=Antiadblock&cluster=cryprox-prod&service=cryprox_actions&dashboard=Antiadblock_system_partner_dashboard&b=1h&l.service_id={service_id}
      Пожаловаться: https://st.yandex-team.ru/createTicket?queue=ANTIADBALERTS&priority=2&summary=antiadb_403_errors%3A{service_id}&type=2&tags[0]=false_positive
  children:
    - child:
        host: razladki_403_crit
  aggregator: logic_or
  notifications:
    - TELEGRAM
  flaps_config:
    stable: 180
    critical: 660
  mark: cryprox-4xx-errors
  format_description:
    service_id: service_id
  namespace: antiadb

antiadb_403_errors:*_call:
  ttl: 3600
  aggregator_kwargs:
    nodata_mode: skip
  children:
    - child:
        host: razladki_403_crit
  aggregator: logic_or
  notifications:
    - DAY_PHONE
  flaps_config:
    stable: 480
    critical: 820
  pronounce: На сервисе {service_id} выросли 403 ошибки
  format_description:
    service_id: service_id
  mark: cryprox-4xx-errors
  namespace: antiadb


antiadb_4xx_errors:*:
  ttl: 3600
  aggregator_kwargs:
    nodata_mode: skip
    unreach_checks:
      - antiadb_403_errors:#
      - antiadb_4xx_errors:all_dc_fix_threshold
      - antiadb_4xx_errors:man_fix_threshold
      - antiadb_4xx_errors:sas_fix_threshold
      - antiadb_4xx_errors:vla_fix_threshold
      - antiadb_4xx_errors:myt_fix_threshold
      - antiadb_4xx_errors:iva_fix_threshold
      - antiadb_4xx_errors:all_services
      - antiadb_4xx_errors:all_dc_fix_threshold_night
      - antiadb_4xx_errors:man_fix_threshold_night
      - antiadb_4xx_errors:sas_fix_threshold_night
      - antiadb_4xx_errors:vla_fix_threshold_night
      - antiadb_4xx_errors:myt_fix_threshold_night
      - antiadb_4xx_errors:iva_fix_threshold_night
      - antiadb_4xx_errors:all_services_night
    crit_desc: |
      На сервисе {service_id} выросли четырехсотые ошибки

      График: https://solomon.yandex-team.ru/?project=Antiadblock&cluster=cryprox-prod&service=cryprox_actions&dashboard=Antiadblock_system_partner_dashboard&b=1h&l.service_id={service_id}
      Отключить звонок: https://juggler.yandex-team.ru/check_details/?host=antiadb_4xx_errors&service={service_id}&last=1DAY
      Пожаловаться: https://st.yandex-team.ru/createTicket?queue=ANTIADBALERTS&priority=2&summary=antiadb_4xx_errors%3A{service_id}&type=2&tags[0]=false_positive
  children:
    - child:
        host: razladki_4xx_crit
  aggregator: logic_or
  notifications:
    - TELEGRAM
  flaps_config:
    stable: 240
    critical: 720
  mark: cryprox-4xx-errors
  format_description:
    service_id: service_id
  namespace: antiadb

antiadb_4xx_errors:*_call:
  ttl: 3600
  aggregator_kwargs:
    nodata_mode: skip
    unreach_checks:
      - antiadb_403_errors:#_call
      - antiadb_4xx_errors:all_dc_fix_threshold
      - antiadb_4xx_errors:man_fix_threshold
      - antiadb_4xx_errors:sas_fix_threshold
      - antiadb_4xx_errors:vla_fix_threshold
      - antiadb_4xx_errors:myt_fix_threshold
      - antiadb_4xx_errors:iva_fix_threshold
      - antiadb_4xx_errors:all_services
      - antiadb_4xx_errors:all_dc_fix_threshold_night
      - antiadb_4xx_errors:man_fix_threshold_night
      - antiadb_4xx_errors:sas_fix_threshold_night
      - antiadb_4xx_errors:vla_fix_threshold_night
      - antiadb_4xx_errors:myt_fix_threshold_night
      - antiadb_4xx_errors:iva_fix_threshold_night
      - antiadb_4xx_errors:all_services_night
  children:
    - child:
        host: razladki_4xx_crit
  aggregator: logic_or
  notifications:
    - DAY_PHONE
  flaps_config:
    stable: 540
    critical: 900
  pronounce: На сервисе {service_id} выросли четырехсотые ошибки
  format_description:
    service_id: service_id
  mark: cryprox-4xx-errors
  namespace: antiadb
