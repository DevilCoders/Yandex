## Админка под самогоном

### Как деплоить
1. Заходим на инсталляцию самогона, которую нужно задеплоить, например, препрод https://aabadmin11.n.yandex-team.ru
1. В левом меню переходим в раздел Deploy
1. Напротив поля "Package" вводим sbr:<sandbox_resource_id>, например: sbr:986087903
1. Нажимаем на кнопку Deploy
1. Вас перенаправит на страницу прогресса деплоя

### Как собирать локально 
Для сборки необходимо собрать пакет - тарник и залить его в сэндбок
1. Переходим в терминале в директорию arcadia/antiadblock/configs_api/samogon
1. Выполняем команду: `ya package --checkout --target-platform default-linux-x86_64 package.json && ya upload --ttl=256 aab-configs_api.master.tar.gz`
1. В случае успешной сборки ищем в последних строках вывода надпись: `"Created resource id is <number>"`, число и есть айди ресурса сэндбокса, он же sandbox resource id или sbr 
1. Полученный айди можно использовать для деплоя на свою инсталляцию админки в самогоне

### Как развернуть собственную инсталляцию
1. Редактируем файл antiadblock/configs_api/samogon/plugin/\_\_init__.py  
1. В словаре CONFIG_BY_KEY копируем сущность с ключом 23, новый ключ - любое незанятое число в словаре больше 20
1. Создаём свой тестовый кластер БД в PGaaS
1. В поле pg_db_host прописываем хост в созданной базе данных, см [как развернуть dev PGaaS](#как-развернуть-dev-pgaas)
1. Делаем локальную сборку, см [как собирать локально](#как-собирать-локально)
1. Заходим в https://ui-deploy.n.yandex-team.ru и напротив aab_admin_11 кликаем на Clone (зелёная иконка планшета)
1. В Namespace вводим то число, которые было выбрано для словаря
1. В Package вводим sbr:<your_sandbox_id> - айди собранного на предыдущем шаге ресурса
1. В Samogon Version указываем stable если там ничего нет
1. Нажимаем deploy и ждём некоторое время пока инсталляция развернётся
1. После того как инсталляция успешно задеплоилась, изменения в конфигурации можно закомитить

### Как развернуть dev PGaaS
1. Заходим сюда https://yc.yandex-team.ru/folders/fooavoes33es4l9p4drt/managed-postgresql
1. Нажимаем "Создать кластер"
1. Выбираем имя для кластера, в имени надо указать ваш логин, в описание написать что кластер ваш
1. В имени БД указываем aab_admin_yandex_team_ru_db_dev
1. В имени пользователя antiadb
1. Пароль берём из секретницы https://yav.yandex-team.ru/secret/sec-01d1gdj91zqghj9fbyvdrmey4g/create/version/ver-01d1gdrbkssmnrdcgfpdrch6fb, ключ - aab-admin-dev_db-password
1. Нажимаем "Создать кластер"
1. "Хост" можно взять, зайдя в созданный кластер, нажав на "Подключиться" из примера строки подключения - значение поля host
