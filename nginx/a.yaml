service: strm
title: Nginx Web Server
ci:
  secret: sec-01en0dfpvq4edxmhv1ggdfpep8
  runtime:
    sandbox-owner: STRM-DEV

  release-title-source: flow
  releases:
    package:
      title: Build nginx deb packages
      flow: package-deb
      filters:
        - sub-paths: ['bin/debians/debian/changelog']
      auto: true
      stages:
        package-deb:
          title: Package debs

  flows:
    package-deb:
      title: Build nginx package
      jobs:
        start-package:
          title: Start deb packaging
          task: dummy
          stage: package-deb

        package-precise:
          title: Build precise package
          description: Runs ya package in sandbox
          task: common/arcadia/ya_package
          requirements:
            sandbox:
              client_tags: GENERIC & LINUX & LXC
              container_resource: 2448765509
          input:
            packages: nginx/bin/debians/package-precise.json
            build_type: release
            package_type: debian
            key_user: robot-strm-sandbox
            publish_package: true
            multiple_publish: true
            publish_to_mapping:
              nginx/bin/debians/package-precise.json: yandex-precise;search-precise
            debian_distribution: unstable
            dupload_max_attempts: 2
            resource_type: YA_PACKAGE
          needs: start-package

        package-trusty:
          title: Build trusty package
          description: Runs ya package in sandbox
          task: common/arcadia/ya_package
          requirements:
            sandbox:
              client_tags: GENERIC & LINUX & LXC
              container_resource: 2448783790
          input:
            packages: nginx/bin/debians/package-trusty.json
            build_type: release
            package_type: debian
            key_user: robot-strm-sandbox
            publish_package: true
            multiple_publish: true
            publish_to_mapping:
              nginx/bin/debians/package-trusty.json: yandex-trusty;search-trusty
            debian_distribution: unstable
            dupload_max_attempts: 2
            resource_type: YA_PACKAGE
          needs: start-package

        package-xenial:
          title: Build xenial package
          description: Runs ya package in sandbox
          task: common/arcadia/ya_package
          requirements:
            sandbox:
              client_tags: GENERIC & LINUX & LXC
              container_resource: 2448774862
          input:
            packages: nginx/bin/debians/package-xenial.json
            build_type: release
            package_type: debian
            key_user: robot-strm-sandbox
            publish_package: true
            multiple_publish: true
            publish_to_mapping:
              nginx/bin/debians/package-xenial.json: yandex-xenial;search-xenial
            debian_distribution: unstable
            dupload_max_attempts: 2
            resource_type: YA_PACKAGE
          needs: start-package

        package-bionic:
          title: Build bionic package
          description: Runs ya package in sandbox
          task: common/arcadia/ya_package
          requirements:
            sandbox:
              client_tags: GENERIC & LINUX & LXC
              container_resource: 2537446459
          input:
            packages: nginx/bin/debians/package-bionic.json
            build_type: release
            package_type: debian
            key_user: robot-strm-sandbox
            publish_package: true
            multiple_publish: true
            publish_to_mapping:
              nginx/bin/debians/package-bionic.json: yandex-bionic
            debian_distribution: unstable
            dupload_max_attempts: 2
            resource_type: YA_PACKAGE
          needs: start-package

        package-focal:
          title: Build focal package
          description: Runs ya package in sandbox
          task: common/arcadia/ya_package
          requirements:
            sandbox:
              client_tags: GENERIC & LINUX & LXC
              container_resource: 2537448920
          input:
            packages: nginx/bin/debians/package-focal.json
            build_type: release
            package_type: debian
            key_user: robot-strm-sandbox
            publish_package: true
            multiple_publish: true
            publish_to_mapping:
              nginx/bin/debians/package-focal.json: yandex-focal
            debian_distribution: unstable
            dupload_max_attempts: 2
            resource_type: YA_PACKAGE
          needs: start-package

        package-noperl:
          title: Build package without perl (should be version-agnostic)
          description: Runs ya package in sandbox
          task: common/arcadia/ya_package
          requirements:
            sandbox:
              client_tags: GENERIC & LINUX & LXC
              container_resource: 2537448920
          input:
            packages: nginx/bin/debians/package-noperl.json
            build_type: release
            package_type: debian
            key_user: robot-strm-sandbox
            publish_package: true
            multiple_publish: true
            publish_to_mapping:
              nginx/bin/debians/package-noperl.json: yandex-focal
            debian_distribution: unstable
            dupload_max_attempts: 2
            resource_type: YA_PACKAGE
          needs: start-package

