#
# This file was auto-generated by strm/admins/ci. Zero-diff counter: 2
#
service: strm
title: nginx
ci:
  autocheck:
    strong: true
  secret: sec-01en0dfpvq4edxmhv1ggdfpep8
  runtime:
    sandbox-owner: STRM-DEV
  releases:
    nginx:
      title: nginx
      flow: nginx_release
      auto: false
      filters:
      - discovery: any
      - discovery: dir
        abs-paths:
        - nginx/bin/debians/debian/changelog
      stages:
      - id: build
        title: Build
        displace: true
        rollback: false
      - id: testing
        title: Deploy to testing
        displace: true
        rollback: true
      - id: prestable
        title: Deploy to prestable
        displace: true
        rollback: true
      - id: production
        title: Deploy to production
        displace: false
        rollback: true
  flows:
    nginx_release:
      title: nginx
      jobs:
        start_build:
          title: Start Build
          task: dummy
          version: stable
          manual: false
          needs: []
          needs-type: all
          stage: build
        build_binary:
          title: Build cloud resource
          task: projects/strm/build/ya_make_2
          version: stable
          manual: false
          needs:
          - start_build
          needs-type: all
          input:
            targets: nginx/strm-bin
            arts: nginx/strm-bin/nginx
            arts_source: nginx/bin/debians/nginx=etc
            definition_flags: -DARCADIA_NGINX_USE_LUAJIT_21
            thinlto: true
            result_single_file: false
            result_rd: Release STRM_NGINX_BINARY v${context.version_info.full} r${to_string(context.target_revision.number)}
              from ${context.ci_url}
            result_rt: STRM_NGINX_BINARY
            result_ttl: '30'
        build_deb:
          title: Build debian package
          task: projects/strm/build/ya_package
          version: stable
          manual: false
          needs:
          - start_build
          needs-type: all
          input:
            packages: nginx/bin/debians/package-strm.json
            package_type: debian
            resource_type: YA_PACKAGE
            strip_binaries: false
            create_debug_packages: false
            thinlto: true
            publish_package: true
            publish_to_mapping:
              nginx/bin/debians/package-strm.json: common
            dupload_max_attempts: 2
        start_testing:
          title: Start Deploy to testing
          task: dummy
          version: stable
          manual: false
          needs:
          - build_binary
          - build_deb
          needs-type: all
          stage: testing
        skip_testing:
          title: Skip wait for Deploy to testing
          task: dummy
          version: stable
          manual: true
          needs:
          - start_testing
          needs-type: all
          stage: testing
        sandbox_testing:
          title: Release in sandbox
          task: common/releases/release_to_sandbox
          version: stable
          manual: false
          needs:
          - start_testing
          needs-type: all
          if: ${context.flow_type != 'ROLLBACK'}
          input:
            config:
              sandbox_resource_type: STRM_NGINX_BINARY
              common_release_data:
                release_stage: testing
        conductor_testing:
          title: Create conductor ticket
          task: projects/strm/conductor/create_ticket
          version: stable
          manual: false
          needs:
          - start_testing
          needs-type: all
          input:
            ticket_params:
              branch: testing
              start_tasks: true
              wait_for_deploy: true
        nanny_stream-default-tst:
          title: 'Nanny: deploy stream-default-tst'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_testing
          needs-type: all
          input:
            config:
              service_id: stream-default-tst
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: testing
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm-cold-cache-test:
          title: 'Nanny: deploy strm-cold-cache-test'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_testing
          needs-type: all
          input:
            config:
              service_id: strm-cold-cache-test
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: testing
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm_channel_tumbler_testing:
          title: 'Nanny: deploy strm_channel_tumbler_testing'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_testing
          needs-type: all
          input:
            config:
              service_id: strm_channel_tumbler_testing
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: testing
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm_clickhouse_proxy_testing:
          title: 'Nanny: deploy strm_clickhouse_proxy_testing'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_testing
          needs-type: all
          input:
            config:
              service_id: strm_clickhouse_proxy_testing
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: testing
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm_plgo_testing:
          title: 'Nanny: deploy strm_plgo_testing'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_testing
          needs-type: all
          input:
            config:
              service_id: strm_plgo_testing
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: testing
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm_pult_cms_test:
          title: 'Nanny: deploy strm_pult_cms_test'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_testing
          needs-type: all
          input:
            config:
              service_id: strm_pult_cms_test
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: testing
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm_pult_tst:
          title: 'Nanny: deploy strm_pult_tst'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_testing
          needs-type: all
          input:
            config:
              service_id: strm_pult_tst
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: testing
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_testing_xaccelredirect:
          title: 'Nanny: deploy testing_xaccelredirect'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_testing
          needs-type: all
          input:
            config:
              service_id: testing_xaccelredirect
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: testing
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm-anycast-ru-net-testing:
          title: 'Nanny: deploy strm-anycast-ru-net-testing'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_testing
          needs-type: all
          input:
            config:
              service_id: strm-anycast-ru-net-testing
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: testing
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm-anycast-media-testing:
          title: 'Nanny: deploy strm-anycast-media-testing'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_testing
          needs-type: all
          input:
            config:
              service_id: strm-anycast-media-testing
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: testing
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm-playlist-cache-test:
          title: 'Nanny: deploy strm-playlist-cache-test'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_testing
          needs-type: all
          input:
            config:
              service_id: strm-playlist-cache-test
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: testing
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        end_testing:
          title: End Deploy to testing
          task: dummy
          version: stable
          manual: false
          needs:
          - sandbox_testing
          - conductor_testing
          - nanny_stream-default-tst
          - nanny_strm-cold-cache-test
          - nanny_strm_channel_tumbler_testing
          - nanny_strm_clickhouse_proxy_testing
          - nanny_strm_plgo_testing
          - nanny_strm_pult_cms_test
          - nanny_strm_pult_tst
          - nanny_testing_xaccelredirect
          - nanny_strm-anycast-ru-net-testing
          - nanny_strm-anycast-media-testing
          - nanny_strm-playlist-cache-test
          needs-type: all
          stage: testing
        start_prestable:
          title: Start Deploy to prestable
          task: dummy
          version: stable
          manual: true
          needs:
          - end_testing
          - skip_testing
          needs-type: any
          stage: prestable
        skip_prestable:
          title: Skip wait for Deploy to prestable
          task: dummy
          version: stable
          manual: true
          needs:
          - start_prestable
          needs-type: all
          stage: prestable
        sandbox_prestable:
          title: Release in sandbox
          task: common/releases/release_to_sandbox
          version: stable
          manual: false
          needs:
          - start_prestable
          needs-type: all
          if: ${context.flow_type != 'ROLLBACK'}
          input:
            config:
              sandbox_resource_type: STRM_NGINX_BINARY
              common_release_data:
                release_stage: prestable
        conductor_prestable:
          title: Create conductor ticket
          task: projects/strm/conductor/create_ticket
          version: stable
          manual: false
          needs:
          - start_prestable
          needs-type: all
          input:
            ticket_params:
              branch: prestable
              start_tasks: true
              wait_for_deploy: true
        nanny_stream-default-prestable:
          title: 'Nanny: deploy stream-default-prestable'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_prestable
          needs-type: all
          input:
            config:
              service_id: stream-default-prestable
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: prestable
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm-cold-cache-prestable-v2:
          title: 'Nanny: deploy strm-cold-cache-prestable-v2'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_prestable
          needs-type: all
          input:
            config:
              service_id: strm-cold-cache-prestable-v2
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: prestable
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm_cacto_prestable:
          title: 'Nanny: deploy strm_cacto_prestable'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_prestable
          needs-type: all
          input:
            config:
              service_id: strm_cacto_prestable
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: prestable
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm_plgo_prestable:
          title: 'Nanny: deploy strm_plgo_prestable'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_prestable
          needs-type: all
          input:
            config:
              service_id: strm_plgo_prestable
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: prestable
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm-anycast-ru-net-prestable:
          title: 'Nanny: deploy strm-anycast-ru-net-prestable'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_prestable
          needs-type: all
          input:
            config:
              service_id: strm-anycast-ru-net-prestable
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: prestable
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm-anycast-media-prestable:
          title: 'Nanny: deploy strm-anycast-media-prestable'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_prestable
          needs-type: all
          input:
            config:
              service_id: strm-anycast-media-prestable
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: prestable
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        end_prestable:
          title: End Deploy to prestable
          task: dummy
          version: stable
          manual: false
          needs:
          - sandbox_prestable
          - conductor_prestable
          - nanny_stream-default-prestable
          - nanny_strm-cold-cache-prestable-v2
          - nanny_strm_cacto_prestable
          - nanny_strm_plgo_prestable
          - nanny_strm-anycast-ru-net-prestable
          - nanny_strm-anycast-media-prestable
          needs-type: all
          stage: prestable
        start_production:
          title: Start Deploy to production
          task: dummy
          version: stable
          manual: true
          needs:
          - end_prestable
          - skip_prestable
          needs-type: any
          stage: production
        sandbox_production:
          title: Release in sandbox
          task: common/releases/release_to_sandbox
          version: stable
          manual: false
          needs:
          - start_production
          needs-type: all
          if: ${context.flow_type != 'ROLLBACK'}
          input:
            config:
              sandbox_resource_type: STRM_NGINX_BINARY
              common_release_data:
                release_stage: stable
        conductor_production:
          title: Create conductor ticket
          task: projects/strm/conductor/create_ticket
          version: stable
          manual: false
          needs:
          - start_production
          needs-type: all
          input:
            ticket_params:
              branch: stable
              start_tasks: true
              wait_for_deploy: true
        nanny_playlist-cache-prod:
          title: 'Nanny: deploy playlist-cache-prod'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_production
          needs-type: all
          input:
            config:
              service_id: playlist-cache-prod
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: stable
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_production_xaccelredirect:
          title: 'Nanny: deploy production_xaccelredirect'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_production
          needs-type: all
          input:
            config:
              service_id: production_xaccelredirect
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: stable
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_stream-default:
          title: 'Nanny: deploy stream-default'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_production
          needs-type: all
          input:
            config:
              service_id: stream-default
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: stable
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm-cold-cache-production-v2:
          title: 'Nanny: deploy strm-cold-cache-production-v2'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_production
          needs-type: all
          input:
            config:
              service_id: strm-cold-cache-production-v2
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: stable
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm-stream-internal-edge:
          title: 'Nanny: deploy strm-stream-internal-edge'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_production
          needs-type: all
          input:
            config:
              service_id: strm-stream-internal-edge
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: stable
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm_adblock_production:
          title: 'Nanny: deploy strm_adblock_production'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_production
          needs-type: all
          input:
            config:
              service_id: strm_adblock_production
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: stable
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm_cacto_production:
          title: 'Nanny: deploy strm_cacto_production'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_production
          needs-type: all
          input:
            config:
              service_id: strm_cacto_production
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: stable
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm_channel_tumbler_production:
          title: 'Nanny: deploy strm_channel_tumbler_production'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_production
          needs-type: all
          input:
            config:
              service_id: strm_channel_tumbler_production
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: stable
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm_clickhouse_proxy_production:
          title: 'Nanny: deploy strm_clickhouse_proxy_production'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_production
          needs-type: all
          input:
            config:
              service_id: strm_clickhouse_proxy_production
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: stable
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm_plgo_internal:
          title: 'Nanny: deploy strm_plgo_internal'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_production
          needs-type: all
          input:
            config:
              service_id: strm_plgo_internal
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: stable
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm_pult_production:
          title: 'Nanny: deploy strm_pult_production'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_production
          needs-type: all
          input:
            config:
              service_id: strm_pult_production
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: stable
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm-anycast-ru-net-production:
          title: 'Nanny: deploy strm-anycast-ru-net-production'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_production
          needs-type: all
          input:
            config:
              service_id: strm-anycast-ru-net-production
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: stable
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
        nanny_strm-anycast-media-production:
          title: 'Nanny: deploy strm-anycast-media-production'
          task: common/nanny/update_service
          version: stable
          manual: false
          needs:
          - start_production
          needs-type: all
          input:
            config:
              service_id: strm-anycast-media-production
              queue_id: STRM
              release_title: Release STRM_NGINX_BINARY v${context.version_info.full}
                r${to_string(context.target_revision.number)} from ${context.ci_url}
              release_type: stable
              target_status: ACTIVE
              prepare_recipe: ''
              activate_recipe: default
              patches:
              - sandbox:
                  resource_type: STRM_NGINX_BINARY
                  resource:
                    local_path: nginx
