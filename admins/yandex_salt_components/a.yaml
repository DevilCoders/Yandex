service: nocdev
title: yandex_salt_components

ci:
  autocheck:
    fast-targets:
      - admins/yandex_salt_components

  secret: sec-01f00xrpf9sfcd6fjrdrzw8tj3

  runtime:
    sandbox-owner: NOCDEV

  releases:
    release:
      title: Release yandex_salt_components
      flow: release
      auto: true
      filters:
      - discovery: dir
        sub-paths:
        - a.yaml
        - pkg.json
      stages:
      - id: build
        title: Build
        displace: true
        rollback: false
      - id: testing
        title: Deploy to testing
        displace: true
        rollback: true
  flows:
    release:
      title: Release yandex_salt_components package
      jobs:
        build:
          stage: build
          title: Build yandex_salt_components package
          description: Build yandex_salt_components package and upload it to dist
          task: common/arcadia/ya_package
          input:
            packages: admins/yandex_salt_components/pkg.json
            build_type: release
            package_type: debian
            publish_package: true
            publish_to: common
            debian_distribution: unstable
            resource_type: YA_PACKAGE
            use_aapi_fuse: true
            use_arc_instead_of_aapi: false
            aapi_fallback: true
            use_new_format: true
            compress_package_archive: false
            key_user: robot-nocdeploy
        conductor_testing:
          stage: testing
          title: Create conductor ticket
          task: projects/strm/conductor/create_ticket
          version: stable
          manual: false
          needs:
          - build
          input:
            ticket_params:
              branch: testing
              start_tasks: false
              wait_for_deploy: false
