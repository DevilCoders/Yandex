{% set is_prod = grains['yandex-environment'] == 'production' %}
{% set project = salt['grains.get']('conductor:project', 'storage') %}

# vim: ft=sls
interface: '::'
ipv6: True
{% if is_prod and project == 'elliptics' %}
worker_threads: 48
{% else %}
worker_threads: 24
{% endif %}
user: robot-media-salt
log_level: INFO
log_level_logfile: INFO
auto_accept: True
ping_on_rotate: True
keep_jobs: 1
pillar_merge_lists: True
pillarenv_from_saltenv: True

fileserver_backend:
  - dynamic_roots

dynamic_roots_config: /srv/salt/configs/dynamic_roots_config.yaml
dynamic_pillar_config: /srv/salt/configs/dynamic_pillar_config.yaml

ext_pillar:
   - dynamic_pillar_roots: ~

top_file_merging_strategy: same
pillar_source_merging_strategy: none

module_dirs:
   - /srv/salt/extmods

