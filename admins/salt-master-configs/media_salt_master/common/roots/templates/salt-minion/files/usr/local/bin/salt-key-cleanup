#!/usr/bin/env python2

import os
import yaml

MINION_CONF="/etc/salt/minion.d/minion.conf"

if not os.path.exists(MINION_CONF):
    print("ERROR: minion config not found")
    os._exit(0)

with open(MINION_CONF) as conf_file:
    conf = yaml.load(conf_file)

for master in conf["master"]:
    try:
        resp = os.popen("echo clean-key|nc {0} 80".format(master))
        print("STATUS for: {0}\n\n{1}".format(master, resp.read()))
    except:
        import sys
        print("Exception {0[0].__name__}: {0[1]}!".format(sys.exc_info()))
