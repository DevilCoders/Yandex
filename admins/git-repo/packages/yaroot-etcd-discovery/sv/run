#!/bin/sh
ADDR="[$(hostname -i | egrep -o '[0-9a-f:]{8,}')]"
export ETCD_ADDR="$ADDR:4002"
export ETCD_PEER_ADDR="[::1]:7002"
export ETCD_NAME=$(hostname)
export ETCD_DATA_DIR=/var/lib/etcd/discovery
if ! id etcd; then
  useradd -d /var/lib/etcd -m -r etcd
fi
mkdir -p /var/lib/etcd/
chown etcd /var/lib/etcd/
cd /var/lib/etcd/
exec chpst -u etcd -U etcd /usr/lib/etcd/etcd -initial-cluster-state new -initial-cluster "$ETCD_NAME=http://$ETCD_PEER_ADDR" 2>&1
