upstream grng_upstream {
        server 37.140.131.111 max_fails=5 fail_timeout=1s;
        server 5.45.254.207 max_fails=5 fail_timeout=1s;
        server 77.88.10.15 max_fails=5 fail_timeout=1s;
        keepalive 32;
}

server {
#        listen 80;
#        listen 443;
include listen;
include listen_ssl;

        server_name gr-ng;
        location / {
                rewrite ^(.*) $scheme://gr-ng.yandex-team.ru$1 permanent;
        }
}

server {
#        listen 80;
#        listen 443;
include listen;
include listen_ssl;


        server_name  gr-ng.*;

        access_log /var/log/nginx/gr-ng.access.log main;

        location / {
                proxy_pass http://grng_upstream;
                proxy_set_header Host                   gr-ng.yandex-team.ru;
                proxy_set_header X-Real-IP              $remote_addr;
        }

        location /metric {
                proxy_pass http://grng_upstream;
                proxy_set_header Host                   graphite.gr.yandex.net;
                proxy_set_header X-Real-IP              $remote_addr;
                proxy_set_header Cookie                 "";
        }

        location /render {
                proxy_pass http://grng_upstream;
                proxy_set_header Host                   graphite.gr.yandex.net;
                proxy_set_header X-Real-IP              $remote_addr;
                proxy_set_header Cookie                 "";
        }

        location /content {
                proxy_pass http://grng_upstream;
                proxy_set_header Host                   graphite.gr.yandex.net;
                proxy_set_header X-Real-IP              $remote_addr;
                proxy_set_header Cookie                 "";
        }

}
