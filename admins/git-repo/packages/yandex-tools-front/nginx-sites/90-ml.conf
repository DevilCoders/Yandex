upstream ml-www {
#    server django-front01e5.tools.yandex.net max_fails=2 fail_timeout=60s;
#    server django-front02e5.tools.yandex.net max_fails=2 fail_timeout=60s;
#    server django-front01d.tools.yandex.net max_fails=2 fail_timeout=60s;
#    server django-front02d.tools.yandex.net max_fails=2 fail_timeout=60s;
#    server django-front01g.tools.yandex.net max_fails=2 fail_timeout=60s;
#    server django-front02g.tools.yandex.net max_fails=2 fail_timeout=60s;
     server localhost:8081;
}

server {
	listen 80;
	listen 443;
	server_name ml.yandex-team.ru;

	location / {
		proxy_connect_timeout   500ms;
		proxy_next_upstream timeout http_502;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header Host $host;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_pass http://ml-www;
		if ($scheme = https) {
		   set $SSL  on;
		   }
	}
}

server {
        listen 80;
        listen 443;

        server_name ml ml.* maillists.* ml.yandex.ru;

        rewrite ^(.*)$ $scheme://ml.yandex-team.ru$1 permanent;
}
