server {
	include listen;
	server_name xml.yandex.ru xml.yandex.com;
	server_name ~^xml\.[a-z0-9\-]+\.yandex\.ru$;
	server_name ~^xml\.[a-z0-9\-]+\.yandex\.com$;
	root /usr/local/www5/xmlsearch-user-new;
	index index.xml index.html;
	include fastcgi_params_yandex;
	include xscripts/default;
	rewrite ^/ip.xml /settings.xml permanent;
	rewrite ^/ip_set.xml$ /settings.xml permanent;
	rewrite ^/ip_set.xml\?(.*) /settings.xml?do=save&$1 permanent;
	rewrite ^/request_example.xml /test_query.xml permanent;
	rewrite ^/cgi(.*) http://xml.yandex.net/cgi$1 permanent;
}

server {
	include listen;
	server_name xml.yandex.net;
        server_name ~^xml\.[a-z0-9\-]+\.yandex\.net$;
	location /cgi {
		proxy_pass http://213.180.204.117:80;
		proxy_set_header Host xmlsearch-cgi.yandex.ru;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header X-Real-IP $remote_addr;

	}
	location / {
		rewrite / http://xml.yandex.ru permanent;
		return 404;
	}
}

