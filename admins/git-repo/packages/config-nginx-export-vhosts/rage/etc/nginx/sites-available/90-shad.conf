server {
	include listen;
	server_name ~^shad\.[a-z0-9\-]+\.yandex\.ru$;
	server_name yandex-school.ru shad.yandex.ru;
	root /usr/local/www5/shad;
	include fastcgi_params_yandex;
	include xscripts/default;
	rewrite ^/robots.txt$ /pages/robots.txt last;
	rewrite ^/(\?.*)?$ /pages/index/index.xml$1 last;
	rewrite ^/_(?:\w+)\.(js|css|\w+\.css)(\?.*)?$ /pages/index/_index.$1$2 last;
	rewrite ^/seniors/(\?.*)?$ /pages/seniors/seniors.xml$2 last;
	rewrite ^/seniors/practical/?$ /pages/practical/practical.xml last;
	rewrite ^/seniors/([^\/]+)/?(\?(.+))?$ /pages/senior/senior.xml?person last;
	rewrite ^/hidden/(mathematics|bioinformatics-bio|bioinformatics-math)/(\?(.*))?$ /pages/hidden/hidden.xml?type last;
	rewrite ^/hidden/(mathematics|bioinformatics-bio|bioinformatics-math)/save/(\?(.*))?$ /pages/save/save.xml?type last;
	rewrite ^/hidden/(mathematics|bioinformatics-bio|bioinformatics-math)/save/(success|error|failed)/(\?(.*))?$ /pages/save/save.xml?type last;
	rewrite ^/(([^/]+/)+([^/]+\.xml)?)(\?.*)?$ /pages/core/core.xml?page break;
	rewrite ^/(\w+)/_(?:\w+)\.(js|css|\w+\.css)(\?.*)?$ /pages/$1/_$1.$2$3 last;
	rewrite ^/([^?/.]+)(\?.*)?$ /$1/$2 permanent;
	rewrite ^/([^?]+/[^?/.]+)(\?.*)?$ /$1/$2 permanent;
}

