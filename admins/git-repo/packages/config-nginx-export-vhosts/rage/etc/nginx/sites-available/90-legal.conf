server {
	include listen;

	server_name	legal.yandex.ru		www.legal.yandex.ru;
	server_name	legal.yandex.com	www.legal.yandex.com;
	server_name	legal.yandex.com.tr	www.legal.yandex.com.tr;
	server_name	~^(www\.)?legal\.[a-z0-9\-]+\.yandex\.ru$;
	server_name	~^(www\.)?legal\.[a-z0-9\-]+\.yandex\.com$;
	server_name	~^(www\.)?legal\.[a-z0-9\-]+\.yandex\.com\.tr$;

	root /usr/local/www5/legal;
	
	include	locations/add-final-slash;
	include fastcgi_params_yandex;
	include xscripts/default;
	include locations/ycssjs;

	location ~* ^/css/.+\.css$ {}
	location ~* ^/js/.+\.js$ {}
	location ~* ^/freeze/ {}
	location /robots.txt {}
	location /favicon.ico {	return 404;	}
	location /i {
		root /usr/local/www5/legal/content;
	}
	location / {
		if ($arg_mode = xml) {		rewrite	^/(.*)	/xml.xml?path=$1&lang=$arg_lang?	last;	}
		if ($arg_mode = text) {		rewrite	^/(.*)	/text.xml?path=$1&lang=$arg_lang?	last;	}
		if ($arg_mode = html) {		rewrite	^/(.*)	/html.xml?path=$1&lang=$arg_lang?	last;	}
		if ($arg_mode = raw-html) {	rewrite	^/(.*)	/raw-html.xml?path=$1&lang=$arg_lang?	last;	}
		rewrite	^/(.*)$					/index.xml?path=$1			last;
	}
}

server {
	include listen;
	server_name	m.legal.yandex.ru;
	server_name	m.legal.yandex.com;
	server_name	m.legal.yandex.com.tr;
	server_name	~^m\.legal\.[a-z0-9\-]+\.yandex\.ru$;
	server_name	~^m\.legal\.[a-z0-9\-]+\.yandex\.com$;
	server_name	~^m\.legal\.[a-z0-9\-]+\.yandex\.com\.tr$;

	root /usr/local/www5/legal;

	include	locations/add-final-slash;
	include fastcgi_params_yandex;
	include xscripts/default;
	include locations/ycssjs;

	location ~* ^/css/.+\.css$ {}
	location ~* ^/js/.+\.js$ {}
	location ~* ^/freeze/ {}
	location /robots.txt {}
	location /favicon.ico {	return 404;	}
	location /i {
		root /usr/local/www5/legal/content;
	}
	location / {
		rewrite	^/(.*)					/html.xml?path=$1			last;
	}
}

