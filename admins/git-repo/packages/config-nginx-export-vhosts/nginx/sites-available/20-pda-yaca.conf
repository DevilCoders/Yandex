server {
    include listen_ssl;

#    server_name m.yaca.ssyrkin.user.daze.yandex.ru m.yaca.ssyrkin.user.daze.yandex.ua m.yaca.ssyrkin.user.daze.yandex.by m.yaca.ssyrkin.user.daze.yandex.kz;
#    server_name pda.yaca.ssyrkin.user.daze.yandex.ru pda.yaca.ssyrkin.user.daze.yandex.ua pda.yaca.ssyrkin.user.daze.yandex.by pda.yaca.ssyrkin.user.daze.yandex.kz;


    server_name m.yaca.yandex.ru m.yaca.yandex.ua m.yaca.yandex.by;
    server_name pda.yaca.yandex.ru pda.yaca.yandex.ua pda.yaca.yandex.by;
    server_name ~^(www\.)?m.yaca\.[a-z0-9\-]+\.yandex\.ru$;
    server_name ~^(www\.)?m.yaca\.[a-z0-9\-]+\.yandex\.ua$;
    server_name ~^(www\.)?m.yaca\.[a-z0-9\-]+\.yandex\.by$;
    server_name ~^(www\.)?m.yaca\.[a-z0-9\-]+\.yandex\.kz$;
    server_name ~^(www\.)?pda.yaca\.[a-z0-9\-]+\.yandex\.ru$;
    server_name ~^(www\.)?pda.yaca\.[a-z0-9\-]+\.yandex\.ua$;
    server_name ~^(www\.)?pda.yaca\.[a-z0-9\-]+\.yandex\.by$;
    server_name ~^(www\.)?pda.yaca\.[a-z0-9\-]+\.yandex\.kz$;

    include xscripts/yaca;
    include fastcgi_params_yandex;

    root /usr/local/www5/pda.yaca;

    if ($host ~* ^(www\.)?pda.yaca\.([a-z0-9\-]+\.)?yandex\.(by|ru|ua|kz)$) {
        return 301 https://m.yaca.$2yandex.$3$request_uri;
    }

    rewrite ^/yca(.*)$       /yca.xml$1;
    rewrite ^/platform(.*)$  /platform.xml$1;
    rewrite ^/phone(.*)$     /phone.xml$1;

    location ~* ^/(yca|platform|phone) {
        fastcgi_pass unix:/tmp/xscript-multiple/xscript-yaca.sock;
        include fastcgi_params_yandex;
        fastcgi_split_path_info ^(.+)\.xml(.*)$;
    }

#    error_log /var/log/nginx/error.log debug;
}

server {
#    server_name m.yaca.ssyrkin.user.daze.yandex.ru m.yaca.ssyrkin.user.daze.yandex.ua m.yaca.ssyrkin.user.daze.yandex.by m.yaca.ssyrkin.user.daze.yandex.kz
#    server_name pda.yaca.ssyrkin.user.daze.yandex.ru pda.yaca.ssyrkin.user.daze.yandex.ua pda.yaca.ssyrkin.user.daze.yandex.by pda.yaca.ssyrkin.user.daze.yandex.kz;

    server_name m.yaca.yandex.ru m.yaca.yandex.ua m.yaca.yandex.by;
    server_name pda.yaca.yandex.ru pda.yaca.yandex.ua pda.yaca.yandex.by;
    server_name ~^(www\.)?m.yaca\.[a-z0-9\-]+\.yandex\.ru$;
    server_name ~^(www\.)?m.yaca\.[a-z0-9\-]+\.yandex\.ua$;
    server_name ~^(www\.)?m.yaca\.[a-z0-9\-]+\.yandex\.by$;
    server_name ~^(www\.)?m.yaca\.[a-z0-9\-]+\.yandex\.kz$;
    server_name ~^(www\.)?pda.yaca\.[a-z0-9\-]+\.yandex\.ru$;
    server_name ~^(www\.)?pda.yaca\.[a-z0-9\-]+\.yandex\.ua$;
    server_name ~^(www\.)?pda.yaca\.[a-z0-9\-]+\.yandex\.by$;
    server_name ~^(www\.)?pda.yaca\.[a-z0-9\-]+\.yandex\.kz$;

    include listen;

    #add_header Strict-Transport-Security "max-age=60";
    if  ($host ~* ^(www\.)?pda.yaca\.([a-z0-9\-]+\.)?yandex\.(by|ru|ua|kz)$) {
        return 301 https://m.yaca.$2yandex.$3$request_uri;
    }

    location / {
        return 301 https://$host$request_uri;
    }

    #error_log /var/log/nginx/error.log debug;
}

