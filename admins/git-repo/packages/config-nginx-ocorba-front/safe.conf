upstream safe_upstream {
	 server localhost:8081;
}

server {
    listen 80;
    listen [::]:80;
    server_name safe.yandex.ru;
    server_name safe.yandex.ua;
    server_name safe.yandex.by;
    server_name safe.yandex.kz;
    server_name safe.yandex.com;
    server_name safe.yandex.com.tr;

    server_name ~^safe\.[a-z0-9\-]+\.yandex\.ru$;
    server_name ~^safe\.[a-z0-9\-]+\.yandex\.ua$;
    server_name ~^safe\.[a-z0-9\-]+\.yandex\.by$;
    server_name ~^safe\.[a-z0-9\-]+\.yandex\.kz$;
    server_name ~^safe\.[a-z0-9\-]+\.yandex\.com$;
    server_name ~^safe\.[a-z0-9\-]+\.yandex\.com\.tr$;


    access_log /var/log/nginx/access.log main;
    location ~/ {
        rewrite ^(.*)$ https://$http_host$1 permanent;
    }


#       location / {
#                proxy_pass http://safe_upstream;
#                proxy_read_timeout                      180s;
#                proxy_set_header Host                   $host;
#                proxy_set_header X-Real-IP              $remote_addr;
#                proxy_set_header X-Service                   safe;
#                proxy_set_header X-Forwarded-For              $remote_addr;
#        }



    }

server {
    include listen_ssl;
    server_name safe.yandex.ru;
    server_name safe.yandex.ua;
    server_name safe.yandex.by;
    server_name safe.yandex.kz;
    server_name safe.yandex.com;
    server_name safe.yandex.com.tr;

    server_name ~^safe\.[a-z0-9\-]+\.yandex\.ru$;
    server_name ~^safe\.[a-z0-9\-]+\.yandex\.ua$;
    server_name ~^safe\.[a-z0-9\-]+\.yandex\.by$;
    server_name ~^safe\.[a-z0-9\-]+\.yandex\.kz$;
    server_name ~^safe\.[a-z0-9\-]+\.yandex\.com$;
    server_name ~^safe\.[a-z0-9\-]+\.yandex\.com\.tr$;


    access_log /var/log/nginx/access.log main;

        location / {
                proxy_pass http://safe_upstream;
                proxy_read_timeout                      180s;
                proxy_set_header Host                   $host;
                proxy_set_header X-Real-IP              $remote_addr;
                proxy_set_header X-Service                   safe;
                proxy_set_header X-Forwarded-For              $remote_addr;

        }



    }

