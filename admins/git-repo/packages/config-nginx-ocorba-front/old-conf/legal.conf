upstream legal_upstream {
	 server localhost:8081;
}

server {
        server_name     legal.yandex.ru         www.legal.yandex.ru;
        server_name     legal.yandex.kz;
#         www.legal.yandex.kz;
        server_name     legal.yandex.ua         www.legal.yandex.ua;
        server_name     legal.yandex.by;
#         www.legal.yandex.by;
        server_name     legal.yandex.com        www.legal.yandex.com;
        server_name     legal.yandex.com.tr     www.legal.yandex.com.tr;
        server_name     ~^(www\.)?legal\.[a-z0-9\-]+\.yandex\.ru$;
        server_name     ~^(www\.)?legal\.[a-z0-9\-]+\.yandex\.kz$;
        server_name     ~^(www\.)?legal\.[a-z0-9\-]+\.yandex\.ua$;
        server_name     ~^(www\.)?legal\.[a-z0-9\-]+\.yandex\.by$;
        server_name     ~^(www\.)?legal\.[a-z0-9\-]+\.yandex\.com$;
        server_name     ~^(www\.)?legal\.[a-z0-9\-]+\.yandex\.com\.tr$;
        server_name     m.legal.yandex.ru;
#        server_name     m.legal.yandex.kz;
        server_name     m.legal.yandex.ua;
#        server_name     m.legal.yandex.by;
        server_name     m.legal.yandex.com;
        server_name     m.legal.yandex.com.tr;
        server_name     ~^m\.legal\.[a-z0-9\-]+\.yandex\.ru$;
        server_name     ~^m\.legal\.[a-z0-9\-]+\.yandex\.kz$;
        server_name     ~^m\.legal\.[a-z0-9\-]+\.yandex\.ua$;
        server_name     ~^m\.legal\.[a-z0-9\-]+\.yandex\.by$;
        server_name     ~^m\.legal\.[a-z0-9\-]+\.yandex\.com$;
        server_name     ~^m\.legal\.[a-z0-9\-]+\.yandex\.com\.tr$;

    access_log /var/log/nginx/access.log main;
    include listen_ssl;


#    location ~/ {
#        rewrite ^(.*)$ http://$http_host$1 permanent;
#    }
#proxy_pass http:
        location / {
                proxy_pass http://legal_upstream;
                proxy_read_timeout                      180s;
                proxy_set_header Host                   $host;
                proxy_set_header X-Real-IP              $remote_addr;
                proxy_set_header X-Service                   legal;
                proxy_set_header X-Forwarded-For              $remote_addr;

        }


}

server {
    listen 80;
    listen [::]:80;
        server_name     legal.yandex.ru         www.legal.yandex.ru;
        server_name     legal.yandex.kz;
#         www.legal.yandex.kz;
        server_name     legal.yandex.ua         www.legal.yandex.ua;
        server_name     legal.yandex.by;
#         www.legal.yandex.by;
        server_name     legal.yandex.com        www.legal.yandex.com;
        server_name     legal.yandex.com.tr     www.legal.yandex.com.tr;
        server_name     ~^(www\.)?legal\.[a-z0-9\-]+\.yandex\.ru$;
        server_name     ~^(www\.)?legal\.[a-z0-9\-]+\.yandex\.kz$;
        server_name     ~^(www\.)?legal\.[a-z0-9\-]+\.yandex\.ua$;
        server_name     ~^(www\.)?legal\.[a-z0-9\-]+\.yandex\.by$;
        server_name     ~^(www\.)?legal\.[a-z0-9\-]+\.yandex\.com$;
        server_name     ~^(www\.)?legal\.[a-z0-9\-]+\.yandex\.com\.tr$;
        server_name     m.legal.yandex.ru;
#        server_name     m.legal.yandex.kz;
        server_name     m.legal.yandex.ua;
#        server_name     m.legal.yandex.by;
        server_name     m.legal.yandex.com;
        server_name     m.legal.yandex.com.tr;
        server_name     ~^m\.legal\.[a-z0-9\-]+\.yandex\.ru$;
        server_name     ~^m\.legal\.[a-z0-9\-]+\.yandex\.kz$;
        server_name     ~^m\.legal\.[a-z0-9\-]+\.yandex\.ua$;
        server_name     ~^m\.legal\.[a-z0-9\-]+\.yandex\.by$;
        server_name     ~^m\.legal\.[a-z0-9\-]+\.yandex\.com$;
        server_name     ~^m\.legal\.[a-z0-9\-]+\.yandex\.com\.tr$;

    access_log /var/log/nginx/access.log main;

    location ~/ {
        rewrite ^(.*)$ https://$http_host$1 permanent;
    }

#        location / {
#                proxy_pass http://legal_upstream;
#                proxy_read_timeout                      180s;
#                proxy_set_header Host                   $host;
#                proxy_set_header X-Real-IP              $remote_addr;
#                proxy_set_header X-Service                   legal;
#                proxy_set_header X-Forwarded-For              $remote_addr;
#        }



    }

