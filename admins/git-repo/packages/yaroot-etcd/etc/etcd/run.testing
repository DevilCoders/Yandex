#!/bin/sh
ADDR="[$(hostname -i | egrep -o '[0-9a-f:]{8,}')]"
export ETCD_ADDR="$ADDR:4001"
export ETCD_PEER_ADDR="$ADDR:7001"
export ETCD_NAME=$(hostname)
export ETCD_DATA_DIR=/var/lib/etcd/data
if ! id etcd; then
  useradd -d /var/lib/etcd -m -r etcd
fi
mkdir -p /var/lib/etcd/
chown etcd /var/lib/etcd/
cd /var/lib/etcd/
exec chpst -u etcd -U etcd /usr/lib/etcd/etcd --initial-cluster "$ETCD_NAME=http://$ETCD_PEER_ADDR" --initial-cluster-state new 2>&1
