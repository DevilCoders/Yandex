# Debian lighttpd configuration file
# 

############ Options you really have to take care of ####################

## modules to load
# mod_access, mod_accesslog and mod_alias are loaded by default
# all other module should only be loaded if neccesary
# - saves some time
# - saves memory

server.modules              = ( 
            "mod_access",
            "mod_alias",
            "mod_accesslog",
            "mod_rewrite", 
            "mod_setenv",
	    "mod_fastcgi",
	    "mod_cgi",
            "mod_deflate", 
            "mod_redirect", 
#            "mod_setenv",
            "mod_compress",
            "mod_expire",
	    "mod_magnet",
	    "mod_proxy"
 )

server.core-files = "enable"

server.port = 80

$SERVER["socket"] == "0.0.0.0:443" {
	ssl.engine                  = "enable" 
	ssl.pemfile                 = "/etc/lighttpd-x5/keys/export_pdd_upics.pem" 
	ssl.ca-file                 = "/etc/lighttpd-x5/keys/export_pddimport.ca-bundle" 
}

server.username = "www-data"
server.groupname = "www-data"
server.document-root       = "/usr/local/www5/"
server.max-worker = 24
#server.max-keep-alive-requests = 0
server.max-fds = 40960

etag.use-inode = "disable"

$SERVER["socket"] == ":8080" {
	server.document-root = "/var/www"
}

$SERVER["socket"] == ":8079" {
	server.document-root = "/var/www"
}

#cgi.assign      = (
#	".cgi"  => ""
#)
		
#magnet.attract-physical-path-to = ( "/etc/lighttpd-x5/blocker.lua" )
	
# xslt access
$HTTP["remoteip"] != "87.250.250.0/24" {
	$HTTP["url"] =~ "\.xsl" {
		access.deny-all = "enable"
	}
	$HTTP["url"] =~ "^/cgi-bin/" {
		$HTTP["url"] !~ "^/cgi-bin/lingvo.pl" {
			access.deny-all = "enable"
		}
	}
}
#Xscript"
fastcgi.map-extensions = ( ".xhtml" => ".xml" )
fastcgi.server = (
	".xml" =>
	((
		"socket" => "/tmp/xscript-multiple/xscript-default.sock",
		"check-local" => "enable",
		"allow-x-send-file" => "enable"
	))
)							

## where to send error-messages to
#server.errorlog            = "/var/log/lighttpd-x5/error.log"
server.errorlog-use-syslog = "enable"

## files to check for if .../ is requested
index-file.names           = ( "index.xml", "index.html" )

#accesslog.filename         = "/var/log/lighttpd-x5/access.log"
accesslog.use-syslog    = "enable"
accesslog.format           = "%t %v %h \"%R\" %s \"%{Referer}i\" \"%{User-Agent}i\" \"%{Cookie}i\" %{hd}D"

server.pid-file            = "/var/run/lighttpd-x5.pid"
compress.cache-dir          = "/var/tmp/lighttpd/"
compress.filetype           = ("text/plain", "text/html","text/css","text/javascript","application/x-javascript")
#alias.url = ("___invalid___" => "___invalid___")

alias.url = (
        "___invalid___" => "___invalid___",
        "/404.xml" => "/usr/local/www5/common/404.xml",
        "/404tr.xml" => "/usr/local/www5/common/404tr.xml"
        )
$HTTP["host"] !~ "yandex\.com\.tr" {
    server.error-handler-404 = "/404.xml"
}
$HTTP["host"] =~ "yandex\.com\.tr" {
    server.error-handler-404 = "/404tr.xml"
}
server.errorfile-prefix = "/usr/local/www5/common/error-handlers/"

deflate.enabled = "enable"
#deflate.debug = "enable"
deflate.compression-level = 9
deflate.mem-level = 9
deflate.window-size = 15
deflate.min-compress-size = 200
deflate.work-block-size = 512
deflate.mimetypes = (
		"text/plain",
		"text/plain; charset=utf-8",
		"application/xml",
		"application/xml; charset=utf-8",
		"text/html",
		"text/plain; charset=utf8",
		"application/xml; charset=utf8",
		"text/xml; charset=utf-8",
		"text/xml",
		"application/x-javascript",
		"text/javascript;charset=utf-8",
		"text/xml; charset=windows-1251",
		"application/json;charset=utf-8",
		"text/x-cross-domain-policy",
		"text/javascript; charset=UTF-8",
		"application/json; charset=utf-8",
		"text/javascript; charset=utf-8",
		"application/rss+xml; charset=utf-8",
		"text/xml; charset=UTF-8",
		"application/rss+xml",
		"application/atom+xml; charset=utf-8",
		"text/javascript",
 		    )

include_shell "/usr/share/lighttpd/create-mime.assign.pl"
include_shell "/etc/lighttpd-x5/include-conf-enabled.pl"
