user www-data;                                                                                                               
worker_processes  3;
worker_rlimit_nofile 100000;                                                                                                 
                                                                                                                             
error_log /var/log/nginx/access.log crit;
pid        /var/run/nginx.pid;                                                                                               
                                                                                                                             
events {                                                                                                                     
    worker_connections  65536;                                                                                               
    multi_accept on;                                                                                                         
}                                                                                                                            
                                                                                                                             
http {                                                                                                                       
    include       /etc/nginx/mime.types;

log_format main  '[$time_local] $http_host $remote_addr "$request" $status "$http_referer" "$http_user_agent" "$http_cookie" $request_time $upstream_cache_status $bytes_sent'; 

    access_log  /var/log/nginx/forum.kinopoisk.ru-access.log main;

    client_header_timeout   10m;                                                                                                                             
    client_body_timeout 10m;                                                                                                                                 
    send_timeout        10m;                                                                                                                                 
    client_max_body_size 250m;

    connection_pool_size        2048;
    client_header_buffer_size   4k;
    large_client_header_buffers 1000 8k;
    request_pool_size       4k;
    log_not_found off;

    output_buffers  128 64k;
    postpone_output 1460;

    sendfile    off;
    tcp_nopush  on;
    tcp_nodelay on;

    keepalive_timeout   75 60;
    ignore_invalid_headers  on;
    proxy_buffers 8000 16k;

    gzip  off;

    server {
        listen 80;
        listen [::]:80;

        server_name  forum.kinopoisk.ru forum01h.kp.yandex.net;

        set_real_ip_from  87.250.235.37/32;
        set_real_ip_from  87.250.235.36/32;
        set_real_ip_from  37.9.72.2/32;
        set_real_ip_from  37.9.72.3/32;
        set_real_ip_from  2a02:6b8:0:1490:225:90ff:fe02:a5d4;
        set_real_ip_from  2a02:6b8:0:1490:225:90ff:fe02:8140;
        set_real_ip_from  2a02:6b8:0:c5c:226:18ff:fe94:3c8f;
        set_real_ip_from  2a02:6b8:0:c5c:226:18ff:fe2c:7880;
        real_ip_header    X-Forwarded-For;

        location / {
                proxy_set_header Host $http_host;
                proxy_intercept_errors off;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $remote_addr;
                proxy_pass http://127.0.0.1:8080;
}

        location ~*^.+\.(jpg|jpeg|gif|png|css|zip|tgz|gz|rar|bz2|doc|xls|exe|pdf|ppt|tar|wav|bmp|rtf|js)$
                {
            root  /home/www/forum.kinopoisk.ru/;
}
}

}
