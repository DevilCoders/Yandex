swagger: '2.0'
info:
   title: "Icecream agent API"
   description: "HTTP API for icecream agent"
   version: "1"
   contact:
     email: media-admin@yandex-team.ru
basePath: "/v1"
host: "{{ host }}"
consumes:
  - application/json
produces:
  - application/json
definitions:
  Volume:
    type: object
    description: representation of storages volume
    properties:
      name:
        type: string
        description: volume name
      path:
        type: string
        description: device path on host machine
      size:
        type: integer
        description: volume size in bytes
      container:
        type: string
        description: volume container name
  Storage:
    type: object
    description: representation of disk storage
    properties:
      name:
        type: string
        description: name of storage device
      type:
        type: string
        description: type of storage device
      size:
        type: integer
        description: size of storage in bytes
      free:
        type: integer
        description: free space on storage in bytes
      disks:
        type: string
        description: type of disks, may be hdd or ssd
      volumes:
        type: array
        description: storage volumes
        items:
          '$ref': '#/definitions/Volume'
  Dom0:
    type: object
    description: representation of dom0 machine
    required:
    - hostname
    properties:
      hostname:
        type: string
        description: hostname
      cpu:
        type: integer
        description: count of cpu
      memory:
        type: integer
        description: memory size in bytes
      storage:
        '$ref': '#/definitions/Storage'
      pool:
        type: string
        description: dom0 pool
paths:
  /resources:
    get:
      operationId: icecream_agent.api.v1.routes.resources
      description: get info about dom0 machine resources
      responses:
        200:
          description: OK
          schema:
            '$ref': '#/definitions/Dom0'
  /containers/{name}/volume:
    parameters:
      - name: name
        in: path
        description: container name
        required: true
        type: string
    get:
      operationId: icecream_agent.api.v1.routes.container_volume
      description: get info about container volume
      responses:
        200:
          description: OK
          schema:
            '$ref': '#/definitions/Volume'
  /containers/{name}/volume/size:
    parameters:
      - name: name
        in: path
        description: container name
        required: true
        type: string
    put:
      operationId: icecream_agent.api.v1.routes.container_volume_size
      description: change container volume size
      consumes:
        - text/plain
      produces:
        - text/plain
      parameters:
        - name: payload
          in: body
          description: new volume size
          required: true
          schema:
            type: integer
      responses:
        200:
          description: OK
          schema:
            type: integer
  /ping:
    get:
      operationId: icecream_agent.api.v1.routes.ping
      description: check if app is alive
      produces:
        - text/plain
      responses:
        200:
          description: return 200 OK if app is alive
