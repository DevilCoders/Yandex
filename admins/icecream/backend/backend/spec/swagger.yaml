swagger: '2.0'
info:
  title: LXD web api
  description: Container management API
  version: '1.0'
schemes:
  - https
basePath: /v1
produces:
  - application/json
paths:
  /physical:
    post:
      summary: Add new physical host
      description: |
        Add new physical host to icecream
      tags:
      - physicals
      parameters:
      - name: payload
        in: body
        description: physical fqdn
        required: true
        schema:
          $ref: '#/definitions/Physical'
      responses:
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
    put:
      summary: Update the state of a physical host
      description: |
        Update the state of a phycal on in icecream
      tags:
      - physicals
      parameters:
      - name: payload
        in: body
        description: physical fqdn
        required: true
        schema:
          $ref: '#/definitions/Physical'
      responses:
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
  /project:
    get:
      summary: Get information about project(s)
      responses:
        default:
          description: Error
          schema:
            $ref: '#/definitions/Error'
  /project/{project}:
    parameters:
      - name: project
        in: path
        description: project name
        required: true
        type: string
    get:
      tags:
        - project
      description: project info
      responses:
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
  /info:
    get:
      summary: Get information about container
      description: |
        Returns information about container
      tags:
        - info
      responses:
        200:
          description: info from hw host
          schema:
            $ref: '#/definitions/GlobalInfo'
        default:
          description: Error
          schema:
            $ref: '#/definitions/Error'
  /list:
    get:
      summary: Retrieve resources
      description: |
        Returns the resources â€” total and used.
      parameters:
        - name: fqdn
          in: query
          description: Information about hw host
          required: false
          type: string
      tags:
        - resources
      responses:
        200:
          description: The physical resource list
          schema:
            type: array
            items:
              $ref: '#/definitions/PhysicalHost'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
  /container:
    post:
      summary: Create a new container
      description: |
        Creates a new container in the LXD cloud.
      tags:
        - containers
      parameters:
        - name: payload
          in: body
          description: The new container fqdn
          required: true
          schema:
            $ref: '#/definitions/Container'
      responses:
        200:
          description: Container created
          schema:
            $ref: '#/definitions/ContainerCreationInfo'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
  /container/{fqdn}:
    parameters:
      - name: fqdn
        in: path
        description: container fqdn
        required: true
        type: string
    delete:
      tags:
        - container
      description: delete container
      responses:
        200:
          description: container deleted
          schema:
            type: object
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
    get:
      tags:
        - container
      description: container info
      responses:
        200:
          description: The container info
          schema:
            $ref: '#/definitions/ContainerCreationInfo'
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
    put:
      summary: change container param
      description: |
        change container param
      tags:
        - containers
      parameters:
        - name: payload
          in: body
          description: change container param
          required: true
          schema:
            $ref: '#/definitions/ContainerCreationInfo'
      responses:
        200:
          description: The container info
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
  /ping:
    get:
      description: Return 200 OK if app is alive
      produces:
        - text/plain
      responses:
        200:
          description: ping application
definitions:
  Physical:
    type: object
    properties:
      physical_fqdn:
        type: string
  PhysicalHost:
    type: object
    properties:
      fqdn:
        type: string
        description: The physical host fqdn
      cpu:
        type: integer
        description: Total CPU count
      ram:
        type: integer
        description: Total memory in bytes
      datacenter:
        type: string
        description: The datacenter name
      disksize:
        type: integer
        description: vgsize in bytes
      disktype:
        type: string
        description: The type of disks
      project:
        type: string
        description: The physical host project
      containers:
        type: array
        description: The container list
        items:
          $ref: '#/definitions/Container'
  Container:
    type: object
    properties:
      fqdn:
        type: string
        description: The container fqdn
      cpu:
        type: integer
        description: CPU usage count
      ram:
        type: integer
        description: Memory maximum usage
      project:
        type: string
        description: The project name
      image:
        type: string
        description: The creation image name
      profiles:
        type: array
        description: The profile list
        items:
          type: string
      datacenter:
        type: string
        description: The dc name
      status:
        type: string
        description: The container status
      physical_fqdn:
        type: string
        description: physical hostname
  ContainerCreationInfo:
    type: object
    properties:
      fqdn:
        type: string
        description: The container fqdn
      cpu:
        type: integer
        description: CPU usage count
      ram:
        type: integer
        description: Memory maximum usage
      project:
        type: string
        description: The project name
      image:
        type: string
        description: The creation image name
      network:
        type: string
        description: The container network
      status:
        type: string
        description: The container status
      migrate:
        type: string
        description: Invoke migration type for container
      physical_fqdn:
        type: string
        description: The physical host the container was created on
      target_fqdn:
        type: string
        description: The physical host to migrate container
      target_fs:
        type: string
        description: The physical container fs
  GlobalInfo:
    type: object
    properties:
      datacenters:
        type: array
        description: Datacenter list
        items:
          type: string
      images:
        type: array
        description: Image list
        items:
          type: string
      profiles:
        type: array
        description: Profile list without bootstrap
        items:
          type: string
      projects:
        type: array
        description: Project list
        items:
          type: string
  Error:
    type: object
    properties:
      status:
        type: integer
        format: int32
      message:
        type: string
