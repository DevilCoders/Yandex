---
name: music-qa-musfront_status
parsing:
  groups: [music_qa_musfront]
  metahost: music_qa_musfront
  DataFetcher:
    timetail_url: "/timetail?pattern=xfront-status&type=tskv&log_ts="
  HostFetcher:
    type: "rtc"
    geo: ["sas", "man", "vla"]
    BasicUrl: "http://nanny.yandex-team.ru/v2/services/%s/current_state/instances/"
aggregate:
  data:
    rtc.nginx:
      type: custom
      class: Multimetrics
      timings_is: _time
      factor: 1000
  senders:
    graphite:
      type: graphite
      cluster: media.music
    4xx: &cfg
      type: juggler
      Host: "music.qa.yandex.ru"
      Method: Juggler
      Aggregator: timed_more_than_limit_is_problem
      config: { type: metahost }
      checkname: 4xx
      description: 4xx
      aggregator_kwargs:
        nodata_mode: force_ok
        limits: [{day_start: 1, day_end: 7, time_start: 0, time_end: 23, crit: 146%, warn: 0}]
      CRIT: ["${rtc.nginx}['4xx']>30"]
    5xx:
      << : *cfg
      checkname: 5xx
      description: 5xx
      CRIT: ["${rtc.nginx}['5xx']>5"]
---
name: music-qa-musfront_xscript
parsing:
  groups: [music_qa_musfront]
  metahost: music_qa_musfront
  DataFetcher:
    logname: "xscript/default.log"
    timetail_url: "/timetail?pattern=xfront-xscript-status&log_ts="
  HostFetcher:
    type: "rtc"
    geo: ["sas", "man", "vla"]
    BasicUrl: "http://nanny.yandex-team.ru/v2/services/%s/current_state/instances/"
aggregate:
  data:
    rtc.xscript:
      type: custom
      class: Multimetrics
  senders:
    graphite:
      type: graphite
      cluster: media.music
    xscript:
      type: juggler
      Host: "music.qa.yandex.ru"
      Method: Juggler
      Aggregator: timed_more_than_limit_is_problem
      config: { type: metahost }
      checkname: xscript_err
      description: xscript_err
      flaps: { stable_time: 60, critical_time: 90 }
      aggregator_kwargs:
        nodata_mode: force_ok
        limits: [{day_start: 1, day_end: 7, time_start: 0, time_end: 23, crit: 146%, warn: 0}]
      CRIT: ["${rtc.xscript}['err']>2"]
---
name: music-qa-musfront_nodejs
parsing:
  groups: [music_qa_musfront]
  metahost: music_qa_musfront
  DataFetcher:
    logname: "node-init-cluster/yandex-music-re/yandex-music-nodejs.log"
    timetail_url: "/timetail?pattern=music-nodejs&type=mulcagate&log_ts="
  HostFetcher:
    type: "rtc"
    geo: ["sas", "man", "vla"]
    BasicUrl: "http://nanny.yandex-team.ru/v2/services/%s/current_state/instances/"
aggregate:
  data:
    rtc.nodejs:
      type: custom
      class: Multimetrics
      perHost: YES
  senders:
    graphite:
      type: graphite
      cluster: media.music
---
name: music-qa-musfront_ads_requests
parsing:
  groups: [music_qa_musfront]
  DataFetcher:
    timetail_url: "/timetail?pattern=music_ads_requests&type=tskv&log_ts="
  HostFetcher:
    type: "rtc"
    geo: ["sas", "man", "vla"]
    BasicUrl: "http://nanny.yandex-team.ru/v2/services/%s/current_state/instances/"
aggregate:
  data:
    rtc.requests:
      type: custom
      class: Multimetrics
      perHost: YES
  senders:
    graphite:
      type: graphite
      cluster: media.music
---
name: music_qa_musfront-msie-status
parsing:
  groups: [music_qa_musfront]
  metahost: music_qa_musfront
  DataFetcher:
    timetail_url: "/timetail?pattern=xfront-msie-status&type=tskv&log_ts="
  HostFetcher:
    type: "rtc"
    geo: ["sas", "man", "vla"]
    BasicUrl: "http://nanny.yandex-team.ru/v2/services/%s/current_state/instances/"
aggregate:
  data:
    rtc.msie:
      type: custom
      class: Multimetrics
      factor: 1000
      perHost: YES
  senders:
    graphite:
      type: graphite
      cluster: media.music
---
name: music_qa_musfront-non-msie-status
parsing:
  groups: [music_qa_musfront]
  metahost: music_qa_musfront
  DataFetcher:
    timetail_url: "/timetail?pattern=xfront-non-msie-status&type=tskv&log_ts="
  HostFetcher:
    type: "rtc"
    geo: ["sas", "man", "vla"]
    BasicUrl: "http://nanny.yandex-team.ru/v2/services/%s/current_state/instances/"
aggregate:
  data:
    rtc.non_msie:
      type: custom
      class: Multimetrics
      factor: 1000
      perHost: YES
  senders:
    graphite:
      type: graphite
      cluster: media.music
---
name: music_qa_musfront-stats
parsing:
  groups: [music_qa_musfront]
  metahost: music_qa_musfront
  DataFetcher:
    logname: "node-init-cluster/yandex-music-re/yandex-music-nodejs.log /var/log/node-init-cluster/yandex-music-re/yandex-music-nodejs.log.1"
    timetail_url: "/timetail?pattern=tskv-aggr&type=tskv&log_ts="
  HostFetcher:
    type: "rtc"
    geo: ["sas", "man", "vla"]
    BasicUrl: "http://nanny.yandex-team.ru/v2/services/%s/current_state/instances/"
aggregate:
  data:
    rtc.stats:
      type: custom
      class: Multimetrics
      factor: 1000
      perHost: YES
      timings_is: 'duration'
  senders:
    graphite:
      type: graphite
      cluster: media.music
---
name: music_qa_musfront-nginx
parsing:
  groups: [music_qa_musfront]
  metahost: music_qa_musfront
  DataFetcher:
    timetail_url: "/timetail?pattern=front-nginx&type=tskv&log_ts="
  HostFetcher:
    type: "rtc"
    geo: ["sas", "man", "vla"]
    BasicUrl: "http://nanny.yandex-team.ru/v2/services/%s/current_state/instances/"
aggregate:
  data:
    rtc.nginx:
      type: custom
      class: Multimetrics
      factor: 1000
      perHost: YES
      timings_is: 'duration'
  senders:
    graphite:
      type: graphite
      cluster: media.music
