# vim: sts=2 sw=2 ts=2 et
name: musfrontStableHaproxy
parsing:
  groups: [ music_stable_musfront, music_prestable_musfront ]
  metahost: music_stable_musfront
  DataFetcher:
    type: http
    uri: "/;csv"
    port: 9002
  HostFetcher:
    type: "rtc"
    geo: [ "sas", "man", "vla" ]
    BasicUrl: "http://nanny.yandex-team.ru/v2/services/%s/current_state/instances/"
aggregate:
  data:
    haproxy-slb:
      type: custom
      class: HaproxySlb
      perHost: YES
  senders:
    graphite:
      type: graphite
      cluster: media.music
---
name: haproxy_status_stable
parsing:
  groups: [ music_stable_musfront, music_prestable_musfront ]
  metahost: musfront-music-web
  DataFetcher:
    logname: "haproxy/haproxy-frontend.log haproxy/haproxy-frontend.log.1"
    timetail_url: "/timetail?pattern=haproxy_stats&type=tskv&log_ts="
  HostFetcher:
    type: "rtc"
    geo: [ "man", "sas", "vla" ]
    BasicUrl: "http://nanny.yandex-team.ru/v2/services/%s/current_state/instances/"
aggregate:
  data:
    status:
      type: custom
      class: Multimetrics
      perHost: YES
  senders:
    graphite:
      type: graphite
      cluster: media.music
    solomon:
      type: solomon
      cluster: prod
      project: music
      service: musfront_proxy.haproxy
---
name: haproxy_status_prestable
parsing:
  groups: [ music_prestable_musfront ]
  metahost: musfront-music-web
  DataFetcher:
    logname: "haproxy/haproxy-frontend.log haproxy/haproxy-frontend.log.1"
    timetail_url: "/timetail?pattern=haproxy_stats&type=tskv&log_ts="
  HostFetcher:
    type: "rtc"
    geo: [ "man", "sas", "vla" ]
    BasicUrl: "http://nanny.yandex-team.ru/v2/services/%s/current_state/instances/"
aggregate:
  data:
    status:
      type: custom
      class: Multimetrics
      perHost: YES
  senders:
    graphite:
      type: graphite
      cluster: media.music
    solomon:
      type: solomon
      cluster: prestable
      project: music
      service: musfront.haproxy
