---
name: music_prod_rworker_java
parsing:
  groups: [music-prod-rworker]
  DataFetcher:
    logname : "ichwill/music-worker/ichwill.log"
    timetail_url: "/timetail?&pattern=java&type=java&log_ts="
aggregate:
  data:
    java:
      type: custom
      class: Multimetrics
      perHost: YES
  senders:
    graphite:
      type: graphite
      cluster: media.music
    java_err:
      type: juggler
      namespace: music.combaine
      Host: "music-prod-rworker"
      notifications:
          - template_name: phone_escalation
            template_kwargs:
                delay: 900 # seconds
                logins:
                    - '@svc_musicbackend:music-infra'
                    - stepanar
                    - skacheev
                    - paulus
          - template_name: on_status_change
            template_kwargs:
                delay: 300 # seconds
                status:
                  - {from: OK, to: CRIT}
                  - {from: WARN, to: CRIT}
                method:
                    - telegram
                login:  [ya-music-monitoring]
      Aggregator: timed_more_than_limit_is_problem
      checkname: java_err
      description: java_err
      aggregator_kwargs:
        nodata_mode: force_ok
        limits: [{crit: 0,time_start: 2,time_end: 1,day_end: 7,day_start: 1}]
      CRIT: ["${java}['java_error']>2"]
