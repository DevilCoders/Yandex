parsing:
  groups: [disk_deploy_mpfs_stable]
  metahost: mpfs.deploy.disk.yandex.net
  DataFetcher:
    logname: "nginx/mpfs/tskv.log"
    timetail_url: "/timetail?pattern=mpfs_nginx_by_ycrid&type=tskv&log_ts="

aggregate:
  data:
    mpfs_nginx:
      type: "custom"
      class: "Multimetrics"
      factor: 1000
      perHost: NO
  senders:
    graphite:
      cluster: "media.disk"
      type: graphite

    juggler_mpfs_nginx_status_andr_5xx-507: &juggler-conf-devops-ycrid
      type: juggler
      namespace: disk-devops
      Host: "disk_deploy_mpfs_stable_devops_ycrids"
      notifications:
        - template_name: phone_escalation
          template_kwargs:
            on_success_next_call_delay: 120
            repeat: 100
            delay: 900
            logins:
                - robot-disk-java-mntr
                - shirankov
                - akinfold
                - kis8ya
                - sanya2013
                - yak-dmitriy
                - friendlyevil
                - c4et4uk
                - derovi
      Aggregator: logic_or
      tags:
        - disk_deploy_mpfs_stable_ycrid
      checkname: ycrid_andr_5xx-507
      description: mpfs_nginx_status_5xx-507 per ycrid
      aggregator_kwargs:
        nodata_mode: force_ok
      flaps: { stable_time: 120, critical_time: 180 }
      meta:
        urls:
          -
            title: Documentation
            url: >-
                https://wiki.yandex-team.ru/disk/mpfs/meps/mep-025/#diskdeploympfsstabledevopsycrids/ycridandr5xx-507
            type: wiki
      CRIT: [" (${mpfs_nginx}['andr.5xx'] - ${mpfs_nginx}['andr.507'])  > 24 "]
      config:
          type: metahost
    juggler_mpfs_nginx_status_dav_5xx-507:
      << : *juggler-conf-devops-ycrid
      checkname: ycrid_dav_5xx-507
      description: mpfs_nginx_status_5xx-507 per ycrid
      aggregator_kwargs:
        nodata_mode: force_ok
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" (${mpfs_nginx}['dav.5xx'] - ${mpfs_nginx}['dav.507'])  > 5 "]
      config:
          type: metahost
    juggler_mpfs_nginx_status_win_5xx-507:
      << : *juggler-conf-devops-ycrid
      checkname: ycrid_win_5xx-507
      description: mpfs_nginx_status_5xx-507 per ycrid
      aggregator_kwargs:
        nodata_mode: force_ok
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" (${mpfs_nginx}['win.5xx'] - ${mpfs_nginx}['win.507'])  > 15 "]
      config:
          type: metahost
    juggler_mpfs_nginx_status_ios_5xx-507:
      << : *juggler-conf-devops-ycrid
      checkname: ycrid_ios_5xx-507
      description: mpfs_nginx_status_5xx-507 per ycrid
      aggregator_kwargs:
        nodata_mode: force_ok
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" (${mpfs_nginx}['ios.5xx'] - ${mpfs_nginx}['ios.507'])  > 5 "]
      config:
          type: metahost
    juggler_mpfs_nginx_status_mac_5xx-507:
      << : *juggler-conf-devops-ycrid
      checkname: ycrid_mac_5xx-507
      description: mpfs_nginx_status_5xx-507 per ycrid
      aggregator_kwargs:
        nodata_mode: force_ok
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" (${mpfs_nginx}['mac.5xx'] - ${mpfs_nginx}['mac.507'])  > 5 "]
      config:
          type: metahost
    juggler_mpfs_nginx_status_web_5xx-507:
      << : *juggler-conf-devops-ycrid
      checkname: ycrid_web_5xx-507
      description: mpfs_nginx_status_5xx-507 per ycrid
      aggregator_kwargs:
        nodata_mode: force_ok
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" (${mpfs_nginx}['web.5xx'] - ${mpfs_nginx}['web.507'])  > 10 "]
      config:
          type: metahost
    juggler_mpfs_nginx_status_public_5xx-507:
      << : *juggler-conf-devops-ycrid
      checkname: ycrid_public_5xx-507
      description: mpfs_nginx_status_5xx-507 per ycrid
      aggregator_kwargs:
        nodata_mode: force_ok
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" (${mpfs_nginx}['public.5xx'] - ${mpfs_nginx}['public.507'])  > 3 "]
      config:
          type: metahost
    juggler_mpfs_nginx_status_rest_5xx-507:
      << : *juggler-conf-devops-ycrid
      checkname: ycrid_rest_5xx-507
      description: mpfs_nginx_status_5xx-507 per ycrid
      aggregator_kwargs:
        nodata_mode: force_ok
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" (${mpfs_nginx}['rest.5xx'] - ${mpfs_nginx}['rest.507'])  > 20 "]
      config:
          type: metahost
    juggler_mpfs_nginx_status_lnx_5xx-507:
      << : *juggler-conf-devops-ycrid
      checkname: ycrid_lnx_5xx-507
      description: mpfs_nginx_status_5xx-507 per ycrid
      aggregator_kwargs:
        nodata_mode: force_ok
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" (${mpfs_nginx}['lnx.5xx'] - ${mpfs_nginx}['lnx.507'])  > 3 "]
      config:
          type: metahost

    juggler_mpfs_nginx_status_andr_4xx-429:
      << : *juggler-conf-devops-ycrid
      checkname: ycrid_andr_4xx-429
      description: mpfs_nginx_status_4xx-429 per ycrid
      aggregator_kwargs:
        nodata_mode: force_ok
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" (${mpfs_nginx}['andr.4xx'] - ${mpfs_nginx}['andr.429'])  > 2500 "]
      config:

    juggler_mpfs_nginx_status_dav_4xx-429:
      << : *juggler-conf-devops-ycrid
      checkname: ycrid_dav_4xx-429
      description: mpfs_nginx_status_4xx-429 per ycrid
      aggregator_kwargs:
        nodata_mode: force_ok
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" (${mpfs_nginx}['dav.4xx'] - ${mpfs_nginx}['dav.429'])  > 800 "]
      config:
          type: metahost
    juggler_mpfs_nginx_status_win_4xx-429:
      << : *juggler-conf-devops-ycrid
      checkname: ycrid_win_4xx-429
      description: mpfs_nginx_status_4xx-429 per ycrid
      aggregator_kwargs:
        nodata_mode: force_ok
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" (${mpfs_nginx}['win.4xx'] - ${mpfs_nginx}['win.429'])  > 3500 "]
      config:
          type: metahost
    juggler_mpfs_nginx_status_ios_4xx-429:
      << : *juggler-conf-devops-ycrid
      checkname: ycrid_ios_4xx-429
      description: mpfs_nginx_status_4xx-429 per ycrid
      aggregator_kwargs:
        nodata_mode: force_ok
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" (${mpfs_nginx}['ios.4xx'] - ${mpfs_nginx}['ios.429'])  > 2500 "]
      config:
          type: metahost
    juggler_mpfs_nginx_status_mac_4xx-429:
      << : *juggler-conf-devops-ycrid
      checkname: ycrid_mac_4xx-429
      description: mpfs_nginx_status_4xx-429 per ycrid
      aggregator_kwargs:
        nodata_mode: force_ok
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" (${mpfs_nginx}['mac.4xx'] - ${mpfs_nginx}['mac.429'])  > 1000 "]
      config:
          type: metahost
    juggler_mpfs_nginx_status_web_4xx-429:
      << : *juggler-conf-devops-ycrid
      checkname: ycrid_web_4xx-429
      description: mpfs_nginx_status_4xx-429 per ycrid
      aggregator_kwargs:
        nodata_mode: force_ok
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" (${mpfs_nginx}['web.4xx'] - ${mpfs_nginx}['web.429'])  > 150 "]
      config:
          type: metahost
    juggler_mpfs_nginx_status_public_4xx-429:
      << : *juggler-conf-devops-ycrid
      checkname: ycrid_public_4xx-429
      description: mpfs_nginx_status_4xx-429 per ycrid
      aggregator_kwargs:
        nodata_mode: force_ok
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" (${mpfs_nginx}['public.4xx'] - ${mpfs_nginx}['public.429'])  > 100 "]
      config:
          type: metahost
    juggler_mpfs_nginx_status_rest_4xx-429:
      << : *juggler-conf-devops-ycrid
      checkname: ycrid_rest_4xx-429
      description: mpfs_nginx_status_4xx-429 per ycrid
      aggregator_kwargs:
        nodata_mode: force_ok
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" (${mpfs_nginx}['rest.4xx'] - ${mpfs_nginx}['rest.429'])  > 3000 "]
      config:
          type: metahost
    juggler_mpfs_nginx_status_lnx_4xx-429:
      << : *juggler-conf-devops-ycrid
      checkname: ycrid_lnx_4xx-429
      description: mpfs_nginx_status_4xx-429 per ycrid
      aggregator_kwargs:
        nodata_mode: force_ok
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" (${mpfs_nginx}['lnx.4xx'] - ${mpfs_nginx}['lnx.429'])  > 100 "]
      config:
          type: metahost

    juggler_mpfs_nginx_status_95_prc_per_ycrid:
      << : *juggler-conf-devops-ycrid
      plugin: picker
      checkname: mpfs_nginx_status_95_prc-picker
      tags:
        - disk_deploy_mpfs_stable_ycrid
        - timings
      config:
        type: metahost
        prefix: 95_perc_ycrid_
        query: "^(%a+).request_(timings).4$"
        limits:
          # default over9k to skip other clients
          default: 10000
          andr: 510
          dav: 660
          ios: 800
          lnx: 800
          mac: 760
          public: 500
          rest: 650
          web: 750
          win: 1000
      
    juggler_mpfs_nginx_status_andr_low_2xx:
      << : *juggler-conf-devops-ycrid
      notifications:
        - template_name: on_status_change
          description: СМС в полминуты
          template_kwargs:
              status:
                  - to: CRIT
                    from: OK
                  - to: OK
                    from: CRIT
                  - to: WARN
                    from: CRIT
                  - to: CRIT
                    from: WARN
              min_interval: 30
              login:
                - robot-disk-java-mntr
                - shirankov
                - akinfold
                - kis8ya
                - sanya2013
                - yak-dmitriy
                - friendlyevil
                - c4et4uk
                - derovi
              method:
                  - sms
      checkname: ycrid_andr_low_2xx
      description: mpfs_nginx_status_low_2xx per ycrid
      Aggregator: timed_more_than_limit_is_problem
      aggregator_kwargs:
        nodata_mode: force_ok
        limits:
          - 
            crit: 146%
            time_start: 22
            time_end: 09
            day_start: 1
            day_end: 5
          - 
            crit: 146%
            time_start: 2
            time_end: 1
            day_start: 6
            day_end: 7
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" ${mpfs_nginx}['andr.2xx']  < 4000 "]
      config:
          type: metahost

    juggler_mpfs_nginx_status_ios_low_2xx:
      << : *juggler-conf-devops-ycrid
      notifications:
        - template_name: on_status_change
          description: СМС в полминуты
          template_kwargs:
              status:
                  - to: CRIT
                    from: OK
                  - to: OK
                    from: CRIT
                  - to: WARN
                    from: CRIT
                  - to: CRIT
                    from: WARN
              min_interval: 30
              login:
                - robot-disk-java-mntr
                - shirankov
                - akinfold
                - kis8ya
                - sanya2013
                - yak-dmitriy
                - friendlyevil
                - c4et4uk
                - derovi
              method:
                  - sms
      checkname: ycrid_ios_low_2xx
      description: mpfs_nginx_status_low_2xx per ycrid
      Aggregator: timed_more_than_limit_is_problem
      aggregator_kwargs:
        nodata_mode: force_ok
        limits:
          - 
            crit: 146%
            time_start: 01
            time_end: 08
            day_start: 1
            day_end: 5
          - 
            crit: 146%
            time_start: 2
            time_end: 1
            day_start: 6
            day_end: 7
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" ${mpfs_nginx}['ios.2xx']  < 600 "]
      config:
          type: metahost

    juggler_mpfs_nginx_status_mac_low_2xx:
      << : *juggler-conf-devops-ycrid
      notifications:
        - template_name: on_status_change
          description: СМС в полминуты
          template_kwargs:
              status:
                  - to: CRIT
                    from: OK
                  - to: OK
                    from: CRIT
                  - to: WARN
                    from: CRIT
                  - to: CRIT
                    from: WARN
              min_interval: 30
              login:
                - robot-disk-java-mntr
                - shirankov
                - akinfold
                - kis8ya
                - sanya2013
                - yak-dmitriy
                - friendlyevil
                - c4et4uk
                - derovi
              method:
                  - sms
      checkname: ycrid_mac_low_2xx
      description: mpfs_nginx_status_low_2xx per ycrid
      Aggregator: timed_more_than_limit_is_problem
      aggregator_kwargs:
        nodata_mode: force_ok
        limits:
          - 
            crit: 146%
            time_start: 23
            time_end: 09
            day_start: 1
            day_end: 5
          - 
            crit: 146%
            time_start: 2
            time_end: 1
            day_start: 6
            day_end: 7
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" ${mpfs_nginx}['mac.2xx']  < 184 "]
      config:
          type: metahost

    juggler_mpfs_nginx_status_win_low_2xx:
      << : *juggler-conf-devops-ycrid
      notifications:
        - template_name: on_status_change
          description: СМС в полминуты
          template_kwargs:
              status:
                  - to: CRIT
                    from: OK
                  - to: OK
                    from: CRIT
                  - to: WARN
                    from: CRIT
                  - to: CRIT
                    from: WARN
              min_interval: 30
              login:
                - robot-disk-java-mntr
                - shirankov
                - akinfold
                - kis8ya
                - sanya2013
                - yak-dmitriy
                - friendlyevil
                - c4et4uk
                - derovi
              method:
                  - sms
      checkname: ycrid_win_low_2xx
      description: mpfs_nginx_status_low_2xx per ycrid
      Aggregator: timed_more_than_limit_is_problem
      aggregator_kwargs:
        nodata_mode: force_ok
        limits:
          - 
            crit: 146%
            time_start: 21
            time_end: 07
            day_start: 1
            day_end: 5
          - 
            crit: 146%
            time_start: 2
            time_end: 1
            day_start: 6
            day_end: 7
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" ${mpfs_nginx}['win.2xx']  < 1900 "]
      config:
          type: metahost

    juggler_mpfs_nginx_status_web_low_2xx:
      << : *juggler-conf-devops-ycrid
      notifications:
        - template_name: on_status_change
          description: СМС в полминуты
          template_kwargs:
              status:
                  - to: CRIT
                    from: OK
                  - to: OK
                    from: CRIT
                  - to: WARN
                    from: CRIT
                  - to: CRIT
                    from: WARN
              min_interval: 30
              login:
                - robot-disk-java-mntr
                - shirankov
                - akinfold
                - kis8ya
                - sanya2013
                - yak-dmitriy
                - friendlyevil
                - c4et4uk
                - derovi
              method:
                  - sms
      checkname: ycrid_web_low_2xx
      description: mpfs_nginx_status_low_2xx per ycrid
      Aggregator: timed_more_than_limit_is_problem
      aggregator_kwargs:
        nodata_mode: force_ok
        limits:
          - 
            crit: 146%
            time_start: 23
            time_end: 08
            day_start: 1
            day_end: 5
          - 
            crit: 146%
            time_start: 2
            time_end: 1
            day_start: 6
            day_end: 7
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" ${mpfs_nginx}['web.2xx']  < 800 "]
      config:
          type: metahost

    juggler_mpfs_nginx_status_public_low_2xx:
      << : *juggler-conf-devops-ycrid
      notifications:
        - template_name: on_status_change
          description: СМС в полминуты
          template_kwargs:
              status:
                  - to: CRIT
                    from: OK
                  - to: OK
                    from: CRIT
                  - to: WARN
                    from: CRIT
                  - to: CRIT
                    from: WARN
              min_interval: 30
              login:
                - robot-disk-java-mntr
                - shirankov
                - akinfold
                - kis8ya
                - sanya2013
                - yak-dmitriy
                - friendlyevil
                - c4et4uk
                - derovi
              method:
                  - sms
      checkname: ycrid_public_low_2xx
      description: mpfs_nginx_status_low_2xx per ycrid
      Aggregator: timed_more_than_limit_is_problem
      aggregator_kwargs:
        nodata_mode: force_ok
        limits:
          - 
            crit: 146%
            time_start: 23
            time_end: 9
            day_start: 1
            day_end: 5
          - 
            crit: 146%
            time_start: 2
            time_end: 1
            day_start: 6
            day_end: 7
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" ${mpfs_nginx}['public.2xx']  < 200 "]
      config:
          type: metahost

    juggler_mpfs_nginx_status_rest_low_2xx:
      << : *juggler-conf-devops-ycrid
      notifications:
        - template_name: on_status_change
          description: СМС в полминуты
          template_kwargs:
              status:
                  - to: CRIT
                    from: OK
                  - to: OK
                    from: CRIT
                  - to: WARN
                    from: CRIT
                  - to: CRIT
                    from: WARN
              min_interval: 30
              login:
                - robot-disk-java-mntr
                - shirankov
                - akinfold
                - kis8ya
                - sanya2013
                - yak-dmitriy
                - friendlyevil
                - c4et4uk
                - derovi
              method:
                  - sms
      checkname: ycrid_rest_low_2xx
      description: mpfs_nginx_status_low_2xx per ycrid
      Aggregator: timed_more_than_limit_is_problem
      aggregator_kwargs:
        nodata_mode: force_ok
        limits:
          - 
            crit: 146%
            time_start: 23
            time_end: 07
            day_start: 1
            day_end: 5
          - 
            crit: 146%
            time_start: 2
            time_end: 1
            day_start: 6
            day_end: 7
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" ${mpfs_nginx}['rest.2xx']  < 500 "]
      config:
          type: metahost

