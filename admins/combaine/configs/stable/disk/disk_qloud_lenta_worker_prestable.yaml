---
name: disk_qloud_lenta_worker_prestable-requests_http
parsing:
  groups: [disk_qa_lenta_worker]
  metahost: disk_qloud_lenta_worker_prestable
  DataFetcher: 
    logname: 'yandex/disk/lenta-worker-tskv.log'
    timetail_url: '/timetail?pattern=requests_http&type=java&timeout=60&log_ts='
  Combainer:
    MINIMUM_PERIOD: 60

aggregate:
  data:
    requests_http:
      type: "custom"
      class: "Multimetrics"

  senders:
    graphite:
      cluster: "media.disk"
      type: graphite
---
name: disk_qloud_lenta_worker_prestable-requests_pg
parsing:
  groups: [disk_qa_lenta_worker]
  metahost: disk_qloud_lenta_worker_prestable
  DataFetcher: 
    logname: 'yandex/disk/lenta-worker-tskv.log'
    timetail_url: '/timetail?pattern=requests_pg&type=java&timeout=60&log_ts='
  Combainer:
    MINIMUM_PERIOD: 60

aggregate:
  data:
    requests_pg:
      type: "custom"
      class: "Multimetrics"

  senders:
    graphite:
      cluster: "media.disk"
      type: graphite

---
name: disk_qloud_lenta_worker_prestable-worker_tasks
parsing:
  groups: [disk_qa_lenta_worker]
  metahost: disk_qloud_lenta_worker_prestable
  DataFetcher: 
    logname: 'yandex/disk/lenta-worker-tskv.log'
    timetail_url: '/timetail?pattern=worker_tasks&type=java&timeout=60&log_ts='
  Combainer:
    MINIMUM_PERIOD: 60

aggregate:
  data:
    worker_tasks:
      type: "custom"
      class: "Multimetrics"
      rps: no

  senders:
    graphite:
      cluster: "media.disk"
      type: graphite

    juggler_lenta_worker_task_total_fail: &juggler-conf
      type: juggler
      namespace: disk
      Host: "disk_qloud_lenta_worker_prestable"
      Method: Juggler
      Aggregator: logic_or
      checkname: lenta_worker_task_total_failed
      description: lenta_worker_task_total_failed
      aggregator_kwargs:
        nodata_mode: force_ok
      flaps: { stable_time: 120, critical_time: 180 }
      CRIT: [" ${worker_tasks}['total.failed'] > 400 "]
      tags:
        - not_production

    juggler_lenta_worker_task_deleteOrUpdateLentaBlock_failed:
      << : *juggler-conf
      checkname: lenta_worker_task_deleteOrUpdateLentaBlock_failed
      description: lenta_worker_task_deleteOrUpdateLentaBlock_failed
      CRIT: [" ${worker_tasks}['deleteOrUpdateLentaBlock.failed'] > 300 "]

    juggler_lenta_worker_task_deleteEmptyLentaBlock_failed:
      << : *juggler-conf
      checkname: lenta_worker_task_deleteEmptyLentaBlock_failed
      description: lenta_worker_task_deleteEmptyLentaBlock_failed
      CRIT: [" ${worker_tasks}['deleteEmptyLentaBlock.failed'] > 300 "]

    juggler_lenta_worker_task_setMemoriesBlock_failed:
      << : *juggler-conf
      checkname: lenta_worker_task_setMemoriesBlock_failed
      description: lenta_worker_task_setMemoriesBlock_failed
      CRIT: [" ${worker_tasks}['setMemoriesBlock.failed'] > 300 "]

    juggler_lenta_worker_task_findAndDeleteOrUpdateLentaBlocks_failed:
      << : *juggler-conf
      checkname: lenta_worker_task_findAndDeleteOrUpdateLentaBlocks_failed
      description: lenta_worker_task_findAndDeleteOrUpdateLentaBlocks_failed
      CRIT: [" ${worker_tasks}['findAndDeleteOrUpdateLentaBlocks.failed'] > 300 "]

    juggler_lenta_worker_task_unpinLentaBlock_failed:
      << : *juggler-conf
      checkname: lenta_worker_task_unpinLentaBlock_failed
      description: lenta_worker_task_unpinLentaBlock_failed
      CRIT: [" ${worker_tasks}['unpinLentaBlock.failed'] > 300 "]

    juggler_lenta_worker_task_cleanupLentaBlockCreatures_failed:
      << : *juggler-conf
      checkname: lenta_worker_task_cleanupLentaBlockCreatures_failed
      description: lenta_worker_task_cleanupLentaBlockCreatures_failed
      CRIT: [" ${worker_tasks}['cleanupLentaBlockCreatures.failed'] > 300 "]

    juggler_lenta_worker_task_remindPhotos_failed:
      << : *juggler-conf
      checkname: lenta_worker_task_remindPhotos_failed
      description: lenta_worker_task_remindPhotos_failed
      CRIT: [" ${worker_tasks}['remindPhotos.failed'] > 300 "]

    juggler_lenta_worker_task_mergeContentLentaBlocks_failed:
      << : *juggler-conf
      checkname: lenta_worker_task_mergeContentLentaBlocks_failed
      description: lenta_worker_task_mergeContentLentaBlocks_failed
      CRIT: [" ${worker_tasks}['mergeContentLentaBlocks.failed'] > 300 "]

    juggler_lenta_worker_task_updateAndUpOrDeleteLentaBlock_failed:
      << : *juggler-conf
      checkname: lenta_worker_task_updateAndUpOrDeleteLentaBlock_failed
      description: lenta_worker_task_updateAndUpOrDeleteLentaBlock_failed
      CRIT: [" ${worker_tasks}['updateAndUpOrDeleteLentaBlock.failed'] > 300 "]
