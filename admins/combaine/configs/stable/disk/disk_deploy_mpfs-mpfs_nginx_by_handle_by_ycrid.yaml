parsing:
  groups: [disk_deploy_mpfs_stable]
  metahost: mpfs.deploy.disk.yandex.net
  DataFetcher:
    logname: "nginx/mpfs/tskv.log"
    timetail_url: "/timetail?pattern=mpfs_nginx_by_handle_by_ycrid&type=tskv&log_ts="

aggregate:
  data:
    mpfs_nginx_by_handle:
      type: "custom"
      class: "Multimetrics"
      factor: 1000
  senders:
    graphite:
      cluster: "media.disk"
      type: graphite

# /json/public_info

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_public_info_5xx: &juggler-conf-devops
      type: juggler
      namespace: disk-devops
      Host: "disk_deploy_mpfs_stable_devops_public"
      notifications:
        - template_name: on_status_change
          description: СМС в полминуты
          template_kwargs:
              status:
                  - to: CRIT
                    from: OK
                  - to: OK
                    from: CRIT
                  - to: WARN
                    from: CRIT
                  - to: CRIT
                    from: WARN
              min_interval: 30
              login:
                - robot-disk-java-mntr
                - shirankov
                - akinfold
                - kis8ya
                - sanya2013
                - yak-dmitriy
                - friendlyevil
                - c4et4uk
                - derovi
              method:
                  - sms
      Aggregator: logic_or
      checkname: ycrid_public_by_handle_json_public_info_5xx
      description: ycrid_public_by_handle_json_public_info_5xx
      config:
          type: metahost
      aggregator_kwargs:
        nodata_mode: force_ok
      flaps: { stable_time: 200, critical_time: 600 }
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.public_info.5xx'] > 0.5 "]

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_public_info_4xx:
      << : *juggler-conf-devops
      checkname: ycrid_public_by_handle_json_public_info_4xx
      description: ycrid_public_by_handle_json_public_info_4xx
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.public_info.4xx'] > 40 "]

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_public_info_low_2xx:
      << : *juggler-conf-devops
      checkname: ycrid_public_by_handle_json_public_info_low_2xx
      description: ycrid_public_by_handle_json_public_info_low_2xx
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.public_info.2xx'] < 10 "]

# /json/user_feature_toggles

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_user_feature_toggles_5xx:
      << : *juggler-conf-devops
      checkname: ycrid_public_by_handle_json_user_feature_toggles_5xx
      description: ycrid_public_by_handle_json_user_feature_toggles_5xx
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.user_feature_toggles.5xx'] > 1 "]

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_user_feature_toggles_4xx:
      << : *juggler-conf-devops
      checkname: ycrid_public_by_handle_json_user_feature_toggles_4xx
      description: ycrid_public_by_handle_json_user_feature_toggles_4xx
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.user_feature_toggles.4xx'] > 20 "]

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_user_feature_toggles_low_2xx:
      << : *juggler-conf-devops
      checkname: ycrid_public_by_handle_json_user_feature_toggles_low_2xx
      description: ycrid_public_by_handle_json_user_feature_toggles_low_2xx
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.user_feature_toggles.2xx'] < 10 "]

# /json/public_list

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_public_list_5xx:
      << : *juggler-conf-devops
      checkname: ycrid_public_by_handle_json_public_list_5xx
      description: ycrid_public_by_handle_json_public_list_5xx
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.public_list.5xx'] > 0.5 "]

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_public_list_4xx:
      << : *juggler-conf-devops
      checkname: ycrid_public_by_handle_json_public_list_4xx
      description: ycrid_public_by_handle_json_public_list_4xx
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.public_list.4xx'] > 25 "]

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_public_list_low_2xx:
      << : *juggler-conf-devops
      checkname: ycrid_public_by_handle_json_public_list_low_2xx
      description: ycrid_public_by_handle_json_public_list_low_2xx
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.public_list.2xx'] < 2 "]

# /json/public_dir_size

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_public_dir_size_5xx:
      << : *juggler-conf-devops
      checkname: ycrid_public_by_handle_json_public_dir_size_5xx
      description: ycrid_public_by_handle_json_public_dir_size_5xx
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.public_dir_size.5xx'] > 0.5 "]

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_public_dir_size_4xx:
      << : *juggler-conf-devops
      checkname: ycrid_public_by_handle_json_public_dir_size_4xx
      description: ycrid_public_by_handle_json_public_dir_size_4xx
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.public_dir_size.4xx'] > 1 "]

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_public_dir_size_low_2xx:
      << : *juggler-conf-devops
      checkname: ycrid_public_by_handle_json_public_dir_size_low_2xx
      description: ycrid_public_by_handle_json_public_dir_size_low_2xx
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.public_dir_size.2xx'] < 1 "]

# /json/status

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_status_5xx:
      << : *juggler-conf-devops
      checkname: ycrid_public_by_handle_json_status_5xx
      description: ycrid_public_by_handle_json_status_5xx
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.status.5xx'] > 0.1 "]

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_status_4xx:
      << : *juggler-conf-devops
      checkname: ycrid_public_by_handle_json_status_4xx
      description: ycrid_public_by_handle_json_status_4xx
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.status.4xx'] > 0 "]

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_status_low_2xx:
      << : *juggler-conf-devops
      checkname: ycrid_public_by_handle_json_status_low_2xx
      description: ycrid_public_by_handle_json_status_low_2xx
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.status.2xx'] < 0.05 "]

# /json/async_public_copy

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_async_public_copy_5xx:
      << : *juggler-conf-devops
      checkname: ycrid_public_by_handle_json_async_public_copy_5xx
      description: ycrid_public_by_handle_json_async_public_copy_5xx
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.async_public_copy.5xx'] > 0.5 "]

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_async_public_copy_4xx:
      << : *juggler-conf-devops
      checkname: ycrid_public_by_handle_json_async_public_copy_4xx
      description: ycrid_public_by_handle_json_async_public_copy_4xx
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.async_public_copy.4xx'] > 3 "]

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_async_public_copy_low_2xx:
      << : *juggler-conf-devops
      checkname: ycrid_public_by_handle_json_async_public_copy_low_2xx
      description: ycrid_public_by_handle_json_async_public_copy_low_2xx
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.async_public_copy.2xx'] < 0.05 "]

# /json/user_check

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_user_check_5xx:
      << : *juggler-conf-devops
      checkname: ycrid_public_by_handle_json_user_check_5xx
      description: ycrid_public_by_handle_json_user_check_5xx
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.user_check.5xx'] > 0.1 "]

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_user_check_4xx:
      << : *juggler-conf-devops
      checkname: ycrid_public_by_handle_json_user_check_4xx
      description: ycrid_public_by_handle_json_user_check_4xx
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.user_check.4xx'] > 0 "]

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_user_check_low_2xx:
      << : *juggler-conf-devops
      checkname: ycrid_public_by_handle_json_user_check_low_2xx
      description: ycrid_public_by_handle_json_user_check_low_2xx
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.user_check.2xx'] < 0.05 "]

# /json/public_url

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_public_url_5xx:
      << : *juggler-conf-devops
      checkname: ycrid_public_by_handle_json_public_url_5xx
      description: ycrid_public_by_handle_json_public_url_5xx
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.public_url.5xx'] > 1 "]

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_public_url_4xx:
      << : *juggler-conf-devops
      checkname: ycrid_public_by_handle_json_public_url_4xx
      description: ycrid_public_by_handle_json_public_url_4xx
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.public_url.4xx'] > 4 "]

    juggler_mpfs_nginx_status_ycrid_public_by_handle_json_public_url_low_2xx:
      << : *juggler-conf-devops
      checkname: ycrid_public_by_handle_json_public_url_low_2xx
      description: ycrid_public_by_handle_json_public_url_low_2xx
      CRIT: [" ${mpfs_nginx_by_handle}['public.handles.json.public_url.2xx'] < 1 "]


