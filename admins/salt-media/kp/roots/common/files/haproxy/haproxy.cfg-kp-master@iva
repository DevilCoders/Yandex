global
        log 127.0.0.1 local0 notice
        maxconn 65535
        user haproxy
        group haproxy
        quiet
        stats socket /tmp/haproxy_stat

defaults
        log global
        mode tcp
        option clitcpka
        option srvtcpka
        retries 3
        maxconn 65535
        timeout connect 500
        timeout client 90000
        timeout server 90000
        balance leastconn

resolvers mydns
        parse-resolv-conf
        resolve_retries 3
        timeout resolve 1s
        timeout retry 1s
        hold other 30s
        hold refused 30s
        hold nx 30s
        hold timeout 30s
        hold valid 10s
        hold obsolete 30s

listen stats
        bind *:18888,:::18888
        mode http
        stats enable
        stats uri /

listen redis_16379
        bind :::16379 v4v6
        option allbackups
        option tcp-check
        tcp-check connect
        tcp-check send PING\r\n
        tcp-check expect rstring ^(\+OK|\+PONG|-NOAUTH)
        tcp-check send QUIT\r\n
        tcp-check expect string +OK
        server vla-w907c9dwhyazf7am.db.yandex.net vla-w907c9dwhyazf7am.db.yandex.net:6379 check port 6379 inter 1s fall 3 rise 5 on-marked-down shutdown-sessions
        server myt-jlm2nfczz2fva7y9.db.yandex.net myt-jlm2nfczz2fva7y9.db.yandex.net:6379 check port 6379 inter 1s fall 3 rise 5 on-marked-down shutdown-sessions backup
        server sas-eyyq5lmhlwlh3v2s.db.yandex.net sas-eyyq5lmhlwlh3v2s.db.yandex.net:6379 check port 6379 inter 1s fall 3 rise 5 on-marked-down shutdown-sessions backup
