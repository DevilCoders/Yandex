template t_kp_php_perfile {
    template("[$YEAR-$MONTH-$DAY $HOUR:$MIN:$SEC] $LEVEL: $MSGONLY\n");
    template_escape(no);
};

destination d_kp_php_perfile {
    file("/var/log/php/php-${1}.log"
        create_dirs(yes)
        dir_owner(www-data)
        dir_group(www-data)
        dir_perm(0755)
        owner(www-data)
        group(www-data)
        perm(0644)
        template(t_kp_php_perfile)
    );
};

filter f_kp_php_perfile {
    match(
        "^kinopoisk_([a-z_]+)"
        flags("store-matches")
        value("MSGONLY")
    );
};

log {
    source(s_all);
    filter(f_kp_php_perfile);
    destination(d_kp_php_perfile);
    flags(final);
};

