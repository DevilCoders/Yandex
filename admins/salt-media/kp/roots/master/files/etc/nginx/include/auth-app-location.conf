location = /auth-remote/ {
    internal;

    proxy_set_header Content-Length 0;
    proxy_set_header Content-Type "";
    proxy_set_header Content-Encoding "";
    proxy_set_header Accept "*/*";
    proxy_set_header Host "{{ pillar.hosts.auth_app }}";
    proxy_set_header X-Real-Host $host;

    # remove client's Connection header (usually "Connection: close")
    # to force enable keepalive nginx <-> auth
    proxy_set_header Connection "";
    proxy_http_version 1.1;

    # CADMIN-7496
    proxy_intercept_errors on;
    error_page 300 301 302 400 401 402 403 404 405 500 501 502 503 504 =200 @auth-remote-fallback;

    # CADMIN-7584
    proxy_connect_timeout 300ms;
    proxy_read_timeout 3s;

    proxy_pass https://upstream_auth_app/v1/auth/;
}
