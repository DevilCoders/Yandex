- group: CGROUP%kp-stable-db-sphinx
  tags:
    - conductor
    - mysql
  check_template: kp-db-slaves.yaml
  base: base.yaml
  checks:
    pt_kill:
      check_template: crit.yaml
    mysqld_watchdog:
    mysql_ping-4:
    mysql_replica-4:
      aggregator_kwargs:
        limits:
          - {day_start: 1,day_end: 5,time_start: 11,time_end: 19,warn: 0,crit: 30%}
          - {day_start: 6,day_end: 7,time_start: 11,time_end: 19,warn: 0,crit: 50%}
          - {day_start: 1,day_end: 7,time_start: 20,time_end: 10,warn: 0,crit: 50%}
      notifications:
          - template_name: phone_escalation
            template_kwargs:
                repeat: 2
                delay: 300
                logins:
                     - '@svc_sre_kinopoiskotttv:sre_kptvott'
                     - etruntaev
                     - coldmind
                     - gibzer
                     - sergeyv
                     - vyacheslav
                on_success_next_call_delay: 600
    mysql_connections-4:
    mysql_backup_data-4:
      aggregator_kwargs:
        limits:
          - {day_start: 1,day_end: 5,time_start: 11,time_end: 19,warn: 0,crit: 30%}
          - {day_start: 6,day_end: 7,time_start: 11,time_end: 19,warn: 0,crit: 50%}
          - {day_start: 1,day_end: 7,time_start: 20,time_end: 10,warn: 0,crit: 101%}
      notifications:
          - template_name: phone_escalation
            template_kwargs:
                repeat: 2
                delay: 300
                logins:
                     - '@svc_sre_kinopoiskotttv:sre_kptvott'
                     - etruntaev
                     - coldmind
                     - gibzer
                     - sergeyv
                     - vyacheslav
                on_success_next_call_delay: 600
    __jupy_merge_mode: skip

- group: CGROUP%kp-test-db-sphinx
  check_template: nonproduction.yaml
  checks:
    mysql_backup_data-4:
      aggregator_kwargs:
        limits:
          - {day_start: 1,day_end: 7,time_start: 0,time_end: 23, warn: 101%,crit: 101%}
