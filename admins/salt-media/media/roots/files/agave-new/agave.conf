upstream agave_upstream {
	server 127.0.0.1:3000 max_fails=1 fail_timeout=10s;
	server 127.0.0.1:3001 max_fails=1 fail_timeout=10s;
	server 127.0.0.1:3002 max_fails=1 fail_timeout=10s;
	server 127.0.0.1:3003 max_fails=1 fail_timeout=10s;
	server 127.0.0.1:3004 max_fails=1 fail_timeout=10s;
	server 127.0.0.1:3005 max_fails=1 fail_timeout=10s;
	server 127.0.0.1:3006 max_fails=1 fail_timeout=10s;
	server 127.0.0.1:3007 max_fails=1 fail_timeout=10s;
        server 127.0.0.1:3008 max_fails=1 fail_timeout=10s;
        server 127.0.0.1:3009 max_fails=1 fail_timeout=10s;
        server 127.0.0.1:3010 max_fails=1 fail_timeout=10s;
        server 127.0.0.1:3011 max_fails=1 fail_timeout=10s;
        server 127.0.0.1:3012 max_fails=1 fail_timeout=10s;
        server 127.0.0.1:3013 max_fails=1 fail_timeout=10s;
        server 127.0.0.1:3014 max_fails=1 fail_timeout=10s;
        server 127.0.0.1:3015 max_fails=1 fail_timeout=10s;
}


server {
    listen 80;
    listen [::]:80;

    server_name  agave.media-test.yandex-team.ru;

    location /ping {
        return 200;
    }

    location / {
        root /usr/lib/yandex/agavefield/public;
        proxy_set_header Host           $host;
        proxy_set_header  X-Real-IP  $remote_addr;

        if (-f $request_filename) {
            break;
        }
        if (!-f $request_filename) {
            proxy_pass http://agave_upstream;
        }
    }

    error_page   500 502 503 504  /500.html;
}
