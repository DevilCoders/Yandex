host: {{ host|default(group|replace("CGROUP%", "")) }}
namespace: tv
tags: {{_context.macro.add_env_tags_by_group(group, and_add=["sre"])}}
ttl: 120
refresh_time: 60
aggregator: timed_more_than_limit_is_problem
aggregator_kwargs:
    nodata_mode: force_ok
{% if 'backup' not in tags %}
    unreach_mode: force_ok
    unreach_service: [{check: ":UNREACHABLE"}]
{% endif %}
    {% if '-stable-' in group %}
    limits:
        - time_start: 11
          time_end: 19
          day_start: 1
          day_end: 5
          warn: 0
          crit: 35%
        - time_start: 11
          time_end: 19
          day_start: 6
          day_end: 7
          warn: 0
          crit: 101%
        - time_start: 20
          time_end: 10
          day_start: 1
          day_end: 7
          warn: 0
          crit: 101%
    {% else %}
    limits:
        - {day_start: 1,day_end: 5,time_start: 11,time_end: 19,warn: 0,crit: 101%}
        - {day_start: 6,day_end: 7,time_start: 11,time_end: 19,warn: 0,crit: 101%}
        - {day_start: 1,day_end: 7,time_start: 20,time_end: 10,warn: 0,crit: 101%}
    {% endif %}
notifications:
    - template_name: phone_escalation
      template_kwargs:
          repeat: 2
          delay: 300
          logins:
              - '@svc_sre_kinopoiskotttv:sre_kptvott'
              - etruntaev
              - coldmind
              - gibzer
              - sergeyv
              - vyacheslav
          on_success_next_call_delay: 300

