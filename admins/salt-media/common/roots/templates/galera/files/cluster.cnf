# generated by {{ slsname }}
[mysqld]

# Path to Galera library
wsrep_provider=/usr/lib/galera3/libgalera_smm.so

# Cluster connection URL contains IPs of node#1, node#2 and node#3

wsrep_cluster_address           = gcomm://{% for n in config.cluster_nodes %}{% if not loop.last %}{{n}}:{{config.wsrep_port}},{%else%}{{n}}:{{config.wsrep_port}}{%endif%}{%endfor%}

wsrep_provider_options          = "gmcast.listen_addr=tcp://[::]:{{config.wsrep_port}}; ist.recv_addr={{ me }};gcache.size=10G; gcache.recover=yes;"

wsrep_sst_donor			= {% for n in config.sst_donors %}{{n}},{% endfor %}

{%- if config.on_state_change is defined %}
wsrep_notify_cmd		= {{ config.on_state_change }}
{%- endif %}

# In order for Galera to work correctly binlog format should be ROW
binlog_format                   = ROW

# MyISAM storage engine has only experimental support
default_storage_engine          = InnoDB
innodb_locks_unsafe_for_binlog  = 1

# This changes how InnoDB autoincrement locks are managed and is a requirement for Galera
innodb_autoinc_lock_mode        = 2

# Enable GTID (https://dev.mysql.com/doc/refman/5.6/en/replication-options-gtids.html)
gtid_mode = on
log-slave-updates
enforce-gtid-consistency

wsrep_node_address              = "{{me}}"

# Cluster name
wsrep_cluster_name              = {{ cluster_name }}

# SST method
wsrep_sst_method                = xtrabackup-v2
wsrep_sst_receive_address       = {{me}}

#Authentication for SST method
wsrep_sst_auth                  = "{{config.wsrep_user}}:{{config.wsrep_password}}"

[sst]
# for ipv6
sockopt                         = ',pf=ipv6'
# increase SST speed
compressor='pigz'
decompressor='pigz -dc'

