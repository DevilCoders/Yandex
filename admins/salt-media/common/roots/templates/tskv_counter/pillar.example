tskv_counter:
  configs:
    '/etc/yandex/tskv_counter/tskv_counter.yaml': 'salt://templates/tskv_counter/files/etc/yandex/tskv_counter/tskv_counter.yaml.tmpl'
  local_gr:
    enabled: True
    package: 'yabs-graphite-sender'
    src: 'salt://templates/tskv_counter/files/usr/lib/yandex-graphite-checks/enabled/tskv_counter'
    tskv_config: '/etc/yandex/tskv_counter/tskv_counter.yaml'
    log: '/var/log/nginx/access.tskv.log /var/log/nginx/access.tskv.log.1'
    timetail_time: 60
    args:
      - '--no-timings'
    configs:
      tskv_counter:
        enabled: True
  local_monrun:
    enabled: True
    tskv_config: '/etc/yandex/tskv_counter/tskv_counter.yaml'
    log: '/var/log/nginx/access.tskv.log /var/log/nginx/access.tskv.log.1'
    timetail_time: 60
    args:
      - '--no-hands'
    mopts:
      - type: {{ salt['grains.get']('conductor:project').encode('utf8') }}
      - execution_interval: 60
      - execution_timeout: 50
    configs:
      nginx-50x:
        enabled: True
  global:
    metric_prefix: ''
    timings:
      - request_time
      - upstream_response_time
    monrun_hosts_filter:
      - ::1
      - 127.0.0.1
  types:
    common:
      fields:
        - request_time
        - status
    afisha_yandex_ru:
      fields:
        - status
        - upstream_response_time
      vhosts:
        - afisha.yandex.
      monrun:
        - status:
          - 50: 1
          - 499: 1
        - upstream_response_time:
          - 75: 200
          - 100: 2000
