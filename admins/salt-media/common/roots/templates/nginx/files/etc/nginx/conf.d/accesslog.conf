log_format main      '$remote_addr - $remote_user [$time_local] '
                     '"$request" $status $bytes_sent '
                     '"$http_referer" "$http_user_agent" '
                     '"$gzip_ratio"';

log_format download  '$remote_addr - $remote_user [$time_local] '
                     '"$request" $status $bytes_sent '
                     '"$http_referer" "$http_user_agent" '
                     '"$http_range" "$sent_http_content_range"';

log_format default  '[$time_local] $http_host $remote_addr '
                    '"$request" $status "$http_referer" '
                    '"$http_user_agent" "$http_cookie" '
                    '$request_time $upstream_cache_status '
                    '$bytes_sent "$upstream_addr" "$upstream_status" '
                    '"$upstream_response_time" "$request_id"';

{% if not log_params|default(False) -%}
tskv_log_format access-log-{{ salt['grains.get']('conductor:project').encode('utf8') }} "$request_time" "$upstream_addr" "$upstream_status" "$upstream_response_time" "$request_id" "$bytes_sent";
{%- else %}
{%- set lp = log_params %}

tskv_log_format {{ lp.name }} 'request_time=$request_time upstream_addr=$upstream_addr'
      ' upstream_cache_status=$upstream_cache_status upstream_status=$upstream_status'
      ' upstream_response_time=$upstream_response_time request_id=$request_id'
      ' scheme=$scheme bytes_sent=$bytes_sent args=$args ssl_session_id=$ssl_session_id'
      ' ssl_protocol=$ssl_protocol ssl_cipher=$ssl_cipher'
      ' ssl_handshake_time=$ssl_handshake_time{% if lp.custom_fields|d %} {{lp.custom_fields|join(" ")}}{%endif%}';

tskv_log {{ lp.access_log_dir|default('/var/log/nginx') }}/{{ lp.access_log_name|default('access.tskv.log') }} {{ lp.name }};
error_log {{ lp.error_log_dir|default('/var/log/nginx') }}/{{ lp.error_log_name|default('error.log') }} {{ lp.error_level|default('error') }};
{%- endif %}
