{%- set tskv = pillar['tskv']['name'] -%}
{%- set access_log_dir = pillar['tskv']['access_log_dir'] -%}
{%- set error_log_dir = pillar['tskv']['error_log_dir'] -%}
{%- set access_log_name = pillar['tskv']['access_log_name'] -%}
{%- set error_log_name = pillar['tskv']['error_log_name'] -%}
{%- set error_level = pillar['tskv']['error_level'] -%}
{%- set custom_fields = salt["pillar.get"]("tskv:custom_fields") -%}

tskv_log_format {{ tskv }} "request_time=$request_time upstream_addr=$upstream_addr upstream_cache_status=$upstream_cache_status upstream_status=$upstream_status upstream_response_time=$upstream_response_time request_id=$request_id scheme=$scheme bytes_sent=$bytes_sent args=$args ssl_session_id=$ssl_session_id ssl_protocol=$ssl_protocol ssl_cipher=$ssl_cipher ssl_handshake_time=$ssl_handshake_time{% if custom_fields %} {{ custom_fields|join(" ") }}{% endif %}";
tskv_log {{ access_log_dir|default('/var/log/nginx') }}/{{ access_log_name|default('tskv.log') }} {{ tskv }};
error_log {{ error_log_dir|default('/var/log/nginx') }}/{{ error_log_name|default('error.log') }} {{ error_level|default('error') }};
