server {
  listen          80;
  listen          [::]:80;
  listen          443 ssl;
  listen          [::]:443 ssl;

  server_name grad.yandex.net default_server;
  client_max_body_size  64M;
  keepalive_timeout 5;
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_set_header Host $http_host;
  proxy_redirect off;

  ssl_certificate_key "/etc/nginx/ssl/grad.yandex.net.key";
  ssl_certificate "/etc/nginx/ssl/grad.yandex.net.crt";

  location /nginx_status {
    stub_status;
    allow 127.0.0.1;
    deny all;
  }

  # slb
  location = /ping {
    proxy_pass http://127.0.0.1:18080;
  }

  # legacy
  location = /is_master {
    rewrite ^/is_master /ping last;
  }

  # solomon-proxy
  location /send {
    # to solomon-proxy
    proxy_pass http://127.0.0.1:18080;
  }

  # Everything is a 404
  location / {
    return 404;
  }
}

server {
  listen          80;
  listen          [::]:80;
  listen          443 ssl;
  listen          [::]:443 ssl;

  server_name ro.grad.yandex.net;
  client_max_body_size  64M;
  keepalive_timeout 5;
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_set_header Host $http_host;
  proxy_redirect off;

  ssl_certificate_key "/etc/nginx/ssl/grad.yandex.net.key";
  ssl_certificate "/etc/nginx/ssl/grad.yandex.net.crt";

  # to influx-proxy
  location /query {
    proxy_pass http://127.0.0.1:8001;
    proxy_set_header       X-Real-IP $remote_addr;
    proxy_set_header       X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # slb
  location = /ping {
    proxy_pass http://127.0.0.1:8001;
  }

  # Everything is a 404
  location / {
    return 404;
  }
}
