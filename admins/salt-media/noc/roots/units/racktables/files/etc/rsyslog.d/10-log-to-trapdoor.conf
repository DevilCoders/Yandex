# NOCDEV-1315, modified in NOCDEV-7682
auth,authpriv.*;lpr.info                                        @trapdoor.yandex.net:514

template(
  name="fwd-trapdoor"
  type="string"
  string="%TIMESTAMP% %HOSTNAME% %syslogtag%: %msg:::drop-last-lf%\n"
)

input(
  type="imfile"
  file="/var/log/nginx-access.log"
  tag="yandex/nginx/racktables"
  ruleset="to_trapdoor"
  PersistStateInterval="100"  # state file is written at least every time n file lines have been processed
)

ruleset(name="to_trapdoor") {
  action(type="omfwd" target="trapdoor.yandex.net" port="514" protocol="udp" template="fwd-trapdoor")
}
