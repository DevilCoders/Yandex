invapi:
  {%- if salt['file.directory_exists' ]('/usr/share/rtapi2rr/rtapi') %}
  command:  "php -d memory_limit=3072M rtapi/graphql.php"
  {%- else %}
  command:  "php -d memory_limit=3072M graphql.php"
  {%- endif %}
  statsd:
    service: invapi
    tags:
      _db: racktables
      api: invapi
      {%- if grains['yandex-environment'] != 'production' %}
      instance: invapi-{{grains['yandex-environment']}}
      _cluster: {{ grains['yandex-environment'] }}
      {%- else %}
      instance: invapi
      {%- endif %}
  listen: 0.0.0.0:8080
  idleTimeout: 10s
  poolConfig:
    numWorkers: 8
    allocateTimeout: 120s
    limits:
      max_worker_memory: 3072
      ttl: 30s
      idle_ttl: 0
      exec_ttl: 0
    watchdog:
      ping_timeout: 5s
      ping_interval: 1s
  accessLog:
    mode: production
    file_logger_options:
      log_output: /var/log/invapi/access.log
server:
  relay: pipes
rpc:
  listen: tcp://127.0.0.1:6003
logs:
  {%- if grains['yandex-environment'] != 'production' %}
  mode: development
  level: debug
  {%- else %}
  mode: production
  {%- endif %}
  encoding: console
syslog:
  tag: "invapi"
