{%- set pg_cmd = '/usr/bin/pg_ctlcluster ' + postgresql['version']|string + ' ' + postgresql['cluster'] -%}
node_id= {{ repmgr['node_id'] }}
node_name= {{ grains['fqdn'] }}
conninfo='host={{ grains['fqdn'] }} user={{ repmgr['user'] }} dbname=repmgr'
data_directory='/var/lib/postgresql/{{ postgresql['version'] }}/{{ postgresql['cluster'] }}/'
replication_type=physical

log_file='/var/log/repmgr/repmgr.log'
log_status_interval=60

pg_bindir='/usr/lib/postgresql/{{ postgresql['version'] }}/bin/'

use_primary_conninfo_password=false
ssh_options='-q -o ConnectTimeout=10'

failover=manual
promote_command='/usr/bin/repmgr -f /etc/repmgr.conf standby promote --log-to-file'
follow_command='/usr/bin/repmgr standby follow -f /etc/repmgr.conf --log-to-file --upstream-node-id=%n'

service_start_command = '{{ pg_cmd }} start'
service_stop_command =  '{{ pg_cmd }} stop'
service_restart_command = '{{ pg_cmd }} restart'
service_reload_command = '{{ pg_cmd }}reload'
