server {
	server_name tikaite.tst.ape.yandex.net;
	listen 80;
	listen [::]:80;

	#TVM2 service section
	tvm2_service_id 200;
	tvm2_keys_url "/keys?lib_version=2.0.5";

	location ~* ^/disk/([a-zA-Z0-9_-]+) {
		include include/tikaite_common.conf;
		proxy_set_header X-Cocaine-Service "tikaite-srw__v012";
		proxy_set_header X-Cocaine-Event "disk";
	}
	location ~* ^/(?<handle>[a-zA-Z0-9_-]+) {
		include include/tikaite_common.conf;
		proxy_set_header X-Cocaine-Service "tikaite-srw__v012";
		proxy_set_header X-Cocaine-Event "${handle}";
		proxy_set_header X-Srw-Namespace "disk";
		proxy_set_header X-Srw-Key-Type  "STID";
		proxy_set_header X-Srw-Key  $arg_stid;
	}
	location = /keys{
		internal;
		proxy_pass https://tvm-api.yandex.net/2/keys;
	}
}
server {
        server_name tikaite-fast-srw.tst.ape.yandex.net;
        listen 80;
        listen [::]:80;

	#TVM2 service section
        tvm2_service_id 200;
        tvm2_keys_url "/keys?lib_version=2.0.5";

	location ~* ^/disk/([a-zA-Z0-9_-]+) {
		include include/tikaite_common.conf;
		proxy_set_header X-Cocaine-Service "tikaite-fast-srw__v012";
		proxy_set_header X-Cocaine-Event "disk";
		proxy_set_header X-Srw-Namespace "disk";
		proxy_set_header X-Srw-Key-Type  "STID";
		proxy_set_header X-Srw-Key  $arg_stid;
	}
	location ~* ^/(?<handle>[a-zA-Z0-9_-]+) {
		include include/tikaite_common.conf;
		proxy_set_header X-Cocaine-Service "tikaite-fast-srw__v012";
		proxy_set_header X-Cocaine-Event "${handle}";
		proxy_set_header X-Srw-Namespace "disk";
		proxy_set_header X-Srw-Key-Type  "STID";
		proxy_set_header X-Srw-Key  $arg_stid;
	}
	location = /keys{
                internal;
                proxy_pass https://tvm-api.yandex.net/2/keys;
        }
}

server {
        server_name tikaite-ml.tst.ape.yandex.net;
        listen 80;
        listen [::]:80;

        #TVM2 service section
        tvm2_service_id 200;
        tvm2_keys_url "/keys?lib_version=2.0.5";

        location ~* ^/disk/([a-zA-Z0-9_-]+) {
                include include/tikaite_common.conf;
                proxy_set_header X-Cocaine-Service "tikaite-ml-srw__v012";
                proxy_set_header X-Cocaine-Event "disk";
                proxy_set_header X-Srw-Namespace "disk";
                proxy_set_header X-Srw-Key-Type  "STID";
                proxy_set_header X-Srw-Key  $arg_stid;
        }
        location ~* ^/(?<handle>[a-zA-Z0-9_-]+) {
                include include/tikaite_common.conf;
                proxy_set_header X-Cocaine-Service "tikaite-ml-srw__v012";
                proxy_set_header X-Cocaine-Event "${handle}";
                proxy_set_header X-Srw-Namespace "disk";
                proxy_set_header X-Srw-Key-Type  "STID";
                proxy_set_header X-Srw-Key  $arg_stid;
        }
        location = /keys{
                internal;
                proxy_pass https://tvm-api.yandex.net/2/keys;
        }
}
