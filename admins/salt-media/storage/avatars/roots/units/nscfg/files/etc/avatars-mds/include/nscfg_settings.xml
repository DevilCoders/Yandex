{%- set env = grains['yandex-environment'] -%}
{%- set fqdn = grains['conductor']['fqdn'] -%}
<nscfg>
    {%- if fqdn in ['proxy-mds01iva-avt.mdst.yandex.net'] %}
    <enabled>yes</enabled>
    <nscfg_host>https://nscfg.mdst.yandex.net:1443</nscfg_host>
    <request_path>/v1/all-settings/testing/</request_path>
    <request_qargs>mds-old-style=yes</request_qargs>
    <sign_secret>{{ pillar['yav']['nscfg-testing_all_settings_secret'] }}</sign_secret>
    {%- elif fqdn in ['proxy-mds01vla.avatars.yandex.net'] %}
    <enabled>yes</enabled>
    <nscfg_host>https://nscfg.mdst.yandex.net:1443</nscfg_host>
    <request_path>/v1/all-settings/prestable/</request_path>
    <request_qargs>mds-old-style=yes</request_qargs>
    <sign_secret>{{ pillar['yav']['nscfg-testing_all_settings_secret'] }}</sign_secret>
    <disable-balancer-ping>no</disable-balancer-ping>
    {%- elif fqdn in ['proxy-mds02sas.avatars.yandex.net'] %}
    <enabled>yes</enabled>
    <nscfg_host>https://nscfg.mdst.yandex.net:1443</nscfg_host>
    <request_path>/v1/all-settings/production/</request_path>
    <request_qargs>mds-old-style=yes</request_qargs>
    <sign_secret>{{ pillar['yav']['nscfg-testing_all_settings_secret'] }}</sign_secret>
    <disable-balancer-ping>no</disable-balancer-ping>
    {%- elif env in ['testing', 'prestable', 'production'] %}
    <enabled>yes</enabled>
    <nscfg_host>https://nscfg.mds.yandex.net:1443</nscfg_host>
    <request_path>/v1/all-settings/{{ env }}/</request_path>
    <request_qargs>mds-old-style=yes</request_qargs>
    <sign_secret>{{ pillar['yav']['nscfg-all_settings_secret'] }}</sign_secret>
    {%- endif %}
    <warning_time_sec>1200</warning_time_sec>
    <cache_path>/usr/share/libmastermind/settings.cache</cache_path>
    <update_interval_sec>60</update_interval_sec>
    <http_request_timeout_msec>15000</http_request_timeout_msec>
</nscfg>
