lua_shared_dict numeric_metrics 16M;
lua_shared_dict histogram_names 16M;
lua_shared_dict histogram_values 16M;
init_worker_by_lua_file include/worker.lua;
init_by_lua_file include/metric-funcs.lua;

server {
    listen 127.0.0.1:4444;
    listen [::1]:4444;

    location = /unistat {
        content_by_lua_block {
            ngx.say(cjson.encode(get_yasm_metrics()))
            increment_metric("stat_monitor_dmmm", 1)
        }
        log_by_lua_block {
            increment_metric("stat_system_dmmm", 1)
        }
    }
}
