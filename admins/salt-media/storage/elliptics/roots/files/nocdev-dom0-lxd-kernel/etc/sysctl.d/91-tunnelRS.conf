# отключаем rpf, бо в траффике асимметрия
net.ipv4.conf.default.rp_filter = 0
net.ipv4.conf.all.rp_filter = 0

# Есть основания думать, что этот блок морально устарел и в ядрах 3.Х маршрутизация для корректной работы декапсуляции не требуется
# Если при прочих равных не заработало - то имеет смысл ее таки включить.
## включаем маршрутизацию, бо она между локальными адресами есть
#net.ipv4.ip_forward = 1
#net.ipv4.conf.default.forwarding = 1
#net.ipv4.conf.all.forwarding = 1

# не принимаем icmp redirect, чтоб не портить свою маршрутизацию
net.ipv4.conf.all.accept_redirects = 0
# и не отправляем их - мы не роутер, а так, притворяемся
net.ipv4.conf.all.send_redirects = 0

# подстраиваем GC route-cache'а, чтоб не работал бесконечно (бо через туннель прилетают мильены сорс-адресов извне, и каждому запись в кэш)
net.ipv4.route.gc_elasticity = 8
net.ipv4.route.gc_interval = 60
net.ipv4.route.gc_min_interval = 0
net.ipv4.route.gc_min_interval_ms = 500
net.ipv4.route.gc_thresh = 3145728
net.ipv4.route.gc_timeout = 60

# ip6 requirements

# Есть основания думать, что этот блок морально устарел и в ядрах 3.Х маршрутизация для корректной работы декапсуляции не требуется
# Если при прочих равных не заработало - то имеет смысл ее таки включить.
## форвардинг на ip6
#net.ipv6.conf.all.forwarding = 1

# подстраиваем GC
net.ipv6.neigh.default.gc_thresh1 = 1024
net.ipv6.neigh.default.gc_thresh2 = 2048
net.ipv6.neigh.default.gc_thresh3 = 4096
# дефолт ну оооочень маленький и в него легко упираться, приподнимаем
net.ipv6.route.max_size = 32768

