{%- set env = grains['yandex-environment'] -%}
{
    "system_app": {
        "monitor_addr": ":4442",
        "max_header_bytes": 8388608,
        "read_header_timeout": 1,
        "health_check_timeout_msec": 1000
    },

    "logging": {
        "default": {
            "level": "error",
            "file_path": "logrotate+asyncskip:///var/log/s3/billing/main.log"
        },
        "filtered": [
            {
                "level": "info",
                "name": "billing.scheduler.access_log",
                "file_path": "logrotate+asyncskip:///var/log/s3/billing/access.log"
            },
            {
                "level": "debug",
                "name_prefix": "billing.scheduler",
                "file_path": "logrotate+async:///var/log/s3/billing/billing.log"
            },
            {
                "level": "error",
                "name": "billing.scheduler.pg.bad_values",
                "file_path": "logrotate+async:///var/log/s3/billing/bad_values.log"
            },
            {
                "level": "info",
                "name": "*.pg.queries",
                "file_path": "logrotate+asyncskip:///var/log/s3/billing/pg-access.log"
            },
            {
                "level": "info",
                "name": "*.sys_pgx",
                "file_path": "logrotate+asyncskip:///var/log/s3/billing/sysdb.log"
            }
        ]
    },

    "cron": {
        "tasks": [
            {
                "event_name": "UpdateTasks",
                "run_every": "10m",
                "run_immediate": true,
                "parallel_count": 1
            },
            {
                "event_name": "ProcessTasks",
                "run_every": "1h",
                "run_immediate": true,
                "parallel_count": 1
            }
        ]
    },

    "adapters": {
        "bucket_usage_reporter": "logbroker"
    },

    "billing": {
        "min_object_lifetime_days": 365,
        "calc_delay": "1h30m",
        "tasks_limit": 50
    },

    "logbroker": {
        "type": "file",
        "file": {
            "bucket_usage_report_filepath": "/var/log/s3/billing/report.log"
        },
        "bucket_usage_use_service_id": true
    }
}
