{%- set tvm_client_id = 2024891 -%}
{%- set tvm_secret = pillar['yav']['nscfg-testing_tvm_secret'] -%}
{%- set mongo_password = pillar['yav']['nscfg-testing_mongo_password'] -%}
{
    "metadata": {
        "url": "mongodb://nscfg-ng:{{ mongo_password }}@vla-yb2ipalyrt1tot3o.db.yandex.net:27018,sas-uvrctumr87ldflov.db.yandex.net:27018,vla-y8tst5zlv5qtte3m.db.yandex.net:27018/?replicaSet=rs01&authSource=mastermind_test_namespaces",
        "options": {
            "maxPoolSize": 100,
            "socketTimeoutMS": 10000,
            "connectTimeoutMS": 10000,
            "w": 2,
            "wtimeout": 10000
        },
        "namespaces": {
            "db": "mastermind_test_namespaces",
            "settings_collection": "nscfg_ng_test_settings",
            "meta_collection": "nscfg_ng_test_meta",
            "orders_collection": "nscfg_ng_test_orders"
        }
    },
    "zookeeper": {
        "hosts": "zk01man.mdst.yandex.net:2181,zk01myt.mdst.yandex.net:2181,zk01sas.mdst.yandex.net:2181",
        "lock_path_prefix": "/nscfg/locks/",
        "options": {
            "timeout": 3,
            "command_retry": {
                "max_tries": 10,
                "max_jitter": 0.0,
                "delay": 0.2,
                "backoff": 1
            }
        },
        "lock_acquire_timeout": 3
    },
    "unix_socket": "/var/run/nscfg-ng-test.sock",
    "unix_socket_permissions": "666",
    "settings_schema_path": "/etc/nscfg/settings_schema.json",
    "ui_schema_path": "/etc/nscfg/ui_schema.json",
    "mds_doc_path": "/etc/nscfg/mds_doc.yml",
    "avatars_doc_path": "/etc/nscfg/avatars_doc.yml",
    "auth": {
        "tvm": {
            "enable": true,
            "self_id": {{ tvm_client_id }},
            "secret": "{{ tvm_secret }}",
            "abc_api_id": 2012190,
            "allowed_users_ids": [2021185]
        },
        "admins": ["aikch", "jonny-k", "izhidkov", "arstotzkan", "kanst9", "shindo", "agodin", "mishik", "mukhintim", "sxep", "sareyu", "w100", "kirkharitonov", "sedr0", "mf49", "tumenbaev", "gemberg", "aleks5d"]
    },
    "yav": {
        "environment": "testing",
        "oauth_token": "{{ pillar['yav']['nscfg-robot-yav-oauth'] }}",
        "cache_path": "/var/cache/nscfg-server-ng-test/yav_cache",
        "secret_roles": [
            {"role": "OWNER", "abc_id": 32013, "abc_scope": "secrets_management"},
            {"role": "OWNER", "abc_id": 895, "abc_scope": "developer"},
            {"role": "OWNER", "abc_id": 895, "abc_scope": "administration"}
        ]
    },
    "ns_info_links_html_markup": "<a class=\"link link_theme_normal\" href=\"{link_template}\">{link_text}</a>",
    "ns_info_links":[
        {
            "description": "Dispencer link",
            "link_template": "https://dispenser.yandex-team.ru/db/projects/{abc_slug}",
            "link_text": "dispenser"
        },
        {
            "description": "Version in testing",
            "link_template": "https://yasm.yandex-team.ru/template/panel/avatars_mds/dashboard=nscfg;ns={ns_name};ctype=testing/",
            "link_text": "yasm testing"
        },
        {
            "description": "Version in prestable",
            "link_template": "https://yasm.yandex-team.ru/template/panel/avatars_mds/dashboard=nscfg;ns={ns_name};ctype=prestable/",
            "link_text": "yasm prestable"
        },
        {
            "description": "Version in production",
            "link_template": "https://yasm.yandex-team.ru/template/panel/avatars_mds/dashboard=nscfg;ns={ns_name};ctype=production/",
            "link_text": "yasm production"
        }
    ],
    "logging": {
        "version": 1,
        "disable_existing_loggers": false,
        "formatters": {
            "accesslog": {
                "format": "[%(asctime)s.%(msecs)03d] %(trace_id)s %(levelname)s %(remote_addr)s \"%(message)s\" %(status)s %(elapsed_time).3f",
                "datefmt": "%Y-%m-%d %H:%M:%S",
                "converter": "time.gtime"
            },
            "default": {
                "format": "[%(asctime)s.%(msecs)03d] %(levelname)s %(name)s: %(message)s",
                "datefmt": "%Y-%m-%d %H:%M:%S",
                "converter": "time.gtime"
            },
            "requests": {
                "format": "[%(asctime)s.%(msecs)03d] %(levelname)s %(name)s:%(trace_id)s: %(message)s",
                "datefmt": "%Y-%m-%d %H:%M:%S",
                "converter": "time.gtime"
            }
        },
        "handlers": {
            "accesslog_file": {
                "class": "logging.handlers.WatchedFileHandler",
                "formatter": "accesslog",
                "filename": "/var/log/nscfg-server-ng-test/access.log"
            },
            "defaultlog_file": {
                 "class": "logging.handlers.WatchedFileHandler",
                 "formatter": "default",
                 "filename": "/var/log/nscfg-server-ng-test/server.log"
            },
            "nscfglog_file": {
                 "class": "logging.handlers.WatchedFileHandler",
                 "formatter": "requests",
                 "filename": "/var/log/nscfg-server-ng-test/server.log"
            }
        },
        "root": {
            "level": "INFO",
            "handlers": ["defaultlog_file"]
        },
        "loggers": {
            "tornado.access": {
                "level": "INFO",
                "handlers": ["accesslog_file"],
                "propagate": false
            },
            "nscfg_server": {
                "level": "INFO",
                "handlers": ["nscfglog_file"],
                "propagate": false
            }
        }
    }
}
