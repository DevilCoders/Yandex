{%- set config = vars -%}
{
    "enable": {{ config.resizer.enable|lower }},
    "enable_logs_aggregator": {{ config.resizer.enable_logs_aggregator|lower }},
    "enable_load_analyzer": {{ config.resizer.enable_load_analyzer|lower }},
    "enable_cluster_topology_changer": {{ config.resizer.enable_cluster_topology_changer|lower }},
    "enable_new_expected_load_table_format": {{ config.resizer.enable_new_expected_load_table_format|lower }},

    "listen_port": 8082,
    "loop_delay": {{ config.resizer.loop_delay }},
    "yql_token": "{{ config.token }}",
    "yt_token": "{{ config.token }}",
    "log_path": "/var/log/mastermind/resizer.log",
    "log_level": "info",

    "zookeeper": {
        "class": "sync.kazoo_impl.ZkSyncManager",
        "host": "{{ config.zk.hosts }}",
        "timeout": {{ config.zk.timeout }}
    },

    "mongodb": {
        "url": "{{ config.mongo.mdb_url_template.format(user=config.mongo.mdb_user, password=config.mongo.mdb_password) }}",
        "options": {
            "connectTimeoutMS": 15000
        },
        "resizer": {
            "db": "{{ config.mongo.metadata_db_prefix }}_resizer"
        },
        "scheduler": {
            "db": "{{ config.mongo.metadata_db_prefix }}_scheduler"
        },
        "jobs": {
            "db": "{{ config.mongo.metadata_db_prefix }}_jobs"
        }
    },
    "collector": {
        "addresses": "{{ config.collector.addresses }}",
        "timeout": {{ config.collector.timeout }}
    },
    "yt": {
        "cluster": "hahn",

        "elliptics_logs_dir": "{{ config.resizer.yt.elliptics_logs_dir }}",
        "minutes_aggregated_load_dir": "//home/mds/mastermind-resizer/{{ config.resizer.yt.resizer_cluster }}/minutes_aggregated_load",
        "expected_load_dir": "//home/mds/mastermind-resizer/{{ config.resizer.yt.resizer_cluster }}/expected_load",
        "sensitive_predicted_load_dir": "//home/mds/mastermind-resizer/{{ config.resizer.yt.resizer_cluster }}/sensitive_predicted_load",
        "namespaces_storage_classes_predicted_load_dir": "//home/mds/mastermind-resizer/{{ config.resizer.yt.resizer_cluster }}/namespaces_storage_classes_predicted_load",
        "jobs_traceids_dir": "//home/mds/mastermind-resizer/{{ config.resizer.yt.resizer_cluster }}/jobs_traceids_dir",
        "groups_info_dir": "//home/mds/mastermind-resizer/{{ config.resizer.yt.resizer_cluster }}/groups_info"
    },
    "grpc": {
        "port": 8095,
        "pool_size": 3,
        "max_concurrent_rpcs": 10
    },
    "topology_changer": {
        "load_reserve": {{ config.resizer.topology_changer.load_reserve }},
        "disk_avg_util_read_estimate": {{ config.resizer.topology_changer.disk_avg_util_read_estimate }},
        "disk_avg_util_write_estimate": {{ config.resizer.topology_changer.disk_avg_util_write_estimate }},
        "replicas_reduce": {{ config.resizer.topology_changer.replicas_reduce | tojson() }},
        "lrc_convert": {{ config.resizer.topology_changer.lrc_convert | tojson() }}
    },
    "ns_settings": {
        "replicas_reduce": {{ config.resizer.replicas_reduce | tojson() }},
        "lrc_convert": {{ config.resizer.lrc_convert | tojson() }}
    }
}
