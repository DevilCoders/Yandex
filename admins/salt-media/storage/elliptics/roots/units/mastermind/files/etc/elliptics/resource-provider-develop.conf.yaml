{%- set config = vars -%}
metadata:
  url: "{{ config.mongo.mdb_url_template.format(user=config.mongo.mdb_user, password=config.mongo.mdb_password) }}"
  options:
    max_pool_size: 100
    socketTimeoutMS: 10000
    connectTimeoutMS: 10000
    w: 2
    wtimeout: 10000
  namespaces:
    db: "test_integration_resource_provider"

zookeeper:
  endpoints: "{{ config.zk.hosts }}"
  prefix: "/nscfg/folder_locks_test_integration/"
  options:
    timeout: 10
    command_retry:
      max_tries: 10

federation:
  allowed_to_set_host_federations:
    {%- for fed in config.inventory.allowed_to_set_host_federations %}
    - "{{ fed }}"
    {%- endfor %}
  fallback_federation_id: {{ config.federation | int }}

mastermind:
  endpoints: 'localhost:9010'
  request_timeout: 10

service_account:
  endpoint: "[::]:8666"
  mds_id: "defc2a34-1cd4-4c38-8f81-c96279c909c0"
  mds_min_space_gib: {{ config.resource_provider.min_space_gib }}
  avatars_id: "a859f2fb-8cb0-431f-acba-a2991555d920"
  avatars_min_space_gib: {{ config.resource_provider.min_space_gib }}
  gib_unit_key: "gibibytes"
  max_accounts_per_folder: 20
  max_list_batch_size: 1000
  ping_period: 3
  forbidden_to_move_quota_namespaces:
    - "disk"
    - "mail"

  tls:
    enable: true
    key_path: "/etc/yandex-certs/d.mdst.yandex.net.key"
    cert_path: "/etc/yandex-certs/d.mdst.yandex.net.pem"
  tvm:
    enable: true
    service_d_id: 2023015
    allowed_user_ids:
      # service D ticket
      - 2023015
      # self ticket for testing
      - 2028820
    self_id: 2028820
    tvm_secret_path: "/etc/nscfg/resource-provider-tvm-secret-develop"

stats_updater:
  update_period: 10

system:
  port: 8667

abcd:
  collect_enabled: true
  endpoint: "grpc.d.test.yandex-team.ru:8080"
  sleep_between_requests: 0.1
  collect_period: 3600
  reserved_folder_ids:
    - "df730c90-80ae-4d97-bfc6-880e4c1c19a7"
    - "7d019735-619f-468e-8229-35eb43741e5b"

logging:
  version: 1
  formatters:
    requestlog:
      format: "[%(asctime)s.%(msecs)03d] %(levelname)s %(trace_id)s %(method)s %(message)s"
      datefmt: "%Y-%m-%d %H:%M:%S"
      converter: "time.gtime"
    default:
      format: "[%(asctime)s.%(msecs)03d] %(levelname)s %(name)s: %(message)s"
      datefmt: "%Y-%m-%d %H:%M:%S"
      converter: "time.gtime"
  handlers:
    accesslog_file:
      class: "logging.handlers.WatchedFileHandler"
      formatter: "requestlog"
      filename: "/var/log/resource-provider-develop/access.log"
    defaultlog_file:
      class: "logging.handlers.WatchedFileHandler"
      formatter: "default"
      filename: "/var/log/resource-provider-develop/server.log"
    requestlog_file:
      class: "logging.handlers.WatchedFileHandler"
      formatter: "requestlog"
      filename: "/var/log/resource-provider-develop/server.log"
  root:
    handlers:
      - "defaultlog_file"
  loggers:
    resource_provider.access:
      level: "INFO"
      handlers:
        - "accesslog_file"
      propagate: false
    resource_provider.account_service:
      level: "INFO"
      handlers:
        - "requestlog_file"
      propagate: false
    resource_provider:
      level: "INFO"
      handlers:
        - "defaultlog_file"
      propagate: false
    mm.mongo:
      level: "DEBUG"
      handlers:
        - "defaultlog_file"
      propagate: false
    TVM:
      level: "INFO"
      handlers:
        - "defaultlog_file"
      propagate: false
