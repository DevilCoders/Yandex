{% set zookeeper = pillar.get('logshatter_zookeper') %}

{
    "http_server": {
        "port": 8383,
        "listen_address": "::1"
    },
    "zookeeper": {
        "hosts": {{ zookeeper | json }},
        "path_prefix": "/clickhouse-custom-metrics",
        "lock_name": "lock",
        "lock_wait_timeout_sec": null
    },
    "clickhouse": {
        "slb-host": "clickhouse.ape.yandex.net",
        "user": "reader",
        "password": "",
        "http_port": 8123
    },
    "metrics-queries": [
        {
            "metric": "clickhouse.cocaine_logs.cocaine_logs.lag_sec_aver_axxx",
            "query": "select toUnixTimestamp(now() - max(timestamp)) as lag from cocaine_logs.cocaine_logs where timestamp < toUnixTimestamp(now() + 1) and timestamp > toUnixTimestamp(now()) - 60 * 60 format CSV",
            "timeout_sec": 2
        }
    ]
}
