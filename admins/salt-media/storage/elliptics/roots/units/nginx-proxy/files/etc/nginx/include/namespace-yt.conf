location ~ ^/get-(devtools|diapositiva|direct-moderate-internal|shuttilka|video-[\w-]+|kinopoisk-archive|docker-registry|browser-tracing|radioatushka|video-ya-study-hr)/ {
    proxy_pass http://mediastorage;
    more_set_headers -s '200 206 404 401 500' "Access-Control-Allow-Origin: *";

    set $unistat_request_type "get";
    set $unistat_namespace $1;
}

location ~ ^/(delete|upload)-devtools/ {
    proxy_set_header X-MDS-SECURITY "{{ pillar['yav']['x_mds_security'] }}";
    client_max_body_size 500g;
    proxy_request_buffering off;
    proxy_read_timeout 7200s;
    proxy_send_timeout 600s;
    proxy_connect_timeout 300s;
    proxy_buffer_size           64k;
    proxy_buffers               16 32k;
    proxy_redirect              off;
    proxy_set_header X-Https-Request yes;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_pass http://mediastorage;

    set $unistat_request_type $1;
    set $unistat_namespace "devtools";
}

location ^~ /ping {
    proxy_pass http://mediastorage;

    set $unistat_request_type "ping";
}

location / {
    return 418;

    log_by_lua_block {
        increment_metric("stat_system_dmmm", 1)
    }
}
