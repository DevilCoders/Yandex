lua_package_path '/etc/nginx/include/?.lua;/usr/share/lua/5.1/?.lua;;';
lua_package_cpath '/usr/lib/x86_64-linux-gnu/lua/5.1/?.so;;';

{% if salt.pillar.get('nginx-proxy:lua:ssl_trusted_certificate', None) -%}
lua_ssl_trusted_certificate '{{ salt.pillar.get("nginx-proxy:lua:ssl_trusted_certificate") }}';
lua_ssl_verify_depth {{ salt.pillar.get("nginx-proxy:lua:ssl_verify_depth", 1) }};

{% endif -%}

init_by_lua_block {
    local function try_require(module)
      local status, lib = pcall(require, module)
      if (status) then
        return lib
      end

      return nil
    end

    try_require("s3.lib")
}
