if ($http_range ~* "bytes=.*") {
        set $range_flag "$http_range";
}

if ($http_range ~* "bytes=0\-$") {
        set $range_flag "";
}
proxy_set_header    Range   $http_range;
proxy_set_header    X-MDS-SECURITY  "{{ pillar['yav']['x_mds_security'] }}";
proxy_set_header    X-Request-Id    $request_id;

proxy_no_cache $range_flag;

proxy_pass http://mediastorage;
proxy_cache_use_stale error timeout invalid_header updating http_500 http_502 http_503 http_504 http_404;

set $never_use_bypass "";
proxy_cache_bypass $never_use_bypass;
proxy_cache_revalidate on;
