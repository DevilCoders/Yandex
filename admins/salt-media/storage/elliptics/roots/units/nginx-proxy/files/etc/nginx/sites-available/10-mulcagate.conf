server {
    listen 10010;
    listen [::]:10010 ipv6only=on;

    include include/proxy_options.conf;
    include include/proxy_parameters.conf;

    location = /ping {
        proxy_pass http://mediastorage/ping;
        set $unistat_request_type "ping";
    }

    location = /unistats {
        proxy_pass http://mediastorage/unistats;
    }

    location ^~ /gate/ {
        set $unistat_namespace "unknown";
        proxy_pass http://mediastorage/gate/;
    }

    header_filter_by_lua_block {
        increment_metric("stat_monitor_dmmm", 1)
    }
    set $unistat_cluster_type "mulcagate";
    log_by_lua_file /etc/nginx/include/metrics.lua;
}
