server {
	server_name registry.yandex.net;
	listen 141.8.146.189:80 default;
	listen [2a02:6b8:0:3400::189]:80 default;
	listen 141.8.146.189:443 ssl default backlog=16834;
	listen [2a02:6b8:0:3400::189]:443 ssl default ipv6only=on backlog=16834;

	ssl_certificate /etc/nginx/ssl/registry.yandex.net.pem;
	ssl_certificate_key /etc/nginx/ssl/registry.yandex.net.pem;

	ssl_client_certificate /etc/nginx/ssl/allCAs.pem;
	ssl_verify_client optional;
	ssl_verify_depth 3;

	location /v1 {
		return 404;
	}

	location /v2 {
		proxy_set_header	Host $http_host;
		proxy_http_version	1.1;
		proxy_set_header	Connection "";
		proxy_set_header	X-Real-IP       $remote_addr;
		proxy_set_header	X-Forwarded-For	$proxy_add_x_forwarded_for;
		proxy_set_header	X-Forwarded-Proto $scheme;
		proxy_pass		http://127.0.0.1:5000;
		proxy_send_timeout	3600s;
		proxy_read_timeout	3600s;
	}

	location /v2/sdc {
                proxy_set_header        Host $http_host;
                proxy_http_version      1.1;
                proxy_set_header        Connection "";
		proxy_set_header	X-Resolve-Redirect "True";
                proxy_set_header        X-Real-IP       $remote_addr;
                proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header        X-Forwarded-Proto $scheme;
                proxy_pass              http://127.0.0.1:5000;
                proxy_send_timeout      3600s;
                proxy_read_timeout      3600s;
        }

	location / {
		proxy_set_header	Host		$http_host;
		proxy_http_version	1.1;
		proxy_set_header	Connection	"";
		proxy_set_header	X-Real-IP	$remote_addr;
		proxy_pass		http://127.0.0.1:5000;
		proxy_send_timeout	3600s;
		proxy_read_timeout	3600s;
	}

	location = /ping {
		return 200;
		#rewrite ^/ping / break;
		#proxy_set_header	Host		$http_host;
		#proxy_http_version	1.1;
		#proxy_set_header	Connection	"";
		#proxy_set_header	X-Real-IP	$remote_addr;
		#proxy_pass		http://127.0.0.1:5000;
	}
}

