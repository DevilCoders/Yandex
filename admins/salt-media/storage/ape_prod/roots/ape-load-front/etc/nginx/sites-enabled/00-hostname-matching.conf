server {
	server_name ~^(?<appname>[a-zA-Z0-9-]+)\_(?<version>.+)\.front01h\.(dev|load)\.ape\.(yandex-team|yandex)\.(net|ru|tr|com\.tr|ua|com\.ua|kz|com\.kz|by|com\.by)$;
	listen 80;
	listen [::]:80 default;
	location / {
		proxy_pass http://cocaine-native;
		proxy_set_header Host $host;
		proxy_http_version 1.1;
		proxy_set_header Connection "";
		proxy_set_header        X-Request-Id    $request_id;
		proxy_set_header X-Real-IP $remote_addr;
		set $app "${appname}:${version}";
		if ($version ~ _v012) {
			set $app "${appname}__v012";
		}
		proxy_set_header X-Cocaine-Service "$app";
		proxy_set_header X-Cocaine-Event "http";
		proxy_read_timeout 30s;
		proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;
	}
}

