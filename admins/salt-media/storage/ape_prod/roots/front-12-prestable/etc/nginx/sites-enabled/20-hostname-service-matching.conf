server {
	server_name ~^front-int\.ape\.(yandex-team|yandex)\.(net|ru|tr|com\.tr|ua|com\.ua|kz|com\.kz|by|com\.by)$;
	listen 5.255.240.178:80;
	listen [2a02:6b8:0:3400::1:178]:80;
	location / {
		proxy_pass http://cocaine-http-proxy;
		proxy_set_header Host $host;
		proxy_http_version 1.1;
		proxy_set_header Connection "";
		proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Request-Id $request_id;
		proxy_read_timeout 1800s;
	}
}
server {
        server_name ~^(?<appname>[a-zA-Z0-9-]+)\_(?<version>.+)\.front-int\.ape\.(yandex-team|yandex)\.(net|ru|tr|com\.tr|ua|com\.ua|kz|com\.kz|by|com\.by)$;
	listen 5.255.240.178:80;
	listen [2a02:6b8:0:3400::1:178]:80;
        location / {
                proxy_pass http://cocaine-http-proxy;
                proxy_set_header Host $host;
                proxy_http_version 1.1;
                proxy_set_header Connection "";
                proxy_set_header X-Real-IP $remote_addr;
		set $app "${appname}:${version}";
		if ($version ~ _v012) {
			set $app "${appname}__v012";
		}
		proxy_set_header X-Cocaine-Service "$app";
                proxy_set_header X-Cocaine-Event "http";
                proxy_set_header X-Request-Id $request_id;
                proxy_read_timeout 1800s;
        }
}
