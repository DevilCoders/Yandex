server {
	include listen_xfront;
	server_name hava.yandex.com.tr;
	server_name ~^hava\.[a-z0-9]+\.yandex\.com\.tr$;

	root /usr/local/www5/weather;

	rewrite ^/data/(.*) /get/weather-embed/$1?embed=1 break;

	include fastcgi_params_yandex;
	include xscripts/weather;
#	include locations/404-xml;
#	include locations/robots-xscript-default;
#	include locations/rss-x-default;

	# allow access to i-helper__social
	location ~* \.html { }
	
	include locations/lego-xml-deny;
	include locations/weather/vuln-deny;
	location ~* \.txt {
		rewrite ^/robots.txt /robots.tr.txt last;
		}
	location = / {
		rewrite ^/$ /index.xml?page=brief; 
		}
	location /get {
		include /etc/nginx/locations/weather/elliptics_proxy_pass;
		}
	location ~* \.(bz2|gz|xml|csv|png|jpg|jpeg|gif|ico|css|js) { }

	location / {
		rewrite ^/([^/]+)/tune/?$ / permanent;
		rewrite ^/(([^/]+)/tune/?\?(.*)|^/([^/]+)/tune/?)$ / permanent;
		rewrite ^/static/perblock-informer([0-9])(_white)?/([0-9]+) http://umbrella-informer.yandex.net/$1$2/$3.png permanent;
		rewrite ^/i/(n?1?[0-9])\.png?$ http://i.yandex.st/weather/i/icons/$1.png permanent;
		rewrite ^/([^/]+)/detail(ed)?/?$ /$1/details/ permanent;
		rewrite ^/([^/]+)/[ck]limat/?$ /$1/climate/ permanent;
		rewrite ^/search.xml$ / permanent;
		rewrite ^/(detail|details|detailed|climate|climat|health|choose|informer|reception|климат|подробно|slice)/?$ /index.xml?page=$1 last;
		rewrite ^/([^?]+)/(choose|выбор)/?$ /router.xml?page=choose&geo-name=$1 last;
		rewrite ^/region/?$ /router.xml?page=region last;
		rewrite ^/region/([^/]+)/?$ /router.xml?page=region&id=$1 last;
		rewrite ^/about/?$ /help.xml?page=about? last;
		rewrite ^/agreement/?$ /help.xml?page=agreement? last;
		rewrite ^/informer.xml$ /informer/ permanent;
		rewrite ^/informer_tips.xml /informer/tips/ permanent;
		rewrite ^/([^?]+)/informers?/?$ /router.xml?page=informer&geo-name=$1? last;
		rewrite ^/informer/tips/?$ /help.xml?page=tips? last;
		rewrite ^/delivery/(-?[0-9]+)/?(\?.*)?$ /router.xml?page=delivery&deg=$1 last;
		rewrite ^/delivery/water/(-?[0-9]+)/?(\?.*)?$ /router.xml?page=delivery&deg=$1&wt=1 last;
		#rewrite ^/([^?]+)/(slice)/?$ /slice.xml?geo-name=$1 last;
		rewrite ^/search/?$ /router.xml?page=search last;
		rewrite ^/search/\?request=(.*)$ /router.xml?page=search?request=$1 last;
		rewrite ^/search/\?text=(.*)$ /router.xml?page=search?request=$1 last;
		rewrite ^/(.*?)/(details|подробно|detailed) /router.xml?geo-name=$1&page=forecast&widget=detailed? last;
		rewrite ^/(.*?)/(climate|климат)/? /router.xml?geo-name=$1&page=forecast&widget=climate? last;
		rewrite ^/(.*?)/hourly /router.xml?geo-name=$1&page=forecast&widget=hourly? last;
		rewrite ^/(.*?)(/(brief)?)?/?$ /router.xml?geo-name=$1&page=forecast&widget=brief? last;
		rewrite ^/(([^?/]+/)*?[^?/]+)/?$ /router.xml?geo-name=$1 last;
		}
}
