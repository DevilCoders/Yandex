server {
    include /etc/nginx/listen;
    include listen_ssl;
    
    ssl_certificate /etc/nginx/ssl/kino.yandex.ru.cer;
    ssl_certificate_key /etc/nginx/ssl/kino.yandex.ru.pem;

    ssl_prefer_server_ciphers on;
    ssl_protocols TLSv1 SSLv3;
    ssl_ciphers !aNULL:!LOW:!MD5:!EXP:RC4:CAMELLIA:AES128:3DES:SEED:AES256;

    include /etc/nginx/locations/404-any;

    server_name ~^(www\.)?(beta\.)?kino.yandex.(ru|by|ua|kz|com)$;
    server_name kino-front.content.yandex.net;
    server_name kino.target120g.load.yandex.net kino.front01g.load.content.yandex.ru;
    server_name ~^kino\.front.?.?.?\.((tst|load)\.)?content\.yandex\.(ru|com|net|ua|by|kz|com\.ua|com\.tr)$;

    proxy_read_timeout 10;
    proxy_connect_timeout 10;

    #see https://lego.yandex-team.ru/desktop/common/blocks/i-social
    location /lego/blocks-desktop/i-social/closer/i-social__closer.html {
        root /usr/local/www5/kino;
    }

    #robots.txt
    location /robots.txt {
        root /usr/local/www5/kino;
    }

    #sitemap
    location /sitemap {
        root /usr/local/www5/kino;
    }

    error_page 503 /500.html;
    error_page 500 /500.html;

    #403
    rewrite ^/403.html $scheme://yandex.ru permanent;

    location ~* /500.html {
        root /usr/local/www/common/error-handlers/;
    }

    location /403.html {
        rewrite ^(.*)$ $scheme://yandex.ru permanent;
    }

    location / {
        if ($host ~* ^(www\.)?(kino\.(yandex|ya)\.(ru|by|ua|kz|com))$ ) {
            rewrite ^(.*)$ $scheme://beta.kino.yandex.ru permanent;
        }

        error_page 403 = /403.html;
        error_page 404 @404;

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_set_header X-NginX-Proxy true;

        proxy_pass http://unix:/tmp/kino-ui.sock:$request_uri;

        proxy_intercept_errors on;
        proxy_redirect off;
    }

    allow fdef::1;
    allow 10.0.0.1;
    allow 84.201.166.216;
    allow 5.45.207.128/25;
    allow 5.45.212.0/27;
    allow 5.45.212.64/26;
    allow 5.45.214.0/27;
    allow 5.45.215.64/26;
    allow 5.45.242.0/24;
    allow 5.255.201.32/27;
    allow 37.9.64.64/26;
    allow 37.9.64.192/26;
    allow 37.9.66.0/26;
    allow 37.9.66.160/27;
    allow 37.9.67.176/28;
    allow 37.9.74.64/27;
    allow 37.9.75.96/27;
    allow 37.140.169.0/24;
    allow 37.140.172.0/24;
    allow 37.140.173.80/28;
    allow 37.140.173.128/28;
    allow 37.140.175.0/24;
    allow 77.88.2.0/23;
    allow 77.88.4.0/24;
    allow 77.88.13.0/25;
    allow 77.88.13.160/27;
    allow 77.88.16.224/27;
    allow 77.88.45.32/27;
    allow 77.88.45.128/26;
    allow 84.201.129.32/27;
    allow 84.201.144.0/24;
    allow 84.201.150.0/23;
    allow 84.201.157.64/27;
    allow 84.201.157.160/27;
    allow 84.201.164.0/23;
    allow 84.201.166.0/23;
    allow 84.201.168.0/23;
    allow 84.201.172.128/26;
    allow 84.201.172.192/26;
    allow 84.201.173.0/24;
    allow 84.201.174.0/26;
    allow 84.201.174.64/27;    
    allow 84.201.174.160/27;
    allow 84.201.175.0/24;
    allow 87.250.227.0/27;
    allow 87.250.227.32/27;
    allow 87.250.227.128/30;
    allow 87.250.227.144/28;
    allow 87.250.227.160/28;
    allow 87.250.227.176/28;
    allow 87.250.227.208/28;
    allow 87.250.240.64/26;
    allow 87.250.240.128/25;
    allow 87.250.248.0/24;
    allow 93.158.136.0/27;
    allow 93.158.154.0/24;
    allow 93.158.159.0/24;
    allow 95.108.132.32/27;
    allow 95.108.168.0/28;
    allow 95.108.168.96/27;
    allow 95.108.170.0/24;
    allow 95.108.171.0/25;
    allow 95.108.171.128/25;
    allow 95.108.172.0/22;
    allow 95.108.176.96/27;
    allow 95.108.176.128/26;
    allow 95.108.177.0/24;
    allow 95.108.178.0/26;
    allow 95.108.178.64/26;
    allow 95.108.193.0/24;
    allow 95.108.197.32/27;
    allow 95.108.199.64/26;
    allow 95.108.225.192/27;
    allow 95.108.238.0/23;
    allow 100.43.78.16/28;
    allow 100.43.78.192/26;
    allow 130.193.37.96/27;
    allow 130.193.45.128/27;
    allow 141.8.144.192/26;
    allow 141.8.175.64/26;
    allow 141.8.175.128/26;
    allow 178.154.191.32/28;
    allow 178.154.201.192/26;
    allow 178.154.228.0/22;
    allow 213.180.195.0/24;
    allow 213.180.202.0/24;
    allow 213.180.203.80/28;
    allow 213.180.203.96/27;
    allow 213.180.203.192/26;
    allow 213.180.206.16/28;
    allow 213.180.216.0/22;
    allow 213.180.220.96/27;
    allow 2620:10f:d000:101::/64;
    allow 2a02:6b8:0:101::/64;
    allow 2a02:6b8:0:103::/64;
    allow 2a02:6b8:0:105::/64;
    allow 2a02:6b8:0:106::/64;
    allow 2a02:6b8:0:107::/64;
    allow 2a02:6b8:0:108::/64;
    allow 2a02:6b8:0:10a::/64;
    allow 2a02:6b8:0:21a::/64;
    allow 2a02:6b8:0:21b::/64;
    allow 2a02:6b8:0:21f::/64;
    allow 2a02:6b8:0:401::/64;
    allow 2a02:6b8:0:402::/64;
    allow 2a02:6b8:0:405::/64;
    allow 2a02:6b8:0:406::/64;
    allow 2a02:6b8:0:407::/64;
    allow 2a02:6b8:0:408::/64;
    allow 2a02:6b8:0:409::/64;
    allow 2a02:6b8:0:40a::/64;
    allow 2a02:6b8:0:40c::/64;
    allow 2a02:6b8:0:40e::/64;
    allow 2a02:6b8:0:414::/64;
    allow 2a02:6b8:0:81f::/64;
    allow 2a02:6b8:0:c33::/64;
    allow 2a02:6b8:0:c41::/64;
    allow 2a02:6b8:0:1224::/64;
    allow 2a02:6b8:0:1495::/64;
    allow 2a02:6b8:0:2307::/64;
    allow 2a02:6b8:0:2308::/64;
    allow 2a02:6b8:0:2309::/64;
    allow 2a02:6b8:0:230a::/64;
    allow 2a02:6b8:0:230f::/64;
    allow 2a02:6b8:0:2311::/64;
    allow 2a02:6b8:0:250f::/64;
    allow 2a02:6b8:0:2704::/64;
    allow 2a02:6b8:0:2807::/64;
    allow 2a02:6b8:0:2809::/64;
    allow 2a02:6b8:0:2903::/64;
    allow 2a02:6b8:0:2e03::/64;
    allow 2a02:6b8:0:2f03::/64;
    allow 2a02:6b8:0:3201::/64;
    allow 2a02:6b8:0:3202::/64;
    allow 2a02:6b8:0:3204::/64;
    allow 2a02:6b8:0:3205::/64;
    allow 2a02:6b8:0:3207::/64;
    allow 2a02:6b8:0:3208::/64;
    allow 2a02:6b8:0:3209::/64;
    allow 2a02:6b8:0:320a::/64;
    allow 2a02:6b8:0:320b::/64;
    allow 2a02:6b8:0:320c::/64;
    allow 2a02:6b8:0:3303::/64;
    allow 66.116.119.181/32;
    allow 100.43.67.254/32;
    allow 100.43.71.254/32;
    allow 100.43.75.254/32;
    allow 100.43.77.254/32;
    allow 100.43.78.6/32;
    allow 100.43.78.30/32;
    allow 130.193.35.254/32;
    allow 130.193.37.254/32;
    allow 130.193.60.254/32;
    allow 130.193.61.254/32;
    allow 199.21.96.254/32;
    allow 199.21.98.126/32;
    allow 199.21.98.158/32;
    allow 199.21.98.162/32;
    allow 199.21.98.190/32;
    allow 199.21.98.194/32;
    allow 199.21.99.2/32;
    allow 199.36.240.126/32;
    allow 199.36.240.254/32;
    allow 199.36.243.254/32;
    allow 2620:10f:d000:100::1/128;
    allow 77.75.155.87/32;
    allow 77.75.159.30/32;
    allow 84.201.167.136;
    allow 95.108.188.6;
    allow 84.201.161.244;
    allow 37.9.65.192/27;
    allow 84.201.146.96/27;
    allow 84.201.148.32/29;
    allow 84.201.149.48/28;
    allow 2a02:6b8:0:22f::/64;
    allow 2a02:6b8:0:827::/64;
    allow 2a02:6b8:0:c21::/64;
    allow 2a02:6b8:0:1418::/64;
    allow 84.201.160.0/23;
    allow 2a02:6b8:0:2f03::/64;
    allow 178.154.154.0/24;
    deny all;

}

