server {
    include listen;

    server_name ~^tv-bko\d\d\w\.(unstable\.|tst\.)?(content)?\.yandex(-team)?\.(net|ru)$;
    server_name  ~^tv-backoffice\.(tst\.)?yandex(-team)?\.ru$;
    server_name tv-backoffice.yandex-team.ru;

    location = /ping {
        return 200;
    }

    location / {
        return 301 https://$host$request_uri;
    }
}


server {
    include listen_ssl;
    include xscripts/yt;

    ssl_certificate ssl/tv-backoffice.yandex-team.ru.crt;
    ssl_certificate_key ssl/tv-backoffice.yandex-team.ru.key;

    server_name  ~^tv-backoffice\.(tst\.)?(content\.|tv\.)?yandex(-team)?\.(net|ru)$;
    server_name tv-backoffice.yandex-team.ru;

    root /usr/local/www5/tv-bo-view;
    index index.xml index.html index.htm;

    proxy_redirect     off;
    proxy_set_header   Host             $host;
    proxy_set_header   X-Real-IP        $remote_addr;
    proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
    proxy_set_header   X-Forwarded-Proto https;
    proxy_connect_timeout      60;
    proxy_send_timeout         1800;
    proxy_read_timeout         1800;
    proxy_buffer_size          16k;
    proxy_buffers              16 128k;

    client_max_body_size       100m;
    client_body_buffer_size    256k;

    large_client_header_buffers 4 8k;
    gzip_types       text/plain text/css application/x-javascript text/xml application/xml application/xml+rss text/javascript;

    location = /ping {
        return 200;
    }

    location ^~/wizard-exports  {
        alias     /var/lib/yandex/kino-tv-bko/exports/current; 
        autoindex on;
    }
}
