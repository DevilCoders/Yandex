- hosts: localhost
  gather_facts: False
  vars:
    host: weather-stable-admin
    type: production
    host_tags:
      - stable

  pre_tasks:
    - juggler_facts: jserver_api={{ jserver_search_api }}
    - include_vars: "vars"
  post_tasks:
    - juggler_cleanup: #jcheck_mark={{ host }} # commented for clean up all checks made with playbook

  tasks:
    - include: tasks/unreachable.yml
    - include: tasks/common-check.yml
    - include: tasks/specific-check.yml
      vars:
        checks:
          - iptables_reject
          - push-client-status
          - cert_expires
    - include: tasks/specific-check.yml
      vars:
        checks:
          - nginx-50x
        night_percent: "0%"
        notifications:
          - template: golem
          - template: on_status_change
            golem_responsible: yes
    - include: tasks/specific-check.yml
      vars:
        checks:
          - celery-queue-status
          - lag-check-vector
          - weather-tile
          - page_parse_check
        night_percent: "0%"
        notifications:
          - template: golem
          - template: on_status_change
            golem_responsible: no
            method: [telegram]
            login: [weather_snafu]
            status: "{{ statuses_warning }}"
          - template: on_status_change
            golem_responsible: no
            method: [telegram]
            login: [weather_fubar]
            status: "{{ statuses_critical }}"
    - include: tasks/specific-check.yml
      vars:
        checks:
          - failed-log-parsing
        type: testing
    - include: tasks/specific-check.yml
      vars:
        checks:
          - weather_beat_check
          - weather_beat_alive
        night_percent: "0%"
        notifications:
          - template: golem
          - template: on_status_change
            golem_responsible: no
            method: [telegram]
            login: [weather_fubar]
            status: "{{ statuses_critical }}"
        custom_flap:
          stable: 180
          critical: 600
